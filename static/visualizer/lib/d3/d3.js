define(["d3"],function(a){return a.parcoords=function(b){function c(b,c,d){a.keys(c).forEach(function(a){b[a]=function(e){if(!arguments.length)return c[a];var f=c[a];return c[a]=e,D[a].call(s,{value:e,previous:f}),d[a].call(s,{value:e,previous:f}),b}})}function d(a,b){for(key in b)a[key]=b[key];return a}function e(b){var c=a.map(),d=a.map();return q.data.forEach(function(a){var c=y[b](a[b]);d.has(c)||d.set(c,0);var e=d.get(c);d.set(c,e+1)}),q.data.forEach(function(e){q.dimensions.map(function(f){var g=y[b](e[b]);if(!c.has(g)){var h=a.map();c.set(g,h)}c.get(g).has(f)||c.get(g).set(f,0);var i=c.get(g).get(f);i+=y[f](e[f])/d.get(g),c.get(g).set(f,i)})}),c}function f(a){for(var b=[],c=q.dimensions,d=c.length,e=.5,f=0;d>f;++f){var g=p(c[f]),h=y[c[f]](a[c[f]]);if(b.push($V([g,h])),d-1>f){var i=g+e*(p(c[f+1])-g),j=h+e*(y[c[f+1]](a[c[f+1]])-h);if(null!==q.bundleDimension){var k=q.clusterCentroids.get(y[q.bundleDimension](a[q.bundleDimension])).get(c[f]),l=q.clusterCentroids.get(y[q.bundleDimension](a[q.bundleDimension])).get(c[f+1]),m=.5*(k+l);j=m+(1-q.bundlingStrength)*(j-m)}b.push($V([i,j]))}}return b}function g(a){var b=a.length,c=q.smoothness,d=[];d.push(a[0]),d.push($V([a[0].e(1)+2*c*(a[1].e(1)-a[0].e(1)),a[0].e(2)]));for(var e=1;b-1>e;++e){var f=a[e],g=a[e-1],h=a[e+1],i=g.subtract(h);d.push(f.add(i.x(c))),d.push(f),d.push(f.subtract(i.x(c)))}return d.push($V([a[b-1].e(1)+2*c*(a[b-2].e(1)-a[b-1].e(1)),a[b-1].e(2)])),d.push(a[b-1]),d}function h(a,b){var c=f(a),d=g(c);b.moveTo(d[0].e(1),d[0].e(2));for(var e=1;e<d.length;e+=3){if(q.showControlPoints)for(var h=0;3>h;h++)b.fillRect(d[e+h].e(1),d[e+h].e(2),2,2);b.bezierCurveTo(d[e].e(1),d[e].e(2),d[e+1].e(1),d[e+1].e(2),d[e+2].e(1),d[e+2].e(2))}}function i(b,c){c.strokeStyle=a.functor(q.color)(b),c.beginPath(),null===q.bundleDimension||0===q.bundlingStrength&&0==q.smoothness?k(b,c):h(b,c),c.stroke()}function j(a,b){b.clearRect(-1,-1,u()+2,v()+2),b.beginPath(),a.forEach(function(a){null===q.bundleDimension||0===q.bundlingStrength&&0==q.smoothness?k(a,b):h(a,b)}),b.stroke()}function k(a,b){q.dimensions.map(function(c,d){0==d?b.moveTo(p(c),y[c](a[c])):b.lineTo(p(c),y[c](a[c]))})}function l(a){return i(a,B.foreground)}function m(a){return i(a,B.highlight)}function n(a){return!y[a].brush.empty()}function o(){var a=q.dimensions.filter(n),b=a.map(function(a){return y[a].brush.extent()}),c={date:function(a,c,d){return b[d][0]<=a[c]&&a[c]<=b[d][1]},number:function(a,c,d){return b[d][0]<=a[c]&&a[c]<=b[d][1]},string:function(a,c,d){return b[d][0]<=y[c](a[c])&&y[c](a[c])<=b[d][1]}};return q.data.filter(function(b){return a.every(function(a,d){return c[q.types[a]](b,a,d)})})}function p(a){var b=z[a];return null==b?x(a):b}var q={data:[],dimensions:[],dimensionTitles:{},types:{},brushed:!1,mode:"default",rate:20,width:600,height:300,margin:{top:24,right:0,bottom:12,left:0},color:"#069",composite:"source-over",alpha:.7,bundlingStrength:.5,bundleDimension:null,smoothness:.25,showControlPoints:!1,hideAxis:[]};d(q,b);var r,s=function(b){return b=s.selection=a.select(b),q.width=b[0][0].clientWidth,q.height=b[0][0].clientHeight,["shadows","marks","foreground","highlight"].forEach(function(a){C[a]=b.append("canvas").attr("class",a)[0][0],B[a]=C[a].getContext("2d")}),s.svg=b.append("svg").attr("width",q.width).attr("height",q.height).append("svg:g").attr("transform","translate("+q.margin.left+","+q.margin.top+")"),s},t=a.dispatch.apply(this,["render","resize","highlight","brush"].concat(a.keys(q))),u=function(){return q.width-q.margin.right-q.margin.left},v=function(){return q.height-q.margin.top-q.margin.bottom},w={brushable:!1,reorderable:!1,axes:!1,interactive:!1,shadows:!1,debug:!1},x=a.scale.ordinal(),y={},z={},A=(a.svg.line(),a.svg.axis().orient("left").ticks(5)),B={},C={},D=a.dispatch.apply(this,a.keys(q)).on("composite",function(a){B.foreground.globalCompositeOperation=a.value}).on("alpha",function(a){B.foreground.globalAlpha=a.value}).on("width",function(){s.resize()}).on("height",function(){s.resize()}).on("margin",function(){s.resize()}).on("rate",function(a){E.rate(a.value)}).on("data",function(){w.shadows&&j(q.data,B.shadows)}).on("dimensions",function(){x.domain(q.dimensions),w.interactive&&s.render().updateAxes()}).on("bundleDimension",function(a){q.dimensions.length||s.detectDimensions(),q.dimensions[0]in y||s.autoscale(),"number"==typeof a.value?a.value<q.dimensions.length?q.bundleDimension=q.dimensions[a.value]:a.value<q.hideAxis.length&&(q.bundleDimension=q.hideAxis[a.value]):q.bundleDimension=a.value,q.clusterCentroids=e(q.bundleDimension)}).on("hideAxis",function(a){s.dimensions(_.without(q.dimensions,a.value))});s.state=q,s.flags=w,c(s,q,t),a.rebind(s,t,"on"),a.rebind(s,A,"ticks","orient","tickValues","tickSubdivide","tickSize","tickPadding","tickFormat"),s.autoscale=function(){var b={date:function(b){return a.time.scale().domain(a.extent(q.data,function(a){return a[b]?a[b].getTime():null})).range([v()+1,1])},number:function(b){return a.scale.linear().domain(a.extent(q.data,function(a){return+a[b]})).range([v()+1,1])},string:function(b){return a.scale.ordinal().domain(q.data.map(function(a){return a[b]})).rangePoints([v()+1,1])}};return q.dimensions.forEach(function(a){y[a]=b[q.types[a]](a)}),q.hideAxis.forEach(function(a){y[a]=b[q.types[a]](a)}),s.dimensions(s.dimensions().filter(function(a){var b=y[a].domain().length;return"string"==q.types[a]&&(b>60||2>b)?!1:!0})),x.rangePoints([0,u()],1),s.selection.selectAll("canvas").style("margin-top",q.margin.top+"px").style("margin-left",q.margin.left+"px").attr("width",u()+2).attr("height",v()+2),B.foreground.strokeStyle=q.color,B.foreground.lineWidth=1.4,B.foreground.globalCompositeOperation=q.composite,B.foreground.globalAlpha=q.alpha,B.highlight.lineWidth=3,B.shadows.strokeStyle="#dadada",this},s.scale=function(a,b){return y[a].domain(b),this},s.flip=function(a){return y[a].domain(y[a].domain().reverse()),this},s.commonScale=function(b,c){var d=c||"number";"undefined"==typeof b&&(b=!0);var e=q.dimensions.concat(q.hideAxis).filter(function(a){return q.types[a]==d});if(b){var f=a.extent(e.map(function(a){return y[a].domain()}).reduce(function(a,b){return a.concat(b)}));e.forEach(function(a){y[a].domain(f)})}else e.forEach(function(b){y[b].domain(a.extent(q.data,function(a){return+a[b]}))});return null!==q.bundleDimension&&s.bundleDimension(q.bundleDimension),this},s.detectDimensions=function(){return s.types(s.detectDimensionTypes(q.data)),s.dimensions(a.keys(s.types())),this},s.toType=function(a){return{}.toString.call(a).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},s.toTypeCoerceNumbers=function(a){return parseFloat(a)==a&&null!=a?"number":s.toType(a)},s.detectDimensionTypes=function(b){var c={};return a.keys(b[0]).forEach(function(a){c[a]=s.toTypeCoerceNumbers(b[0][a])}),c},s.render=function(){return q.dimensions.length||s.detectDimensions(),q.dimensions[0]in y||s.autoscale(),s.render[q.mode](),t.render.call(this),this},s.render.default=function(){s.clear("foreground"),q.brushed?q.brushed.forEach(l):q.data.forEach(l)};var E=a.renderQueue(l).rate(50).clear(function(){s.clear("foreground")});return s.render.queue=function(){E(q.brushed?q.brushed:q.data)},s.shadows=function(){return w.shadows=!0,q.data.length>0&&j(q.data,B.shadows),this},s.axisDots=function(){var b=s.ctx.marks;return b.globalAlpha=a.min([1/Math.pow(data.length,.5),1]),q.data.forEach(function(a){q.dimensions.map(function(c){b.fillRect(p(c)-.75,y[c](a[c])-.75,1.5,1.5)})}),this},s.clear=function(a){return B[a].clearRect(0,0,u()+2,v()+2),this},s.createAxes=function(){return r&&s.removeAxes(),r=s.svg.selectAll(".dimension").data(q.dimensions,function(a){return a}).enter().append("svg:g").attr("class","dimension").attr("transform",function(a){return"translate("+x(a)+")"}),r.append("svg:g").attr("class","axis").attr("transform","translate(0,0)").each(function(b){a.select(this).call(A.scale(y[b]))}).append("svg:text").attr({"text-anchor":"middle",y:0,transform:"translate(0,-12)",x:0,"class":"label"}).text(function(a){return a in q.dimensionTitles?q.dimensionTitles[a]:a}),w.axes=!0,this},s.removeAxes=function(){return r.remove(),this},s.updateAxes=function(){var b=s.svg.selectAll(".dimension").data(q.dimensions,function(a){return a});return b.enter().append("svg:g").attr("class","dimension").attr("transform",function(a){return"translate("+p(a)+")"}).style("opacity",0).append("svg:g").attr("class","axis").attr("transform","translate(0,0)").each(function(b){a.select(this).call(A.scale(y[b]))}).append("svg:text").attr({"text-anchor":"middle",y:0,transform:"translate(0,-12)",x:0,"class":"label"}).text(String),b.exit().remove(),r=s.svg.selectAll(".dimension"),r.transition().duration(1100).attr("transform",function(a){return"translate("+p(a)+")"}).style("opacity",1),s.svg.selectAll(".axis").transition().duration(1100).each(function(b){a.select(this).call(A.scale(y[b]))}),w.shadows&&j(q.data,B.shadows),this},s.brushable=function(){return r||s.createAxes(),r.append("svg:g").attr("class","brush").each(function(b){a.select(this).call(y[b].brush=a.svg.brush().y(y[b]).on("brushstart",function(){a.event.sourceEvent.stopPropagation()}).on("brush",s.brush))}).selectAll("rect").style("visibility",null).attr("x",-15).attr("width",30),w.brushable=!0,this},s.reorderable=function(){return r||s.createAxes(),r.style("cursor","move").call(a.behavior.drag().on("dragstart",function(a){z[a]=this.__origin__=x(a)}).on("drag",function(b){z[b]=Math.min(u(),Math.max(0,this.__origin__+=a.event.dx)),q.dimensions.sort(function(a,b){return p(a)-p(b)}),x.domain(q.dimensions),s.render(),r.attr("transform",function(a){return"translate("+p(a)+")"})}).on("dragend",function(b){delete this.__origin__,delete z[b],a.select(this).transition().attr("transform","translate("+x(b)+")"),s.render()})),w.reorderable=!0,this},s.adjacent_pairs=function(a){for(var b=[],c=0;c<a.length-1;c++)b.push([a[c],a[c+1]]);return b},s.interactive=function(){return w.interactive=!0,this},s.brush=function(){q.brushed=o(),t.brush.call(s,q.brushed),s.render()},s.xscale=x,s.yscale=y,s.ctx=B,s.canvas=C,s.g=function(){return r},s.brushReset=function(){return q.brushed=!1,r&&(r.selectAll(".brush").each(function(b){a.select(this).call(y[b].brush.clear())}),s.render()),this},s.resize=function(){return s.selection.select("svg").attr("width",q.width).attr("height",q.height),s.svg.attr("transform","translate("+q.margin.left+","+q.margin.top+")"),w.brushable&&s.brushReset(),s.autoscale(),r&&s.createAxes(),w.shadows&&j(q.data,B.shadows),w.brushable&&s.brushable(),w.reorderable&&s.reorderable(),t.resize.call(this,{width:q.width,height:q.height,margin:q.margin}),this},s.highlight=function(b){return s.clear("highlight"),a.select(C.foreground).classed("faded",!0),b.forEach(m),t.highlight.call(this,b),this},s.unhighlight=function(){return s.clear("highlight"),a.select(C.foreground).classed("faded",!1),this},s.intersection=function(a,b,c,d){return{x:((a.x*b.y-a.y*b.x)*(c.x-d.x)-(a.x-b.x)*(c.x*d.y-c.y*d.x))/((a.x-b.x)*(c.y-d.y)-(a.y-b.y)*(c.x-d.x)),y:((a.x*b.y-a.y*b.x)*(c.y-d.y)-(a.y-b.y)*(c.x*d.y-c.y*d.x))/((a.x-b.x)*(c.y-d.y)-(a.y-b.y)*(c.x-d.x))}},s.toString=function(){return"Parallel Coordinates: "+q.dimensions.length+" dimensions ("+a.keys(q.data[0]).length+" total) , "+q.data.length+" rows"},s.version="0.3.1",s},a.renderQueue=function(b){var c=[],d=10,e=function(){},f=0,g=function(a){a&&g.data(a),g.invalidate(),e(),g.render()};return g.render=function(){function e(){if(!h)return!0;if(f>c.length)return!0;var a=c.slice(f,f+d);f+=d,a.map(b)}f=0;var h=!0;g.invalidate=function(){h=!1},a.timer(e)},g.data=function(a){return g.invalidate(),c=a.slice(0),g},g.rate=function(a){return arguments.length?(d=a,g):d},g.remaining=function(){return c.length-f},g.clear=function(a){return arguments.length?(e=a,g):(e(),g)},g.invalidate=function(){},g},a}),define(["d3"],function(a){if(!a)throw"d3 wasn't included!";return function(){function b(b,c){var d=function(a,b){if(b(a),a.children)for(var c=a.children.length-1;c>=0;c--)d(a.children[c],b)};d(b[0],function(a){a.rootDist=(a.parent?a.parent.rootDist:0)+(a.length||0)});var e=b.map(function(a){return a.rootDist}),f=a.scale.linear().domain([0,a.max(e)]).range([0,c]);return d(b[0],function(a){a.y=f(a.rootDist)}),f}a.phylogram={},a.phylogram.rightAngleDiagonal=function(){function a(a){var d=a.source,e=a.target,f=((d.x+e.x)/2,(d.y+e.y)/2,[d,{x:e.x,y:d.y},e]);return f=f.map(b),c(f)}var b=function(a){return[a.y,a.x]},c=function(a){return"M"+a[0]+" "+a[1]+" "+a[2]};return a.projection=function(c){return arguments.length?(b=c,a):b},a.path=function(b){return arguments.length?(c=b,a):c},a},a.phylogram.radialRightAngleDiagonal=function(){return a.phylogram.rightAngleDiagonal().path(function(b){var c=b[0],d=b[1],e=b[2],f=Math.sqrt(c[0]*c[0]+c[1]*c[1]),g=a.phylogram.coordinateToAngle(c,f),h=a.phylogram.coordinateToAngle(d,f),i=Math.abs(h-g)>Math.PI?g>=h:h>g,j=0,k=0,l=i?0:1;return"M"+c+" A"+[f,f]+" "+j+" "+k+","+l+" "+d+"L"+e}).projection(function(a){var b=a.y,c=(a.x-90)/180*Math.PI;return[b*Math.cos(c),b*Math.sin(c)]})},a.phylogram.coordinateToAngle=function(a,b){var c=2*Math.PI,d=c/4,e=a[0]>=0?a[1]>=0?1:2:a[1]>=0?4:3,f=Math.abs(Math.asin(a[1]/b));switch(e){case 1:coordAngle=d-f;break;case 2:coordAngle=d+f;break;case 3:coordAngle=2*d+d-f;break;case 4:coordAngle=3*d+f}return coordAngle},a.phylogram.styleTreeNodes=function(a){a.selectAll("g.leaf.node").append("svg:circle").attr("r",4.5).attr("stroke","yellowGreen").attr("fill",function(a){return a.data&&a.data.$color?a.data.$color:"grey"}).attr("stroke","grey").attr("stroke-width","1px"),a.selectAll("g.root.node").append("svg:circle").attr("r",4.5).attr("fill","steelblue").attr("stroke","#369").attr("stroke-width","2px")},a.phylogram.build=function(c,d,e){e=e||{};var f=e.width||a.select(c).style("width")||a.select(c).attr("width"),g=e.height||a.select(c).style("height")||a.select(c).attr("height"),f=parseInt(f),g=parseInt(g),h=e.tree||a.layout.cluster().size([g,f]).sort(function(a){return a.children?a.children.length:-1}).children(e.children||function(a){return a.branchset}),i=e.diagonal||a.phylogram.rightAngleDiagonal(),j=e.vis||a.select(c).append("svg:svg").attr("width",f+300).attr("height",g+30).append("svg:g").attr("transform","translate(20, 20)"),d=h(d);if(e.skipBranchLengthScaling)var k=a.scale.linear().domain([0,f]).range([0,f]);else var k=b(d,f);e.skipTicks||(j.selectAll("line").data(k.ticks(10)).enter().append("svg:line").attr("y1",0).attr("y2",g).attr("x1",k).attr("x2",k).attr("stroke","#ddd"),j.selectAll("text.rule").data(k.ticks(10)).enter().append("svg:text").attr("class","rule").attr("x",k).attr("y",0).attr("dy",-3).attr("text-anchor","middle").attr("font-size","8px").attr("fill","#ccc").text(function(a){return Math.round(100*a)/100}));j.selectAll("path.link").data(h.links(d)).enter().append("svg:path").attr("class","link").attr("d",i).attr("fill","none").attr("stroke","#aaa").attr("stroke-width","4px").on("click",function(a){e.callbackClickBranch&&e.callbackClickBranch(a)}).on("mouseover",function(a){e.callbackMouseOverBranch&&e.callbackMouseOverBranch(a)}).on("mouseout",function(a){e.callbackMouseOverBranch&&e.callbackMouseOverBranch(a)}),j.selectAll("g.node").data(d).enter().append("svg:g").attr("class",function(a){return a.children?0==a.depth?"root node":"inner node":"leaf node"}).attr("transform",function(a){return"translate("+a.y+","+a.x+")"}).on("click",function(a){e.callbackClickLeaf&&e.callbackClickLeaf(a)}).on("mouseover",function(a){e.callbackMouseOverLeaf&&e.callbackMouseOverLeaf(a)}).on("mouseout",function(a){e.callbackMouseOutLeaf&&e.callbackMouseOutLeaf(a)});return a.phylogram.styleTreeNodes(j),e.skipLabels||(j.selectAll("g.inner.node").append("svg:text").attr("dx",-6).attr("dy",-6).attr("text-anchor","end").attr("font-size","8px").attr("fill","#ccc").text(function(a){return a.length}),j.selectAll("g.leaf.node").append("svg:text").attr("dx",8).attr("dy",3).attr("text-anchor","start").attr("font-family","Helvetica Neue, Helvetica, sans-serif").attr("font-size","10px").attr("fill","black").text(function(a){return a.data?a.data.label:void 0})),{tree:h,vis:j}},a.phylogram.buildRadial=function(b,c,d){d=d||{};{var e=d.width||a.select(b).style("width")||a.select(b).attr("width"),f=e/2,g=d.skipLabels?10:d.labelWidth||120,h=a.select(b).append("svg:svg").attr("width",2*f).attr("height",2*f).append("svg:g").attr("transform","translate("+f+","+f+")"),i=a.layout.tree().size([360,f-g]).sort(function(a){return a.children?a.children.length:-1}).children(d.children||function(a){return a.branchset}).separation(function(a,b){return(a.parent==b.parent?1:2)/a.depth});a.phylogram.build(b,c,{vis:h,tree:i,skipBranchLengthScaling:!0,skipTicks:!0,skipLabels:d.skipLabels,diagonal:a.phylogram.radialRightAngleDiagonal()})}return h.selectAll("g.node").attr("transform",function(a){return"rotate("+(a.x-90)+")translate("+a.y+")"}),d.skipLabels||(h.selectAll("g.leaf.node text").attr("dx",function(a){return a.x<180?8:-8}).attr("dy",".31em").attr("text-anchor",function(a){return a.x<180?"start":"end"}).attr("transform",function(a){return a.x<180?null:"rotate(180)"}).attr("font-family","Helvetica Neue, Helvetica, sans-serif").attr("font-size","10px").attr("fill","black").text(function(a){return a.data.name}),h.selectAll("g.inner.node text").attr("dx",function(a){return a.x<180?-6:6}).attr("text-anchor",function(a){return a.x<180?"end":"start"}).attr("transform",function(a){return a.x<180?null:"rotate(180)"})),{tree:i,vis:h}}}(),a});
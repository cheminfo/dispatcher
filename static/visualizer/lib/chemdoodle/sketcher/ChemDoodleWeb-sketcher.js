ChemDoodle.sketcher=function(){var a={actions:{},gui:{}};return a.gui.desktop={},a.gui.mobile={},a.states={},a}(),function(a){a._Action=function(){return this.forward=function(a){this.innerForward(),this.checks(a)},this.reverse=function(a){this.innerReverse(),this.checks(a)},this.checks=function(a){a.molecule.check(),a.repaint()},!0}}(ChemDoodle.sketcher.actions),function(a,b){a.AddAction=function(a,b,c){return this.mol=a,this.as=b,this.bs=c,!0},a.AddAction.prototype=new a._Action,a.AddAction.prototype.innerForward=function(){if(null!=this.as)for(var a=0,b=this.as.length;b>a;a++)this.mol.atoms.push(this.as[a]);if(null!=this.bs)for(a=0,b=this.bs.length;b>a;a++)this.mol.bonds.push(this.bs[a])},a.AddAction.prototype.innerReverse=function(){if(null!=this.as){for(var a=[],c=0,d=this.mol.atoms.length;d>c;c++)-1==b(this.mol.atoms[c],this.as)&&a.push(this.mol.atoms[c]);this.mol.atoms=a}if(null!=this.bs){for(a=[],c=0,d=this.mol.bonds.length;d>c;c++)-1==b(this.mol.bonds[c],this.bs)&&a.push(this.mol.bonds[c]);this.mol.bonds=a}}}(ChemDoodle.sketcher.actions,jQuery.inArray),function(a,b){a.ChangeBondAction=function(a,c,d){return this.b=a,this.orderBefore=a.bondOrder,this.stereoBefore=a.stereo,c?(this.orderAfter=c,this.stereoAfter=d):(this.orderAfter=a.bondOrder+1,3<this.orderAfter&&(this.orderAfter=1),this.stereoAfter=b.STEREO_NONE),!0},a.ChangeBondAction.prototype=new a._Action,a.ChangeBondAction.prototype.innerForward=function(){this.b.bondOrder=this.orderAfter,this.b.stereo=this.stereoAfter},a.ChangeBondAction.prototype.innerReverse=function(){this.b.bondOrder=this.orderBefore,this.b.stereo=this.stereoBefore}}(ChemDoodle.sketcher.actions,ChemDoodle.structures.Bond),function(a){a.ChangeChargeAction=function(a,b){return this.a=a,this.delta=b,!0},a.ChangeChargeAction.prototype=new a._Action,a.ChangeChargeAction.prototype.innerForward=function(){this.a.charge+=this.delta},a.ChangeChargeAction.prototype.innerReverse=function(){this.a.charge-=this.delta}}(ChemDoodle.sketcher.actions),function(a){a.ChangeCoordinatesAction=function(a,b){this.as=a,this.recs=[];for(var c=0,d=this.as.length;d>c;c++)this.recs[c]={xo:this.as[c].x,yo:this.as[c].y,xn:b[c].x,yn:b[c].y};return!0},a.ChangeCoordinatesAction.prototype=new a._Action,a.ChangeCoordinatesAction.prototype.innerForward=function(){for(var a=0,b=this.as.length;b>a;a++)this.as[a].x=this.recs[a].xn,this.as[a].y=this.recs[a].yn},a.ChangeCoordinatesAction.prototype.innerReverse=function(){for(var a=0,b=this.as.length;b>a;a++)this.as[a].x=this.recs[a].xo,this.as[a].y=this.recs[a].yo}}(ChemDoodle.sketcher.actions),function(a){a.ChangeLabelAction=function(a,b){return this.a=a,this.before=a.label,this.after=b,!0},a.ChangeLabelAction.prototype=new a._Action,a.ChangeLabelAction.prototype.innerForward=function(){this.a.label=this.after},a.ChangeLabelAction.prototype.innerReverse=function(){this.a.label=this.before}}(ChemDoodle.sketcher.actions),function(a){a.ChangeLonePairAction=function(a,b){return this.a=a,this.delta=b,!0},a.ChangeLonePairAction.prototype=new a._Action,a.ChangeLonePairAction.prototype.innerForward=function(){this.a.numLonePair+=this.delta},a.ChangeLonePairAction.prototype.innerReverse=function(){this.a.numLonePair-=this.delta}}(ChemDoodle.sketcher.actions),function(a){a.ClearAction=function(a){return this.sketcher=a,this.before=this.sketcher.getMolecule(),this.sketcher.clear(),this.after=this.sketcher.getMolecule(),!0},a.ClearAction.prototype=new a._Action,a.ClearAction.prototype.innerForward=function(){this.sketcher.molecule=this.after},a.ClearAction.prototype.innerReverse=function(){this.sketcher.molecule=this.before}}(ChemDoodle.sketcher.actions),function(a){a.DeleteAction=function(a,b,c){return this.mol=a,this.as=b,this.bs=c,!0},a.DeleteAction.prototype=new a._Action,a.DeleteAction.prototype.innerForward=a.AddAction.prototype.innerReverse,a.DeleteAction.prototype.innerReverse=a.AddAction.prototype.innerForward}(ChemDoodle.sketcher.actions),function(a){a.FlipBondAction=function(a){return this.b=a,!0},a.FlipBondAction.prototype=new a._Action,a.FlipBondAction.prototype.innerForward=function(){var a=this.b.a1;this.b.a1=this.b.a2,this.b.a2=a},a.FlipBondAction.prototype.innerReverse=function(){this.innerForward()}}(ChemDoodle.sketcher.actions),function(a){a.MoveAction=function(a,b){return this.as=a,this.dif=b,!0},a.MoveAction.prototype=new a._Action,a.MoveAction.prototype.innerForward=function(){for(var a=0,b=this.as.length;b>a;a++)this.as[a].add(this.dif)},a.MoveAction.prototype.innerReverse=function(){for(var a=0,b=this.as.length;b>a;a++)this.as[a].sub(this.dif)}}(ChemDoodle.sketcher.actions),function(a,b){a.RotateAction=function(a,b,c){return this.as=a,this.dif=b,this.center=c,!0},a.RotateAction.prototype=new a._Action,a.RotateAction.prototype.innerForward=function(){for(var a=0,c=this.as.length;c>a;a++){var d=this.center.distance(this.as[a]),e=this.center.angle(this.as[a])+this.dif;this.as[a].x=this.center.x+d*b.cos(e),this.as[a].y=this.center.y-d*b.sin(e)}},a.RotateAction.prototype.innerReverse=function(){for(var a=0,c=this.as.length;c>a;a++){var d=this.center.distance(this.as[a]),e=this.center.angle(this.as[a])-this.dif;this.as[a].x=this.center.x+d*b.cos(e),this.as[a].y=this.center.y-d*b.sin(e)}}}(ChemDoodle.sketcher.actions,Math),function(a){a.SwitchMoleculeAction=function(a,b){return this.sketcher=a,this.molB=a.molecule,this.molA=b,!0},a.SwitchMoleculeAction.prototype=new a._Action,a.SwitchMoleculeAction.prototype.innerForward=function(){this.sketcher.loadMolecule(this.molA)},a.SwitchMoleculeAction.prototype.innerReverse=function(){this.sketcher.molecule=this.molB}}(ChemDoodle.sketcher.actions,jQuery.inArray),function(a){a.HistoryManager=function(a){return this.sketcher=a,this.undoStack=[],this.redoStack=[],!0},a.HistoryManager.prototype.undo=function(){if(0!=this.undoStack.length){var a=this.undoStack.pop();a.reverse(this.sketcher),this.redoStack.push(a),0==this.undoStack.length&&this.sketcher.toolbarManager.buttonUndo.disable(),this.sketcher.toolbarManager.buttonRedo.enable()}},a.HistoryManager.prototype.redo=function(){if(0!=this.redoStack.length){var a=this.redoStack.pop();a.forward(this.sketcher),this.undoStack.push(a),this.sketcher.toolbarManager.buttonUndo.enable(),0==this.redoStack.length&&this.sketcher.toolbarManager.buttonRedo.disable()}},a.HistoryManager.prototype.pushUndo=function(a){a.forward(this.sketcher),this.undoStack.push(a),0!=this.redoStack.length&&(this.redoStack=[]),this.sketcher.toolbarManager.buttonUndo.enable(),this.sketcher.toolbarManager.buttonRedo.disable()},a.HistoryManager.prototype.clear=function(){0!=this.undoStack.length&&(this.undoStack=[],this.sketcher.toolbarManager.buttonUndo.disable()),0!=this.redoStack.length&&(this.redoStack=[],this.sketcher.toolbarManager.buttonRedo.disable())}}(ChemDoodle.sketcher.actions),function(a,b,c,d,e,f,g,h){d._State=function(){return!0},d._State.prototype.setup=function(a){this.sketcher=a},d._State.prototype.bondExists=function(a,b){for(var c=0,d=this.sketcher.molecule.bonds.length;d>c;c++)if(this.sketcher.molecule.bonds[c].contains(a)&&this.sketcher.molecule.bonds[c].contains(b))return!0;return!1},d._State.prototype.getBond=function(a,b){for(var c=0,d=this.sketcher.molecule.bonds.length;d>c;c++)if(this.sketcher.molecule.bonds[c].contains(a)&&this.sketcher.molecule.bonds[c].contains(b))return this.sketcher.molecule.bonds[c];return null},d._State.prototype.clearHover=function(){null!=this.sketcher.hovering&&(this.sketcher.hovering.isHover=!1,this.sketcher.hovering.isSelected=!1),this.sketcher.hovering=null},d._State.prototype.findHoveredObject=function(a,b,c){this.clearHover();var d=1/0,e=null;if(b)for(var b=0,f=this.sketcher.molecule.atoms.length;f>b;b++){this.sketcher.molecule.atoms[b].isHover=!1;var g=a.p.distance(this.sketcher.molecule.atoms[b]);g<this.sketcher.specs.bondLength&&d>g&&(d=g,e=this.sketcher.molecule.atoms[b])}if(c)for(b=0,f=this.sketcher.molecule.bonds.length;f>b;b++)this.sketcher.molecule.bonds[b].isHover=!1,g=a.p.distance(this.sketcher.molecule.bonds[b].getCenter()),g<this.sketcher.specs.bondLength&&d>g&&(d=g,e=this.sketcher.molecule.bonds[b]);null!=e&&(e.isHover=!0,this.sketcher.hovering=e)},d._State.prototype.getOptimumAngle=function(b){var b=this.sketcher.molecule.getAngles(b),c=0;if(0==b.length)c=h.PI/6;else if(1==b.length){for(var c=null,d=0,e=this.sketcher.molecule.bonds.length;e>d;d++)this.sketcher.molecule.bonds[d].contains(this.sketcher.hovering)&&(c=this.sketcher.molecule.bonds[d]);3<=c.bondOrder?c=b[0]+h.PI:(c=2*(b[0]%h.PI),c=a.isBetween(c,0,h.PI/2)||a.isBetween(c,h.PI,3*h.PI/2)?b[0]+2*h.PI/3:b[0]-2*h.PI/3)}else c=a.angleBetweenLargest(b).angle;return c},d._State.prototype.click=function(a){this.innerclick&&this.innerclick(a)},d._State.prototype.rightclick=function(a){this.innerrightclick&&this.innerrightclick(a)},d._State.prototype.dblclick=function(a){this.innerdblclick&&this.innerdblclick(a),null==this.sketcher.hovering&&(a=new e.Point(this.sketcher.width/2,this.sketcher.height/2),a.sub(this.sketcher.molecule.getCenter()),this.sketcher.historyManager.pushUndo(new c.MoveAction(this.sketcher.molecule.atoms,a)))},d._State.prototype.mousedown=function(a){this.sketcher.lastPoint=a.p,this.sketcher.isHelp||this.sketcher.isMobile&&10>a.op.distance(this.sketcher.helpPos)?(this.sketcher.isHelp=!1,this.sketcher.repaint(),window.open("http://web.chemdoodle.com/sketcher")):this.innermousedown&&this.innermousedown(a)},d._State.prototype.rightmousedown=function(a){this.innerrightmousedown&&this.innerrightmousedown(a)},d._State.prototype.mousemove=function(a){this.innermousemove&&this.innermousemove(a),this.sketcher.repaint()},d._State.prototype.mouseout=function(a){this.innermouseout&&this.innermouseout(a)},d._State.prototype.mouseover=function(a){this.innermouseover&&this.innermouseover(a)},d._State.prototype.mouseup=function(a){this.parentAction=null,this.innermouseup&&this.innermouseup(a)},d._State.prototype.rightmouseup=function(a){this.innerrightmouseup&&this.innerrightmouseup(a)},d._State.prototype.mousewheel=function(a,b){this.innermousewheel&&this.innermousewheel(a),this.sketcher.specs.scale+=b/10,this.sketcher.checkScale(),this.sketcher.repaint()},d._State.prototype.drag=function(a){if(this.innerdrag&&this.innerdrag(a),null==this.sketcher.hovering){if(b.SHIFT){var d=new e.Point(this.sketcher.width/2,this.sketcher.height/2),f=d.angle(this.sketcher.lastPoint),g=d.angle(a.p)-f;if(null==this.parentAction)this.parentAction=new c.RotateAction(this.sketcher.molecule.atoms,g,d),this.sketcher.historyManager.pushUndo(this.parentAction);else{this.parentAction.dif+=g;for(var f=0,i=this.sketcher.molecule.atoms.length;i>f;f++){var j=d.distance(this.sketcher.molecule.atoms[f]),k=d.angle(this.sketcher.molecule.atoms[f])+g;this.sketcher.molecule.atoms[f].x=d.x+j*h.cos(k),this.sketcher.molecule.atoms[f].y=d.y-j*h.sin(k)}this.sketcher.molecule.check()}}else{if(!this.sketcher.lastPoint)return;if(d=new e.Point(a.p.x,a.p.y),d.sub(this.sketcher.lastPoint),null==this.parentAction)this.parentAction=new c.MoveAction(this.sketcher.molecule.atoms,d),this.sketcher.historyManager.pushUndo(this.parentAction);else{for(this.parentAction.dif.add(d),f=0,i=this.sketcher.molecule.atoms.length;i>f;f++)this.sketcher.molecule.atoms[f].add(d);this.sketcher.molecule.check()}}this.sketcher.repaint()}this.sketcher.lastPoint=a.p},d._State.prototype.keydown=function(d){if(b.CANVAS_DRAGGING==this.sketcher)null!=this.sketcher.lastPoint&&(d.p=this.sketcher.lastPoint,this.drag(d));else if(b.META)90==d.which?this.sketcher.historyManager.undo():89==d.which?this.sketcher.historyManager.redo():83==d.which?this.sketcher.toolbarManager.buttonSave.getElement().click():79==d.which?this.sketcher.toolbarManager.buttonOpen.getElement().click():78==d.which?this.sketcher.toolbarManager.buttonClear.getElement().click():187==d.which||61==d.which?this.sketcher.toolbarManager.buttonScalePlus.getElement().click():(189==d.which||109==d.which)&&this.sketcher.toolbarManager.buttonScaleMinus.getElement().click();else if(37<=d.which&&40>=d.which){var i=new e.Point;switch(d.which){case 37:i.x=-10;break;case 38:i.y=-10;break;case 39:i.x=10;break;case 40:i.y=10}this.sketcher.historyManager.pushUndo(new c.MoveAction(this.sketcher.molecule.atoms,i))}else if(187==d.which||189==d.which||61==d.which||109==d.which)null!=this.sketcher.hovering&&this.sketcher.hovering instanceof e.Atom&&this.sketcher.historyManager.pushUndo(new c.ChangeChargeAction(this.sketcher.hovering,187==d.which||61==d.which?1:-1));else if(8==d.which||127==d.which)this.sketcher.stateManager.STATE_ERASE.handleDelete();else if(48<=d.which&&57>=d.which){if(null!=this.sketcher.hovering){var j=d.which-48,i=[],k=[];if(this.sketcher.hovering instanceof e.Atom)if(b.SHIFT){if(j>2&&9>j){var l=this.sketcher.molecule.getAngles(this.sketcher.hovering),m=3*h.PI/2;for(0!=l.length&&(m=a.angleBetweenLargest(l).angle),m=this.sketcher.stateManager.STATE_NEW_RING.getRing(this.sketcher.hovering,j,this.sketcher.specs.bondLength,m,!1),-1==g(m[0],this.sketcher.molecule.atoms)&&i.push(m[0]),this.bondExists(this.sketcher.hovering,m[0])||k.push(new e.Bond(this.sketcher.hovering,m[0])),l=1,j=m.length;j>l;l++)-1==g(m[l],this.sketcher.molecule.atoms)&&i.push(m[l]),this.bondExists(m[l-1],m[l])||k.push(new e.Bond(m[l-1],m[l]));this.bondExists(m[m.length-1],this.sketcher.hovering)||k.push(new e.Bond(m[m.length-1],this.sketcher.hovering))}}else{0==j&&(j=10);for(var n=new e.Point(this.sketcher.hovering.x,this.sketcher.hovering.y),o=this.getOptimumAngle(this.sketcher.hovering),p=this.sketcher.hovering,l=0;j>l;l++){m=o+(1==l%2?h.PI/3:0),n.x+=this.sketcher.specs.bondLength*h.cos(m),n.y-=this.sketcher.specs.bondLength*h.sin(m);for(var q=new e.Atom("C",n.x,n.y),r=1/0,s=null,m=0,t=this.sketcher.molecule.atoms.length;t>m;m++){var u=this.sketcher.molecule.atoms[m].distance(q);r>u&&(r=u,s=this.sketcher.molecule.atoms[m])}5>r?q=s:i.push(q),this.bondExists(p,q)||k.push(new e.Bond(p,q)),p=q}}else if(this.sketcher.hovering instanceof e.Bond)if(b.SHIFT){if(j>2&&9>j){for(m=this.sketcher.stateManager.STATE_NEW_RING.getOptimalRing(this.sketcher.hovering,j),l=this.sketcher.hovering.a2,t=this.sketcher.hovering.a1,m[0]==this.sketcher.hovering.a1&&(l=this.sketcher.hovering.a1,t=this.sketcher.hovering.a2),-1==g(m[1],this.sketcher.molecule.atoms)&&i.push(m[1]),this.bondExists(l,m[1])||k.push(new e.Bond(l,m[1])),l=2,j=m.length;j>l;l++)-1==g(m[l],this.sketcher.molecule.atoms)&&i.push(m[l]),this.bondExists(m[l-1],m[l])||k.push(new e.Bond(m[l-1],m[l]));this.bondExists(m[m.length-1],t)||k.push(new e.Bond(m[m.length-1],t))}}else j>0&&4>j&&this.sketcher.historyManager.pushUndo(new c.ChangeBondAction(this.sketcher.hovering,j,e.Bond.STEREO_NONE));(0!=i.length||0!=k.length)&&this.sketcher.historyManager.pushUndo(new c.AddAction(this.sketcher.molecule,i,k))}}else if(65<=d.which&&90>=d.which&&null!=this.sketcher.hovering)if(this.sketcher.hovering instanceof e.Atom){for(l=String.fromCharCode(d.which),k=i=null,j=!1,m=0,t=f.length;t>m;m++)if(this.sketcher.hovering.label.charAt(0)==l)f[m]==this.sketcher.hovering.label?j=!0:f[m].charAt(0)==l&&(j&&null==k?k=f[m]:null==i&&(i=f[m]));else if(f[m].charAt(0)==l){i=f[m];break}q="C",null!=k?q=k:null!=i&&(q=i),this.sketcher.historyManager.pushUndo(new c.ChangeLabelAction(this.sketcher.hovering,q))}else this.sketcher.hovering instanceof e.Bond&&70==d.which&&this.sketcher.historyManager.pushUndo(new c.FlipBondAction(this.sketcher.hovering));this.innerkeydown&&this.innerkeydown(d)},d._State.prototype.keypress=function(a){this.innerkeypress&&this.innerkeypress(a)},d._State.prototype.keyup=function(a){b.CANVAS_DRAGGING==this.sketcher&&null!=this.sketcher.lastPoint&&(a.p=this.sketcher.lastPoint,this.sketcher.drag(a)),this.innerkeyup&&this.innerkeyup(a)}}(ChemDoodle.math,ChemDoodle.monitor,ChemDoodle.sketcher.actions,ChemDoodle.sketcher.states,ChemDoodle.structures,ChemDoodle.SYMBOLS,jQuery.inArray,Math),function(a,b){b.ChargeState=function(a){return this.setup(a),this.delta=1,!0},b.ChargeState.prototype=new b._State,b.ChargeState.prototype.innermouseup=function(){null!=this.sketcher.hovering&&this.sketcher.historyManager.pushUndo(new a.ChangeChargeAction(this.sketcher.hovering,this.delta))},b.ChargeState.prototype.innermousemove=function(a){this.findHoveredObject(a,!0,!1)}}(ChemDoodle.sketcher.actions,ChemDoodle.sketcher.states),function(a,b,c,d){b.EraseState=function(a){return this.setup(a),!0},b.EraseState.prototype=new b._State,b.EraseState.prototype.handleDelete=function(){if(null!=this.sketcher.hovering){if(this.sketcher.hovering instanceof c.Atom){for(var b=0,e=this.sketcher.molecule.atoms.length;e>b;b++)this.sketcher.molecule.atoms[b].visited=!1;var f=[],g=[];for(this.sketcher.hovering.visited=!0,b=0,e=this.sketcher.molecule.bonds.length;e>b;b++)if(this.sketcher.molecule.bonds[b].contains(this.sketcher.hovering)){var h=[],i=[],j=new c.Queue;for(j.enqueue(this.sketcher.molecule.bonds[b].getNeighbor(this.sketcher.hovering));!j.isEmpty();){var k=j.dequeue();if(!k.visited){k.visited=!0,h.push(k);for(var l=0,m=this.sketcher.molecule.bonds.length;m>l;l++)this.sketcher.molecule.bonds[l].contains(k)&&!this.sketcher.molecule.bonds[l].getNeighbor(k).visited&&(j.enqueue(this.sketcher.molecule.bonds[l].getNeighbor(k)),i.push(this.sketcher.molecule.bonds[l]))}}f.push(h),g.push(i)}for(h=i=-1,b=0,e=f.length;e>b;b++)f[b].length>i&&(h=b,i=f[b].length);if(h>-1){for(b=[],e=[],i=0,j=this.sketcher.molecule.atoms.length;j>i;i++)-1==d(this.sketcher.molecule.atoms[i],f[h])&&b.push(this.sketcher.molecule.atoms[i]);for(i=0,j=this.sketcher.molecule.bonds.length;j>i;i++)-1==d(this.sketcher.molecule.bonds[i],g[h])&&e.push(this.sketcher.molecule.bonds[i]);this.sketcher.historyManager.pushUndo(new a.DeleteAction(this.sketcher.molecule,b,e))}else this.sketcher.historyManager.pushUndo(new a.ClearAction(this.sketcher))}else this.sketcher.hovering instanceof c.Bond&&null!=this.sketcher.hovering.ring&&(e=[],e[0]=this.sketcher.hovering,this.sketcher.historyManager.pushUndo(new a.DeleteAction(this.sketcher.molecule,null,e)));this.sketcher.repaint()}},b.EraseState.prototype.innermouseup=function(){this.handleDelete()},b.EraseState.prototype.innermousemove=function(a){this.findHoveredObject(a,!0,!0)}}(ChemDoodle.sketcher.actions,ChemDoodle.sketcher.states,ChemDoodle.structures,jQuery.inArray),function(a,b){b.LabelState=function(a){return this.setup(a),this.label="C",!0},b.LabelState.prototype=new b._State,b.LabelState.prototype.innermouseup=function(){null!=this.sketcher.hovering&&this.sketcher.historyManager.pushUndo(new a.ChangeLabelAction(this.sketcher.hovering,this.label))},b.LabelState.prototype.innermousemove=function(a){this.findHoveredObject(a,!0,!1)}}(ChemDoodle.sketcher.actions,ChemDoodle.sketcher.states),function(a,b){b.LonePairState=function(a){return this.setup(a),this.delta=1,!0},b.LonePairState.prototype=new b._State,b.LonePairState.prototype.innermouseup=function(){0>this.delta&&1>this.sketcher.hovering.numLonePair||null!=this.sketcher.hovering&&this.sketcher.historyManager.pushUndo(new a.ChangeLonePairAction(this.sketcher.hovering,this.delta))},b.LonePairState.prototype.innermousemove=function(a){this.findHoveredObject(a,!0,!1)}}(ChemDoodle.sketcher.actions,ChemDoodle.sketcher.states),function(a,b,c){b.MoveState=function(a){return this.setup(a),this.action=null,!0},b.MoveState.prototype=new b._State,b.MoveState.prototype.innerdrag=function(b){if(null!=this.sketcher.hovering)if(null==this.action){var d=[],b=new c.Point(b.p.x,b.p.y);this.sketcher.hovering instanceof c.Atom?(b.sub(this.sketcher.hovering),d[0]=this.sketcher.hovering):this.sketcher.hovering instanceof c.Bond&&(b.sub(this.sketcher.lastPoint),d[0]=this.sketcher.hovering.a1,d[1]=this.sketcher.hovering.a2),this.action=new a.MoveAction(d,b),this.sketcher.historyManager.pushUndo(this.action)}else{b=new c.Point(b.p.x,b.p.y),b.sub(this.sketcher.lastPoint),this.action.dif.add(b);for(var d=0,e=this.action.as.length;e>d;d++)this.action.as[d].add(b);this.sketcher.molecule.check(),this.sketcher.repaint()}},b.MoveState.prototype.innermousemove=function(a){this.findHoveredObject(a,!0,!0)},b.MoveState.prototype.innermouseup=function(){this.action=null}}(ChemDoodle.sketcher.actions,ChemDoodle.sketcher.states,ChemDoodle.structures),function(a,b,c,d,e){c.NewBondState=function(a){return this.setup(a),this.bondOrder=1,this.stereo=d.Bond.STEREO_NONE,!0},c.NewBondState.prototype=new c._State,c.NewBondState.prototype.incrementBondOrder=function(a){1==this.bondOrder&&this.stereo==d.Bond.STEREO_NONE?this.sketcher.historyManager.pushUndo(new b.ChangeBondAction(a)):a.bondOrder==this.bondOrder&&a.stereo==this.stereo?(1==a.bondOrder&&a.stereo!=d.Bond.STEREO_NONE||2==a.bondOrder&&a.stereo==d.Bond.STEREO_NONE)&&this.sketcher.historyManager.pushUndo(new b.FlipBondAction(a)):this.sketcher.historyManager.pushUndo(new b.ChangeBondAction(a,this.bondOrder,this.stereo))},c.NewBondState.prototype.innerdrag=function(b){if(this.sketcher.hovering instanceof d.Atom){if(15>b.p.distance(this.sketcher.hovering)){var c=this.getOptimumAngle(this.sketcher.hovering),b=this.sketcher.hovering.x+this.sketcher.specs.bondLength*e.cos(c),c=this.sketcher.hovering.y-this.sketcher.specs.bondLength*e.sin(c);this.sketcher.tempAtom=new d.Atom("C",b,c,0)}else a.ALT&&a.SHIFT?this.sketcher.tempAtom=new d.Atom("C",b.p.x,b.p.y,0):(c=this.sketcher.hovering.angle(b.p),b=this.sketcher.hovering.distance(b.p),a.SHIFT||(b=this.sketcher.specs.bondLength),a.ALT||(c=e.floor((c+e.PI/12)/(e.PI/6))*e.PI/6),this.sketcher.tempAtom=new d.Atom("C",this.sketcher.hovering.x+b*e.cos(c),this.sketcher.hovering.y-b*e.sin(c),0));for(c=0,b=this.sketcher.molecule.atoms.length;b>c;c++)5>this.sketcher.molecule.atoms[c].distance(this.sketcher.tempAtom)&&(this.sketcher.tempAtom.x=this.sketcher.molecule.atoms[c].x,this.sketcher.tempAtom.y=this.sketcher.molecule.atoms[c].y,this.sketcher.tempAtom.isOverlap=!0);this.sketcher.repaint()}},c.NewBondState.prototype.innermousedown=function(a){this.sketcher.hovering instanceof d.Atom?(this.sketcher.hovering.isHover=!1,this.sketcher.hovering.isSelected=!0,this.drag(a)):this.sketcher.hovering instanceof d.Bond&&(this.sketcher.hovering.isHover=!1,this.incrementBondOrder(this.sketcher.hovering),this.sketcher.molecule.check(),this.sketcher.repaint())},c.NewBondState.prototype.innermouseup=function(a){if(null!=this.sketcher.tempAtom&&null!=this.sketcher.hovering){var c=[],e=[],f=!0;if(this.sketcher.tempAtom.isOverlap){for(var g=0,h=this.sketcher.molecule.atoms.length;h>g;g++)5>this.sketcher.molecule.atoms[g].distance(this.sketcher.tempAtom)&&(this.sketcher.tempAtom=this.sketcher.molecule.atoms[g]);g=this.getBond(this.sketcher.hovering,this.sketcher.tempAtom),null!=g&&(this.incrementBondOrder(g),f=!1)}else c.push(this.sketcher.tempAtom);f&&(e[0]=new d.Bond(this.sketcher.hovering,this.sketcher.tempAtom,this.bondOrder),e[0].stereo=this.stereo,this.sketcher.historyManager.pushUndo(new b.AddAction(this.sketcher.molecule,c,e)))}this.sketcher.tempAtom=null,this.sketcher.isMobile||this.mousemove(a)},c.NewBondState.prototype.innermousemove=function(a){null==this.sketcher.tempAtom&&this.findHoveredObject(a,!0,!0)}}(ChemDoodle.monitor,ChemDoodle.sketcher.actions,ChemDoodle.sketcher.states,ChemDoodle.structures,Math),function(a,b,c,d,e,f,g){d.NewRingState=function(a){return this.setup(a),this.numSides=6,this.unsaturated=!1,!0},d.NewRingState.prototype=new d._State,d.NewRingState.prototype.getRing=function(a,b,c,d,f){for(var h=g.PI-2*g.PI/b,d=d+h/2,i=[],j=0;b-1>j;j++){var k=0==j?new e.Atom("C",a.x,a.y):new e.Atom("C",i[i.length-1].x,i[i.length-1].y);k.x+=c*g.cos(d),k.y-=c*g.sin(d),i.push(k),d+=g.PI+h}for(a=0,b=this.sketcher.molecule.atoms.length;b>a;a++)this.sketcher.molecule.atoms[a].isOverlap=!1;for(j=0,c=i.length;c>j;j++){for(d=1/0,h=null,a=0,b=this.sketcher.molecule.atoms.length;b>a;a++)k=this.sketcher.molecule.atoms[a].distance(i[j]),d>k&&(d=k,h=this.sketcher.molecule.atoms[a]);5>d&&(i[j]=h,f&&(h.isOverlap=!0))}return i},d.NewRingState.prototype.getOptimalRing=function(a,b){for(var c=g.PI/2-g.PI/b,d=a.a1.distance(a.a2),e=this.getRing(a.a1,b,d,a.a1.angle(a.a2)-c,!1),c=this.getRing(a.a2,b,d,a.a2.angle(a.a1)-c,!1),f=d=0,h=1,i=e.length;i>h;h++)for(var j=0,k=this.sketcher.molecule.atoms.length;k>j;j++)var l=this.sketcher.molecule.atoms[j].distance(e[h]),m=this.sketcher.molecule.atoms[j].distance(c[h]),d=d+g.min(1e8,1/(l*l)),f=f+g.min(1e8,1/(m*m));return f>d?e:c},d.NewRingState.prototype.innerdrag=function(c){if(this.sketcher.hovering instanceof e.Atom){var d=0,h=0;15>c.p.distance(this.sketcher.hovering)?(c=this.sketcher.molecule.getAngles(this.sketcher.hovering),d=0==c.length?3*g.PI/2:a.angleBetweenLargest(c).angle,h=this.sketcher.specs.bondLength):(d=this.sketcher.hovering.angle(c.p),h=this.sketcher.hovering.distance(c.p),b.ALT&&b.SHIFT||(b.SHIFT||(h=this.sketcher.specs.bondLength),b.ALT||(d=g.floor((d+g.PI/12)/(g.PI/6))*g.PI/6))),this.sketcher.tempRing=this.getRing(this.sketcher.hovering,this.numSides,h,d,!0),this.sketcher.repaint()}else if(this.sketcher.hovering instanceof e.Bond){if(d=a.distanceFromPointToLineInclusive(c.p,this.sketcher.hovering.a1,this.sketcher.hovering.a2),h=null,-1!=d&&7>=d)h=this.getOptimalRing(this.sketcher.hovering,this.numSides);else{for(var h=g.PI/2-g.PI/this.numSides,i=this.sketcher.hovering.a1.distance(this.sketcher.hovering.a2),d=this.getRing(this.sketcher.hovering.a1,this.numSides,i,this.sketcher.hovering.a1.angle(this.sketcher.hovering.a2)-h,!1),h=this.getRing(this.sketcher.hovering.a2,this.numSides,i,this.sketcher.hovering.a2.angle(this.sketcher.hovering.a1)-h,!1),j=new e.Point,i=new e.Point,k=1,l=d.length;l>k;k++)j.add(d[k]),i.add(h[k]);j.x/=d.length-1,j.y/=d.length-1,i.x/=h.length-1,i.y/=h.length-1,j=j.distance(c.p),c=i.distance(c.p),c>j&&(h=d)}for(c=1,d=h.length;d>c;c++)-1!=f(h[c],this.sketcher.molecule.atoms)&&(h[c].isOverlap=!0);this.sketcher.tempRing=h,this.sketcher.repaint()}},d.NewRingState.prototype.innermousedown=function(a){null!=this.sketcher.hovering&&(this.sketcher.hovering.isHover=!1,this.sketcher.hovering.isSelected=!0,this.drag(a))},d.NewRingState.prototype.innermouseup=function(a){if(null!=this.sketcher.tempRing&&null!=this.sketcher.hovering){var b=[],d=[];if(this.sketcher.hovering instanceof e.Atom){-1==f(this.sketcher.tempRing[0],this.sketcher.molecule.atoms)&&b.push(this.sketcher.tempRing[0]),this.bondExists(this.sketcher.hovering,this.sketcher.tempRing[0])||d.push(new e.Bond(this.sketcher.hovering,this.sketcher.tempRing[0]));for(var g=1,h=this.sketcher.tempRing.length;h>g;g++)-1==f(this.sketcher.tempRing[g],this.sketcher.molecule.atoms)&&b.push(this.sketcher.tempRing[g]),this.bondExists(this.sketcher.tempRing[g-1],this.sketcher.tempRing[g])||d.push(new e.Bond(this.sketcher.tempRing[g-1],this.sketcher.tempRing[g],1==g%2&&this.unsaturated?2:1));this.bondExists(this.sketcher.tempRing[this.sketcher.tempRing.length-1],this.sketcher.hovering)||d.push(new e.Bond(this.sketcher.tempRing[this.sketcher.tempRing.length-1],this.sketcher.hovering,this.unsaturated?2:1))}else if(this.sketcher.hovering instanceof e.Bond){var g=this.sketcher.hovering.a2,i=this.sketcher.hovering.a1;for(this.sketcher.tempRing[0]==this.sketcher.hovering.a1&&(g=this.sketcher.hovering.a1,i=this.sketcher.hovering.a2),-1==f(this.sketcher.tempRing[1],this.sketcher.molecule.atoms)&&b.push(this.sketcher.tempRing[1]),this.bondExists(g,this.sketcher.tempRing[1])||d.push(new e.Bond(g,this.sketcher.tempRing[1])),g=2,h=this.sketcher.tempRing.length;h>g;g++)-1==f(this.sketcher.tempRing[g],this.sketcher.molecule.atoms)&&b.push(this.sketcher.tempRing[g]),this.bondExists(this.sketcher.tempRing[g-1],this.sketcher.tempRing[g])||d.push(new e.Bond(this.sketcher.tempRing[g-1],this.sketcher.tempRing[g],0==g%2&&this.unsaturated?2:1));this.bondExists(this.sketcher.tempRing[this.sketcher.tempRing.length-1],i)||d.push(new e.Bond(this.sketcher.tempRing[this.sketcher.tempRing.length-1],i))}(0!=b.length||0!=d.length)&&this.sketcher.historyManager.pushUndo(new c.AddAction(this.sketcher.molecule,b,d))}for(b=0,d=this.sketcher.molecule.atoms.length;d>b;b++)this.sketcher.molecule.atoms[b].isOverlap=!1;this.sketcher.tempRing=null,this.sketcher.isMobile||this.mousemove(a)},d.NewRingState.prototype.innermousemove=function(a){null==this.sketcher.tempAtom&&this.findHoveredObject(a,!0,!0)}}(ChemDoodle.math,ChemDoodle.monitor,ChemDoodle.sketcher.actions,ChemDoodle.sketcher.states,ChemDoodle.structures,jQuery.inArray,Math),function(a){a.StateManager=function(b){return this.STATE_NEW_BOND=new a.NewBondState(b),this.STATE_NEW_RING=new a.NewRingState(b),this.STATE_CHARGE=new a.ChargeState(b),this.STATE_LONE_PAIR=new a.LonePairState(b),this.STATE_MOVE=new a.MoveState(b),this.STATE_ERASE=new a.EraseState(b),this.STATE_LABEL=new a.LabelState(b),this.currentState=this.STATE_NEW_BOND,!0}}(ChemDoodle.sketcher.states),function(a,b){a.Button=function(a,b,c,d,e){return this.id=a,this.iconPath=b,this.icon=c,this.toggle=!1,this.tooltip=d?d:"",this.func=e?e:null,!0},a.Button.prototype.getElement=function(){return b("#"+this.id)},a.Button.prototype.getSource=function(a){var b=[];return this.toggle?(b.push('<input type="radio" name="'),b.push(a),b.push('" id="'),b.push(this.id),b.push('"><label for="'),b.push(this.id),b.push('"><img id="'),b.push(this.id),b.push('_icon" title="'),b.push(this.tooltip),b.push('" src="'),b.push(this.iconPath),b.push(this.icon),b.push('.png"></label>')):(b.push('<button id="'),b.push(this.id),b.push('" onclick="return false;"><img title="'),b.push(this.tooltip),b.push('" width="20" height="20" src="'),b.push(this.iconPath),b.push(this.icon),b.push('.png"></button>')),b.join("")},a.Button.prototype.setup=function(a){(!this.toggle||a)&&this.getElement().button(),this.getElement().click(this.func)},a.Button.prototype.disable=function(){var a=this.getElement();a.mouseout(),a.button("disable")},a.Button.prototype.enable=function(){this.getElement().button("enable")},a.Button.prototype.select=function(){var a=this.getElement();a.attr("checked",!0),a.button("refresh")}}(ChemDoodle.sketcher.gui.desktop,jQuery),function(a,b){a.ButtonSet=function(a){return this.id=a,this.buttons=[],this.buttonGroup="main_group",this.toggle=!0},a.ButtonSet.prototype.getElement=function(){return b("#"+this.id)},a.ButtonSet.prototype.getSource=function(){var a=[];a.push('<span id="'),a.push(this.id),a.push('">');for(var b=0,c=this.buttons.length;c>b;b++)this.toggle&&(this.buttons[b].toggle=!0),a.push(this.buttons[b].getSource(this.buttonGroup));return null!=this.dropDown&&a.push(this.dropDown.getButtonSource()),a.push("</span>"),null!=this.dropDown&&a.push(this.dropDown.getHiddenSource()),a.join("")},a.ButtonSet.prototype.setup=function(){this.getElement().buttonset();for(var a=0,b=this.buttons.length;b>a;a++)this.buttons[a].setup(!1);null!=this.dropDown&&this.dropDown.setup()},a.ButtonSet.prototype.addDropDown=function(b,c){this.dropDown=new a.DropDown(this.id+"_dd",c,b,this.buttons[this.buttons.length-1])}}(ChemDoodle.sketcher.gui.desktop,jQuery),function(a,b,c){a.Dialog=function(a,b){return this.id=a,this.title=b?b:"Information",this.afterMessage=this.message=this.buttons=null,this.includeTextArea=!1,!0},a.Dialog.prototype.getElement=function(){return b("#"+this.id)},a.Dialog.prototype.getTextArea=function(){return b("#"+this.id+"_ta")},a.Dialog.prototype.setup=function(){var a=[];a.push('<div style="font-size:12px;" id="'),a.push(this.id),a.push('" title="'),a.push(this.title),a.push('">'),null!=this.message&&(a.push("<p>"),a.push(this.message),a.push("</p>")),this.includeTextArea&&(a.push('<textarea style="font-family:\'Courier New\';" id="'),a.push(this.id),a.push('_ta" cols="55" rows="10"></textarea>')),null!=this.afterMessage&&(a.push("<p>"),a.push(this.afterMessage),a.push("</p>")),a.push("</div>"),c.writeln(a.join("")),this.getElement().dialog({autoOpen:!1,width:435,buttons:this.buttons})}}(ChemDoodle.sketcher.gui.desktop,jQuery,document),function(a,b,c,d){b.MolGrabberDialog=function(a){return this.id=a,this.title="MolGrabber",this.afterMessage=this.message=this.buttons=null,this.includeTextArea=!1,!0
},b.MolGrabberDialog.prototype=new b.Dialog,b.MolGrabberDialog.prototype.setup=function(){var a=[];a.push('<div style="font-size:12px;text-align:center;" id="'),a.push(this.id),a.push('" title="'),a.push(this.title),a.push('">'),null!=this.message&&(a.push("<p>"),a.push(this.message),a.push("</p>")),d.writeln(a.join("")),this.canvas=new ChemDoodle.MolGrabberCanvas(this.id+"_mg",200,200),a=[],null!=this.afterMessage&&(a.push("<p>"),a.push(this.afterMessage),a.push("</p>")),a.push("</div>"),d.writeln(a.join("")),this.getElement().dialog({autoOpen:!1,width:250,buttons:this.buttons})}}(ChemDoodle,ChemDoodle.sketcher.gui.desktop,jQuery,document),function(a,b,c,d){b.PeriodicTableDialog=function(a){return this.id=a,this.title="Periodic Table",this.afterMessage=this.message=this.buttons=null,this.includeTextArea=!1,!0},b.PeriodicTableDialog.prototype=new b.Dialog,b.PeriodicTableDialog.prototype.setup=function(){var a=[];a.push('<div style="text-align:center;" id="'),a.push(this.id),a.push('" title="'),a.push(this.title),a.push('">'),d.writeln(a.join("")),this.canvas=new ChemDoodle.PeriodicTableCanvas(this.id+"_pt",20),d.writeln("</div>"),this.getElement().dialog({autoOpen:!1,width:400,buttons:this.buttons})}}(ChemDoodle,ChemDoodle.sketcher.gui.desktop,jQuery,document),function(a,b,c,d){b.SaveFileDialog=function(a,b){return this.id=a,this.sketcher=b,this.title="Save File",this.afterMessage=this.buttons=null,this.includeTextArea=!1,!0},b.SaveFileDialog.prototype=new b.Dialog,b.SaveFileDialog.prototype.clear=function(){c("#"+this.id+"_link").html("The file link will appear here.")},b.SaveFileDialog.prototype.setup=function(){var a=[];a.push('<div style="font-size:12px;" id="'),a.push(this.id),a.push('" title="'),a.push(this.title),a.push('">'),a.push("<p>Select the file format to save your structure to and click on the <strong>Generate File</strong> button.</p>"),a.push('<select id="'),a.push(this.id),a.push('_select">'),a.push('<option value="sk2">ACD/ChemSketch Document {sk2}'),a.push('<option value="ros">Beilstein ROSDAL {ros}'),a.push('<option value="cdx">Cambridgesoft ChemDraw Exchange {cdx}'),a.push('<option value="cdxml">Cambridgesoft ChemDraw XML {cdxml}'),a.push('<option value="mrv">ChemAxon Marvin Document {mrv}'),a.push('<option value="cml">Chemical Markup Language {cml}'),a.push('<option value="smiles">Daylight SMILES {smiles}'),a.push('<option value="icl" selected>iChemLabs ChemDoodle Document {icl}'),a.push('<option value="inchi">IUPAC InChI {inchi}'),a.push('<option value="jdx">IUPAC JCAMP-DX {jdx}'),a.push('<option value="skc">MDL ISIS Sketch {skc}'),a.push('<option value="tgf">MDL ISIS Sketch Transportable Graphics File {tgf}'),a.push('<option value="mol">MDL MOLFile {mol}'),a.push('<option value="sdf">MDL SDFile {sdf}'),a.push('<option value="jme">Molinspiration JME String {jme}'),a.push('<option value="pdb">RCSB Protein Data Bank {pdb}'),a.push('<option value="mmd">Schr&ouml;dinger Macromodel {mmd}'),a.push('<option value="mae">Schr&ouml;dinger Maestro {mae}'),a.push('<option value="smd">Standard Molecular Data {smd}'),a.push('<option value="mol2">Tripos Mol2 {mol2}'),a.push('<option value="sln">Tripos SYBYL SLN {sln}'),a.push('<option value="xyz">XYZ {xyz}'),a.push("</select>"),a.push('<button id="'),a.push(this.id),a.push('_button">'),a.push("Generate File</button>"),a.push("<p>When the file is written, a link will appear in the red-bordered box below, right-click on the link and choose the browser's <strong>Save As...</strong> function to save the file to your computer.</p>"),a.push('<div style="width:100%;height:30px;border:1px solid #c10000;text-align:center;" id="'),a.push(this.id),a.push('_link">The file link will appear here.</div>'),a.push('<p><a href="http://www.chemdoodle.com" target="_blank">How do I use these files?</a></p>'),a.push("</div>"),d.writeln(a.join(""));var b=this;c("#"+this.id+"_button").click(function(){c("#"+b.id+"_link").html("Generating file, please wait..."),ChemDoodle.iChemLabs.saveFile(b.sketcher.molecule,c("#"+b.id+"_select").val(),function(a){c("#"+b.id+"_link").html('<a href="'+a+'"><span style="text-decoration:underline;">File is generated. Right-click on this link and Save As...</span></a>')})}),this.getElement().dialog({autoOpen:!1,width:435,buttons:b.buttons})}}(ChemDoodle,ChemDoodle.sketcher.gui.desktop,jQuery,document),function(a,b,c,d,e){c.DialogManager=function(c){c.useServices?this.saveDialog=new d.SaveFileDialog(c.id+"_save_dialog",c):(this.saveDialog=new d.Dialog(c.id+"_save_dialog","Save Molecule"),this.saveDialog.message="Copy and paste the content of the textarea into a file and save it with the extension <strong>.mol</strong>.",this.saveDialog.includeTextArea=!0,this.saveDialog.afterMessage='<a href="http://www.chemdoodle.com" target="_blank">How do I use MOLFiles?</a>'),this.saveDialog.setup(),this.loadDialog=new d.Dialog(c.id+"_load_dialog","Load Molecule"),this.loadDialog.message="Copy and paste the contents of a MOLFile (extension <strong>.mol</strong>) in the textarea below and then press the <strong>Load</strong> button.",this.loadDialog.includeTextArea=!0,this.loadDialog.afterMessage='<a href="http://www.chemdoodle.com" target="_blank">Where do I get MOLFiles?</a>';var f=this;return this.loadDialog.buttons={Load:function(){e(this).dialog("close");var d=a.readMOL(f.loadDialog.getTextArea().val());0!=d.atoms.length?c.historyManager.pushUndo(new b.SwitchMoleculeAction(c,d)):alert("No chemical content was recognized.")}},this.loadDialog.setup(),this.searchDialog=new d.MolGrabberDialog(c.id+"_search_dialog"),this.searchDialog.buttons={Load:function(){e(this).dialog("close");var a=f.searchDialog.canvas.molecule;null!=a&&0!=a.atoms.length&&a!=c.molecule&&c.historyManager.pushUndo(new b.SwitchMoleculeAction(c,a))}},this.searchDialog.setup(),this.periodicTableDialog=new d.PeriodicTableDialog(c.id+"_periodicTable_dialog"),this.periodicTableDialog.buttons={Close:function(){e(this).dialog("close")}},this.periodicTableDialog.setup(),this.periodicTableDialog.canvas.click=function(){if(null!=this.hovered){this.selected=this.hovered;var a=this.getHoveredElement();c.stateManager.currentState=c.stateManager.STATE_LABEL,c.stateManager.STATE_LABEL.label=a.symbol,this.repaint()}},this.calculateDialog=new d.Dialog(c.id+"_calculate_dialog","Calculations"),this.calculateDialog.includeTextArea=!0,this.calculateDialog.afterMessage='<a href="http://www.chemdoodle.com" target="_blank">Want more calculations?</a>',this.calculateDialog.setup(),!0}}(ChemDoodle,ChemDoodle.sketcher.actions,ChemDoodle.sketcher.gui,ChemDoodle.sketcher.gui.desktop,jQuery),function(a,b,c){a.DropDown=function(b,c,d,e){return this.id=b,this.iconPath=c,this.tooltip=d,this.dummy=e,this.buttonSet=new a.ButtonSet(b+"_set"),this.buttonSet.buttonGroup=d,this.defaultButton=null,!0},a.DropDown.prototype.getButtonSource=function(){var a=[];return a.push('<button id="'),a.push(this.id),a.push('" onclick="return false;"><img title="'),a.push(this.tooltip),a.push('" src="'),a.push(this.iconPath),a.push('arrowDown.png"></button>'),a.join("")},a.DropDown.prototype.getHiddenSource=function(){var a=[];return a.push('<div style="display:none;position:absolute;z-index:10;border:1px #C1C1C1 solid;background:#F5F5F5;padding:5px;border-bottom-left-radius:5px;-moz-border-radius-bottomleft:5px;border-bottom-right-radius:5px;-moz-border-radius-bottomright:5px;" id="'),a.push(this.id),a.push('_hidden">'),a.push(this.buttonSet.getSource()),a.push("</div>"),a.join("")},a.DropDown.prototype.setup=function(){null==this.defaultButton&&(this.defaultButton=this.buttonSet.buttons[0]);var a="#"+this.id;b(a).button(),b(a+"_hidden").hide(),b(a).click(function(){var d=b(a+"_hidden");return d.show().position({my:"center top",at:"center bottom",of:this,collision:"fit"}),b(c).one("click",function(){d.hide()}),!1}),this.buttonSet.setup();var d=this;b.each(this.buttonSet.buttons,function(a){d.buttonSet.buttons[a].getElement().click(function(){d.dummy.absorb(d.buttonSet.buttons[a]),d.dummy.select(),d.dummy.func()})}),d.dummy.absorb(this.defaultButton),this.defaultButton.select()}}(ChemDoodle.sketcher.gui.desktop,jQuery,document),function(a,b){a.DummyButton=function(a,b,c,d){return this.id=a,this.iconPath=b,this.icon=c,this.toggle=!1,this.tooltip=d?d:"",this.func=null,!0},a.DummyButton.prototype=new a.Button,a.DummyButton.prototype.setup=function(){var a=this;this.getElement().click(function(){a.func()})},a.DummyButton.prototype.absorb=function(a){b("#"+this.id+"_icon").attr("src",a.iconPath+a.icon+".png"),b("#"+this.id).button("refresh"),this.func=a.func}}(ChemDoodle.sketcher.gui.desktop,jQuery),function(a,b,c,d,e,f,g,h,i){e.ToolbarManager=function(e){return this.sketcher=e,this.buttonOpen=new f.Button(e.id+"_button_open",e.iconPath,"open20","Open",function(){e.dialogManager.loadDialog.getTextArea().val(""),e.dialogManager.loadDialog.getElement().dialog("open")}),this.buttonSave=new f.Button(e.id+"_button_save",e.iconPath,"save20","Save",function(){e.useServices?e.dialogManager.saveDialog.clear():e.dialogManager.saveDialog.getTextArea().val(a.writeMOL(e.molecule)),e.dialogManager.saveDialog.getElement().dialog("open")}),this.buttonSearch=new f.Button(e.id+"_button_search",e.iconPath,"search20","Search",function(){e.dialogManager.searchDialog.getElement().dialog("open")}),this.buttonCalculate=new f.Button(e.id+"_button_calculate",e.iconPath,"calculate20","Calculate",function(){b.calculate(e.molecule,"mf,mw,miw,deg_unsat,hba,hbd,pol_miller,cmr,tpsa,xlogp2".split(","),function(a){function b(a,b,d){for(c.push(a),c.push(": "),a=a.length+2;30>a;a++)c.push(" ");c.push(b),c.push(" "),c.push(d),c.push("\n")}var c=[];b("Molecular Formula",a.mf,""),b("Molecular Mass",a.mw,"amu"),b("Monoisotopic Mass",a.miw,"amu"),b("Degree of Unsaturation",a.deg_unsat,""),b("Hydrogen Bond Acceptors",a.hba,""),b("Hydrogen Bond Donors",a.hbd,""),b("Molecular Polarizability",a.pol_miller,"Å³"),b("Molar Refractivity",a.cmr,"cm³/mol"),b("Polar Surface Area",a.tpsa,"Å²"),b("logP",a.xlogp2,""),e.dialogManager.calculateDialog.getTextArea().val(c.join("")),e.dialogManager.calculateDialog.getElement().dialog("open")})}),this.buttonMove=new f.Button(e.id+"_button_move",e.iconPath,"move20","Move",function(){e.stateManager.currentState=e.stateManager.STATE_MOVE}),this.buttonMove.toggle=!0,this.buttonErase=new f.Button(e.id+"_button_erase",e.iconPath,"erase20","Erase",function(){e.stateManager.currentState=e.stateManager.STATE_ERASE}),this.buttonErase.toggle=!0,this.buttonClear=new f.Button(e.id+"_button_clear",e.iconPath,"clear20","Clear",function(){var a=!0;if(1==e.molecule.atoms.length){var b=e.molecule.atoms[0];"C"==b.label&&0==b.charge&&-1==b.mass&&(a=!1)}a&&e.historyManager.pushUndo(new d.ClearAction(e))}),this.buttonClean=new f.Button(e.id+"_button_clean",e.iconPath,"optimize20","Clean",function(){b.contactServer("optimize",{mol:c.toJSONDummy(e.molecule),dimension:2},function(a){var a=c.fromJSONDummy(a.mol),b=a.getCenter(),f=new g.Point(e.width/2,e.height/2);f.sub(b);for(var b=0,h=a.atoms.length;h>b;b++)a.atoms[b].add(f);e.historyManager.pushUndo(new d.ChangeCoordinatesAction(e.molecule.atoms,a.atoms))})}),this.makeScaleSet(this),this.makeHistorySet(this),this.makeLabelSet(this),this.makeBondSet(this),this.makeRingSet(this),this.makeAttributeSet(this),!0},e.ToolbarManager.prototype.write=function(){var a=[];a.push(this.buttonOpen.getSource()),a.push(this.buttonSave.getSource()),this.sketcher.useServices&&a.push(this.buttonSearch.getSource()),a.push(this.scaleSet.getSource()),a.push(this.buttonClear.getSource()),a.push(this.buttonErase.getSource("main_group")),a.push(this.buttonMove.getSource("main_group")),this.sketcher.useServices&&a.push(this.buttonClean.getSource()),a.push(this.historySet.getSource()),this.sketcher.useServices&&a.push(this.buttonCalculate.getSource()),a.push("<br>"),a.push(this.labelSet.getSource()),a.push(this.bondSet.getSource()),a.push(this.ringSet.getSource()),a.push(this.attributeSet.getSource()),a.push("<br>"),i.write(a.join(""))},e.ToolbarManager.prototype.setup=function(){this.buttonOpen.setup(),this.buttonSave.setup(),this.sketcher.useServices&&this.buttonSearch.setup(),this.scaleSet.setup(),this.buttonClear.setup(),this.buttonErase.setup(!0),this.buttonMove.setup(!0),this.sketcher.useServices&&this.buttonClean.setup(),this.historySet.setup(),this.sketcher.useServices&&this.buttonCalculate.setup(),this.labelSet.setup(),this.bondSet.setup(),this.ringSet.setup(),this.attributeSet.setup(),this.buttonSingle.select(),this.buttonUndo.disable(),this.buttonRedo.disable()},e.ToolbarManager.prototype.makeScaleSet=function(a){this.scaleSet=new f.ButtonSet(a.sketcher.id+"_buttons_scale"),this.scaleSet.toggle=!1,this.buttonScalePlus=new f.Button(a.sketcher.id+"_button_scale_plus",a.sketcher.iconPath,"zoomIn20","Increase Scale",function(){a.sketcher.specs.scale*=1.5,a.sketcher.checkScale(),a.sketcher.repaint()}),this.scaleSet.buttons.push(this.buttonScalePlus),this.buttonScaleMinus=new f.Button(a.sketcher.id+"_button_scale_minus",a.sketcher.iconPath,"zoomOut20","Decrease Scale",function(){a.sketcher.specs.scale/=1.5,a.sketcher.checkScale(),a.sketcher.repaint()}),this.scaleSet.buttons.push(this.buttonScaleMinus)},e.ToolbarManager.prototype.makeHistorySet=function(a){this.historySet=new f.ButtonSet(a.sketcher.id+"_buttons_history"),this.historySet.toggle=!1,this.buttonUndo=new f.Button(a.sketcher.id+"_button_undo",a.sketcher.iconPath,"undo20","Undo",function(){a.sketcher.historyManager.undo()}),this.historySet.buttons.push(this.buttonUndo),this.buttonRedo=new f.Button(a.sketcher.id+"_button_redo",a.sketcher.iconPath,"redo20","Redo",function(){a.sketcher.historyManager.redo()}),this.historySet.buttons.push(this.buttonRedo)},e.ToolbarManager.prototype.makeLabelSet=function(a){this.labelSet=new f.ButtonSet(a.sketcher.id+"_buttons_label"),this.buttonLabel=new f.DummyButton(a.sketcher.id+"_button_label",a.sketcher.iconPath,"Carbon","Set Label"),this.labelSet.buttons.push(this.buttonLabel),this.labelSet.addDropDown("More Labels",a.sketcher.iconPath),this.labelSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_label_h",a.sketcher.iconPath,"Hydrogen","Hydrogen",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_LABEL,a.sketcher.stateManager.STATE_LABEL.label="H"})),this.labelSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_label_c",a.sketcher.iconPath,"Carbon","Carbon",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_LABEL,a.sketcher.stateManager.STATE_LABEL.label="C"})),this.labelSet.dropDown.defaultButton=this.labelSet.dropDown.buttonSet.buttons[this.labelSet.dropDown.buttonSet.buttons.length-1],this.labelSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_label_n",a.sketcher.iconPath,"Nitrogen","Nitrogen",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_LABEL,a.sketcher.stateManager.STATE_LABEL.label="N"})),this.labelSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_label_o",a.sketcher.iconPath,"Oxygen","Oxygen",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_LABEL,a.sketcher.stateManager.STATE_LABEL.label="O"})),this.labelSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_label_f",a.sketcher.iconPath,"Fluorine","Fluorine",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_LABEL,a.sketcher.stateManager.STATE_LABEL.label="F"})),this.labelSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_label_cl",a.sketcher.iconPath,"Chlorine","Chlorine",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_LABEL,a.sketcher.stateManager.STATE_LABEL.label="Cl"})),this.labelSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_label_br",a.sketcher.iconPath,"Bromine","Bromine",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_LABEL,a.sketcher.stateManager.STATE_LABEL.label="Br"})),this.labelSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_label_i",a.sketcher.iconPath,"Iodine","Iodine",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_LABEL,a.sketcher.stateManager.STATE_LABEL.label="I"})),this.labelSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_label_p",a.sketcher.iconPath,"Phosphorus","Phosphorus",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_LABEL,a.sketcher.stateManager.STATE_LABEL.label="P"})),this.labelSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_label_s",a.sketcher.iconPath,"Sulfur","Sulfur",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_LABEL,a.sketcher.stateManager.STATE_LABEL.label="S"})),this.labelSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_label_pt",a.sketcher.iconPath,"periodicTable20","Choose Symbol",function(){for(var b=0,c=a.sketcher.dialogManager.periodicTableDialog.canvas.cells.length;c>b;b++){var d=a.sketcher.dialogManager.periodicTableDialog.canvas.cells[b];if(d.element.symbol==a.sketcher.stateManager.STATE_LABEL.label){a.sketcher.dialogManager.periodicTableDialog.canvas.selected=d,a.sketcher.dialogManager.periodicTableDialog.canvas.repaint();break}}a.sketcher.dialogManager.periodicTableDialog.getElement().dialog("open")}))},e.ToolbarManager.prototype.makeBondSet=function(a){this.bondSet=new f.ButtonSet(a.sketcher.id+"_buttons_bond"),this.buttonSingle=new f.Button(a.sketcher.id+"_button_bond_single",a.sketcher.iconPath,"SingleBond","Single Bond",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_NEW_BOND,a.sketcher.stateManager.STATE_NEW_BOND.bondOrder=1,a.sketcher.stateManager.STATE_NEW_BOND.stereo=g.Bond.STEREO_NONE}),this.bondSet.buttons.push(this.buttonSingle),this.buttonRecessed=new f.Button(a.sketcher.id+"_button_bond_recessed",a.sketcher.iconPath,"RecessedBond","Recessed Bond",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_NEW_BOND,a.sketcher.stateManager.STATE_NEW_BOND.bondOrder=1,a.sketcher.stateManager.STATE_NEW_BOND.stereo=g.Bond.STEREO_RECESSED}),this.bondSet.buttons.push(this.buttonRecessed),this.buttonProtruding=new f.Button(a.sketcher.id+"_button_bond_protruding",a.sketcher.iconPath,"ProtrudingBond","Protruding Bond",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_NEW_BOND,a.sketcher.stateManager.STATE_NEW_BOND.bondOrder=1,a.sketcher.stateManager.STATE_NEW_BOND.stereo=g.Bond.STEREO_PROTRUDING}),this.bondSet.buttons.push(this.buttonProtruding),this.buttonDouble=new f.Button(a.sketcher.id+"_button_bond_double",a.sketcher.iconPath,"DoubleBond","Double Bond",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_NEW_BOND,a.sketcher.stateManager.STATE_NEW_BOND.bondOrder=2,a.sketcher.stateManager.STATE_NEW_BOND.stereo=g.Bond.STEREO_NONE}),this.bondSet.buttons.push(this.buttonDouble),this.buttonBond=new f.DummyButton(a.sketcher.id+"_button_bond",a.sketcher.iconPath,"TripleBond","Other Bond"),this.bondSet.buttons.push(this.buttonBond),this.bondSet.addDropDown("More Bonds",a.sketcher.iconPath),this.bondSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_bond_triple",a.sketcher.iconPath,"TripleBond","Triple Bond",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_NEW_BOND,a.sketcher.stateManager.STATE_NEW_BOND.bondOrder=3,a.sketcher.stateManager.STATE_NEW_BOND.stereo=g.Bond.STEREO_NONE})),this.bondSet.dropDown.defaultButton=this.bondSet.dropDown.buttonSet.buttons[this.bondSet.dropDown.buttonSet.buttons.length-1],this.bondSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_bond_ambiguous_double",a.sketcher.iconPath,"AmbiguousDoubleBond","Ambiguous Double Bond",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_NEW_BOND,a.sketcher.stateManager.STATE_NEW_BOND.bondOrder=2,a.sketcher.stateManager.STATE_NEW_BOND.stereo=g.Bond.STEREO_AMBIGUOUS}))},e.ToolbarManager.prototype.makeRingSet=function(a){this.ringSet=new f.ButtonSet(a.sketcher.id+"_buttons_ring"),this.buttonCyclohexane=new f.Button(a.sketcher.id+"_button_ring_cyclohexane",a.sketcher.iconPath,"Cyclohexane","Cyclohexane Ring",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_NEW_RING,a.sketcher.stateManager.STATE_NEW_RING.numSides=6,a.sketcher.stateManager.STATE_NEW_RING.unsaturated=!1}),this.ringSet.buttons.push(this.buttonCyclohexane),this.buttonBenzene=new f.Button(a.sketcher.id+"_button_ring_benzene",a.sketcher.iconPath,"Benzene","Benzene Ring",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_NEW_RING,a.sketcher.stateManager.STATE_NEW_RING.numSides=6,a.sketcher.stateManager.STATE_NEW_RING.unsaturated=!0}),this.ringSet.buttons.push(this.buttonBenzene),this.buttonBond=new f.DummyButton(a.sketcher.id+"_button_ring",a.sketcher.iconPath,"Cyclopentane","Other Ring"),this.ringSet.buttons.push(this.buttonBond),this.ringSet.addDropDown("More Rings",a.sketcher.iconPath),this.ringSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_ring_cyclopropane",a.sketcher.iconPath,"Cyclopropane","Cyclopropane Ring",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_NEW_RING,a.sketcher.stateManager.STATE_NEW_RING.numSides=3,a.sketcher.stateManager.STATE_NEW_RING.unsaturated=!1})),this.ringSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_ring_cyclobutane",a.sketcher.iconPath,"Cyclobutane","Cyclobutane Ring",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_NEW_RING,a.sketcher.stateManager.STATE_NEW_RING.numSides=4,a.sketcher.stateManager.STATE_NEW_RING.unsaturated=!1})),this.ringSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_ring_cyclopentane",a.sketcher.iconPath,"Cyclopentane","Cyclopentane Ring",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_NEW_RING,a.sketcher.stateManager.STATE_NEW_RING.numSides=5,a.sketcher.stateManager.STATE_NEW_RING.unsaturated=!1})),this.ringSet.dropDown.defaultButton=this.ringSet.dropDown.buttonSet.buttons[this.ringSet.dropDown.buttonSet.buttons.length-1],this.ringSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_ring_cycloheptane",a.sketcher.iconPath,"Cycloheptane","Cycloheptane Ring",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_NEW_RING,a.sketcher.stateManager.STATE_NEW_RING.numSides=7,a.sketcher.stateManager.STATE_NEW_RING.unsaturated=!1})),this.ringSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_ring_cyclooctane",a.sketcher.iconPath,"Cyclooctane","Cyclooctane Ring",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_NEW_RING,a.sketcher.stateManager.STATE_NEW_RING.numSides=8,a.sketcher.stateManager.STATE_NEW_RING.unsaturated=!1}))},e.ToolbarManager.prototype.makeAttributeSet=function(a){this.attributeSet=new f.ButtonSet(a.sketcher.id+"_buttons_attribute"),this.buttonChargePlus=new f.Button(a.sketcher.id+"_button_attribute_charge_increment",a.sketcher.iconPath,"IncreaseCharge","Increase Charge",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_CHARGE,a.sketcher.stateManager.STATE_CHARGE.delta=1}),this.attributeSet.buttons.push(this.buttonChargePlus),this.buttonAttribute=new f.DummyButton(a.sketcher.id+"_button_attribute",a.sketcher.iconPath,"DecreaseCharge","Other Attribute"),this.attributeSet.buttons.push(this.buttonAttribute),this.attributeSet.addDropDown("More Attributes",a.sketcher.iconPath),this.attributeSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_attribute_charge_decrement",a.sketcher.iconPath,"DecreaseCharge","Decrease Charge",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_CHARGE,a.sketcher.stateManager.STATE_CHARGE.delta=-1})),this.attributeSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_attribute_lonePair_increment",a.sketcher.iconPath,"AddLonePair","Add Lone Pair",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_LONE_PAIR,a.sketcher.stateManager.STATE_LONE_PAIR.delta=1})),this.attributeSet.dropDown.buttonSet.buttons.push(new f.Button(a.sketcher.id+"_button_attribute_lonePair_decrement",a.sketcher.iconPath,"RemoveLonePair","Remove Lone Pair",function(){a.sketcher.stateManager.currentState=a.sketcher.stateManager.STATE_LONE_PAIR,a.sketcher.stateManager.STATE_LONE_PAIR.delta=-1}))}}(ChemDoodle,ChemDoodle.iChemLabs,ChemDoodle.io,ChemDoodle.sketcher.actions,ChemDoodle.sketcher.gui,ChemDoodle.sketcher.gui.desktop,ChemDoodle.structures,jQuery,document),function(a,b,c,d,e,f,g){a.SketcherCanvas=function(a,b,f,h,i,j){var k=this;return this.iconPath=h,this.isMobile=i,this.useServices=j,this.id=a,this.toolbarManager=new c.gui.ToolbarManager(this),null!=h&&(this.toolbarManager.write(),e(g).load(function(){k.toolbarManager.setup()}),this.dialogManager=new c.gui.DialogManager(this)),this.stateManager=new c.states.StateManager(this),this.historyManager=new c.actions.HistoryManager(this),a&&this.create(a,b,f),this.specs.atoms_circleDiameter_2D=7,this.specs.atoms_circleBorderWidth_2D=0,this.isHelp=!1,this.helpPos=new d.Point(this.width-20,20),this.clear(),this.lastPinchScale=1,this.lastGestureRotate=0,!0},a.SketcherCanvas.prototype=new a._Canvas,a.SketcherCanvas.prototype.clear=function(){var a=new d.Molecule;a.atoms[0]=new d.Atom("C",0,0,0),this.loadMolecule(a)},a.SketcherCanvas.prototype.drawSketcherDecorations=function(a){if(a.save(),a.translate(this.width/2,this.height/2),a.rotate(this.specs.rotateAngle),a.scale(this.specs.scale,this.specs.scale),a.translate(-this.width/2,-this.height/2),null!=this.hovering&&this.hovering.drawDecorations(a),null!=this.tempAtom&&(a.strokeStyle="#00FF00",a.fillStyle="#00FF00",a.lineWidth=1,a.beginPath(),a.moveTo(this.hovering.x,this.hovering.y),b.contextHashTo(a,this.hovering.x,this.hovering.y,this.tempAtom.x,this.tempAtom.y,2,2),a.stroke(),a.beginPath(),a.arc(this.tempAtom.x,this.tempAtom.y,3,0,2*f.PI,!1),a.fill(),this.tempAtom.isOverlap&&(a.strokeStyle="#C10000",a.lineWidth=1.2,a.beginPath(),a.arc(this.tempAtom.x,this.tempAtom.y,7,0,2*f.PI,!1),a.stroke())),null!=this.tempRing){if(a.strokeStyle="#00FF00",a.fillStyle="#00FF00",a.lineWidth=1,a.beginPath(),this.hovering instanceof d.Atom){a.moveTo(this.hovering.x,this.hovering.y),b.contextHashTo(a,this.hovering.x,this.hovering.y,this.tempRing[0].x,this.tempRing[0].y,2,2);for(var c=1,e=this.tempRing.length;e>c;c++)b.contextHashTo(a,this.tempRing[c-1].x,this.tempRing[c-1].y,this.tempRing[c].x,this.tempRing[c].y,2,2);b.contextHashTo(a,this.tempRing[this.tempRing.length-1].x,this.tempRing[this.tempRing.length-1].y,this.hovering.x,this.hovering.y,2,2)}else if(this.hovering instanceof d.Bond){var c=this.hovering.a2,g=this.hovering.a1;for(this.tempRing[0]==this.hovering.a1&&(c=this.hovering.a1,g=this.hovering.a2),a.moveTo(c.x,c.y),b.contextHashTo(a,c.x,c.y,this.tempRing[1].x,this.tempRing[1].y,2,2),c=2,e=this.tempRing.length;e>c;c++)b.contextHashTo(a,this.tempRing[c-1].x,this.tempRing[c-1].y,this.tempRing[c].x,this.tempRing[c].y,2,2);b.contextHashTo(a,this.tempRing[this.tempRing.length-1].x,this.tempRing[this.tempRing.length-1].y,g.x,g.y,2,2)}for(a.stroke(),c=0,e=this.molecule.atoms.length;e>c;c++)this.molecule.atoms[c].isOverlap&&(a.strokeStyle="#C10000",a.lineWidth=1.2,a.beginPath(),a.arc(this.molecule.atoms[c].x,this.molecule.atoms[c].y,7,0,2*f.PI,!1),a.stroke())}a.restore()},a.SketcherCanvas.prototype.drawChildExtras=function(a){if(this.drawSketcherDecorations(a),!this.hideHelp){var b=a.createRadialGradient(this.width-20,20,10,this.width-20,20,2);b.addColorStop(0,"#00680F"),b.addColorStop(1,"#FFFFFF"),a.fillStyle=b,a.beginPath(),a.arc(this.helpPos.x,this.helpPos.y,10,0,2*f.PI,!1),a.fill(),this.isHelp&&(a.lineWidth=2,a.strokeStyle="black",a.stroke()),a.fillStyle=this.isHelp?"red":"black",a.textAlign="center",a.textBaseline="middle",a.font="14px sans-serif",a.fillText("?",this.helpPos.x,this.helpPos.y)}this.paidToHideTrademark||(b=a.measureText("ChemDoodle").width,a.textAlign="left",a.textBaseline="bottom",a.fillStyle="rgba(0, 90, 0, 0.5)",a.fillText("ChemDoodle",this.width-b-18,this.height-4),a.font="8px sans-serif",a.fillText("TM",this.width-18,this.height-12))},a.SketcherCanvas.prototype.scaleEvent=function(a){a.op=new d.Point(a.p.x,a.p.y),1!=this.specs.scale&&(a.p.x=this.width/2+(a.p.x-this.width/2)/this.specs.scale,a.p.y=this.height/2+(a.p.y-this.height/2)/this.specs.scale)},a.SketcherCanvas.prototype.checkScale=function(){.5>this.specs.scale?this.specs.scale=.5:10<this.specs.scale&&(this.specs.scale=10)},a.SketcherCanvas.prototype.click=function(a){this.scaleEvent(a),this.stateManager.currentState.click(a)},a.SketcherCanvas.prototype.rightclick=function(a){this.scaleEvent(a),this.stateManager.currentState.rightclick(a)},a.SketcherCanvas.prototype.dblclick=function(a){this.scaleEvent(a),this.stateManager.currentState.dblclick(a)},a.SketcherCanvas.prototype.mousedown=function(a){this.scaleEvent(a),this.stateManager.currentState.mousedown(a)},a.SketcherCanvas.prototype.rightmousedown=function(a){this.scaleEvent(a),this.stateManager.currentState.rightmousedown(a)},a.SketcherCanvas.prototype.mousemove=function(a){this.isHelp=!1,10>a.p.distance(this.helpPos)&&(this.isHelp=!0),this.scaleEvent(a),this.stateManager.currentState.mousemove(a)},a.SketcherCanvas.prototype.mouseout=function(a){this.scaleEvent(a),this.stateManager.currentState.mouseout(a)},a.SketcherCanvas.prototype.mouseover=function(a){this.scaleEvent(a),this.stateManager.currentState.mouseover(a)},a.SketcherCanvas.prototype.mouseup=function(a){this.scaleEvent(a),this.stateManager.currentState.mouseup(a)},a.SketcherCanvas.prototype.rightmouseup=function(a){this.scaleEvent(a),this.stateManager.currentState.rightmouseup(a)},a.SketcherCanvas.prototype.mousewheel=function(a,b){this.scaleEvent(a),this.stateManager.currentState.mousewheel(a,b)},a.SketcherCanvas.prototype.drag=function(a){this.scaleEvent(a),this.stateManager.currentState.drag(a)},a.SketcherCanvas.prototype.keydown=function(a){this.scaleEvent(a),this.stateManager.currentState.keydown(a)},a.SketcherCanvas.prototype.keypress=function(a){this.scaleEvent(a),this.stateManager.currentState.keypress(a)},a.SketcherCanvas.prototype.keyup=function(a){this.scaleEvent(a),this.stateManager.currentState.keyup(a)},a.SketcherCanvas.prototype.touchstart=function(a){a.originalEvent.touches&&1<a.originalEvent.touches.length?((null!=this.tempAtom||null!=this.tempRing)&&(this.hovering=this.tempRing=this.tempAtom=null,this.repaint()),this.lastPoint=null):(this.scaleEvent(a),this.stateManager.currentState.mousemove(a),this.stateManager.currentState.mousedown(a))},a.SketcherCanvas.prototype.touchmove=function(a){this.scaleEvent(a),this.stateManager.currentState.drag(a)},a.SketcherCanvas.prototype.touchend=function(a){this.scaleEvent(a),this.stateManager.currentState.mouseup(a),null!=this.hovering&&(this.stateManager.currentState.clearHover(),this.repaint())},a.SketcherCanvas.prototype.gesturechange=function(a){if(1!=a.originalEvent.scale-this.lastPinchScale&&(this.specs.scale*=a.originalEvent.scale/this.lastPinchScale,this.checkScale(),this.lastPinchScale=a.originalEvent.scale),0!=this.lastGestureRotate-a.originalEvent.rotation){var b=(this.lastGestureRotate-a.originalEvent.rotation)/180*f.PI,e=new d.Point(this.width/2,this.height/2);if(null==this.parentAction)this.parentAction=new c.actions.RotateAction(this.molecule.atoms,b,e),this.historyManager.pushUndo(this.parentAction);else{this.parentAction.dif+=b;for(var g=0,h=this.molecule.atoms.length;h>g;g++){var i=e.distance(this.molecule.atoms[g]),j=e.angle(this.molecule.atoms[g])+b;this.molecule.atoms[g].x=e.x+i*f.cos(j),this.molecule.atoms[g].y=e.y-i*f.sin(j)}this.molecule.check()}this.lastGestureRotate=a.originalEvent.rotation
}this.repaint()},a.SketcherCanvas.prototype.gestureend=function(){this.lastPinchScale=1,this.lastGestureRotate=0,this.parentAction=null}}(ChemDoodle,ChemDoodle.extensions,ChemDoodle.sketcher,ChemDoodle.structures,jQuery,Math,window);
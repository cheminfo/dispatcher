define(["./../../../math/matrix","./../../../math/decompositions"],function(a,b){function c(a,b){"undefined"==typeof b&&(b=!1),b===!0&&a++,this.coefficients=new Array(a),this.addIntercept=b}function d(a,b){for(var c=b.rows,d=new Array(c),e=0;c>e;e++)d[e]=a.compute(b[e]);return d}return c.prototype={get inputs(){return this.coefficients.length-(this.addIntercept?1:0)},hasIntercept:function(){return this.addIntercept},regress:function(c,d,e){if(c.rows!==d.length)throw"Number of input and output samples does not match.";"undefined"==typeof e&&(e=!0);var f=this.inputs,g=c.rows,h=c.columns;if(f!==h)throw"Input vectors should have length "+f+" but they have "+h;var i,j;if(this.addIntercept){j=a.empty(g,h+1);for(var k=0;g>k;k++){for(var l=0;h>l;l++)j[k][l]=c[k][l];j[k][h]=1}}else j=c.clone();i=e||h>=g?new b.SingularValueDecomposition(j,{computeLeftSingularVectors:!0,computeRightSingularVectors:!0,autoTranspose:!0}):new b.QrDecomposition(j),this.coefficients=i.solve(a.columnVector(d)).to1DArray();for(var m,n=0,k=0;k<d.length;k++)m=d[k]-this.compute(c[k]),n+=m*m;return n},coefficientOfDetermination:function(a,b,c){"undefined"==typeof c&&(c=!1);for(var d,e=a.rows,f=this.inputs,g=0,h=0,i=0,j=0;j<b.length;j++)i+=b[j];i/=e;for(var j=0;j<b.length;j++)d=b[j]-this.compute(a[j]),g+=d*d,d=b[j]-i,h+=d*d;var k=0!==h?1-g/h:1;return c?1===k?1:e-f===1?0/0:1-(1-k)*((e-1)/(e-f-1)):k},compute:function(b){if(b instanceof a)return d(this,b);if(b.length!==this.inputs)throw"Input vectors should have length "+this.inputs+".";for(var c=0,e=0,f=b.length;f>e;e++)c+=this.coefficients[e]*b[e];return this.addIntercept&&(c+=this.coefficients[b.length]),c},toString:function(a){for(var b="undefined"!=typeof a,c=this.coefficients,d="y(",e=this.addIntercept?c.length-1:c.length,f=0;e>f;f++)d+="x"+f,e-1>f&&(d+=", ");d+=") = ";for(var f=0;e>f;f++)d+=b?c[f].toFixed(a)+"*x"+f:parseFloat(c[f].toFixed(10))+"*x"+f,e-1>f&&(d+=" + ");return this.addIntercept&&(d+=b?" + "+c[e].toFixed(a):" + "+parseFloat(c[e].toFixed(10))),d}},c});
define(["forms/form"],function(a){function b(a,b){var e=b.groups.general[0].type[0];switch(e){case"checkbox":a.options=d(b);break;case"combo":a.options=c(b);break;case"slider":a.min=parseFloat(b.groups.slider[0].start[0]||0),a.max=parseFloat(b.groups.slider[0].end[0]||1),a.step=parseFloat(b.groups.slider[0].step[0]||.1);break;case"slider_range":a.min=parseFloat(b.groups.range[0].start[0]||0),a.max=parseFloat(b.groups.range[0].end[0]||1),a.step=parseFloat(b.groups.range[0].step[0]||.1),a.default=[Math.max(parseFloat(b.groups.range[0].val1[0]),a.min),Math.min(parseFloat(b.groups.range[0].val2[0]),a.max)],a.range=!0}}function c(a){a=a.groups.options[0];for(var b=0,c=a.length,d=[];c>b;b++)d.push({title:a[b].label,key:a[b].value});return d}function d(a){a=a.groups.options[0];for(var b=0,c=a.length,d=[];c>b;d[a[b].value]=a[b].label,b++);return d}return{makeConfig:function(a,b){var c={options:{multiple:!0,title:"Form field"},groups:{general:{options:{type:"list"},fields:{name:{type:"text",title:"Field name"},label:{type:"text",title:"Field label"},allow_undefined:{type:"checkbox",title:"Allow undefined",options:{allow:""}},type:{type:"combo",title:"Field type",options:[{title:"Text",key:"text"},{title:"Number",key:"float"},{title:"Combo",key:"combo"},{title:"Slider",key:"slider"},{title:"Range",key:"slider_range"},{title:"Checkbox",key:"checkbox"}],displaySource:{text:"text","float":"float",combo:"combo",checkbox:"checkbox",slider:"slider",slider_range:"slider_range"}}}},defaultVal:{options:{type:"list",displayTarget:["text","slider","combo","checkbox"]},fields:{defaultVal:{type:"text",title:"Default value"}}},text:{options:{type:"list",displayTarget:["text"]},fields:{case_sensitive:{type:"checkbox",title:"Case sensitive",options:{case_sensitive:""}}}},slider:{options:{type:"list",displayTarget:["slider"]},fields:{start:{type:"float",title:"Start"},end:{type:"float",title:"End"},step:{type:"float",title:"Step"}}},range:{options:{type:"list",displayTarget:["slider_range"]},fields:{start:{type:"float",title:"Start"},end:{type:"float",title:"End"},step:{type:"float",title:"Step"},val1:{type:"float",title:"Default min"},val2:{type:"float",title:"Default max"}}},options:{options:{type:"table",multiple:!0,displayTarget:["combo","checkbox"]},fields:{label:{type:"text",title:"Label"},value:{type:"text",title:"Value"}}}},sections:{validation:{options:{multiple:!1,title:"Field validation"},groups:{general:{options:{type:"list"},fields:{pattern:{type:"text",title:"Pattern"},neg:{type:"text",title:"Negative feedback"},pos:{type:"text",title:"Positive feedback"},authorize_empty:{type:"checkbox",title:"Authorize empty",options:{authorize:""}}}}}}}};return a&&(c.groups.general.fields.searchOnField={type:"combo",multiple:!0,title:a.name,options:a.jpaths}),b&&(c.groups.general.fields.operator={type:"combo",multiple:!0,title:b.name,options:[{title:"=",key:"="},{title:"!=",key:"!="},{title:">",key:">"},{title:"<",key:"<"},{title:"between",key:"btw"},{title:"starts with",key:"starts"},{title:"end with",key:"end"},{title:"contains",key:"contains"},{title:"does not contain",key:"notcontain"}]}),c},makeStructure:function(a,c){for(var d,e=0,f=a.length,g={};f>e;e++)if(a[e].groups.general){var h=a[e].groups.defaultVal&&a[e].groups.defaultVal[0].defaultVal[0]?a[e].groups.defaultVal[0].defaultVal[0]:"",i={};switch(a[e].sections.validation&&a[e].sections.validation[0].groups&&""!==a[e].sections.validation[0].groups.general[0].pattern[0]&&(i.rules=[{pattern:a[e].sections.validation[0].groups.general[0].pattern[0],orEmpty:"authorize"==a[e].sections.validation[0].groups.general[0].authorize_empty[0][0],feedback:{_class:!0,message:a[e].sections.validation[0].groups.general[0].neg}}],i.positiveFeedback={message:a[e].sections.validation[0].groups.general[0].pos}),d=a[e].groups.general[0].type[0]){case"slider_range":d="slider"}g[a[e].groups.general[0].name[0]]={type:d,title:a[e].groups.general[0].label[0],"default":h,validation:i},c&&c(a[e],g[a[e].groups.general[0].name[0]]),b(g[a[e].groups.general[0].name[0]],a[e])}return g},makeForm:function(){return new a}}});
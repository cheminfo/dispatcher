Pixastic.Actions.pointillize={process:function(a){var b=Math.max(1,parseInt(a.options.radius,10)),c=Math.min(5,Math.max(0,parseFloat(a.options.density)||0)),d=Math.max(0,parseFloat(a.options.noise)||0),e=!(!a.options.transparent||"false"==a.options.transparent);if(Pixastic.Client.hasCanvasImageData()){var f=a.options.rect,g=f.width,h=f.height,i=h,j=a.canvas.getContext("2d"),k=a.canvas.width,l=a.canvas.height,m=document.createElement("canvas");m.width=m.height=1;var n=m.getContext("2d"),o=document.createElement("canvas");o.width=g,o.height=h;var p=o.getContext("2d");p.drawImage(a.canvas,f.left,f.top,g,h,0,0,g,h);var q=2*b;e&&j.clearRect(f.left,f.top,f.width,f.height);for(var r=b*d,s=1/c,i=0;h+b>i;i+=q*s)for(var t=0;g+b>t;t+=q*s){rndX=d?t+(2*Math.random()-1)*r>>0:t,rndY=d?i+(2*Math.random()-1)*r>>0:i;var u=rndX-b,v=rndY-b;0>u&&(u=0),0>v&&(v=0);var w=rndX+f.left,x=rndY+f.top;0>w&&(w=0),w>k&&(w=k),0>x&&(x=0),x>l&&(x=l);var y=q,z=q;y+u>g&&(y=g-u),z+v>h&&(z=h-v),1>y&&(y=1),1>z&&(z=1),n.drawImage(o,u,v,y,z,0,0,1,1);var A=n.getImageData(0,0,1,1).data;j.fillStyle="rgb("+A[0]+","+A[1]+","+A[2]+")",j.beginPath(),j.arc(w,x,b,0,2*Math.PI,!0),j.closePath(),j.fill()}return a.useData=!1,!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};
Pixastic.Actions.colorhistogram={array256:function(a){arr=[];for(var b=0;256>b;b++)arr[b]=a;return arr},process:function(a){"object"!=typeof a.options.returnValue&&(a.options.returnValue={rvals:[],gvals:[],bvals:[]});var b=!!a.options.paint,c=a.options.returnValue;if("array"!=typeof c.values&&(c.rvals=[],c.gvals=[],c.bvals=[]),Pixastic.Client.hasCanvasImageData()){var d=Pixastic.prepareData(a);a.useData=!1;for(var e=this.array256(0),f=this.array256(0),g=this.array256(0),h=a.options.rect,i=h.width*h.height,j=4*i;i--;)e[d[j-=4]]++,f[d[j+1]]++,g[d[j+2]]++;if(c.rvals=e,c.gvals=f,c.bvals=g,b)for(var k=a.canvas.getContext("2d"),l=[e,f,g],m=0;3>m;m++){for(var n=(m+1)*a.height/3,o=0,p=0;256>p;p++)l[m][p]>o&&(o=l[m][p]);var q=a.height/3/o,r=a.width/256;0==m?k.fillStyle="rgba(255,0,0,0.5)":1==m?k.fillStyle="rgba(0,255,0,0.5)":2==m&&(k.fillStyle="rgba(0,0,255,0.5)");for(var p=0;256>p;p++)k.fillRect(p*r,a.height-q*l[m][p]-a.height+n,r,l[m][p]*q)}return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};
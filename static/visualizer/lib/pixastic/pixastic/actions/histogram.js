Pixastic.Actions.histogram={process:function(a){var b=!(!a.options.average||"false"==a.options.average),c=!(!a.options.paint||"false"==a.options.paint),d=a.options.color||"rgba(255,255,255,0.5)",e=[];"object"!=typeof a.options.returnValue&&(a.options.returnValue={values:[]});var f=a.options.returnValue;if("array"!=typeof f.values&&(f.values=[]),e=f.values,Pixastic.Client.hasCanvasImageData()){var g=Pixastic.prepareData(a);a.useData=!1;for(var h=0;256>h;h++)e[h]=0;var i=a.options.rect,j=i.width*i.height,k=4*j,l=Math.round;if(b)for(;j--;)e[l((g[k-=4]+g[k+1]+g[k+2])/3)]++;else for(;j--;)e[l(.3*g[k-=4]+.59*g[k+1]+.11*g[k+2])]++;if(c){for(var m=0,h=0;256>h;h++)e[h]>m&&(m=e[h]);var n=a.height/m,o=a.width/256,p=a.canvas.getContext("2d");p.fillStyle=d;for(var h=0;256>h;h++)p.fillRect(h*o,a.height-n*e[h],o,e[h]*n)}return f.values=e,!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};
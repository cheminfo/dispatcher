!function(){svgedit.history||(svgedit.history={}),svgedit.history.HistoryEventTypes={BEFORE_APPLY:"before_apply",AFTER_APPLY:"after_apply",BEFORE_UNAPPLY:"before_unapply",AFTER_UNAPPLY:"after_unapply"};svgedit.history.MoveElementCommand=function(a,b,c,d){this.elem=a,this.text=d?"Move "+a.tagName+" to "+d:"Move "+a.tagName,this.oldNextSibling=b,this.oldParent=c,this.newNextSibling=a.nextSibling,this.newParent=a.parentNode},svgedit.history.MoveElementCommand.type=function(){return"svgedit.history.MoveElementCommand"},svgedit.history.MoveElementCommand.prototype.type=svgedit.history.MoveElementCommand.type,svgedit.history.MoveElementCommand.prototype.getText=function(){return this.text},svgedit.history.MoveElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this),this.elem=this.newParent.insertBefore(this.elem,this.newNextSibling),a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)},svgedit.history.MoveElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this),this.elem=this.oldParent.insertBefore(this.elem,this.oldNextSibling),a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)},svgedit.history.MoveElementCommand.prototype.elements=function(){return[this.elem]},svgedit.history.InsertElementCommand=function(a,b){this.elem=a,this.text=b||"Create "+a.tagName,this.parent=a.parentNode,this.nextSibling=this.elem.nextSibling},svgedit.history.InsertElementCommand.type=function(){return"svgedit.history.InsertElementCommand"},svgedit.history.InsertElementCommand.prototype.type=svgedit.history.InsertElementCommand.type,svgedit.history.InsertElementCommand.prototype.getText=function(){return this.text},svgedit.history.InsertElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this),this.elem=this.parent.insertBefore(this.elem,this.nextSibling),a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)},svgedit.history.InsertElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this),this.parent=this.elem.parentNode,this.elem=this.elem.parentNode.removeChild(this.elem),a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)},svgedit.history.InsertElementCommand.prototype.elements=function(){return[this.elem]},svgedit.history.RemoveElementCommand=function(a,b,c,d){this.elem=a,this.text=d||"Delete "+a.tagName,this.nextSibling=b,this.parent=c,svgedit.transformlist.removeElementFromListMap(a)},svgedit.history.RemoveElementCommand.type=function(){return"svgedit.history.RemoveElementCommand"},svgedit.history.RemoveElementCommand.prototype.type=svgedit.history.RemoveElementCommand.type,svgedit.history.RemoveElementCommand.prototype.getText=function(){return this.text},svgedit.history.RemoveElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this),svgedit.transformlist.removeElementFromListMap(this.elem),this.parent=this.elem.parentNode,this.elem=this.parent.removeChild(this.elem),a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)},svgedit.history.RemoveElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this),svgedit.transformlist.removeElementFromListMap(this.elem),null==this.nextSibling&&window.console&&console.log("Error: reference element was lost"),this.parent.insertBefore(this.elem,this.nextSibling),a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)},svgedit.history.RemoveElementCommand.prototype.elements=function(){return[this.elem]},svgedit.history.ChangeElementCommand=function(a,b,c){this.elem=a,this.text=c?"Change "+a.tagName+" "+c:"Change "+a.tagName,this.newValues={},this.oldValues=b;var d;for(d in b)this.newValues[d]="#text"==d?a.textContent:"#href"==d?svgedit.utilities.getHref(a):a.getAttribute(d)},svgedit.history.ChangeElementCommand.type=function(){return"svgedit.history.ChangeElementCommand"},svgedit.history.ChangeElementCommand.prototype.type=svgedit.history.ChangeElementCommand.type,svgedit.history.ChangeElementCommand.prototype.getText=function(){return this.text},svgedit.history.ChangeElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);var b,c=!1;for(b in this.newValues)this.newValues[b]?"#text"==b?this.elem.textContent=this.newValues[b]:"#href"==b?svgedit.utilities.setHref(this.elem,this.newValues[b]):this.elem.setAttribute(b,this.newValues[b]):"#text"==b?this.elem.textContent="":(this.elem.setAttribute(b,""),this.elem.removeAttribute(b)),"transform"==b&&(c=!0);if(!c){var d=svgedit.utilities.getRotationAngle(this.elem);if(d){var e=elem.getBBox(),f=e.x+e.width/2,g=e.y+e.height/2,h=["rotate(",d," ",f,",",g,")"].join("");h!=elem.getAttribute("transform")&&elem.setAttribute("transform",h)}}return a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this),!0},svgedit.history.ChangeElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);var b,c=!1;for(b in this.oldValues)this.oldValues[b]?"#text"==b?this.elem.textContent=this.oldValues[b]:"#href"==b?svgedit.utilities.setHref(this.elem,this.oldValues[b]):this.elem.setAttribute(b,this.oldValues[b]):"#text"==b?this.elem.textContent="":this.elem.removeAttribute(b),"transform"==b&&(c=!0);if(!c){var d=svgedit.utilities.getRotationAngle(this.elem);if(d){var e=elem.getBBox(),f=e.x+e.width/2,g=e.y+e.height/2,h=["rotate(",d," ",f,",",g,")"].join("");h!=elem.getAttribute("transform")&&elem.setAttribute("transform",h)}}return svgedit.transformlist.removeElementFromListMap(this.elem),a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this),!0},svgedit.history.ChangeElementCommand.prototype.elements=function(){return[this.elem]},svgedit.history.BatchCommand=function(a){this.text=a||"Batch Command",this.stack=[]},svgedit.history.BatchCommand.type=function(){return"svgedit.history.BatchCommand"},svgedit.history.BatchCommand.prototype.type=svgedit.history.BatchCommand.type,svgedit.history.BatchCommand.prototype.getText=function(){return this.text},svgedit.history.BatchCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);var b,c=this.stack.length;for(b=0;c>b;++b)this.stack[b].apply(a);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)},svgedit.history.BatchCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);var b;for(b=this.stack.length-1;b>=0;b--)this.stack[b].unapply(a);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)},svgedit.history.BatchCommand.prototype.elements=function(){for(var a=[],b=this.stack.length;b--;)for(var c=this.stack[b].elements(),d=c.length;d--;)-1==a.indexOf(c[d])&&a.push(c[d]);return a},svgedit.history.BatchCommand.prototype.addSubCommand=function(a){this.stack.push(a)},svgedit.history.BatchCommand.prototype.isEmpty=function(){return 0===this.stack.length},svgedit.history.UndoManager=function(a){this.handler_=a||null,this.undoStackPointer=0,this.undoStack=[],this.undoChangeStackPointer=-1,this.undoableChangeStack=[]},svgedit.history.UndoManager.prototype.resetUndoStack=function(){this.undoStack=[],this.undoStackPointer=0},svgedit.history.UndoManager.prototype.getUndoStackSize=function(){return this.undoStackPointer},svgedit.history.UndoManager.prototype.getRedoStackSize=function(){return this.undoStack.length-this.undoStackPointer},svgedit.history.UndoManager.prototype.getNextUndoCommandText=function(){return this.undoStackPointer>0?this.undoStack[this.undoStackPointer-1].getText():""},svgedit.history.UndoManager.prototype.getNextRedoCommandText=function(){return this.undoStackPointer<this.undoStack.length?this.undoStack[this.undoStackPointer].getText():""},svgedit.history.UndoManager.prototype.undo=function(){if(this.undoStackPointer>0){var a=this.undoStack[--this.undoStackPointer];a.unapply(this.handler_)}},svgedit.history.UndoManager.prototype.redo=function(){if(this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0){var a=this.undoStack[this.undoStackPointer++];a.apply(this.handler_)}},svgedit.history.UndoManager.prototype.addCommandToHistory=function(a){this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0&&(this.undoStack=this.undoStack.splice(0,this.undoStackPointer)),this.undoStack.push(a),this.undoStackPointer=this.undoStack.length},svgedit.history.UndoManager.prototype.beginUndoableChange=function(a,b){for(var c=++this.undoChangeStackPointer,d=b.length,e=new Array(d),f=new Array(d);d--;){var g=b[d];null!=g&&(f[d]=g,e[d]=g.getAttribute(a))}this.undoableChangeStack[c]={attrName:a,oldValues:e,elements:f}},svgedit.history.UndoManager.prototype.finishUndoableChange=function(){for(var a=this.undoChangeStackPointer--,b=this.undoableChangeStack[a],c=b.elements.length,d=b.attrName,e=new svgedit.history.BatchCommand("Change "+d);c--;){var f=b.elements[c];if(null!=f){var g={};g[d]=b.oldValues[c],g[d]!=f.getAttribute(d)&&e.addSubCommand(new svgedit.history.ChangeElementCommand(f,g,d))}}return this.undoableChangeStack[a]=null,e}}();
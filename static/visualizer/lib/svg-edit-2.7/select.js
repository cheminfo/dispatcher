!function(){svgedit.select||(svgedit.select={});var a,b,c,d=svgedit.browser.isTouch()?10:4;svgedit.select.Selector=function(b,c){this.id=b,this.selectedElement=c,this.locked=!0,this.selectorGroup=a.createSVGElement({element:"g",attr:{id:"selectorGroup"+this.id}}),this.selectorRect=this.selectorGroup.appendChild(a.createSVGElement({element:"path",attr:{id:"selectedBox"+this.id,fill:"none",stroke:"#22C","stroke-width":"1","stroke-dasharray":"5,5",style:"pointer-events:none"}})),this.gripCoords={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null},this.reset(this.selectedElement)},svgedit.select.Selector.prototype.reset=function(a){this.locked=!0,this.selectedElement=a,this.resize(),this.selectorGroup.setAttribute("display","inline")},svgedit.select.Selector.prototype.updateGripCursors=function(a){var b,d=[],e=Math.round(a/45);0>e&&(e+=8);for(b in c.selectorGrips)d.push(b);for(;e>0;)d.push(d.shift()),e--;var f=0;for(b in c.selectorGrips)c.selectorGrips[b].setAttribute("style","cursor:"+d[f]+"-resize"),f++},svgedit.select.Selector.prototype.showGrips=function(a){var b=a?"inline":"none";c.selectorGripsGroup.setAttribute("display",b);var d=this.selectedElement;this.hasGrips=a,d&&a&&(this.selectorGroup.appendChild(c.selectorGripsGroup),this.updateGripCursors(svgedit.utilities.getRotationAngle(d)))},svgedit.select.Selector.prototype.resize=function(){var b=this.selectorRect,e=c,f=e.selectorGrips,g=this.selectedElement,h=g.getAttribute("stroke-width"),i=a.currentZoom(),j=1/i;"none"===g.getAttribute("stroke")||isNaN(h)||(j+=h/2);var k=g.tagName;"text"===k&&(j+=2/i);var l=svgedit.transformlist.getTransformList(g),m=svgedit.math.transformListToTransform(l).matrix;m.e*=i,m.f*=i;var n=svgedit.utilities.getBBox(g);if("g"===k&&!$.data(g,"gsvg")){var o=a.getStrokedBBox(g.childNodes);o&&(n=o)}var p=n.x,q=n.y,r=n.width,s=n.height;n={x:p,y:q,width:r,height:s},j*=i;var t=svgedit.math.transformBox(p*i,q*i,r*i,s*i,m),u=t.aabox,v=u.x-j,w=u.y-j,x=u.width+2*j,y=u.height+2*j,z=v+x/2,A=w+y/2,B=svgedit.utilities.getRotationAngle(g);if(B){var C=a.svgRoot().createSVGTransform();C.setRotate(-B,z,A);var D=C.matrix;t.tl=svgedit.math.transformPoint(t.tl.x,t.tl.y,D),t.tr=svgedit.math.transformPoint(t.tr.x,t.tr.y,D),t.bl=svgedit.math.transformPoint(t.bl.x,t.bl.y,D),t.br=svgedit.math.transformPoint(t.br.x,t.br.y,D);var E=t.tl,F=E.x,G=E.y,H=E.x,I=E.y,J=Math.min,K=Math.max;F=J(F,J(t.tr.x,J(t.bl.x,t.br.x)))-j,G=J(G,J(t.tr.y,J(t.bl.y,t.br.y)))-j,H=K(H,K(t.tr.x,K(t.bl.x,t.br.x)))+j,I=K(I,K(t.tr.y,K(t.bl.y,t.br.y)))+j,v=F,w=G,x=H-F,y=I-G}var L=a.svgRoot().suspendRedraw(100),M="M"+v+","+w+" L"+(v+x)+","+w+" "+(v+x)+","+(w+y)+" "+v+","+(w+y)+"z";b.setAttribute("d",M);var N=B?"rotate("+[B,z,A].join(",")+")":"";this.selectorGroup.setAttribute("transform",N),this.gripCoords={nw:[v,w],ne:[v+x,w],sw:[v,w+y],se:[v+x,w+y],n:[v+x/2,w],w:[v,w+y/2],e:[v+x,w+y/2],s:[v+x/2,w+y]};var O;for(O in this.gripCoords){var P=this.gripCoords[O];f[O].setAttribute("cx",P[0]),f[O].setAttribute("cy",P[1])}e.rotateGripConnector.setAttribute("x1",v+x/2),e.rotateGripConnector.setAttribute("y1",w),e.rotateGripConnector.setAttribute("x2",v+x/2),e.rotateGripConnector.setAttribute("y2",w-5*d),e.rotateGrip.setAttribute("cx",v+x/2),e.rotateGrip.setAttribute("cy",w-5*d),a.svgRoot().unsuspendRedraw(L)},svgedit.select.SelectorManager=function(){this.selectorParentGroup=null,this.rubberBandBox=null,this.selectors=[],this.selectorMap={},this.selectorGrips={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null},this.selectorGripsGroup=null,this.rotateGripConnector=null,this.rotateGrip=null,this.initGroup()},svgedit.select.SelectorManager.prototype.initGroup=function(){this.selectorParentGroup&&this.selectorParentGroup.parentNode&&this.selectorParentGroup.parentNode.removeChild(this.selectorParentGroup),this.selectorParentGroup=a.createSVGElement({element:"g",attr:{id:"selectorParentGroup"}}),this.selectorGripsGroup=a.createSVGElement({element:"g",attr:{display:"none"}}),this.selectorParentGroup.appendChild(this.selectorGripsGroup),a.svgRoot().appendChild(this.selectorParentGroup),this.selectorMap={},this.selectors=[],this.rubberBandBox=null;var c;for(c in this.selectorGrips){var e=a.createSVGElement({element:"circle",attr:{id:"selectorGrip_resize_"+c,fill:"#22C",r:d,style:"cursor:"+c+"-resize","stroke-width":2,"pointer-events":"all"}});$.data(e,"dir",c),$.data(e,"type","resize"),this.selectorGrips[c]=this.selectorGripsGroup.appendChild(e)}if(this.rotateGripConnector=this.selectorGripsGroup.appendChild(a.createSVGElement({element:"line",attr:{id:"selectorGrip_rotateconnector",stroke:"#22C","stroke-width":"1"}})),this.rotateGrip=this.selectorGripsGroup.appendChild(a.createSVGElement({element:"circle",attr:{id:"selectorGrip_rotate",fill:"lime",r:d,stroke:"#22C","stroke-width":2,style:"cursor:url("+b.imgPath+"rotate.png) 12 12, auto;"}})),$.data(this.rotateGrip,"type","rotate"),!$("#canvasBackground").length){var f=b.dimensions,g=a.createSVGElement({element:"svg",attr:{id:"canvasBackground",width:f[0],height:f[1],x:0,y:0,overflow:svgedit.browser.isWebkit()?"none":"visible",style:"pointer-events:none"}}),h=a.createSVGElement({element:"rect",attr:{width:"100%",height:"100%",x:0,y:0,"stroke-width":1,stroke:"#000",fill:"#FFF",style:"pointer-events:none"}});g.appendChild(h),a.svgRoot().insertBefore(g,a.svgContent())}},svgedit.select.SelectorManager.prototype.requestSelector=function(a){if(null==a)return null;var b,c=this.selectors.length;if("object"==typeof this.selectorMap[a.id])return this.selectorMap[a.id].locked=!0,this.selectorMap[a.id];for(b=0;c>b;++b)if(this.selectors[b]&&!this.selectors[b].locked)return this.selectors[b].locked=!0,this.selectors[b].reset(a),this.selectorMap[a.id]=this.selectors[b],this.selectors[b];return this.selectors[c]=new svgedit.select.Selector(c,a),this.selectorParentGroup.appendChild(this.selectors[c].selectorGroup),this.selectorMap[a.id]=this.selectors[c],this.selectors[c]},svgedit.select.SelectorManager.prototype.releaseSelector=function(a){if(null!=a){var b,c=this.selectors.length,d=this.selectorMap[a.id];for(b=0;c>b;++b)if(this.selectors[b]&&this.selectors[b]==d){0==d.locked&&console.log("WARNING! selector was released but was already unlocked"),delete this.selectorMap[a.id],d.locked=!1,d.selectedElement=null,d.showGrips(!1);try{d.selectorGroup.setAttribute("display","none")}catch(e){}break}}},svgedit.select.SelectorManager.prototype.getRubberBandBox=function(){return this.rubberBandBox||(this.rubberBandBox=this.selectorParentGroup.appendChild(a.createSVGElement({element:"rect",attr:{id:"selectorRubberBand",fill:"#22C","fill-opacity":.15,stroke:"#22C","stroke-width":.5,display:"none",style:"pointer-events:none"}}))),this.rubberBandBox},svgedit.select.init=function(d,e){b=d,a=e,c=new svgedit.select.SelectorManager},svgedit.select.getSelectorManager=function(){return c}}();
svgEditor.addExtension("Arrows",function(a){function b(a,b){o=!0,l=q+b+"_",k.fw.id=l+"fw",k.bk.id=l+"bk"}function c(){o=!1,l=q,k.fw.id=l+"fw",k.bk.id=l+"bk"}function d(b,c){var d=b.getAttribute(c);if(!d)return null;var e=d.match(/\(\#(.*)\)/);return e&&2===e.length?a.getElem(e[1]):null}function e(a){if($("#arrow_panel").toggle(a),a){var b,c=j[0],d=c.getAttribute("marker-end"),e=c.getAttribute("marker-start"),f=c.getAttribute("marker-mid");d&&e?b="both":d?b="end":e?b="start":f&&(b="mid",-1!==f.indexOf("bk")&&(b="mid_bk")),e||f||d||(b="none"),$("#arrow_list").val(b)}}function f(){var a=j[0];a.removeAttribute("marker-start"),a.removeAttribute("marker-mid"),a.removeAttribute("marker-end")}function g(b,c,d){d=d||l+b;var e=a.getElem(d),f=k[b];if("mid"==c&&(f.refx=5),!e){e=m({element:"marker",attr:{viewBox:"0 0 10 10",id:d,refY:5,markerUnits:"strokeWidth",markerWidth:5,markerHeight:5,orient:"auto",style:"pointer-events:none"}});var g=m({element:"path",attr:{d:f.d,fill:"#000000"}});e.appendChild(g),a.findDefs().appendChild(e)}return e.setAttribute("refX",f.refx),e}function h(){var b=this.value;if(f(),"none"!=b){var c="fw";"mid_bk"==b?(b="mid",c="bk"):"both"==b?(g("bk",b),svgCanvas.changeSelectedAttribute("marker-start","url(#"+k.bk.id+")"),b="end",c="fw"):"start"==b&&(c="bk"),g(c,b),svgCanvas.changeSelectedAttribute("marker-"+b,"url(#"+k[c].id+")"),a.call("changed",j)}}function i(b){var c=b.getAttribute("stroke"),e=["start","mid","end"],f=a.findDefs();$.each(e,function(h,i){var j=d(b,"marker-"+i);if(j){var k=$(j).children().attr("fill"),m=$(j).children().attr("d"),n=null;if(k!==c){var o=$(f).find("marker");if(o.each(function(){var a=$(this).children().attr(["fill","d"]);a.fill===c&&a.d===m&&(n=this)}),!n){var p=j.id,q=-1!==p.indexOf("_fw")?"fw":"bk";n=g(q,i,l+q+o.length),$(n).children().attr("fill",c)}$(b).attr("marker-"+i,"url(#"+n.id+")");var r=!0;$(a.svgcontent).find("line, polyline, path, polygon").each(function(){var a=this;return $.each(e,function(b,c){return $(a).attr("marker-"+c)==="url(#"+j.id+")"?r=!1:void 0}),r?void 0:!1}),r&&$(j).remove()}}})}var j,k,l,m=(a.svgcontent,a.addSvgElementFromJson),n=a.nonce,o=a.randomize_ids,p={en:[{id:"arrow_none",textContent:"No arrow"}],fr:[{id:"arrow_none",textContent:"Sans fl√®che"}]},q="se_arrow_";return svgCanvas.bind("setnonce",b),svgCanvas.bind("unsetnonce",c),l=o?q+n+"_":q,k={fw:{d:"m0,0l10,5l-10,5l5,-5l-5,-5z",refx:8,id:l+"fw"},bk:{d:"m10,0l-10,5l10,5l-5,-5l5,-5z",refx:2,id:l+"bk"}},{name:"Arrows",context_tools:[{type:"select",panel:"arrow_panel",title:"Select arrow type",id:"arrow_list",options:{none:"No arrow",end:"----&gt;",start:"&lt;----",both:"&lt;---&gt;",mid:"--&gt;--",mid_bk:"--&lt;--"},defval:"none",events:{change:h}}],callback:function(){$("#arrow_panel").hide(),$("#arrow_list option")[0].id="connector_no_arrow"},addLangData:function(a){return{data:p[a]}},selectedChanged:function(a){j=a.elems;for(var b=j.length,c=["line","path","polyline","polygon"];b--;){var d=j[b];e(d&&-1!==$.inArray(d.tagName,c)?a.selectedElement&&!a.multiselected?!0:!1:!1)}},elementChanged:function(a){var b=a.elems[0];b&&(b.getAttribute("marker-start")||b.getAttribute("marker-mid")||b.getAttribute("marker-end"))&&i(b)}}});
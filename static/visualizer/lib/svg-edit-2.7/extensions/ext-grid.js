svgEditor.addExtension("view_grid",function(){function a(a){var b,c=h[svgEditor.curConfig.baseUnit],d=c*a,e=100/d,g=1;for(b=0;b<i.length;b++){var j=i[b];if(g=j,j>=e)break}var k=g*d;f.width=k,f.height=k;var m=f.getContext("2d"),n=.5,o=k/10;for(m.globalAlpha=.2,m.strokeStyle=svgEditor.curConfig.gridColor,b=1;10>b;b++){var p=Math.round(o*b)+.5,q=0;m.moveTo(p,k),m.lineTo(p,q),m.moveTo(k,p),m.lineTo(q,p)}m.stroke(),m.beginPath(),m.globalAlpha=.5,m.moveTo(n,k),m.lineTo(n,0),m.moveTo(k,n),m.lineTo(0,n),m.stroke();var r=f.toDataURL("image/png");l.setAttribute("width",k),l.setAttribute("height",k),l.parentNode.setAttribute("width",k),l.parentNode.setAttribute("height",k),svgCanvas.setHref(l,r)}var b=svgedit.NS,c=document.getElementById("svgcanvas").ownerDocument,d=!1,e=svgCanvas.assignAttributes,f=document.createElement("canvas"),g=$("#canvasBackground"),h=svgedit.units.getTypeMap(),i=[.01,.1,1,10,100,1e3];$(f).hide().appendTo("body");var j=c.createElementNS(b.SVG,"svg");e(j,{id:"canvasGrid",width:"100%",height:"100%",x:0,y:0,overflow:"visible",display:"none"}),g.append(j);var k=c.createElementNS(b.SVG,"pattern");e(k,{id:"gridpattern",patternUnits:"userSpaceOnUse",x:0,y:0,width:100,height:100});var l=c.createElementNS(b.SVG,"image");e(l,{x:0,y:0,width:100,height:100}),k.appendChild(l),$("#svgroot defs").append(k);var m=c.createElementNS(b.SVG,"rect");return e(m,{width:"100%",height:"100%",x:0,y:0,"stroke-width":0,stroke:"none",fill:"url(#gridpattern)",style:"pointer-events: none; display:visible;"}),$("#canvasGrid").append(m),{name:"view_grid",svgicons:svgEditor.curConfig.extPath+"grid-icon.xml",zoomChanged:function(b){d&&a(b)},buttons:[{id:"view_grid",type:"context",panel:"editor_panel",title:"Show/Hide Grid",events:{click:function(){svgEditor.curConfig.showGrid=d=!d,d&&a(svgCanvas.getZoom()),$("#canvasGrid").toggle(d),$("#view_grid").toggleClass("push_button_pressed tool_button")}}}]}});
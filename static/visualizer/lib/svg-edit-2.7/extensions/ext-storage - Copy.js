svgEditor.addExtension("storage",function(){function a(a){a=a?"storagePrompt="+a:"",window.location.href.indexOf("storagePrompt=")>-1?window.location.href=window.location.href.replace(/([&?])storagePrompt=[^&]*/,(a?"$1":"")+a):window.location.href+=(window.location.href.indexOf("?")>-1?"&":"?")+a}function b(a){if(window.localStorage){var b="svgedit-"+svgEditor.curConfig.canvasName;window.localStorage.setItem(b,a)}}function c(){document.cookie="store=",b("")}function d(){window.addEventListener("beforeunload",function(){if(document.cookie.match(/store=(?:prefsAndContent|prefsOnly)/)){var a;b(svgCanvas.getSvgString()),svgEditor.showSaveWarning=!1;var c=svgEditor.curConfig;for(a in c)if(c.hasOwnProperty(a)){var d,e=svgEditor.storage,f=c[a],g=void 0!=f;if(a="svg-edit-"+a,!g)continue;e?e.setItem(a,f):window.widget?widget.setPreferenceForKey(f,a):(d=new Date,d.setTime(d.getTime()+31536e6),f=encodeURIComponent(f),document.cookie=a+"="+f+"; expires="+d.toUTCString())}}},!1)}var e=!1,f="noPrefsOrContent";return{name:"storage",langReady:function(b,g){var h=$.deparam.querystring(!0).storagePrompt;if(h===!0||h!==!1&&!document.cookie.match(/store=(?:prefsAndContent|prefsOnly)/)){var i=[];window.localStorage?i.unshift({value:"prefsAndContent",text:g.confirmSetStorage.storagePrefsAndContent},{value:"prefsOnly",text:g.confirmSetStorage.storagePrefsOnly},{value:"noPrefsOrContent",text:g.confirmSetStorage.storageNoPrefsOrContent}):i.unshift({value:"prefsOnly",text:g.confirmSetStorage.storagePrefs},{value:"noPrefsOrContent",text:g.confirmSetStorage.storageNoPrefs});var j=$("#dialog_container")[0].style.width,k=$("#dialog_container")[0].style.marginLeft,l=$("#dialog_content")[0].style.height,m=$("#dialog_container")[0].style.height;$("#dialog_content")[0].style.height="120px",$("#dialog_container")[0].style.height="170px",$("#dialog_container")[0].style.width="800px",$("#dialog_container")[0].style.marginLeft="-400px",$.select(g.confirmSetStorage.message,i,function(b,g){return h===!0&&b&&"noPrefsOrContent"!==b?void a():(b&&"noPrefsOrContent"!==b?document.cookie="store="+b:(e&&c(),g&&a("false")),f=b,$("#dialog_container")[0].style.width=j,$("#dialog_container")[0].style.marginLeft=k,$("#dialog_content")[0].style.height=l,$("#dialog_container")[0].style.height=m,d(),void(Editor.storagePromptClosed=!0))},null,null,{label:g.confirmSetStorage.rememberLabel,checked:!1,tooltip:g.confirmSetStorage.rememberTooltip})}else d()}}});
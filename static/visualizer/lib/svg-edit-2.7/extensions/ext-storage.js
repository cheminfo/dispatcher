svgEditor.addExtension("storage",function(){function a(a){a=a?"storagePrompt="+a:"";var b=top.location;b.href.indexOf("storagePrompt=")>-1?b.href=b.href.replace(/([&?])storagePrompt=[^&]*(&?)/,function(b,c,d){return(a?c:"")+a+(!a&&d?c:d||"")}):b.href+=(b.href.indexOf("?")>-1?"&":"?")+a}function b(a){if(j){var b="svgedit-"+svgEditor.curConfig.canvasName;a?j.setItem(b,a):j.removeItem(b)}}function c(a){document.cookie=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"}function d(){c("store")}function e(){b("");var a;for(a in svgEditor.curPrefs)svgEditor.curPrefs.hasOwnProperty(a)&&(a="svg-edit-"+a,j&&j.removeItem(a),c(a))}function f(){window.addEventListener("beforeunload",function(){if(document.cookie.match(/(?:^|;\s*)store=(?:prefsAndContent|prefsOnly)/)){var a;document.cookie.match(/(?:^|;\s*)store=prefsAndContent/)&&b(svgCanvas.getSvgString()),svgEditor.setConfig({no_save_warning:!0});var c=svgEditor.curPrefs;for(a in c)if(c.hasOwnProperty(a)){var d=c[a],e=void 0!=d;if(a="svg-edit-"+a,!e)continue;j?j.setItem(a,d):window.widget?widget.setPreferenceForKey(d,a):(d=encodeURIComponent(d),document.cookie=encodeURIComponent(a)+"="+d+"; expires=Fri, 31 Dec 9999 23:59:59 GMT")}}},!1)}var g=svgEditor.curConfig.emptyStorageOnDecline,h=svgEditor.curConfig.noStorageOnLoad,i=svgEditor.curConfig.forceStorage,j=svgEditor.storage,k=!1;return{name:"storage",langReady:function(b){var c=b.uiStrings,l=$.deparam.querystring(!0).storagePrompt;if(!k)if(k=!0,i||l!==!0&&(l===!1||document.cookie.match(/(?:^|;\s*)store=(?:prefsAndContent|prefsOnly)/)))(!h||i)&&f();else{var m=[];j?m.unshift({value:"prefsAndContent",text:c.confirmSetStorage.storagePrefsAndContent},{value:"prefsOnly",text:c.confirmSetStorage.storagePrefsOnly},{value:"noPrefsOrContent",text:c.confirmSetStorage.storageNoPrefsOrContent}):m.unshift({value:"prefsOnly",text:c.confirmSetStorage.storagePrefs},{value:"noPrefsOrContent",text:c.confirmSetStorage.storageNoPrefs});var n=$("#dialog_container")[0].style.width,o=$("#dialog_container")[0].style.marginLeft,p=$("#dialog_content")[0].style.height,q=$("#dialog_container")[0].style.height;$("#dialog_content")[0].style.height="120px",$("#dialog_container")[0].style.height="170px",$("#dialog_container")[0].style.width="800px",$("#dialog_container")[0].style.marginLeft="-400px",$.select(c.confirmSetStorage.message,m,function(b,c){if(b&&"noPrefsOrContent"!==b){if(document.cookie="store="+encodeURIComponent(b)+"; expires=Fri, 31 Dec 9999 23:59:59 GMT",l===!0&&c)return void a()}else if(d(),b&&g&&e(),b&&c)return void a("false");$("#dialog_container")[0].style.width=n,$("#dialog_container")[0].style.marginLeft=o,$("#dialog_content")[0].style.height=p,$("#dialog_container")[0].style.height=q,f(),svgEditor.storagePromptClosed=!0},null,null,{label:c.confirmSetStorage.rememberLabel,checked:!1,tooltip:c.confirmSetStorage.rememberTooltip})}}}});
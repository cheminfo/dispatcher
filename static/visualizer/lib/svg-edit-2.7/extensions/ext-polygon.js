svgEditor.addExtension("polygon",function(a){function b(a){var b=$("#fc_rules");b.length||(b=$('<style id="fc_rules"></style>').appendTo("head")),b.text(a?" #tool_topath { display: none !important; }":""),$("#polygon_panel").toggle(a)}function c(b,c){svgCanvas.changeSelectedAttribute(b,c),a.call("changed",f)}function d(a){return 1/Math.tan(a)}function e(a){return 1/Math.cos(a)}var f,g,h,i,j,k=!1;return{name:"polygon",svgicons:svgEditor.curConfig.extPath+"polygon-icons.svg",buttons:[{id:"tool_polygon",type:"mode",title:"Polygon Tool",position:11,events:{click:function(){svgCanvas.setMode("polygon"),b(!0)}}}],context_tools:[{type:"input",panel:"polygon_panel",title:"Number of Sides",id:"polySides",label:"sides",size:3,defval:5,events:{change:function(){c("sides",this.value)}}}],callback:function(){$("#polygon_panel").hide();var a=function(){};setTimeout(function(){$("#tool_source_save").clone().hide().attr("id","polygon_save").unbind().appendTo("#tool_source_back").click(function(){k&&(setItexString($("#svg_source_textarea").val())?a():$.confirm("Errors found. Revert to original?",function(b){return b?void a():!1}))}),$("#tool_source_cancel").clone().hide().attr("id","polygon_cancel").unbind().appendTo("#tool_source_back").click(function(){a()})},3e3)},mouseDown:function(b){var c=svgCanvas.getColor("fill");i=c.substring(1,c.length);var d=svgCanvas.getColor("stroke"),e=svgCanvas.getStrokeWidth();return"polygon"==svgCanvas.getMode()?(g=!0,h=a.addSvgElementFromJson({element:"polygon",attr:{cx:b.start_x,cy:b.start_y,id:a.getNextId(),shape:"regularPoly",sides:document.getElementById("polySides").value,orient:"x",edge:0,fill:c,strokecolor:d,strokeWidth:e}}),{started:!0}):void 0},mouseMove:function(a){if(g&&"polygon"==svgCanvas.getMode()){var b=a.mouse_x,c=a.mouse_y,f=$(h).attr(["cx","cy","sides","orient","fill","strokecolor","strokeWidth"]),i=f.cx,k=f.cy,l=f.fill,m=f.strokecolor,n=f.strokeWidth,o=f.sides,p=Math.sqrt((b-i)*(b-i)+(c-k)*(c-k))/1.5;h.setAttributeNS(null,"edge",p);var q,r=p/2*d(Math.PI/o),s=r*e(Math.PI/o),t="";for(q=0;o>=q;q++){var u=2*Math.PI*q/o;b=s*Math.cos(u)+i,c=s*Math.sin(u)+k,t+=b+","+c+" "}return h.setAttributeNS(null,"points",t),h.setAttributeNS(null,"fill",l),h.setAttributeNS(null,"stroke",m),h.setAttributeNS(null,"stroke-width",n),j=h.getAttributeNS(null,"shape"),{started:!0}}},mouseUp:function(){if("polygon"==svgCanvas.getMode()){var a=$(h).attr("edge"),b=0!=a.edge;return{keep:b,element:h}}},selectedChanged:function(a){f=a.elems;for(var c=f.length;c--;){var d=f[c];d&&"regularPoly"===d.getAttributeNS(null,"shape")?a.selectedElement&&!a.multiselected?($("#polySides").val(d.getAttribute("sides")),b(!0)):b(!1):b(!1)}},elementChanged:function(){}}});
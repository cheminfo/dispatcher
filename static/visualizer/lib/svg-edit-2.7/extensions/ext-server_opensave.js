svgEditor.addExtension("server_opensave",{callback:function(){function a(){var a=svgCanvas.getDocumentTitle();return $.trim(a).replace(/[\/\\:*?"<>|]/g,"_")}function b(a){return a.replace(/&(?!amp;)/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;")}function c(a,b,c){var d,e=""===$("<a>")[0].download;return e?(d=$("<a>hidden</a>").attr({download:(a||"image")+b,href:c}).css("display","none").appendTo("body"),d[0].click(),!0):void 0}function d(a){function b(){a.submit(),d(a),$.process_cancel("Uploading...",function(){m=!0,$("#dialog_box").hide()})}a.empty();var c=$('<input type="file" name="svg_file">').appendTo(a);c.change(a[0]==h[0]?function(){svgEditor.openPrep(function(c){return c?void b():void d(a)})}:function(){b()})}var e,f,g,h,i,j,k=svgEditor.curConfig.extPath+"filesave.php",l=svgEditor.curConfig.extPath+"filesave.php",m=!1;$('<iframe name="output_frame" src="#"/>').hide().appendTo("body"),svgEditor.setCustomHandlers({save:function(d,e){var f='<?xml version="1.0" encoding="UTF-8"?>\n'+e,g=a();c(g,".svg","data:image/svg+xml;charset=UTF-8;base64,"+svgedit.utilities.encode64(f))||$("<form>").attr({method:"post",action:k,target:"output_frame"}).append('<input type="hidden" name="output_svg" value="'+b(f)+'">').append('<input type="hidden" name="filename" value="'+b(g)+'">').appendTo("body").submit().remove()},exportImage:function(d,e){var f,g=e.issues,h=e.mimeType,i=e.quality;$("#export_canvas").length||$("<canvas>",{id:"export_canvas"}).hide().appendTo("body"),f=$("#export_canvas")[0],f.width=svgCanvas.contentW,f.height=svgCanvas.contentH,canvg(f,e.svg,{renderCallback:function(){var d,j,k,m=i?f.toDataURL(h,i):f.toDataURL(h),n="";g.length&&(d="\n â€¢ ",n+="\n\n"+d+g.join(d)),n.length&&alert(n),j=a(),k="."+e.type.toLowerCase(),c(j,k,m)||$("<form>").attr({method:"post",action:l,target:"output_frame"}).append('<input type="hidden" name="output_img" value="'+m+'">').append('<input type="hidden" name="mime" value="'+h+'">').append('<input type="hidden" name="filename" value="'+b(j)+'">').appendTo("body").submit().remove()}})}}),window.FileReader||(e=svgEditor.curConfig.extPath+"fileopen.php?type=load_svg",f=svgEditor.curConfig.extPath+"fileopen.php?type=import_svg",g=svgEditor.curConfig.extPath+"fileopen.php?type=import_img",svgEditor.processFile=function(a,b){var c;if(m)return void(m=!1);switch($("#dialog_box").hide(),"import_img"!==b&&(c=svgedit.utilities.decode64(a)),b){case"load_svg":svgCanvas.clear(),svgCanvas.setSvgString(c),svgEditor.updateCanvas();break;case"import_svg":svgCanvas.importSvgString(c),svgEditor.updateCanvas();break;case"import_img":svgCanvas.setGoodImage(a)}},h=$("<form>"),h.attr({enctype:"multipart/form-data",method:"post",action:e,target:"output_frame"}),i=h.clone().attr("action",f),j=h.clone().attr("action",g),d(h),d(i),d(j),$("#tool_open").show().prepend(h),$("#tool_import").show().prepend(i),$("#tool_image").prepend(j))}});
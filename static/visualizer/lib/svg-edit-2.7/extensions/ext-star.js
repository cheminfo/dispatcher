svgEditor.addExtension("star",function(a){function b(a){var b=$("#fc_rules");b.length||(b=$('<style id="fc_rules"></style>').appendTo("head")),b.text(a?" #tool_topath { display: none !important; }":""),$("#star_panel").toggle(a)}function c(b,c){svgCanvas.changeSelectedAttribute(b,c),a.call("changed",d)}var d,e,f,g;return{name:"star",svgicons:svgEditor.curConfig.extPath+"star-icons.svg",buttons:[{id:"tool_star",type:"mode",title:"Star Tool",position:12,events:{click:function(){b(!0),svgCanvas.setMode("star")}}}],context_tools:[{type:"input",panel:"star_panel",title:"Number of Sides",id:"starNumPoints",label:"points",size:3,defval:5,events:{change:function(){c("point",this.value)}}},{type:"input",panel:"star_panel",title:"Pointiness",id:"starRadiusMulitplier",label:"Pointiness",size:3,defval:2.5},{type:"input",panel:"star_panel",title:"Twists the star",id:"radialShift",label:"Radial Shift",size:3,defval:0,events:{change:function(){c("radialshift",this.value)}}}],callback:function(){$("#star_panel").hide()},mouseDown:function(b){var c=svgCanvas.getColor("fill"),d=svgCanvas.getColor("stroke"),g=svgCanvas.getStrokeWidth();return"star"==svgCanvas.getMode()?(e=!0,f=a.addSvgElementFromJson({element:"polygon",attr:{cx:b.start_x,cy:b.start_y,id:a.getNextId(),shape:"star",point:document.getElementById("starNumPoints").value,r:0,radialshift:document.getElementById("radialShift").value,r2:0,orient:"point",fill:c,strokecolor:d,strokeWidth:g}}),{started:!0}):void 0},mouseMove:function(a){if(e&&"star"==svgCanvas.getMode()){var b=a.mouse_x,c=a.mouse_y,d=$(f).attr(["cx","cy","point","orient","fill","strokecolor","strokeWidth","radialshift"]),h=d.cx,i=d.cy,j=d.fill,k=d.strokecolor,l=d.strokeWidth,m=d.radialshift,n=d.point,o=d.orient,p=Math.sqrt((b-h)*(b-h)+(c-i)*(c-i))/1.5,q=p/document.getElementById("starRadiusMulitplier").value;f.setAttributeNS(null,"r",p),f.setAttributeNS(null,"r2",q);var r,s="";for(r=0;n>=r;r++){var t=2*Math.PI*(r/n);"point"==o?t-=Math.PI/2:"edge"==o&&(t=t+Math.PI/n-Math.PI/2),b=p*Math.cos(t)+h,c=p*Math.sin(t)+i,s+=b+","+c+" ",null!=q&&(t=2*Math.PI*(r/n)+Math.PI/n,"point"==o?t-=Math.PI/2:"edge"==o&&(t=t+Math.PI/n-Math.PI/2),t+=m,b=q*Math.cos(t)+h,c=q*Math.sin(t)+i,s+=b+","+c+" ")}return f.setAttributeNS(null,"points",s),f.setAttributeNS(null,"fill",j),f.setAttributeNS(null,"stroke",k),f.setAttributeNS(null,"stroke-width",l),g=f.getAttributeNS(null,"shape"),{started:!0}}},mouseUp:function(){if("star"==svgCanvas.getMode()){var a=$(f).attr(["r"]);return{keep:0!=a.r,element:f}}},selectedChanged:function(a){d=a.elems;for(var c=d.length;c--;){var e=d[c];e&&"star"===e.getAttributeNS(null,"shape")?a.selectedElement&&!a.multiselected?($("#starNumPoints").val(e.getAttribute("point")),$("#radialShift").val(e.getAttribute("radialshift")),b(!0)):b(!1):b(!1)}},elementChanged:function(){}}});
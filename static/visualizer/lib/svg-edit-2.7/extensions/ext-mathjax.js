svgEditor.addExtension("mathjax",function(){function a(){var a=$("#mathjax_code_textarea").val();MathJax.Hub.queue.Push(["Text",b,"\\displaystyle{"+a+"}"]),MathJax.Hub.queue.Push(function(){var a=$(".MathJax_SVG"),b=$(a.html());b.find("use").each(function(){var a,b,c,d;c=$(this).attr("href")?$(this).attr("href").slice(1):$(this).attr("xlink:href").slice(1);var e=$("#"+c).clone().removeAttr("id");a=$(this).attr("x"),b=$(this).attr("y"),d=$(this).attr("transform"),d&&(a||b)?e.attr("transform",d+" translate("+a+","+b+")"):d?e.attr("transform",d):(a||b)&&e.attr("transform","translate("+a+","+b+")"),$(this).replaceWith(e)}),b.removeAttr("style"),b.attr("xmlns","http://www.w3.org/2000/svg"),svgCanvas.importSvgString($("<div>").append(b.clone()).html(),!0),svgCanvas.ungroupSelectedElement(),svgCanvas.moveSelectedElements(c,d,!0)})}var b,c,d,e="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js",f=!1,g=svgEditor.uiStrings;return $.extend(g,{mathjax:{embed_svg:"Save as mathematics",embed_mathml:"Save as figure",svg_save_warning:"The math will be transformed into a figure is manipulatable like everything else. You will not be able to manipulate the TeX-code anymore. ",mathml_save_warning:"Advised. The math will be saved as a figure.",title:"Mathematics code editor"}}),{name:"MatJax",svgicons:svgEditor.curConfig.extPath+"mathjax-icons.xml",buttons:[{id:"tool_mathjax",type:"mode",title:"Add Mathematics",events:{click:function(){f===!1&&($('<div id="mathjax">                <!-- Here is where MathJax creates the math -->                  <div id="mathjax_creator" class="tex2jax_process" style="display:none">                    $${}$$                  </div>                  <div id="mathjax_overlay"></div>                  <div id="mathjax_container">                    <div id="tool_mathjax_back" class="toolbar_button">                      <button id="tool_mathjax_save">OK</button>                      <button id="tool_mathjax_cancel">Cancel</button>                    </div>                    <fieldset>                      <legend id="mathjax_legend">Mathematics Editor</legend>                      <label>                        <span id="mathjax_explication">Please type your mathematics in                         <a href="http://en.wikipedia.org/wiki/Help:Displaying_a_formula" target="_blank">TeX</a> code.</span></label>                      <textarea id="mathjax_code_textarea" spellcheck="false"></textarea>                    </fieldset>                  </div>                </div>').insertAfter("#svg_prefs").hide(),$("#mathjax_container").draggable({cancel:"button,fieldset",containment:"window"}),$("#tool_mathjax_cancel").prepend($.getSvgIcon("cancel",!0)).on("click touched",function(){$("#mathjax").hide()}),$("#tool_mathjax_save").prepend($.getSvgIcon("ok",!0)).on("click touched",function(){a(),$("#mathjax").hide()}),$("body").addClass("tex2jax_ignore"),$.getScript(e).done(function(){MathJax.Hub.queue.Push(function(){b=MathJax.Hub.getAllJax("#mathjax_creator")[0],console.log(b),f=!0,console.log("MathJax Loaded")})}).fail(function(){console.log("Failed loadeing MathJax."),$.alert("Failed loading MathJax. You will not be able to change the mathematics.")})),svgCanvas.setMode("mathjax")}}}],mouseDown:function(){return"mathjax"===svgCanvas.getMode()?{started:!0}:void 0},mouseUp:function(a){if("mathjax"===svgCanvas.getMode()){var b=svgCanvas.getZoom();return c=a.mouse_x/b,d=a.mouse_y/b,$("#mathjax").show(),{started:!1}}},callback:function(){$("<style>").text("				#mathjax fieldset{					padding: 5px;					margin: 5px;					border: 1px solid #DDD;				}				#mathjax label{					display: block;					margin: .5em;				}				#mathjax legend {					max-width:195px;				}				#mathjax_overlay {					position: absolute;					top: 0;					left: 0;					right: 0;					bottom: 0;					background-color: black;					opacity: 0.6;					z-index: 20000;				}								#mathjax_container {					position: absolute;					top: 50px;					padding: 10px;					background-color: #B0B0B0;					border: 1px outset #777;					opacity: 1.0;					font-family: Verdana, Helvetica, sans-serif;					font-size: .8em;					z-index: 20001;				}								#tool_mathjax_back {					margin-left: 1em;					overflow: auto;				}								#mathjax_legend{					font-weight: bold;					font-size:1.1em;				}								#mathjax_code_textarea {\\n          margin: 5px .7em;					overflow: hidden;          width: 416px;					display: block;					height: 100px;				}			").appendTo("head")}}});
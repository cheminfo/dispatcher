!function(){svgedit.path||(svgedit.path={});var a=svgedit.NS,b={pathNodeTooltip:"Drag node to move it. Double-click node to change segment type",pathCtrlPtTooltip:"Drag control point to adjust curve properties"},c={2:["x","y"],4:["x","y"],6:["x","y","x1","y1","x2","y2"],8:["x","y","x1","y1"],10:["x","y","r1","r2","angle","largeArcFlag","sweepFlag"],12:["x"],14:["y"],16:["x","y","x2","y2"],18:["x","y"]},d=[],e=!0,f={};svgedit.path.setLinkControlPoints=function(a){e=a},svgedit.path.path=null;var g=null;svgedit.path.init=function(a){g=a,d=[0,"ClosePath"];var b=["Moveto","Lineto","CurvetoCubic","CurvetoQuadratic","Arc","LinetoHorizontal","LinetoVertical","CurvetoCubicSmooth","CurvetoQuadraticSmooth"];$.each(b,function(a,b){d.push(b+"Abs"),d.push(b+"Rel")})},svgedit.path.insertItemBefore=function(a,b,c){var d=a.pathSegList;if(svgedit.browser.supportsPathInsertItemBefore())return void d.insertItemBefore(b,c);var e,f=d.numberOfItems,g=[];for(e=0;f>e;e++){var h=d.getItem(e);g.push(h)}for(d.clear(),e=0;f>e;e++)e==c&&d.appendItem(b),d.appendItem(g[e])},svgedit.path.ptObjToArr=function(a,b){var d,e=c[a],f=e.length,g=[];for(d=0;f>d;d++)g[d]=b[e[d]];return g},svgedit.path.getGripPt=function(a,b){var c={x:b?b.x:a.item.x,y:b?b.y:a.item.y},d=a.path;if(d.matrix){var e=svgedit.math.transformPoint(c.x,c.y,d.matrix);c=e}return c.x*=g.getCurrentZoom(),c.y*=g.getCurrentZoom(),c},svgedit.path.getPointFromGrip=function(a,b){var c={x:a.x,y:a.y};return b.matrix&&(a=svgedit.math.transformPoint(c.x,c.y,b.imatrix),c.x=a.x,c.y=a.y),c.x/=g.getCurrentZoom(),c.y/=g.getCurrentZoom(),c},svgedit.path.addPointGrip=function(c,d,e){var f=svgedit.path.getGripContainer(),g=svgedit.utilities.getElem("pathpointgrip_"+c);if(!g){g=document.createElementNS(a.SVG,"circle"),svgedit.utilities.assignAttributes(g,{id:"pathpointgrip_"+c,display:"none",r:4,fill:"#0FF",stroke:"#00F","stroke-width":2,cursor:"move",style:"pointer-events:all","xlink:title":b.pathNodeTooltip}),g=f.appendChild(g);var h=$("#pathpointgrip_"+c);h.dblclick(function(){svgedit.path.path&&svgedit.path.path.setSegType()})}return d&&e&&svgedit.utilities.assignAttributes(g,{cx:d,cy:e,display:"inline"}),g},svgedit.path.getGripContainer=function(){var b=svgedit.utilities.getElem("pathpointgrip_container");if(!b){var c=svgedit.utilities.getElem("selectorParentGroup");b=c.appendChild(document.createElementNS(a.SVG,"g")),b.id="pathpointgrip_container"}return b},svgedit.path.addCtrlGrip=function(c){var d=svgedit.utilities.getElem("ctrlpointgrip_"+c);return d?d:(d=document.createElementNS(a.SVG,"circle"),svgedit.utilities.assignAttributes(d,{id:"ctrlpointgrip_"+c,display:"none",r:4,fill:"#0FF",stroke:"#55F","stroke-width":1,cursor:"move",style:"pointer-events:all","xlink:title":b.pathCtrlPtTooltip}),svgedit.path.getGripContainer().appendChild(d),d)},svgedit.path.getCtrlLine=function(b){var c=svgedit.utilities.getElem("ctrlLine_"+b);return c?c:(c=document.createElementNS(a.SVG,"line"),svgedit.utilities.assignAttributes(c,{id:"ctrlLine_"+b,stroke:"#555","stroke-width":1,style:"pointer-events:none"}),svgedit.path.getGripContainer().appendChild(c),c)},svgedit.path.getPointGrip=function(a,b){var c=a.index,d=svgedit.path.addPointGrip(c);if(b){var e=svgedit.path.getGripPt(a);svgedit.utilities.assignAttributes(d,{cx:e.x,cy:e.y,display:"inline"})}return d},svgedit.path.getControlPoints=function(a){var b=a.item,c=a.index;if(!("x1"in b&&"x2"in b))return null;var d,e={},f=(svgedit.path.getGripContainer(),svgedit.path.path.segs[c-1].item),g=[f,b];for(d=1;3>d;d++){var h=c+"c"+d,i=e["c"+d+"_line"]=svgedit.path.getCtrlLine(h),j=svgedit.path.getGripPt(a,{x:b["x"+d],y:b["y"+d]}),k=svgedit.path.getGripPt(a,{x:g[d-1].x,y:g[d-1].y});svgedit.utilities.assignAttributes(i,{x1:j.x,y1:j.y,x2:k.x,y2:k.y,display:"inline"}),e["c"+d+"_line"]=i;var l=e["c"+d]=svgedit.path.addCtrlGrip(h);svgedit.utilities.assignAttributes(l,{cx:j.x,cy:j.y,display:"inline"}),e["c"+d]=l}return e},svgedit.path.replacePathSeg=function(a,b,c,e){var f=e||svgedit.path.path.elem,g="createSVGPathSeg"+d[a],h=f[g].apply(f,c);if(svgedit.browser.supportsPathReplaceItem())f.pathSegList.replaceItem(h,b);else{var i,j=f.pathSegList,k=j.numberOfItems,l=[];for(i=0;k>i;i++){var m=j.getItem(i);l.push(m)}for(j.clear(),i=0;k>i;i++)j.appendItem(i==b?h:l[i])}},svgedit.path.getSegSelector=function(b,c){var d=b.index,e=svgedit.utilities.getElem("segline_"+d);if(!e){var f=svgedit.path.getGripContainer();e=document.createElementNS(a.SVG,"path"),svgedit.utilities.assignAttributes(e,{id:"segline_"+d,display:"none",fill:"none",stroke:"#0FF","stroke-width":2,style:"pointer-events:none",d:"M0,0 0,0"}),f.appendChild(e)}if(c){var g=b.prev;if(!g)return e.setAttribute("display","none"),e;var h=svgedit.path.getGripPt(g);svgedit.path.replacePathSeg(2,0,[h.x,h.y],e);var i,j=svgedit.path.ptObjToArr(b.type,b.item,!0);for(i=0;i<j.length;i+=2)h=svgedit.path.getGripPt(b,{x:j[i],y:j[i+1]}),j[i]=h.x,j[i+1]=h.y;svgedit.path.replacePathSeg(b.type,1,j,e)}return e},svgedit.path.smoothControlPoints=function(a,b,c){var d=a.x-c.x,e=a.y-c.y,f=b.x-c.x,h=b.y-c.y;if(!(0==d&&0==e||0==f&&0==h)){var i=Math.atan2(e,d),j=Math.atan2(h,f),k=Math.sqrt(d*d+e*e),l=Math.sqrt(f*f+h*h),m=g.getSVGRoot().createSVGPoint(),n=g.getSVGRoot().createSVGPoint();0>i&&(i+=2*Math.PI),0>j&&(j+=2*Math.PI);var o,p,q=Math.abs(i-j),r=Math.abs(Math.PI-q)/2;return i-j>0?(o=q<Math.PI?i+r:i-r,p=q<Math.PI?j-r:j+r):(o=q<Math.PI?i-r:i+r,p=q<Math.PI?j+r:j-r),m.x=k*Math.cos(o)+c.x,m.y=k*Math.sin(o)+c.y,n.x=l*Math.cos(p)+c.x,n.y=l*Math.sin(p)+c.y,[m,n]}return void 0},svgedit.path.Segment=function(a,b){this.selected=!1,this.index=a,this.item=b,this.type=b.pathSegType,this.ctrlpts=[],this.ptgrip=null,this.segsel=null},svgedit.path.Segment.prototype.showCtrlPts=function(a){var b;for(b in this.ctrlpts)this.ctrlpts.hasOwnProperty(b)&&this.ctrlpts[b].setAttribute("display",a?"inline":"none")},svgedit.path.Segment.prototype.selectCtrls=function(a){$("#ctrlpointgrip_"+this.index+"c1, #ctrlpointgrip_"+this.index+"c2").attr("fill",a?"#0FF":"#EEE")},svgedit.path.Segment.prototype.show=function(a){this.ptgrip&&(this.ptgrip.setAttribute("display",a?"inline":"none"),this.segsel.setAttribute("display",a?"inline":"none"),this.showCtrlPts(a))},svgedit.path.Segment.prototype.select=function(a){this.ptgrip&&(this.ptgrip.setAttribute("stroke",a?"#0FF":"#00F"),this.segsel.setAttribute("display",a?"inline":"none"),this.ctrlpts&&this.selectCtrls(a),this.selected=a)},svgedit.path.Segment.prototype.addGrip=function(){this.ptgrip=svgedit.path.getPointGrip(this,!0),this.ctrlpts=svgedit.path.getControlPoints(this,!0),this.segsel=svgedit.path.getSegSelector(this,!0)},svgedit.path.Segment.prototype.update=function(a){if(this.ptgrip){var b=svgedit.path.getGripPt(this);svgedit.utilities.assignAttributes(this.ptgrip,{cx:b.x,cy:b.y}),svgedit.path.getSegSelector(this,!0),this.ctrlpts&&(a&&(this.item=svgedit.path.path.elem.pathSegList.getItem(this.index),this.type=this.item.pathSegType),svgedit.path.getControlPoints(this))}},svgedit.path.Segment.prototype.move=function(a,b){var c,d=this.item;if(c=this.ctrlpts?[d.x+=a,d.y+=b,d.x1,d.y1,d.x2+=a,d.y2+=b]:[d.x+=a,d.y+=b],svgedit.path.replacePathSeg(this.type,this.index,c),this.next&&this.next.ctrlpts){var e=this.next.item,f=[e.x,e.y,e.x1+=a,e.y1+=b,e.x2,e.y2];svgedit.path.replacePathSeg(this.next.type,this.next.index,f)}if(this.mate){d=this.mate.item;var g=[d.x+=a,d.y+=b];svgedit.path.replacePathSeg(this.mate.type,this.mate.index,g)}this.update(!0),this.next&&this.next.update(!0)},svgedit.path.Segment.prototype.setLinked=function(a){var b,c,d;if(2==a){if(c=1,b=this.next,!b)return;d=this.item}else{if(c=2,b=this.prev,!b)return;d=b.item}var e=b.item;e["x"+c]=d.x+(d.x-this.item["x"+a]),e["y"+c]=d.y+(d.y-this.item["y"+a]);var f=[e.x,e.y,e.x1,e.y1,e.x2,e.y2];svgedit.path.replacePathSeg(b.type,b.index,f),b.update(!0)},svgedit.path.Segment.prototype.moveCtrl=function(a,b,c){var d=this.item;d["x"+a]+=b,d["y"+a]+=c;var e=[d.x,d.y,d.x1,d.y1,d.x2,d.y2];svgedit.path.replacePathSeg(this.type,this.index,e),this.update(!0)},svgedit.path.Segment.prototype.setType=function(a,b){svgedit.path.replacePathSeg(a,this.index,b),this.type=a,this.item=svgedit.path.path.elem.pathSegList.getItem(this.index),this.showCtrlPts(6===a),this.ctrlpts=svgedit.path.getControlPoints(this),this.update(!0)},svgedit.path.Path=function(a){if(!a||"path"!==a.tagName)throw"svgedit.path.Path constructed without a <path> element";this.elem=a,this.segs=[],this.selected_pts=[],svgedit.path.path=this,this.init()},svgedit.path.Path.prototype.init=function(){$(svgedit.path.getGripContainer()).find("*").attr("display","none");var a=this.elem.pathSegList,b=a.numberOfItems;this.segs=[],this.selected_pts=[],this.first_seg=null;var c;for(c=0;b>c;c++){var d=a.getItem(c),e=new svgedit.path.Segment(c,d);e.path=this,this.segs.push(e)}var f=this.segs,g=null;for(c=0;b>c;c++){var h,i=f[c],j=c+1>=b?null:f[c+1],k=0>c-1?null:f[c-1];2===i.type?(k&&1!==k.type&&(h=f[g],h.next=f[g+1],h.next.prev=h,h.addGrip()),g=c):j&&1===j.type?(i.next=f[g+1],i.next.prev=i,i.mate=f[g],i.addGrip(),null==this.first_seg&&(this.first_seg=i)):j?1!==i.type&&(i.addGrip(),j&&2!==j.type&&(i.next=j,i.next.prev=i)):1!==i.type&&(h=f[g],h.next=f[g+1],h.next.prev=h,h.addGrip(),i.addGrip(),this.first_seg||(this.first_seg=f[g]))}return this},svgedit.path.Path.prototype.eachSeg=function(a){var b,c=this.segs.length;for(b=0;c>b;b++){var d=a.call(this.segs[b],b);if(d===!1)break}},svgedit.path.Path.prototype.addSeg=function(a){var b=this.segs[a];if(b.prev){var c,d,e,f=b.prev;switch(b.item.pathSegType){case 4:d=(b.item.x+f.item.x)/2,e=(b.item.y+f.item.y)/2,c=this.elem.createSVGPathSegLinetoAbs(d,e);break;case 6:var g=(f.item.x+b.item.x1)/2,h=(b.item.x1+b.item.x2)/2,i=(b.item.x2+b.item.x)/2,j=(g+h)/2,k=(h+i)/2;d=(j+k)/2;var l=(f.item.y+b.item.y1)/2,m=(b.item.y1+b.item.y2)/2,n=(b.item.y2+b.item.y)/2,o=(l+m)/2,p=(m+n)/2;e=(o+p)/2,c=this.elem.createSVGPathSegCurvetoCubicAbs(d,e,g,l,j,o);var q=[b.item.x,b.item.y,k,p,i,n];svgedit.path.replacePathSeg(b.type,a,q)}svgedit.path.insertItemBefore(this.elem,c,a)}},svgedit.path.Path.prototype.deleteSeg=function(a){var b=this.segs[a],c=this.elem.pathSegList;b.show(!1);var d,e=b.next;if(b.mate)d=[e.item.x,e.item.y],svgedit.path.replacePathSeg(2,e.index,d),svgedit.path.replacePathSeg(4,b.index,d),c.removeItem(b.mate.index);else if(b.prev)c.removeItem(a);else{{b.item}d=[e.item.x,e.item.y],svgedit.path.replacePathSeg(2,b.next.index,d),c.removeItem(a)}},svgedit.path.Path.prototype.subpathIsClosed=function(a){var b=!1;return svgedit.path.path.eachSeg(function(c){return a>=c?!0:2===this.type?!1:1===this.type?(b=!0,!1):void 0}),b},svgedit.path.Path.prototype.removePtFromSelection=function(a){var b=this.selected_pts.indexOf(a);-1!=b&&(this.segs[a].select(!1),this.selected_pts.splice(b,1))},svgedit.path.Path.prototype.clearSelection=function(){this.eachSeg(function(){this.select(!1)}),this.selected_pts=[]},svgedit.path.Path.prototype.storeD=function(){this.last_d=this.elem.getAttribute("d")},svgedit.path.Path.prototype.show=function(a){return this.eachSeg(function(){this.show(a)}),a&&this.selectPt(this.first_seg.index),this},svgedit.path.Path.prototype.movePts=function(a,b){for(var c=this.selected_pts.length;c--;){var d=this.segs[this.selected_pts[c]];d.move(a,b)}},svgedit.path.Path.prototype.moveCtrl=function(a,b){var c=this.segs[this.selected_pts[0]];c.moveCtrl(this.dragctrl,a,b),e&&c.setLinked(this.dragctrl)},svgedit.path.Path.prototype.setSegType=function(a){this.storeD();for(var b,c=this.selected_pts.length;c--;){var d=this.selected_pts[c],e=this.segs[d],f=e.prev;if(f){if(!a){b="Toggle Path Segment Type";var g=e.type;a=6==g?4:6}a=Number(a);var h,i=e.item.x,j=e.item.y,k=f.item.x,l=f.item.y;switch(a){case 6:if(e.olditem){var m=e.olditem;h=[i,j,m.x1,m.y1,m.x2,m.y2]}else{var n=i-k,o=j-l,p=k+n/3,q=l+o/3,r=i-n/3,s=j-o/3;h=[i,j,p,q,r,s]}break;case 4:h=[i,j],e.olditem=e.item}e.setType(a,h)}}svgedit.path.path.endChanges(b)},svgedit.path.Path.prototype.selectPt=function(a,b){this.clearSelection(),null==a&&this.eachSeg(function(b){this.prev&&(a=b)}),this.addPtsToSelection(a),b&&(this.dragctrl=b,e&&this.segs[a].setLinked(b))},svgedit.path.Path.prototype.update=function(){var a=this.elem;return svgedit.utilities.getRotationAngle(a)?(this.matrix=svgedit.math.getMatrix(a),this.imatrix=this.matrix.inverse()):(this.matrix=null,this.imatrix=null),this.eachSeg(function(b){this.item=a.pathSegList.getItem(b),this.update()}),this},svgedit.path.getPath_=function(a){var b=f[a.id];return b||(b=f[a.id]=new svgedit.path.Path(a)),b},svgedit.path.removePath_=function(a){a in f&&delete f[a]};var h,i,j,k,l,m=function(a,b){var c=a-j,d=b-k,e=Math.sqrt(c*c+d*d),f=Math.atan2(d,c)+l;return c=e*Math.cos(f)+j,d=e*Math.sin(f)+k,c-=h,d-=i,e=Math.sqrt(c*c+d*d),f=Math.atan2(d,c)-l,{x:e*Math.cos(f)+h,y:e*Math.sin(f)+i}};svgedit.path.recalcRotatedPath=function(){var a=svgedit.path.path.elem;if(l=svgedit.utilities.getRotationAngle(a,!0)){var b=svgedit.utilities.getBBox(a),c=svgedit.path.path.oldbbox;j=c.x+c.width/2,k=c.y+c.height/2,h=b.x+b.width/2,i=b.y+b.height/2;var d=h-j,e=i-k,f=Math.sqrt(d*d+e*e),g=Math.atan2(e,d)+l;h=f*Math.cos(g)+j,i=f*Math.sin(g)+k;for(var n=a.pathSegList,o=n.numberOfItems;o;){o-=1;var p=n.getItem(o),q=p.pathSegType;if(1!=q){var r=m(p.x,p.y),s=[r.x,r.y];if(null!=p.x1&&null!=p.x2){var t=m(p.x1,p.y1),u=m(p.x2,p.y2);s.splice(s.length,0,t.x,t.y,u.x,u.y)}svgedit.path.replacePathSeg(q,o,s)}}b=svgedit.utilities.getBBox(a);var v=svgroot.createSVGTransform(),w=svgedit.transformlist.getTransformList(a);v.setRotate(180*l/Math.PI,h,i),w.replaceItem(v,0)}},svgedit.path.clearData=function(){f={}}}();
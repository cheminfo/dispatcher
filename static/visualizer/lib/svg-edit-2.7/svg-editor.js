!function(){window.svgEditor||(window.svgEditor=function(a){function b(b,c){var e=d.setSvgString(b)!==!1;c=c||a.noop,e?c(!0):a.alert(o.notification.errorLoadingSVG,function(){c(!1)})}var c={};c.tool_scale=1,c.langChanged=!1,c.showSaveWarning=!1,c.storagePromptClosed=!1;var d,e,f=svgedit.utilities,g=!1,h=[],i={},j={lang:"",iconsize:"",bkgd_color:"#FFF",bkgd_url:"",img_save:"embed",save_notice_done:!1,export_notice_done:!1},k={},l={extensions:[],allowedOrigins:[]},m=["ext-overview_window.js","ext-markers.js","ext-connector.js","ext-eyedropper.js","ext-shapes.js","ext-imagelib.js","ext-grid.js","ext-polygon.js","ext-star.js","ext-panning.js","ext-storage.js"],n={canvasName:"default",canvas_expansion:3,initFill:{color:"FF0000",opacity:1},initStroke:{width:5,color:"000000",opacity:1},initOpacity:1,colorPickerCSS:null,initTool:"select",wireframe:!1,showlayers:!1,no_save_warning:!1,imgPath:"images/",langPath:"locale/",extPath:"extensions/",jGraduatePath:"jgraduate/images/",dimensions:[640,480],gridSnapping:!1,gridColor:"#000",baseUnit:"px",snappingStep:10,showRulers:!0,preventAllURLConfig:!1,preventURLContentLoading:!1,lockExtensions:!1,noDefaultExtensions:!1,showGrid:!1,noStorageOnLoad:!1,forceStorage:!1,emptyStorageOnDecline:!1},o=c.uiStrings={common:{ok:"OK",cancel:"Cancel",key_up:"Up",key_down:"Down",key_backspace:"Backspace",key_del:"Del"},layers:{layer:"Layer"},notification:{invalidAttrValGiven:"Invalid value given",noContentToFitTo:"No content to fit to",dupeLayerName:"There is already a layer named that!",enterUniqueLayerName:"Please enter a unique layer name",enterNewLayerName:"Please enter the new layer name",layerHasThatName:"Layer already has that name",QmoveElemsToLayer:"Move selected elements to layer '%s'?",QwantToClear:"Do you want to clear the drawing?\nThis will also erase your undo history!",QwantToOpen:"Do you want to open a new file?\nThis will also erase your undo history!",QerrorsRevertToSource:"There were parsing errors in your SVG source.\nRevert back to original SVG source?",QignoreSourceChanges:"Ignore changes made to SVG source?",featNotSupported:"Feature not supported",enterNewImgURL:"Enter the new image URL",defsFailOnSave:"NOTE: Due to a bug in your browser, this image may appear wrong (missing gradients or elements). It will however appear correct once actually saved.",loadingImage:"Loading image, please wait...",saveFromBrowser:"Select 'Save As...' in your browser to save this image as a %s file.",noteTheseIssues:"Also note the following issues: ",unsavedChanges:"There are unsaved changes.",enterNewLinkURL:"Enter the new hyperlink URL",errorLoadingSVG:"Error: Unable to load SVG data",URLloadFail:"Unable to load from URL",retrieving:"Retrieving '%s' ..."}};return a.pref=function(a,b){return b?(k[a]=b,void(c.curPrefs=k)):a in k?k[a]:j[a]},c.loadContentAndPrefs=function(){if(l.forceStorage||!l.noStorageOnLoad&&document.cookie.match(/(?:^|;\s*)store=(?:prefsAndContent|prefsOnly)/)){if(c.storage&&(l.forceStorage||!l.noStorageOnLoad&&document.cookie.match(/(?:^|;\s*)store=prefsAndContent/))){var a="svgedit-"+l.canvasName,b=c.storage.getItem(a);b&&c.loadFromString(b)}var d;for(d in j)if(j.hasOwnProperty(d)){var e="svg-edit-"+d;if(c.storage){var g=c.storage.getItem(e);g&&(j[d]=String(g))}else if(window.widget)j[d]=widget.preferenceForKey(e);else{var h=document.cookie.match(new RegExp("(?:^|;\\s*)"+f.preg_quote(encodeURIComponent(e))+"=([^;]+)"));j[d]=h?decodeURIComponent(h[1]):""}}}},c.setConfig=function(b,d){function e(b,c,d){b[c]&&"object"==typeof b[c]?a.extend(!0,b[c],d):b[c]=d}d=d||{},a.each(b,function(c,f){if(b.hasOwnProperty(c))if(j.hasOwnProperty(c)){if(d.overwrite===!1&&(l.preventAllURLConfig||k.hasOwnProperty(c)))return;d.allowInitialUserOverride===!0?j[c]=f:a.pref(c,f)}else if(["extensions","allowedOrigins"].indexOf(c)>-1){if(d.overwrite===!1&&(l.preventAllURLConfig||"allowedOrigins"===c||"extensions"===c&&l.lockExtensions))return;l[c]=l[c].concat(f)}else if(n.hasOwnProperty(c)){if(d.overwrite===!1&&(l.preventAllURLConfig||l.hasOwnProperty(c)))return;if(l.hasOwnProperty(c)){if(d.overwrite===!1)return;e(l,c,f)}else d.allowInitialUserOverride===!0?e(n,c,f):n[c]&&"object"==typeof n[c]?(l[c]={},a.extend(!0,l[c],f)):l[c]=f}}),c.curConfig=l},c.setCustomHandlers=function(b){c.ready(function(){b.open&&(a('#tool_open > input[type="file"]').remove(),a("#tool_open").show(),d.open=b.open),b.save&&(c.showSaveWarning=!1,d.bind("saved",b.save)),(b.exportImage||b.pngsave)&&d.bind("exported",b.exportImage||b.pngsave),i=b})},c.randomizeIds=function(){d.randomizeIds(arguments)},c.init=function(){function g(){k=a.extend(!0,{},j,k),c.curPrefs=k}function h(){l=a.extend(!0,{},n,l),l.noDefaultExtensions||(l.extensions=l.extensions.concat(m)),a.each(["extensions","allowedOrigins"],function(b,c){l[c]=a.grep(l[c],function(a,b){return b===l[c].indexOf(a)})}),c.curConfig=l}function p(b,c){var e=b.id,f=e.split("_"),g=f[0],h=f[1];c&&d.setStrokeAttr("stroke-"+g,h),nb(),E("#cur_"+g,e,20),a(b).addClass("current").siblings().removeClass("current")}function q(b,c){a.pref("bkgd_color",b),a.pref("bkgd_url",c),d.setBackground(b,c)}function r(){var b=d.getHref(_);b=0===b.indexOf("data:")?"":b,a.prompt(o.notification.enterNewImgURL,b,function(a){a&&qb(a)})}function s(b,c){c||(c=d.getZoom()),b||(b=a("#svgcanvas"));var e,f,g=3e4,h=d.getContentElem(),i=svgedit.units.getTypeMap(),j=i[l.baseUnit];for(e=0;2>e;e++){var k=0===e,m=k?"x":"y",n=k?"width":"height",o=Number(h.getAttribute(m)),p=a("#ruler_"+m+" canvas:first"),q=p.clone();p.replaceWith(q);var r=q[0],s=b[n](),t=s;r.parentNode.style[n]=t+"px";var u,v,w,x=0,y=r.getContext("2d");if(y.fillStyle="rgb(200,0,0)",y.fillRect(0,0,r.width,r.height),q.siblings().remove(),s>=g){w=parseInt(s/g,10)+1,u=[],u[0]=y;var z;for(f=1;w>f;f++)r[n]=g,z=r.cloneNode(!0),r.parentNode.appendChild(z),u[f]=z.getContext("2d");z[n]=s%g,s=g}r[n]=s;var A=j*c,B=50/A,C=1;for(f=0;f<gb.length&&(v=gb[f],C=v,!(v>=B));f++);var D=C*A;y.font="9px sans-serif";for(var E=o/A%C*A,F=E-D;t>E;){F+=D;var G=Math.round(E)+.5;k?(y.moveTo(G,15),y.lineTo(G,0)):(y.moveTo(15,G),y.lineTo(0,G)),v=(F-o)/A;var H;if(C>=1)H=Math.round(v);else{var I=String(C).split(".")[1].length;H=v.toFixed(I)}if(0!==H&&1e3!==H&&H%1e3===0&&(H=H/1e3+"K"),k)y.fillText(H,E+2,8);else{var J=String(H).split("");for(f=0;f<J.length;f++)y.fillText(J[f],1,E+9+9*f)}var K=D/10;for(f=1;10>f;f++){var L=Math.round(E+K*f)+.5;if(u&&L>s){if(x++,y.stroke(),x>=w){f=10,E=t;continue}y=u[x],E-=g,L=Math.round(E+K*f)+.5}var M=f%2?12:10;k?(y.moveTo(L,15),y.lineTo(L,M)):(y.moveTo(15,L),y.lineTo(M,L))}E+=D}y.strokeStyle="#000",y.stroke()}}function t(){d.deleteCurrentLayer()&&(vb(),ib(),a("#layerlist tr.layer").removeClass("layersel"),a("#layerlist tr.layer:first").addClass("layersel"))}function u(){var b=d.getCurrentDrawing().getCurrentLayerName()+" copy";a.prompt(o.notification.enterUniqueLayerName,b,function(b){if(b){if(d.getCurrentDrawing().hasLayer(b))return void a.alert(o.notification.dupeLayerName);d.cloneLayer(b),vb(),ib()}})}function v(){a("#layerlist tr.layersel").index()!=d.getCurrentDrawing().getNumLayers()-1&&(d.mergeLayer(),vb(),ib())}function w(b){var c=a("#layerlist tr.layersel").index(),e=d.getCurrentDrawing().getNumLayers();(c>0||e-1>c)&&(c+=b,d.setCurrentLayerPosition(e-c-1),ib())}function x(a,b){var c=Number(a.value),d=c+b,e=d>=c;return 0===b?c:c>=24?Math.round(e?1.1*c:c/1.1):1>=c?e?2*c:c/2:d}function y(a,b){var c=Number(a.value);if(0===c)return 100;var d=c+b;return 0===b?c:c>=100?d:d>=c?2*c:c/2}function z(a){a.stopPropagation(),a.preventDefault()}function A(a){a.stopPropagation(),a.preventDefault()}function B(a){a.stopPropagation(),a.preventDefault()}try{"localStorage"in window&&(c.storage=localStorage)}catch(C){}var D=[];a("#lang_select option").each(function(){D.push(this.value)}),function(){var b,d;if(e=a.deparam.querystring(!0),a.isEmptyObject(e))h(),c.loadContentAndPrefs(),g();else{if(e.dimensions&&(e.dimensions=e.dimensions.split(",")),e.bkgd_color&&(e.bkgd_color="#"+e.bkgd_color),e.extensions&&(e.extensions=e.extensions.match(/[:\/\\]/)?"":e.extensions.split(",")),a.each(["extPath","imgPath","langPath","jGraduatePath"],function(a){e[a]&&delete e[a]}),c.setConfig(e,{overwrite:!1}),h(),!l.preventURLContentLoading){if(b=e.source,d=a.param.querystring(),b||d.indexOf("source=data:")>=0&&(b=d.match(/source=(data:[^&]*)/)[1]),b)return void(0===b.indexOf("data:")?(b=b.replace(/ /g,"+"),c.loadFromDataURI(b)):c.loadFromString(b));if(-1!==d.indexOf("paramurl="))return void c.loadFromURL(d.substr(9));if(e.url)return void c.loadFromURL(e.url)}(!e.noStorageOnLoad||l.forceStorage)&&c.loadContentAndPrefs(),g()}}(),function(){var a,b=window.opener;if(b)try{a=b.document.createEvent("Event"),a.initEvent("svgEditorReady",!0,!0),b.document.documentElement.dispatchEvent(a)}catch(c){}}();var E=c.setIcon=function(b,c){var d="string"==typeof c?a.getSvgIcon(c,!0):c.clone();return d?void a(b).empty().append(d):void console.log("NOTE: Icon image missing: "+c)},F=function(){a.each(l.extensions,function(){var b=this;b.match(/^ext-.*\.js/)&&a.getScript(l.extPath+b,function(a){if(!a){var c=document.createElement("script");c.src=l.extPath+b,document.querySelector("head").appendChild(c)}})}),c.putLocale(null,D)};"file:"===document.location.protocol?setTimeout(F,100):F(),a.svgIcons(l.imgPath+"svg_edit_icons.svg",{w:24,h:24,id_match:!1,no_img:!svgedit.browser.isWebkit(),fallback_path:l.imgPath,fallback:{new_image:"clear.png",save:"save.png",open:"open.png",source:"source.png",docprops:"document-properties.png",wireframe:"wireframe.png",undo:"undo.png",redo:"redo.png",select:"select.png",select_node:"select_node.png",pencil:"fhpath.png",pen:"line.png",square:"square.png",rect:"rect.png",fh_rect:"freehand-square.png",circle:"circle.png",ellipse:"ellipse.png",fh_ellipse:"freehand-circle.png",path:"path.png",text:"text.png",image:"image.png",zoom:"zoom.png",clone:"clone.png",node_clone:"node_clone.png","delete":"delete.png",node_delete:"node_delete.png",group:"shape_group_elements.png",ungroup:"shape_ungroup.png",move_top:"move_top.png",move_bottom:"move_bottom.png",to_path:"to_path.png",link_controls:"link_controls.png",reorient:"reorient.png",align_left:"align-left.png",align_center:"align-center.png",align_right:"align-right.png",align_top:"align-top.png",align_middle:"align-middle.png",align_bottom:"align-bottom.png",go_up:"go-up.png",go_down:"go-down.png",ok:"save.png",cancel:"cancel.png",arrow_right:"flyouth.png",arrow_down:"dropdown.gif"},placement:{"#logo":"logo","#tool_clear div,#layer_new":"new_image","#tool_save div":"save","#tool_export div":"export","#tool_open div div":"open","#tool_import div div":"import","#tool_source":"source","#tool_docprops > div":"docprops","#tool_wireframe":"wireframe","#tool_undo":"undo","#tool_redo":"redo","#tool_select":"select","#tool_fhpath":"pencil","#tool_line":"pen","#tool_rect,#tools_rect_show":"rect","#tool_square":"square","#tool_fhrect":"fh_rect","#tool_ellipse,#tools_ellipse_show":"ellipse","#tool_circle":"circle","#tool_fhellipse":"fh_ellipse","#tool_path":"path","#tool_text,#layer_rename":"text","#tool_image":"image","#tool_zoom":"zoom","#tool_clone,#tool_clone_multi":"clone","#tool_node_clone":"node_clone","#layer_delete,#tool_delete,#tool_delete_multi":"delete","#tool_node_delete":"node_delete","#tool_add_subpath":"add_subpath","#tool_openclose_path":"open_path","#tool_move_top":"move_top","#tool_move_bottom":"move_bottom","#tool_topath":"to_path","#tool_node_link":"link_controls","#tool_reorient":"reorient","#tool_group_elements":"group_elements","#tool_ungroup":"ungroup","#tool_unlink_use":"unlink_use","#tool_alignleft, #tool_posleft":"align_left","#tool_aligncenter, #tool_poscenter":"align_center","#tool_alignright, #tool_posright":"align_right","#tool_aligntop, #tool_postop":"align_top","#tool_alignmiddle, #tool_posmiddle":"align_middle","#tool_alignbottom, #tool_posbottom":"align_bottom","#cur_position":"align","#linecap_butt,#cur_linecap":"linecap_butt","#linecap_round":"linecap_round","#linecap_square":"linecap_square","#linejoin_miter,#cur_linejoin":"linejoin_miter","#linejoin_round":"linejoin_round","#linejoin_bevel":"linejoin_bevel","#url_notice":"warning","#layer_up":"go_up","#layer_down":"go_down","#layer_moreopts":"context_menu","#layerlist td.layervis":"eye","#tool_source_save,#tool_docprops_save,#tool_prefs_save":"ok","#tool_source_cancel,#tool_docprops_cancel,#tool_prefs_cancel":"cancel","#rwidthLabel, #iwidthLabel":"width","#rheightLabel, #iheightLabel":"height","#cornerRadiusLabel span":"c_radius","#angleLabel":"angle","#linkLabel,#tool_make_link,#tool_make_link_multi":"globe_link","#zoomLabel":"zoom","#tool_fill label":"fill","#tool_stroke .icon_label":"stroke","#group_opacityLabel":"opacity","#blurLabel":"blur","#font_sizeLabel":"fontsize",".flyout_arrow_horiz":"arrow_right",".dropdown button, #main_button .dropdown":"arrow_down","#palette .palette_item:first, #fill_bg, #stroke_bg":"no_color"},resize:{"#logo .svg_icon":28,".flyout_arrow_horiz .svg_icon":5,".layer_button .svg_icon, #layerlist td.layervis .svg_icon":14,".dropdown button .svg_icon":7,"#main_button .dropdown .svg_icon":9,".palette_item:first .svg_icon":15,"#fill_bg .svg_icon, #stroke_bg .svg_icon":16,".toolbar_button button .svg_icon":16,".stroke_tool div div .svg_icon":20,"#tools_bottom label .svg_icon":18},callback:function(){a(".toolbar_button button > svg, .toolbar_button button > img").each(function(){a(this).parent().prepend(this)});var b,d=a("#tools_left");0!==d.length&&(b=d.offset().top+d.outerHeight());var e=a.pref("iconsize");c.setIconSize(e||(a(window).height()<b?"s":"m")),a(".tools_flyout").each(function(){var b=a("#"+this.id+"_show"),c=b.attr("data-curopt");if(!b.children("svg, img").length){var d=a(c).children().clone();d.length&&(d[0].removeAttribute("style"),b.append(d))}}),c.runCallbacks(),setTimeout(function(){a(".flyout_arrow_horiz:empty").each(function(){a(this).append(a.getSvgIcon("arrow_right").width(5).height(5))})},1)}}),c.canvas=d=new a.SvgCanvas(document.getElementById("svgcanvas"),l);var G,H,I,J,K,L=["#000000","#3f3f3f","#7f7f7f","#bfbfbf","#ffffff","#ff0000","#ff7f00","#ffff00","#7fff00","#00ff00","#00ff7f","#00ffff","#007fff","#0000ff","#7f00ff","#ff00ff","#ff007f","#7f0000","#7f3f00","#7f7f00","#3f7f00","#007f00","#007f3f","#007f7f","#003f7f","#00007f","#3f007f","#7f007f","#7f003f","#ffaaaa","#ffd4aa","#ffffaa","#d4ffaa","#aaffaa","#aaffd4","#aaffff","#aad4ff","#aaaaff","#d4aaff","#ffaaff","#ffaad4"],M=svgedit.browser.isMac()?"meta+":"ctrl+",N=d.pathActions,O=d.undoMgr,P=l.imgPath+"logo.png",Q=a("#workarea"),R=a("#cmenu_canvas"),S=null,T="crosshair",U="crosshair",V="toolbars",W="",X={fill:null,stroke:null};!function(){a("#dialog_container").draggable({cancel:"#dialog_content, #dialog_buttons *",containment:"window"});var b=a("#dialog_box"),c=a("#dialog_buttons"),d=a("#dialog_content"),e=function(e,f,g,h,i,j,k){var l,m,n;if(d.html("<p>"+f.replace(/\n/g,"</p><p>")+"</p>").toggleClass("prompt","prompt"==e),c.empty(),l=a('<input type="button" value="'+o.common.ok+'">').appendTo(c),"alert"!==e&&a('<input type="button" value="'+o.common.cancel+'">').appendTo(c).click(function(){b.hide(),g(!1)}),"prompt"===e)m=a('<input type="text">').prependTo(c),m.val(h||""),m.bind("keydown","return",function(){l.click()});else if("select"===e){var p=a('<div style="text-align:center;">');if(m=a("<select>").appendTo(p),k){var q=a("<label>").text(k.label);n=a('<input type="checkbox">').appendTo(q),n.val(k.value),k.tooltip&&q.attr("title",k.tooltip),n.prop("checked",!!k.checked),p.append(a("<div>").append(q))}a.each(i||[],function(b,c){m.append("object"==typeof c?a("<option>").val(c.value).html(c.text):a("<option>").html(c))}),d.append(p),h&&m.val(h),j&&m.bind("change","return",j),m.bind("keydown","return",function(){l.click()})}"process"===e&&l.hide(),b.show(),l.click(function(){b.hide();var a="prompt"===e||"select"===e?m.val():!0;g&&(n?g(a,n.prop("checked")):g(a))}).focus(),("prompt"===e||"select"===e)&&m.focus()};a.alert=function(a,b){e("alert",a,b)},a.confirm=function(a,b){e("confirm",a,b)},a.process_cancel=function(a,b){e("process",a,b)},a.prompt=function(a,b,c){e("prompt",a,c,b)},a.select=function(a,b,c,d,f,g){e("select",a,c,f,b,d,g)}}();var Y,Z=function(){var b=a(".tool_button_current");b.length&&"tool_select"!==b[0].id&&(b.removeClass("tool_button_current").addClass("tool_button"),a("#tool_select").addClass("tool_button_current").removeClass("tool_button"),a("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all} #svgcanvas svg{cursor:default}")),d.setMode("select"),Q.css("cursor","auto")},$=!1,_=null,ab=!1,bb=!1,cb=!1,db=!1,eb="",fb=a("title:first").text(),gb=[];for(Y=.1;1e5>Y;Y*=10)gb.push(Y),gb.push(2*Y),gb.push(5*Y);var hb=function(a){var b,c=[],e=d.getCurrentDrawing().getNumLayers();for(b=0;e>b;b++)c[b]=d.getCurrentDrawing().getLayerName(b);if(a)for(b=0;e>b;++b)c[b]!=a&&d.getCurrentDrawing().setLayerOpacity(c[b],.5);else for(b=0;e>b;++b)d.getCurrentDrawing().setLayerOpacity(c[b],1)},ib=function(){d.clearSelection();for(var b=a("#layerlist tbody").empty(),c=a("#selLayerNames").empty(),e=d.getCurrentDrawing(),f=e.getCurrentLayerName(),g=d.getCurrentDrawing().getNumLayers(),h=a.getSvgIcon("eye");g--;){var i=e.getLayerName(g),j=a('<tr class="layer">').toggleClass("layersel",i===f),k=a('<td class="layervis">').toggleClass("layerinvis",!e.getLayerVisibility(i)),l=a('<td class="layername">'+i+"</td>");b.append(j.append(k,l)),c.append('<option value="'+i+'">'+i+"</option>")}if(void 0!==h){var m=h.clone();a("td.layervis",b).append(m),a.resizeSvgIcons({"td.layervis .svg_icon":14})}a("#layerlist td.layername").mouseup(function(b){a("#layerlist tr.layer").removeClass("layersel"),a(this.parentNode).addClass("layersel"),d.setCurrentLayer(this.textContent),b.preventDefault()}).mouseover(function(){hb(this.textContent)}).mouseout(function(){hb()}),a("#layerlist td.layervis").click(function(){var b=a(this.parentNode).prevAll().length,c=a("#layerlist tr.layer:eq("+b+") td.layername").text(),e=a(this).hasClass("layerinvis");d.setLayerVisibility(c,e),a(this).toggleClass("layerinvis")});for(var n=5-a("#layerlist tr.layer").size();n-->0;)b.append('<tr><td style="color:white">_</td><td/></tr>')},jb=function(b,c){bb||(bb=!0,W=d.getSvgString(),a("#save_output_btns").toggle(!!c),a("#tool_source_back").toggle(!c),a("#svg_source_textarea").val(W),a("#svg_source_editor").fadeIn(),a("#svg_source_textarea").focus())},kb=function(b,c){a("#path_node_panel").toggle(b),a("#tools_bottom_2,#tools_bottom_3").toggle(!b),b?(a(".tool_button_current").removeClass("tool_button_current").addClass("tool_button"),a("#tool_select").addClass("tool_button_current").removeClass("tool_button"),E("#tool_select","select_node"),ab=!1,c.length&&(_=c[0])):setTimeout(function(){E("#tool_select","select")},1e3)},lb=function(b,d){if(c.showSaveWarning=!1,d='<?xml version="1.0"?>\n'+d,svgedit.browser.isIE())return void jb(0,!0);var e=b.open("data:image/svg+xml;base64,"+f.encode64(d)),g=a.pref("save_notice_done");if("all"!==g){var h=o.notification.saveFromBrowser.replace("%s","SVG");svgedit.browser.isGecko()?-1!==d.indexOf("<defs")?(h+="\n\n"+o.notification.defsFailOnSave,a.pref("save_notice_done","all"),g="all"):a.pref("save_notice_done","part"):a.pref("save_notice_done","all"),"part"!==g&&e.alert(h)}},mb=function(b,c){var e=c.issues,f=c.type||"PNG",g=("ICO"===f?"BMP":f).toLowerCase();a("#export_canvas").length||a("<canvas>",{id:"export_canvas"}).hide().appendTo("body");var h=a("#export_canvas")[0];h.width=d.contentW,h.height=d.contentH,canvg(h,c.svg,{renderCallback:function(){var b=c.quality?h.toDataURL("image/"+g,c.quality):h.toDataURL("image/"+g);S.location.href=b;var d=a.pref("export_notice_done");if("all"!==d){var i=o.notification.saveFromBrowser.replace("%s",f);if(e.length){var j="\n â€¢ ";i+="\n\n"+o.notification.noteTheseIssues+j+e.join(j)}a.pref("export_notice_done","all"),S.alert(i)}}})},nb=function(){window.opera&&a("<p/>").hide().appendTo("body").remove()},ob=c.toolButtonClick=function(b,c){if(a(b).hasClass("disabled"))return!1;if(a(b).parent().hasClass("tools_flyout"))return!0;var d="normal";return c||a(".tools_flyout").fadeOut(d),a("#styleoverrides").text(""),Q.css("cursor","auto"),a(".tool_button_current").removeClass("tool_button_current").addClass("tool_button"),a(b).addClass("tool_button_current").removeClass("tool_button"),!0},pb=c.clickSelect=function(){ob("#tool_select")&&(d.setMode("select"),a("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all}, #svgcanvas svg{cursor:default}"))},qb=c.setImageURL=function(b){b||(b=P),d.setImageURL(b),a("#image_url").val(b),0===b.indexOf("data:")?(a("#image_url").hide(),a("#change_image_url").show()):(d.embedImage(b,function(c){a("#url_notice").toggle(!c),P=b}),a("#image_url").show(),a("#change_image_url").hide())},rb=function(b){var c=Math.min(Math.max(12+6*b.value.length,50),300);a(b).width(c)},sb=c.updateCanvas=function(b,f){var g=Q.width(),h=Q.height(),i=g,j=h,k=d.getZoom(),m=Q,n=a("#svgcanvas"),o={x:m[0].scrollLeft+i/2,y:m[0].scrollTop+j/2},p=l.canvas_expansion;g=Math.max(i,d.contentW*k*p),h=Math.max(j,d.contentH*k*p),g==i&&h==j?Q.css("overflow","hidden"):Q.css("overflow","scroll");var q=n.height()/2,r=n.width()/2;n.width(g).height(h);var t=h/2,u=g/2,v=d.updateCanvas(g,h),w=u/r,x=g/2-i/2,y=h/2-j/2;if(f)f.x+=v.x,f.y+=v.y;else{var z=o.x-r,A=u+z*w,B=o.y-q,C=t+B*w;f={x:A,y:C}}b?d.contentW>m.width()?(Q[0].scrollLeft=v.x-10,Q[0].scrollTop=v.y-10):(m[0].scrollLeft=x,m[0].scrollTop=y):(m[0].scrollLeft=f.x-i/2,m[0].scrollTop=f.y-j/2),l.showRulers&&(s(n,k),Q.scroll()),e.storagePrompt===!0||c.storagePromptClosed||a("#dialog_box").hide()},tb=function(){var b,c,e="none"==d.getColor("fill"),f="none"==d.getColor("stroke"),g=["#tool_fhpath","#tool_line"],h=["#tools_rect .tool_button","#tools_ellipse .tool_button","#tool_text","#tool_path"];if(f)for(b in g)c=g[b],a(c).hasClass("tool_button_current")&&pb(),a(c).addClass("disabled");else for(b in g)c=g[b],a(c).removeClass("disabled");if(f&&e)for(b in h)c=h[b],a(c).hasClass("tool_button_current")&&pb(),a(c).addClass("disabled");else for(b in h)c=h[b],a(c).removeClass("disabled");d.runExtensions("toolButtonStateUpdate",{nofill:e,nostroke:f}),a(".tools_flyout").each(function(){var b=a("#"+this.id+"_show"),c=!1;a(this).children().each(function(){a(this).hasClass("disabled")||(c=!0)}),b.toggleClass("disabled",!c)}),nb()},ub=function(){var b,c;if(null!=_)switch(_.tagName){case"use":case"image":case"foreignObject":break;case"g":case"a":var d=null,e=_.getElementsByTagName("*");for(b=0,c=e.length;c>b;b++){var f=e[b].getAttribute("stroke-width");0===b?d=f:d!==f&&(d=null)}a("#stroke_width").val(null===d?"":d),X.fill.update(!0),X.stroke.update(!0);break;default:X.fill.update(!0),X.stroke.update(!0),a("#stroke_width").val(_.getAttribute("stroke-width")||1),a("#stroke_style").val(_.getAttribute("stroke-dasharray")||"none");var g=_.getAttribute("stroke-linejoin")||"miter";0!=a("#linejoin_"+g).length&&p(a("#linejoin_"+g)[0]),g=_.getAttribute("stroke-linecap")||"butt",0!=a("#linecap_"+g).length&&p(a("#linecap_"+g)[0])}if(null!=_){var h=100*(_.getAttribute("opacity")||1);a("#group_opacity").val(h),a("#opac_slider").slider("option","value",h),a("#elem_id").val(_.id)}tb()},vb=function(){var b=_;null==b||b.parentNode||(b=null);var c=d.getCurrentDrawing().getCurrentLayerName(),e=d.getMode(),f="px"!==l.baseUnit?l.baseUnit:null,g="pathedit"==e,h=a("#cmenu_canvas li");if(a("#selected_panel, #multiselected_panel, #g_panel, #rect_panel, #circle_panel,#ellipse_panel, #line_panel, #text_panel, #image_panel, #container_panel, #use_panel, #a_panel").hide(),null!=b){var i=b.nodeName,j=d.getRotationAngle(b);a("#angle").val(j);var k=d.getBlur(b);if(a("#blur").val(k),a("#blur_slider").slider("option","value",k),d.addedNew&&"image"===i&&0!==d.getHref(b).indexOf("data:")&&r(),g||"pathedit"==e){var m=N.getNodePoint();if(a("#tool_add_subpath").removeClass("push_button_pressed").addClass("tool_button"),a("#tool_node_delete").toggleClass("disabled",!N.canDeleteNodes),E("#tool_openclose_path",N.closed_subpath?"open_path":"close_path"),m){var n=a("#seg_type");f&&(m.x=svgedit.units.convertUnit(m.x),m.y=svgedit.units.convertUnit(m.y)),a("#path_node_x").val(m.x),a("#path_node_y").val(m.y),m.type?n.val(m.type).removeAttr("disabled"):n.val(4).attr("disabled","disabled")}return}if(a("#selected_panel").show(),["line","circle","ellipse"].indexOf(i)>=0)a("#xy_panel").hide();else{var o,p;if(["g","polyline","path"].indexOf(i)>=0){var q=d.getStrokedBBox([b]);q&&(o=q.x,p=q.y)}else o=b.getAttribute("x"),p=b.getAttribute("y");f&&(o=svgedit.units.convertUnit(o),p=svgedit.units.convertUnit(p)),a("#selected_x").val(o||0),a("#selected_y").val(p||0),a("#xy_panel").show()}var s=-1==["image","text","path","g","use"].indexOf(i);a("#tool_topath").toggle(s),a("#tool_reorient").toggle("path"===i),a("#tool_reorient").toggleClass("disabled",0===j);var t={g:[],a:[],rect:["rx","width","height"],image:["width","height"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],line:["x1","y1","x2","y2"],text:[],use:[]},u=b.tagName,v=null;if("a"===u&&(v=d.getHref(b),a("#g_panel").show()),"a"===b.parentNode.tagName&&(a(b).siblings().length||(a("#a_panel").show(),v=d.getHref(b.parentNode))),a("#tool_make_link, #tool_make_link").toggle(!v),v&&a("#link_url").val(v),t[u]){var w=t[u];if(a("#"+u+"_panel").show(),a.each(w,function(c,d){var e=b.getAttribute(d);if("px"!==l.baseUnit&&b[d]){var f=b[d].baseVal.value;e=svgedit.units.convertUnit(f)}a("#"+u+"_"+d).val(e||0)}),"text"==u)a("#text_panel").css("display","inline"),d.getItalic()?a("#tool_italic").addClass("push_button_pressed").removeClass("tool_button"):a("#tool_italic").removeClass("push_button_pressed").addClass("tool_button"),d.getBold()?a("#tool_bold").addClass("push_button_pressed").removeClass("tool_button"):a("#tool_bold").removeClass("push_button_pressed").addClass("tool_button"),a("#font_family").val(b.getAttribute("font-family")),a("#font_size").val(b.getAttribute("font-size")),a("#text").val(b.textContent),d.addedNew&&setTimeout(function(){a("#text").focus().select()},100);else if("image"==u)qb(d.getHref(b));else if("g"===u||"use"===u){a("#container_panel").show();var x=d.getTitle(),y=a("#g_title")[0];y.value=x,rb(y),a("#g_title").prop("disabled","use"==u)}}h[("g"===u?"en":"dis")+"ableContextMenuItems"]("#ungroup"),h[("g"!==u&&ab?"en":"dis")+"ableContextMenuItems"]("#group")}else ab?(a("#multiselected_panel").show(),h.enableContextMenuItems("#group").disableContextMenuItems("#ungroup")):h.disableContextMenuItems("#delete,#cut,#copy,#group,#ungroup,#move_front,#move_up,#move_down,#move_back");a("#tool_undo").toggleClass("disabled",0===O.getUndoStackSize()),a("#tool_redo").toggleClass("disabled",0===O.getRedoStackSize()),d.addedNew=!1,b&&!g||ab?(a("#selLayerNames").removeAttr("disabled").val(c),R.enableContextMenuItems("#delete,#cut,#copy,#move_front,#move_up,#move_down,#move_back")):a("#selLayerNames").attr("disabled","disabled")},wb=function(){if(!G){var b="#workarea.wireframe #svgcontent * { stroke-width: "+1/d.getZoom()+"px; }";a("#wireframe_rules").text(Q.hasClass("wireframe")?b:"")}},xb=function(b){b=b||d.getDocumentTitle();var c=fb+(b?": "+b:"");a("title:first").text(c)},yb=function(a,b){var c=d.getMode();"select"===c&&Z();var e="pathedit"==c;_=1===b.length||null==b[1]?b[0]:null,ab=b.length>=2&&null!=b[1],null!=_&&(e||ub()),kb(e,b),vb(),d.runExtensions("selectedChanged",{elems:b,selectedElement:_,multiselected:ab})},zb=function(b,c){var e=d.getMode(),f=c[0];if(f){if(ab=c.length>=2&&null!=c[1],!ab)switch(e){case"rotate":var g=d.getRotationAngle(f);a("#angle").val(g),a("#tool_reorient").toggleClass("disabled",0===g)}d.runExtensions("elementTransition",{elems:c})}},Ab=function(a,b){var e,f=d.getMode();for("select"===f&&Z(),e=0;e<b.length;++e){var g=b[e];g&&"svg"===g.tagName?(ib(),sb()):g&&_&&null==_.parentNode&&(_=g)}c.showSaveWarning=!0,vb(),_&&"select"===f&&(X.fill.update(),X.stroke.update()),d.runExtensions("elementChanged",{elems:b})},Bb=function(){wb()},Cb=d.zoomChanged=function(b,c,e){var f=15,g=Q,h=d.setBBoxZoom(c,g.width()-f,g.height()-f);if(h){var i=h.zoom,j=h.bbox;if(.001>i)return void I({value:.1});a("#zoom").val((100*i).toFixed(1)),e?sb():sb(!1,{x:j.x*i+j.width*i/2,y:j.y*i+j.height*i/2}),"zoom"==d.getMode()&&j.width&&Z(),Bb()}};I=function(a){var b=a.value/100;if(.001>b)return void(a.value=.1);var c=d.getZoom(),e=Q;Cb(window,{width:0,height:0,x:(e[0].scrollLeft+e.width()/2)/c,y:(e[0].scrollTop+e.height()/2)/c,zoom:b},!0)},a("#cur_context_panel").delegate("a","click",function(){var b=a(this);return b.attr("data-root")?d.leaveContext():d.setContext(b.text()),d.clearSelection(),!1});var Db=function(b,c){var e="";if(c){var f="";e='<a href="#" data-root="y">'+d.getCurrentDrawing().getCurrentLayerName()+"</a>",a(c).parentsUntil("#svgcontent > g").andSelf().each(function(){this.id&&(f+=" > "+this.id,e+=this!==c?' > <a href="#">'+this.id+"</a>":" > "+this.id)}),eb=f}else eb=null;a("#cur_context_panel").toggle(!!c).html(e),xb()},Eb=function(){X.fill.prep(),X.stroke.prep()},Fb={},Gb=function(){a(".tools_flyout").each(function(){var b=a("#"+this.id+"_show");if(!b.data("isLibrary")){var c=[];a(this).children().each(function(){c.push(this.title)}),b[0].title=c.join(" / ")}})},Hb=function(){a(".tools_flyout").each(function(){var b=a("#"+this.id+"_show"),d=b.offset(),e=b.outerWidth();a(this).css({left:(d.left+e)*c.tool_scale,top:d.top})})},Ib=function(b){a.each(b,function(c,d){var e=a(c).children(),f=c+"_show",g=a(f),h=!1;e.addClass("tool_button").unbind("click mousedown mouseup").each(function(c){var e=d[c];Fb[e.sel]=e.fn,e.isDefault&&(h=c);var i=function(c){var d=e;if("keydown"===c.type){var h=a(d.parent+"_show").hasClass("tool_button_current"),i=a(d.parent+"_show").attr("data-curopt");a.each(b[e.parent],function(a,f){f.sel==i&&(d=c.shiftKey&&h?b[e.parent][a+1]||b[e.parent][0]:f)})}if(a(this).hasClass("disabled"))return!1;ob(f)&&d.fn();var j;j=d.icon?a.getSvgIcon(d.icon,!0):a(d.sel).children().eq(0).clone(),j[0].setAttribute("width",g.width()),j[0].setAttribute("height",g.height()),g.children(":not(.flyout_arrow_horiz)").remove(),g.append(j).attr("data-curopt",d.sel)};a(this).mouseup(i),e.key&&a(document).bind("keydown",e.key[0]+" shift+"+e.key[0],i)}),h?g.attr("data-curopt",d[h].sel):g.attr("data-curopt")||g.attr("data-curopt",d[0].sel);var i,j=a(f).position();g.mousedown(function(b){if(g.hasClass("disabled"))return!1;var d=a(c),e=j.left+34,f=-1*d.width(),h=d.data("shown_popop")?200:0;i=setTimeout(function(){g.data("isLibrary")?d.css("left",e).show():d.css("left",f).show().animate({left:e},150),d.data("shown_popop",!0)},h),b.preventDefault()}).mouseup(function(){clearTimeout(i);var b=a(this).attr("data-curopt");return g.data("isLibrary")&&a(f.replace("_show","")).is(":visible")?void ob(f,!0):void(ob(f)&&Fb[b]&&Fb[b]())})}),Gb(),Hb()},Jb=function(b,c){var d=a("<div>",{"class":"tools_flyout",id:b}).appendTo("#svg_editor").append(c);return d},Kb=function(){var a,b=/^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/,c=document.getElementsByTagName("script")[0];for(a in c.style)if(b.test(a))return a.match(b)[0];return"WebkitOpacity"in c.style?"Webkit":"KhtmlOpacity"in c.style?"Khtml":""}(),Lb=function(b,c){var d=["top","left","bottom","right"];b.each(function(){var b,e=a(this),f=e.outerWidth()*(c-1),g=e.outerHeight()*(c-1);for(b=0;4>b;b++){var h=d[b],i=e.data("orig_margin-"+h);null==i&&(i=parseInt(e.css("margin-"+h),10),e.data("orig_margin-"+h,i));var j=i*c;"right"===h?j+=f:"bottom"===h&&(j+=g),e.css("margin-"+h,j)}})},Mb=c.setIconSize=function(b){var d="#tools_top .toolset, #editor_panel > *, #history_panel > *,				#main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,				#g_panel > *, #tool_font_size > *, .tools_flyout",e=a(d),f=1;if("number"==typeof b)f=b;else{var g={s:.75,m:1,l:1.25,xl:1.5};f=g[b]}c.tool_scale=f,Hb();var h=e.parents(":hidden");h.css("visibility","hidden").show(),Lb(e,f),h.css("visibility","visible").hide(),a.pref("iconsize",b),a("#iconsize").val(b);
var i={"#tools_top":{left:50,height:72},"#tools_left":{width:31,top:74},"div#workarea":{left:38,top:74}},j=a("#tool_size_rules");if(j.length?j.empty():j=a('<style id="tool_size_rules"></style>').appendTo("head"),"m"!==b){var k="";a.each(i,function(c,d){c="#svg_editor "+c.replace(/,/g,", #svg_editor"),k+=c+"{",a.each(d,function(a,c){var d;"number"==typeof c?d=c*f+"px":(c[b]||c.all)&&(d=c[b]||c.all),k+=a+":"+d+";"}),k+="}"});var l="-"+Kb.toLowerCase()+"-";k+=d+"{"+l+"transform: scale("+f+");} #svg_editor div.toolset .toolset {"+l+"transform: scale(1); margin: 1px !important;} #svg_editor .ui-slider {"+l+"transform: scale("+1/f+");}",j.text(k)}Hb()},Nb=function(b,c,d,e){var f=a(b);c=a(c);var g=!1,h=e.dropUp;h&&a(b).addClass("dropup"),c.find("li").bind("mouseup",function(){e.seticon&&(E("#cur_"+f[0].id,a(this).children()),a(this).addClass("current").siblings().removeClass("current")),d.apply(this,arguments)}),a(window).mouseup(function(){g||(f.removeClass("down"),c.hide(),c.css({top:0,left:0})),g=!1}),f.bind("mousedown",function(){var a=f.offset();h?(a.top-=c.height(),a.left+=8):a.top+=f.height(),c.offset(a),f.hasClass("down")?(c.hide(),c.css({top:0,left:0})):(c.show(),g=!0),f.toggleClass("down")}).hover(function(){g=!0}).mouseout(function(){g=!1}),e.multiclick&&c.mousedown(function(){g=!0})},Ob=[],Pb=function(b,d){function e(){H&&(clearTimeout(H),H=null),g||(H=setTimeout(function(){g=!0,Mb(a.pref("iconsize"))},50))}if(d){var f=!1,g=!1,h=!0;if(d.langReady)if(c.langChanged){var i=a.pref("lang");d.langReady({lang:i,uiStrings:o})}else Ob.push(d);var j=function(){d.callback&&!f&&h&&(f=!0,d.callback())},k=[];if(d.context_tools&&a.each(d.context_tools,function(b,c){var d,e=c.container_id?' id="'+c.container_id+'"':"",f=a("#"+c.panel);switch(f.length||(f=a("<div>",{id:c.panel}).appendTo("#tools_top")),c.type){case"tool_button":d='<div class="tool_button">'+c.id+"</div>";var g=a(d).appendTo(f);c.events&&a.each(c.events,function(b,c){a(g).bind(b,c)});break;case"select":d="<label"+e+'><select id="'+c.id+'">',a.each(c.options,function(a,b){var e=a==c.defval?" selected":"";d+='<option value="'+a+'"'+e+">"+b+"</option>"}),d+="</select></label>";var h=a(d).appendTo(f).find("select");a.each(c.events,function(b,c){a(h).bind(b,c)});break;case"button-select":d='<div id="'+c.id+'" class="dropdown toolset" title="'+c.title+'"><div id="cur_'+c.id+'" class="icon_label"></div><button></button></div>';var i=a('<ul id="'+c.id+'_opts"></ul>').appendTo("#option_lists");c.colnum&&i.addClass("optcols"+c.colnum);{a(d).appendTo(f).children()}k.push({elem:"#"+c.id,list:"#"+c.id+"_opts",title:c.title,callback:c.events.change,cur:"#cur_"+c.id});break;case"input":d="<label"+e+'><span id="'+c.id+'_label">'+c.label+':</span><input id="'+c.id+'" title="'+c.title+'" size="'+(c.size||"4")+'" value="'+(c.defval||"")+'" type="text"/></label>';var j=a(d).appendTo(f).find("input");c.spindata&&j.SpinButton(c.spindata),c.events&&a.each(c.events,function(a,b){j.bind(a,b)})}}),d.buttons){var l={},m={},n=d.svgicons,p={};a.each(d.buttons,function(b,c){for(var d,e,f,g=c.id,h=b;a("#"+g).length;)g=c.id+"_"+ ++h;n?(l[g]=c.icon,e=c.svgicon||c.id,"app_menu"==c.type?m["#"+g+" > div"]=e:m["#"+g]=e):d=a('<img src="'+c.icon+'">');var i,j;switch(c.type){case"mode_flyout":case"mode":i="tool_button",j="#tools_left";break;case"context":i="tool_button",j="#"+c.panel,a(j).length||a("<div>",{id:c.panel}).appendTo("#tools_top");break;case"app_menu":i="",j="#main_menu ul"}var k,o,q,r,s,t=a(c.list||"app_menu"==c.type?"<li/>":"<div/>").attr("id",g).attr("title",c.title).addClass(i);if(c.includeWith||c.list){if(c.list)t.addClass("push_button"),a("#"+c.list+"_opts").append(t),c.isDefault&&(a("#cur_"+c.list).append(t.children().clone()),e=c.svgicon||c.id,m["#cur_"+c.list]=e);else if(c.includeWith){var u=c.includeWith;s=a(u.button),k=s.parent(),s.parent().hasClass("tools_flyout")||(f=s[0].id.replace("tool_","tools_"),q=s.clone().attr("id",f+"_show").append(a("<div>",{"class":"flyout_arrow_horiz"})),s.before(q),k=Jb(f,s)),r=J.getButtonData(u.button),u.isDefault&&(m["#"+f+"_show"]=c.id),o=p["#"+k[0].id]=[{sel:"#"+g,fn:c.events.click,icon:c.id,key:c.key,isDefault:c.includeWith?c.includeWith.isDefault:0},r];var v="position"in u?u.position:"last",w=k.children().length;!isNaN(v)&&v>=0&&w>v?k.children().eq(v).before(t):(k.append(t),o.reverse())}}else"position"in c?a(j).children().eq(c.position).length?a(j).children().eq(c.position).before(t):a(j).children().last().before(t):t.appendTo(j),"mode_flyout"==c.type?(s=a(t),k=s.parent(),s.parent().hasClass("tools_flyout")||(f=s[0].id.replace("tool_","tools_"),q=s.clone().attr("id",f+"_show").append(a("<div>",{"class":"flyout_arrow_horiz"})),s.before(q),k=Jb(f,s),k.data("isLibrary",!0),q.data("isLibrary",!0)),m["#"+f+"_show"]=c.id,o=p["#"+k[0].id]=[{sel:"#"+g,fn:c.events.click,icon:c.id,isDefault:!0},r]):"app_menu"==c.type&&t.append("<div>").append(c.title);n||t.append(d),c.list||a.each(c.events,function(b,d){"click"==b&&"mode"==c.type?(c.includeWith?t.bind(b,d):t.bind(b,function(){ob(t)&&d()}),c.key&&(a(document).bind("keydown",c.key,d),c.title&&t.attr("title",c.title+" ["+c.key+"]"))):t.bind(b,d)}),Ib(p)}),a.each(k,function(){Nb(this.elem,this.list,this.callback,{seticon:!0})}),n&&(h=!1),a.svgIcons(n,{w:24,h:24,id_match:!1,no_img:!svgedit.browser.isWebkit(),fallback:l,placement:m,callback:function(){"m"!==a.pref("iconsize")&&e(),h=!0,j()}})}j()}},Qb=function(b,c,e){var f={alpha:c};if(0===b.indexOf("url(#")){var g=d.getRefElem(b);g=g?g.cloneNode(!0):a("#"+e+"_color defs *")[0],f[g.tagName]=g}else f.solidColor=0===b.indexOf("#")?b.substr(1):"none";return new a.jGraduate.Paint(f)};a("#text").focus(function(){$=!0}),a("#text").blur(function(){$=!1}),d.bind("selected",yb),d.bind("transition",zb),d.bind("changed",Ab),d.bind("saved",lb),d.bind("exported",mb),d.bind("zoomed",Cb),d.bind("contextset",Db),d.bind("extension_added",Pb),d.textActions.setInputElem(a("#text")[0]);var Rb='<div class="palette_item" data-rgb="none"></div>';a.each(L,function(a,b){Rb+='<div class="palette_item" style="background-color: '+b+';" data-rgb="'+b+'"></div>'}),a("#palette").append(Rb);var Sb=["#FFF","#888","#000"];Rb="",a.each(Sb,function(){Rb+='<div class="color_block" style="background-color:'+this+';"></div>'}),a("#bg_blocks").append(Rb);var Tb=a("#bg_blocks div"),Ub="cur_background";Tb.each(function(){var b=a(this);b.click(function(){Tb.removeClass(Ub),a(this).addClass(Ub)})}),q(a.pref("bkgd_color"),a.pref("bkgd_url")),a("#image_save_opts input").val([a.pref("img_save")]);var Vb=function(a){d.setRectRadius(a.value)},Wb=function(a){d.setFontSize(a.value)},Xb=function(a){var b=a.value;0==b&&_&&["line","polyline"].indexOf(_.nodeName)>=0&&(b=a.value=1),d.setStrokeWidth(b)},Yb=function(b){d.setRotationAngle(b.value),a("#tool_reorient").toggleClass("disabled",0===parseInt(b.value,10))},Zb=function(b,c){null==c&&(c=b.value),a("#group_opacity").val(c),b&&b.handle||a("#opac_slider").slider("option","value",c),d.setOpacity(c/100)},$b=function(b,c,e){null==c&&(c=b.value),a("#blur").val(c);var f=!1;b&&b.handle||(a("#blur_slider").slider("option","value",c),f=!0),e?d.setBlurNoUndo(c):d.setBlur(c,f)};a("#stroke_style").change(function(){d.setStrokeAttr("stroke-dasharray",a(this).val()),nb()}),a("#stroke_linejoin").change(function(){d.setStrokeAttr("stroke-linejoin",a(this).val()),nb()}),a("select").change(function(){a(this).blur()});var _b=!1;a("#selLayerNames").change(function(){var b=this.options[this.selectedIndex].value,c=o.notification.QmoveElemsToLayer.replace("%s",b),e=function(a){a&&(_b=!0,d.moveSelectedToLayer(b),d.clearSelection(),ib())};b&&(_b?e(!0):a.confirm(c,e))}),a("#font_family").change(function(){d.setFontFamily(this.value)}),a("#seg_type").change(function(){d.setSegType(a(this).val())}),a("#text").keyup(function(){d.setTextContent(this.value)}),a("#image_url").change(function(){qb(this.value)}),a("#link_url").change(function(){this.value.length?d.setLinkURL(this.value):d.removeHyperlink()}),a("#g_title").change(function(){d.setGroupTitle(this.value)}),a(".attr_changer").change(function(){var b=this.getAttribute("data-attr"),c=this.value,e=svgedit.units.isValidUnit(b,c,_);if(!e)return a.alert(o.notification.invalidAttrValGiven),this.value=_.getAttribute(b),!1;if("id"!==b)if(isNaN(c))c=d.convertToNum(b,c);else if("px"!==l.baseUnit){var f=svgedit.units.getTypeMap();(_[b]||"pathedit"===d.getMode()||"x"===b||"y"===b)&&(c*=f[l.baseUnit])}if("id"===b){var g=_;d.clearSelection(),g.id=c,d.addToSelection([g],!0)}else d.changeSelectedAttribute(b,c);this.blur()}),a("#palette").mouseover(function(){var b=a('<input type="hidden">');a(this).append(b),b.focus().remove()}),a(".palette_item").mousedown(function(b){var c,e=b.shiftKey||2===b.button?"stroke":"fill",f=a(this).data("rgb");"none"===f||"transparent"===f||"initial"===f?(f="none",c=new a.jGraduate.Paint):c=new a.jGraduate.Paint({alpha:100,solidColor:f.substr(1)}),X[e].setPaint(c),d.setColor(e,f),"none"!==f&&1!==d.getPaintOpacity(e)&&d.setPaintOpacity(e,1),tb()}).bind("contextmenu",function(a){a.preventDefault()}),a("#toggle_stroke_tools").on("click",function(){a("#tools_bottom").toggleClass("expanded")}),function(){var b=null,e=null,f=Q[0],g=!1,h=!1;a("#svgcanvas").bind("mousemove mouseup",function(a){return g!==!1?(f.scrollLeft-=a.clientX-b,f.scrollTop-=a.clientY-e,b=a.clientX,e=a.clientY,"mouseup"===a.type&&(g=!1),!1):void 0}).mousedown(function(a){return 1===a.button||h===!0?(g=!0,b=a.clientX,e=a.clientY,!1):void 0}),a(window).mouseup(function(){g=!1}),a(document).bind("keydown","space",function(a){d.spaceKey=h=!0,a.preventDefault()}).bind("keyup","space",function(a){a.preventDefault(),d.spaceKey=h=!1}).bind("keydown","shift",function(){"zoom"===d.getMode()&&Q.css("cursor",U)}).bind("keyup","shift",function(){"zoom"===d.getMode()&&Q.css("cursor",T)}),c.setPanning=function(a){d.spaceKey=h=a}}(),function(){var b=a("#main_icon"),c=a("#main_icon span"),d=a("#main_menu"),e=!1,f=0,g=!0,h=!1;a(window).mouseup(function(c){e||(b.removeClass("buttondown"),"INPUT"!=c.target.tagName?d.fadeOut(200):h||(h=!0,a(c.target).click(function(){d.css("margin-left","-9999px").show()}))),e=!1}).mousedown(function(b){var c=a(b.target).closest("div.tools_flyout, .contextMenu").length;c||a(".tools_flyout:visible,.contextMenu").fadeOut(250)}),c.bind("mousedown",function(){b.hasClass("buttondown")?d.fadeOut(200):(d.css("margin-left",0).show(),f||(f=d.height()),d.css("height",0).animate({height:f},200),e=!0),b.toggleClass("buttondown buttonup")}).hover(function(){e=!0}).mouseout(function(){e=!1});var i=a("#main_menu li");i.mouseover(function(){g="rgba(0, 0, 0, 0)"==a(this).css("background-color"),i.unbind("mouseover"),g&&i.mouseover(function(){this.style.backgroundColor="#FFC"}).mouseout(function(){return this.style.backgroundColor="transparent",!0})})}(),c.addDropDown=function(b,c,d){if(0!=a(b).length){var e=a(b).find("button"),f=a(b).find("ul").attr("id",a(b)[0].id+"-list"),g=!1;d?a(b).addClass("dropup"):a("#option_lists").append(f),f.find("li").bind("mouseup",c),a(window).mouseup(function(){g||(e.removeClass("down"),f.hide()),g=!1}),e.bind("mousedown",function(){if(e.hasClass("down"))f.hide();else{if(!d){var c=a(b).position();f.css({top:c.top+24,left:c.left-10})}f.show(),g=!0}e.toggleClass("down")}).hover(function(){g=!0}).mouseout(function(){g=!1})}},c.addDropDown("#font_family_dropdown",function(){a("#font_family").val(a(this).text()).change()}),c.addDropDown("#opacity_dropdown",function(){if(!a(this).find("div").length){var b=parseInt(a(this).text().split("%")[0],10);Zb(!1,b)}},!0),a("#opac_slider").slider({start:function(){a("#opacity_dropdown li:not(.special)").hide()},stop:function(){a("#opacity_dropdown li").show(),a(window).mouseup()},slide:function(a,b){Zb(b)}}),c.addDropDown("#blur_dropdown",a.noop);var ac=!1;a("#blur_slider").slider({max:10,step:.1,stop:function(b,c){ac=!1,$b(c),a("#blur_dropdown li").show(),a(window).mouseup()},start:function(){ac=!0},slide:function(a,b){$b(b,null,ac)}}),c.addDropDown("#zoom_dropdown",function(){var b=a(this),c=b.data("val");c?Cb(window,c):I({value:parseFloat(b.text())})},!0),Nb("#stroke_linecap","#linecap_opts",function(){p(this,!0)},{dropUp:!0}),Nb("#stroke_linejoin","#linejoin_opts",function(){p(this,!0)},{dropUp:!0}),Nb("#tool_position","#position_opts",function(){var a=this.id.replace("tool_pos","").charAt(0);d.alignSelectedElements(a,"page")},{multiclick:!0}),function(){var b,c=function(){a(b).blur()};a("#svg_editor").find("button, select, input:not(#text)").focus(function(){b=this,V="toolbars",Q.mousedown(c)}).blur(function(){V="canvas",Q.unbind("mousedown",c),"textedit"==d.getMode()&&a("#text").focus()})}();var bc=function(){ob("#tool_fhpath")&&d.setMode("fhpath")},cc=function(){ob("#tool_line")&&d.setMode("line")},dc=function(){ob("#tool_square")&&d.setMode("square")},ec=function(){ob("#tool_rect")&&d.setMode("rect")},fc=function(){ob("#tool_fhrect")&&d.setMode("fhrect")},gc=function(){ob("#tool_circle")&&d.setMode("circle")},hc=function(){ob("#tool_ellipse")&&d.setMode("ellipse")},ic=function(){ob("#tool_fhellipse")&&d.setMode("fhellipse")},jc=function(){ob("#tool_image")&&d.setMode("image")},kc=function(){ob("#tool_zoom")&&(d.setMode("zoom"),Q.css("cursor",T))},lc=function(b){var c=d.getResolution();b=b?c.zoom*b:1,a("#zoom").val(100*b),d.setZoom(b),Bb(),sb(!0)},mc=function(){ob("#tool_zoom")&&(lc(),Z())},nc=function(){ob("#tool_text")&&d.setMode("text")},oc=function(){ob("#tool_path")&&d.setMode("path")},pc=function(){(null!=_||ab)&&d.deleteSelectedElements()},qc=function(){(null!=_||ab)&&d.cutSelectedElements()},rc=function(){(null!=_||ab)&&d.copySelectedElements()},sc=function(){var a=d.getZoom(),b=(Q[0].scrollLeft+Q.width()/2)/a-d.contentW,c=(Q[0].scrollTop+Q.height()/2)/a-d.contentH;d.pasteElements("point",b,c)},tc=function(){null!=_&&d.moveToTopSelectedElement()},uc=function(){null!=_&&d.moveToBottomSelectedElement()},vc=function(a){null!=_&&d.moveUpDownSelected(a)},wc=function(){null!=_&&d.convertToPath()},xc=function(){null!=_&&N.reorient()},yc=function(){(null!=_||ab)&&a.prompt(o.notification.enterNewLinkURL,"http://",function(a){a&&d.makeHyperlink(a)})},zc=function(a,b){if(null!=_||ab){if(l.gridSnapping){var c=d.getZoom()*l.snappingStep;a*=c,b*=c}d.moveSelectedElements(a,b)}},Ac=function(){a("#tool_node_link").toggleClass("push_button_pressed tool_button");var b=a("#tool_node_link").hasClass("push_button_pressed");N.linkControlPoints(b)},Bc=function(){N.getNodePoint()&&N.clonePathNode()},Cc=function(){N.getNodePoint()&&N.deletePathNode()},Dc=function(){var b=a("#tool_add_subpath"),c=!b.hasClass("push_button_pressed");b.toggleClass("push_button_pressed tool_button"),N.addSubPath(c)},Ec=function(){N.opencloseSubPath()},Fc=function(){d.cycleElement(1)},Gc=function(){d.cycleElement(0)},Hc=function(b,c){if(null!=_&&!ab){b||(c*=-1);var e=parseFloat(a("#angle").val())+c;d.setRotationAngle(e),vb()}},Ic=function(){var b=l.dimensions;a.confirm(o.notification.QwantToClear,function(a){a&&(Z(),d.clear(),d.setResolution(b[0],b[1]),sb(!0),lc(),ib(),vb(),Eb(),d.runExtensions("onNewDocument"))})},Jc=function(){return d.setBold(!d.getBold()),vb(),!1},Kc=function(){return d.setItalic(!d.getItalic()),vb(),!1},Lc=function(){var b={images:a.pref("img_save"),round_digits:6};d.save(b)},Mc=function(){a.select("Select an image type for export: ",["PNG","JPEG","BMP","WEBP"],function(b){if(b){if(!i.exportImage&&!i.pngsave){var c=o.notification.loadingImage;S=window.open("data:text/html;charset=utf-8,<title>"+c+"</title><h1>"+c+"</h1>")}var e=parseInt(a("#image-slider").val(),10)/100;window.canvg?d.rasterExport(b,e):a.getScript("canvg/rgbcolor.js",function(){a.getScript("canvg/canvg.js",function(){d.rasterExport(b,e)})})}},function(){var b=a(this);"JPEG"===b.val()||"WEBP"===b.val()?a("#image-slider").length||a('<div><label>Quality: <input id="image-slider" type="range" min="1" max="100" value="92" /></label></div>').appendTo(b.parent()):a("#image-slider").parent().remove()})},Nc=function(){d.open()},Oc=function(){},Pc=function(){O.getUndoStackSize()>0&&(O.undo(),ib())},Qc=function(){O.getRedoStackSize()>0&&(O.redo(),ib())},Rc=function(){ab?d.groupSelectedElements():_&&d.ungroupSelectedElement()},Sc=function(){d.cloneSelectedElements(20,20)},Tc=function(){var b=this.id.replace("tool_align","").charAt(0);d.alignSelectedElements(b,a("#align_relative_to").val())},Uc=function(){if(a("#tool_wireframe").toggleClass("push_button_pressed tool_button"),Q.toggleClass("wireframe"),!G){var b=a("#wireframe_rules");b.length?b.empty():b=a('<style id="wireframe_rules"></style>').appendTo("head"),wb()}};a("#svg_docprops_container, #svg_prefs_container").draggable({cancel:"button,fieldset",containment:"window"});var Vc=function(){if(!cb){cb=!0,a("#image_save_opts input").val([a.pref("img_save")]);var b=d.getResolution();"px"!==l.baseUnit&&(b.w=svgedit.units.convertUnit(b.w)+l.baseUnit,b.h=svgedit.units.convertUnit(b.h)+l.baseUnit),a("#canvas_width").val(b.w),a("#canvas_height").val(b.h),a("#canvas_title").val(d.getDocumentTitle()),a("#svg_docprops").show()}},Wc=function(){if(!db){db=!0,a("#main_menu").hide();var b=a("#bg_blocks div"),c="cur_background",d=k.bkgd_color,e=a.pref("bkgd_url");b.each(function(){var b=a(this),e=b.css("background-color")==d;b.toggleClass(c,e),e&&a("#canvas_bg_url").removeClass(c)}),d||b.eq(0).addClass(c),e&&a("#canvas_bg_url").val(e),a("#grid_snapping_on").prop("checked",l.gridSnapping),a("#grid_snapping_step").attr("value",l.snappingStep),a("#grid_color").attr("value",l.gridColor),a("#svg_prefs").show()}},Xc=function(){a("#svg_source_editor").hide(),bb=!1,a("#svg_source_textarea").blur()},Yc=function(){if(bb){var b=function(){d.clearSelection(),Xc(),lc(),ib(),xb(),Eb()};d.setSvgString(a("#svg_source_textarea").val())?b():a.confirm(o.notification.QerrorsRevertToSource,function(a){return a?void b():!1}),Z()}},Zc=function(){a("#svg_docprops").hide(),a("#canvas_width,#canvas_height").removeAttr("disabled"),a("#resolution")[0].selectedIndex=0,a("#image_save_opts input").val([a.pref("img_save")]),cb=!1},$c=function(){a("#svg_prefs").hide(),db=!1},_c=function(){var b=a("#canvas_title").val();xb(b),d.setDocumentTitle(b);var c=a("#canvas_width"),e=c.val(),f=a("#canvas_height"),g=f.val();return"fit"==e||svgedit.units.isValidUnit("width",e)?(c.parent().removeClass("error"),"fit"==g||svgedit.units.isValidUnit("height",g)?(f.parent().removeClass("error"),d.setResolution(e,g)?(a.pref("img_save",a("#image_save_opts :checked").val()),sb(),void Zc()):(a.alert(o.notification.noContentToFitTo),!1)):(a.alert(o.notification.invalidAttrValGiven),f.parent().addClass("error"),!1)):(a.alert(o.notification.invalidAttrValGiven),c.parent().addClass("error"),!1)},ad=c.savePreferences=function(){var b=a("#bg_blocks div.cur_background").css("background-color")||"#FFF";q(b,a("#canvas_bg_url").val());var e=a("#lang_select").val();e!==a.pref("lang")&&c.putLocale(e,D),Mb(a("#iconsize").val()),l.gridSnapping=a("#grid_snapping_on")[0].checked,l.snappingStep=a("#grid_snapping_step").val(),l.gridColor=a("#grid_color").val(),l.showRulers=a("#show_rulers")[0].checked,a("#rulers").toggle(l.showRulers),l.showRulers&&s(),l.baseUnit=a("#base_unit").val(),d.setConfig(l),sb(),$c()},bd=a.noop,cd=function(){return a("#dialog_box").hide(),bb||cb||db?(bb?W!==a("#svg_source_textarea").val()?a.confirm(o.notification.QignoreSourceChanges,function(a){a&&Xc()}):Xc():cb?Zc():db&&$c(),void bd()):void(eb&&d.leaveContext())},dd={width:a(window).width(),height:a(window).height()};if(svgedit.browser.isIE()&&!function(){bd=function(){0===Q[0].scrollLeft&&0===Q[0].scrollTop&&(Q[0].scrollLeft=K.left,Q[0].scrollTop=K.top)},K={left:Q[0].scrollLeft,top:Q[0].scrollTop},a(window).resize(bd),c.ready(function(){setTimeout(function(){bd()},500)}),Q.scroll(function(){K={left:Q[0].scrollLeft,top:Q[0].scrollTop}})}(),a(window).resize(function(){a.each(dd,function(b,c){var d=a(window)[b]();Q[0]["scroll"+("width"===b?"Left":"Top")]-=(d-c)/2,dd[b]=d}),Hb()}),function(){Q.scroll(function(){0!=a("#ruler_x").length&&(a("#ruler_x")[0].scrollLeft=Q[0].scrollLeft),0!=a("#ruler_y").length&&(a("#ruler_y")[0].scrollTop=Q[0].scrollTop)})}(),a("#url_notice").click(function(){a.alert(this.title)}),a("#change_image_url").click(r),function(){var b=["clear","open","save","source","delete","delete_multi","paste","clone","clone_multi","move_top","move_bottom"],c="",d="tool_button_current";a.each(b,function(a,d){c+="#tool_"+d+(a==b.length-1?",":"")}),a(c).mousedown(function(){a(this).addClass(d)}).bind("mousedown mouseout",function(){a(this).removeClass(d)}),a("#tool_undo, #tool_redo").mousedown(function(){a(this).hasClass("disabled")||a(this).addClass(d)}).bind("mousedown mouseout",function(){a(this).removeClass(d)})}(),svgedit.browser.isMac()&&!window.opera){var ed=["tool_clear","tool_save","tool_source","tool_undo","tool_redo","tool_clone"];for(Y=ed.length;Y--;){var fd=document.getElementById(ed[Y]);if(fd){var gd=fd.title,hd=gd.indexOf("Ctrl+");fd.title=[gd.substr(0,hd),"Cmd+",gd.substr(hd+5)].join("")}}}var id=function(b){var c="stroke_color"==b.attr("id")?"stroke":"fill",e=X[c].paint,f="stroke"==c?"Pick a Stroke Paint and Opacity":"Pick a Fill Paint and Opacity",g=b.offset();a("#color_picker").draggable({cancel:".jGraduate_tabs, .jGraduate_colPick, .jGraduate_gradPick, .jPicker",containment:"window"}).css(l.colorPickerCSS||{left:g.left-140,bottom:40}).jGraduate({paint:e,window:{pickerTitle:f},images:{clientPath:l.jGraduatePath},newstop:"inverse"},function(b){e=new a.jGraduate.Paint(b),X[c].setPaint(e),d.setPaint(c,e),a("#color_picker").hide()},function(){a("#color_picker").hide()})},jd=function(b,c){var e,f,g=l["fill"===c?"initFill":"initStroke"],h=(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg"><rect width="16.5" height="16.5"					fill="#'+g.color+'" opacity="'+g.opacity+'"/>					<defs><linearGradient id="gradbox_"/></defs></svg>',"text/xml"),i=h.documentElement;i=a(b)[0].appendChild(document.importNode(i,!0)),i.setAttribute("width",16.5),this.rect=i.firstChild,this.defs=i.getElementsByTagName("defs")[0],this.grad=this.defs.firstChild,this.paint=new a.jGraduate.Paint({solidColor:g.color}),this.type=c,this.setPaint=function(a,b){this.paint=a;var c="none",g=a.type,h=a.alpha/100;switch(g){case"solidColor":c="none"!=a[g]?"#"+a[g]:a[g];break;case"linearGradient":case"radialGradient":this.defs.removeChild(this.grad),this.grad=this.defs.appendChild(a[g]);var i=this.grad.id="gradbox_"+this.type;c="url(#"+i+")"}this.rect.setAttribute("fill",c),this.rect.setAttribute("opacity",h),b&&(d.setColor(this.type,e,!0),d.setPaintOpacity(this.type,f,!0))},this.update=function(a){if(_){var b,c,g=this.type;switch(_.tagName){case"use":case"image":case"foreignObject":return;case"g":case"a":var h=null,i=_.getElementsByTagName("*");for(b=0,c=i.length;c>b;b++){var j=i[b],k=j.getAttribute(g);if(0===b)h=k;else if(h!==k){h=null;break}}if(null===h)return void(e=null);e=h,f=1;break;default:f=parseFloat(_.getAttribute(g+"-opacity")),isNaN(f)&&(f=1);var l="fill"===g?"black":"none";e=_.getAttribute(g)||l}a&&(d.setColor(g,e,!0),d.setPaintOpacity(g,f,!0)),f*=100;var m=Qb(e,f,g);this.setPaint(m)}},this.prep=function(){var b=this.paint.type;switch(b){case"linearGradient":case"radialGradient":var e=new a.jGraduate.Paint({copy:this.paint});d.setPaint(c,e)}}};X.fill=new jd("#fill_color","fill"),X.stroke=new jd("#stroke_color","stroke"),a("#stroke_width").val(l.initStroke.width),a("#group_opacity").val(100*l.initOpacity);var kd=X.fill.rect.cloneNode(!1);kd.setAttribute("style","vector-effect:non-scaling-stroke"),G="non-scaling-stroke"===kd.style.vectorEffect,kd.removeAttribute("style");var ld=X.fill.rect.ownerDocument,md=ld.createElementNS(svgedit.NS.SVG,"feGaussianBlur");void 0===md.stdDeviationX&&a("#tool_blur").hide(),a(md).remove(),function(){var a="-"+Kb.toLowerCase()+"-zoom-",b=a+"in";Q.css("cursor",b),Q.css("cursor")===b&&(T=b,U=a+"out"),Q.css("cursor","auto")}(),setTimeout(function(){d.embedImage("images/logo.png",function(b){b||(a("#image_save_opts [value=embed]").attr("disabled","disabled"),a("#image_save_opts input").val(["ref"]),a.pref("img_save","ref"),a("#image_opt_embed").css("color","#666").attr("title",o.notification.featNotSupported))})},1e3),a("#fill_color, #tool_fill .icon_label").click(function(){id(a("#fill_color")),tb()}),a("#stroke_color, #tool_stroke .icon_label").click(function(){id(a("#stroke_color")),tb()}),a("#group_opacityLabel").click(function(){a("#opacity_dropdown button").mousedown(),a(window).mouseup()}),a("#zoomLabel").click(function(){a("#zoom_dropdown button").mousedown(),a(window).mouseup()}),a("#tool_move_top").mousedown(function(b){a("#tools_stacking").show(),b.preventDefault()}),a(".layer_button").mousedown(function(){a(this).addClass("layer_buttonpressed")}).mouseout(function(){a(this).removeClass("layer_buttonpressed")}).mouseup(function(){a(this).removeClass("layer_buttonpressed")}),a(".push_button").mousedown(function(){a(this).hasClass("disabled")||a(this).addClass("push_button_pressed").removeClass("push_button")}).mouseout(function(){a(this).removeClass("push_button_pressed").addClass("push_button")}).mouseup(function(){a(this).removeClass("push_button_pressed").addClass("push_button")}),a("#layer_new").click(function(){var b,c=d.getCurrentDrawing().getNumLayers();do b=o.layers.layer+" "+ ++c;while(d.getCurrentDrawing().hasLayer(b));a.prompt(o.notification.enterUniqueLayerName,b,function(b){if(b){if(d.getCurrentDrawing().hasLayer(b))return void a.alert(o.notification.dupeLayerName);d.createLayer(b),vb(),ib()}})}),a("#layer_delete").click(t),a("#layer_up").click(function(){w(-1)}),a("#layer_down").click(function(){w(1)}),a("#layer_rename").click(function(){var b=a("#layerlist tr.layersel td.layername").text();a.prompt(o.notification.enterNewLayerName,"",function(c){if(c){if(b==c||d.getCurrentDrawing().hasLayer(c))return void a.alert(o.notification.layerHasThatName);d.renameCurrentLayer(c),ib()}})});var nd=300,od=150,pd=-1,qd=!1,rd=!1,sd=function(b){var c=a("#ruler_x");a("#sidepanels").width("+="+b),a("#layerpanel").width("+="+b),c.css("right",parseInt(c.css("right"),10)+b),Q.css("right",parseInt(Q.css("right"),10)+b),d.runExtensions("workareaResized")},td=function(b){if(rd&&-1!=pd){qd=!0;var c=pd-b.pageX,d=a("#sidepanels").width();d+c>nd?(c=nd-d,d=nd):2>d+c&&(c=2-d,d=2),0!=c&&(pd-=c,sd(c))}},ud=function(b){var c=a("#sidepanels").width(),d=(c>2||b?2:od)-c;sd(d)};a("#sidepanel_handle").mousedown(function(b){pd=b.pageX,a(window).mousemove(td),rd=!1,setTimeout(function(){rd=!0},20)}).mouseup(function(){qd||ud(),pd=-1,qd=!1}),a(window).mouseup(function(){pd=-1,qd=!1,a("#svg_editor").unbind("mousemove",td)}),ib();var vd=function(){Q.css("line-height",Q.height()+"px")};a(window).bind("load resize",vd),a("#resolution").change(function(){var b=a("#canvas_width,#canvas_height");if(this.selectedIndex)if("content"==this.value)b.val("fit").attr("disabled","disabled");else{var c=this.value.split("x");a("#canvas_width").val(c[0]),a("#canvas_height").val(c[1]),b.removeAttr("disabled")}else"fit"==a("#canvas_width").val()&&b.removeAttr("disabled").val(100)}),a("input,select").attr("autocomplete","off"),J=function(){var b=[{sel:"#tool_select",fn:pb,evt:"click",key:["V",!0]},{sel:"#tool_fhpath",fn:bc,evt:"click",key:["Q",!0]},{sel:"#tool_line",fn:cc,evt:"click",key:["L",!0]},{sel:"#tool_rect",fn:ec,evt:"mouseup",key:["R",!0],parent:"#tools_rect",icon:"rect"},{sel:"#tool_square",fn:dc,evt:"mouseup",parent:"#tools_rect",icon:"square"},{sel:"#tool_fhrect",fn:fc,evt:"mouseup",parent:"#tools_rect",icon:"fh_rect"},{sel:"#tool_ellipse",fn:hc,evt:"mouseup",key:["E",!0],parent:"#tools_ellipse",icon:"ellipse"},{sel:"#tool_circle",fn:gc,evt:"mouseup",parent:"#tools_ellipse",icon:"circle"},{sel:"#tool_fhellipse",fn:ic,evt:"mouseup",parent:"#tools_ellipse",icon:"fh_ellipse"},{sel:"#tool_path",fn:oc,evt:"click",key:["P",!0]},{sel:"#tool_text",fn:nc,evt:"click",key:["T",!0]},{sel:"#tool_image",fn:jc,evt:"mouseup"},{sel:"#tool_zoom",fn:kc,evt:"mouseup",key:["Z",!0]},{sel:"#tool_clear",fn:Ic,evt:"mouseup",key:["N",!0]},{sel:"#tool_save",fn:function(){bb?Yc():Lc()},evt:"mouseup",key:["S",!0]},{sel:"#tool_export",fn:Mc,evt:"mouseup"},{sel:"#tool_open",fn:Nc,evt:"mouseup",key:["O",!0]},{sel:"#tool_import",fn:Oc,evt:"mouseup"},{sel:"#tool_source",fn:jb,evt:"click",key:["U",!0]},{sel:"#tool_wireframe",fn:Uc,evt:"click",key:["F",!0]},{sel:"#tool_source_cancel,.overlay,#tool_docprops_cancel,#tool_prefs_cancel",fn:cd,evt:"click",key:["esc",!1,!1],hidekey:!0},{sel:"#tool_source_save",fn:Yc,evt:"click"},{sel:"#tool_docprops_save",fn:_c,evt:"click"},{sel:"#tool_docprops",fn:Vc,evt:"mouseup"},{sel:"#tool_prefs_save",fn:ad,evt:"click"},{sel:"#tool_prefs_option",fn:function(){return Wc(),!1},evt:"mouseup"},{sel:"#tool_delete,#tool_delete_multi",fn:pc,evt:"click",key:["del/backspace",!0]},{sel:"#tool_reorient",fn:xc,evt:"click"},{sel:"#tool_node_link",fn:Ac,evt:"click"},{sel:"#tool_node_clone",fn:Bc,evt:"click"},{sel:"#tool_node_delete",fn:Cc,evt:"click"},{sel:"#tool_openclose_path",fn:Ec,evt:"click"},{sel:"#tool_add_subpath",fn:Dc,evt:"click"},{sel:"#tool_move_top",fn:tc,evt:"click",key:"ctrl+shift+]"},{sel:"#tool_move_bottom",fn:uc,evt:"click",key:"ctrl+shift+["},{sel:"#tool_topath",fn:wc,evt:"click"},{sel:"#tool_make_link,#tool_make_link_multi",fn:yc,evt:"click"},{sel:"#tool_undo",fn:Pc,evt:"click",key:["Z",!0]},{sel:"#tool_redo",fn:Qc,evt:"click",key:["Y",!0]},{sel:"#tool_clone,#tool_clone_multi",fn:Sc,evt:"click",key:["D",!0]},{sel:"#tool_group_elements",fn:Rc,evt:"click",key:["G",!0]},{sel:"#tool_ungroup",fn:Rc,evt:"click"},{sel:"#tool_unlink_use",fn:Rc,evt:"click"},{sel:"[id^=tool_align]",fn:Tc,evt:"click"},{sel:"#tool_bold",fn:Jc,evt:"mousedown"},{sel:"#tool_italic",fn:Kc,evt:"mousedown"},{sel:"#sidepanel_handle",fn:ud,key:["X"]},{sel:"#copy_save_done",fn:cd,evt:"click"},{key:"ctrl+left",fn:function(){Hc(0,1)}},{key:"ctrl+right",fn:function(){Hc(1,1)}},{key:"ctrl+shift+left",fn:function(){Hc(0,5)}},{key:"ctrl+shift+right",fn:function(){Hc(1,5)}},{key:"shift+O",fn:Gc},{key:"shift+P",fn:Fc},{key:[M+"up",!0],fn:function(){lc(2)}},{key:[M+"down",!0],fn:function(){lc(.5)}},{key:[M+"]",!0],fn:function(){vc("Up")}},{key:[M+"[",!0],fn:function(){vc("Down")}},{key:["up",!0],fn:function(){zc(0,-1)}},{key:["down",!0],fn:function(){zc(0,1)}},{key:["left",!0],fn:function(){zc(-1,0)}},{key:["right",!0],fn:function(){zc(1,0)}},{key:"shift+up",fn:function(){zc(0,-10)}},{key:"shift+down",fn:function(){zc(0,10)}},{key:"shift+left",fn:function(){zc(-10,0)}},{key:"shift+right",fn:function(){zc(10,0)}},{key:["alt+up",!0],fn:function(){d.cloneSelectedElements(0,-1)}},{key:["alt+down",!0],fn:function(){d.cloneSelectedElements(0,1)}},{key:["alt+left",!0],fn:function(){d.cloneSelectedElements(-1,0)}},{key:["alt+right",!0],fn:function(){d.cloneSelectedElements(1,0)}},{key:["alt+shift+up",!0],fn:function(){d.cloneSelectedElements(0,-10)}},{key:["alt+shift+down",!0],fn:function(){d.cloneSelectedElements(0,10)}},{key:["alt+shift+left",!0],fn:function(){d.cloneSelectedElements(-10,0)}},{key:["alt+shift+right",!0],fn:function(){d.cloneSelectedElements(10,0)}},{key:"A",fn:function(){d.selectAllInCurrentLayer()}},{key:M+"z",fn:Pc},{key:M+"shift+z",fn:Qc},{key:M+"y",fn:Qc},{key:M+"x",fn:qc},{key:M+"c",fn:rc},{key:M+"v",fn:sc}],c={"4/Shift+4":"#tools_rect_show","5/Shift+5":"#tools_ellipse_show"};return{setAll:function(){var d={};a.each(b,function(b,e){var f;if(e.sel){if(f=a(e.sel),0==f.length)return!0;if(e.evt&&(svgedit.browser.isTouch()&&"click"===e.evt&&(e.evt="mousedown"),f[e.evt](e.fn)),e.parent&&0!=a(e.parent+"_show").length){var g=a(e.parent);g.length||(g=Jb(e.parent.substr(1))),g.append(f),a.isArray(d[e.parent])||(d[e.parent]=[]),d[e.parent].push(e)}}if(e.key){var h,i=!0,j=e.fn,k=!1;if(a.isArray(e.key)?(h=e.key[0],e.key.length>1&&(k=e.key[1]),e.key.length>2&&(i=e.key[2])):h=e.key,h+="",a.each(h.split("/"),function(b,c){a(document).bind("keydown",c,function(a){return j(),k&&a.preventDefault(),!1})}),e.sel&&!e.hidekey&&f.attr("title")){var l=f.attr("title").split("[")[0]+" ("+h+")";
c[h]=e.sel,f.parents("#main_menu").length||f.attr("title",l)}}}),Ib(d),a(".attr_changer, #image_url").bind("keydown","return",function(b){a(this).change(),b.preventDefault()}),a(window).bind("keydown","tab",function(a){"canvas"===V&&(a.preventDefault(),Fc())}).bind("keydown","shift+tab",function(a){"canvas"===V&&(a.preventDefault(),Gc())}),a("#tool_zoom").dblclick(mc)},setTitles:function(){a.each(c,function(b,c){var d=a(c).parents("#main_menu").length;a(c).each(function(){var c;c=d?a(this).text().split(" [")[0]:this.title.split(" [")[0];var e="";a.each(b.split("/"),function(a,b){var c=b.split("+"),d="";c.length>1&&(d=c[0]+"+",b=c[1]),e+=(a?"/":"")+d+(o["key_"+b]||b)}),d?this.lastChild.textContent=c+" ["+e+"]":this.title=c+" ["+e+"]"})})},getButtonData:function(c){var d;return a.each(b,function(a,b){b.sel===c&&(d=b)}),d}}}(),J.setAll(),c.ready(function(){var b,c=l.initTool,d=a("#tools_left, #svg_editor .tools_flyout"),e=d.find("#tool_"+c),f=d.find("#"+c);b=e.length?e:f.length?f:a("#tool_select"),b.click().mouseup(),l.wireframe&&a("#tool_wireframe").click(),l.showlayers&&ud(),a("#rulers").toggle(!!l.showRulers),l.showRulers&&(a("#show_rulers")[0].checked=!0),l.baseUnit&&a("#base_unit").val(l.baseUnit),l.gridSnapping&&(a("#grid_snapping_on")[0].checked=!0),l.snappingStep&&a("#grid_snapping_step").val(l.snappingStep),l.gridColor&&a("#grid_color").val(l.gridColor)}),a("#rect_rx").SpinButton({min:0,max:1e3,callback:Vb}),a("#stroke_width").SpinButton({min:0,max:99,smallStep:.1,callback:Xb}),a("#angle").SpinButton({min:-180,max:180,step:5,callback:Yb}),a("#font_size").SpinButton({min:.001,stepfunc:x,callback:Wb}),a("#group_opacity").SpinButton({min:0,max:100,step:5,callback:Zb}),a("#blur").SpinButton({min:0,max:10,step:.1,callback:$b}),a("#zoom").SpinButton({min:.001,max:1e4,step:50,stepfunc:y,callback:I}).val(100*d.getZoom()),a("#workarea").contextMenu({menu:"cmenu_canvas",inSpeed:0},function(a){switch(a){case"delete":pc();break;case"cut":qc();break;case"copy":rc();break;case"paste":d.pasteElements();break;case"paste_in_place":d.pasteElements("in_place");break;case"group_elements":d.groupSelectedElements();break;case"ungroup":d.ungroupSelectedElement();break;case"move_front":tc();break;case"move_up":vc("Up");break;case"move_down":vc("Down");break;case"move_back":uc();break;default:svgedit.contextmenu&&svgedit.contextmenu.hasCustomHandler(a)&&svgedit.contextmenu.getCustomHandler(a).call()}d.clipBoard.length&&R.enableContextMenuItems("#paste,#paste_in_place")});var wd=function(a){switch(a){case"dupe":u();break;case"delete":t();break;case"merge_down":v();break;case"merge_all":d.mergeAllLayers(),vb(),ib()}};if(a("#layerlist").contextMenu({menu:"cmenu_layers",inSpeed:0},wd),a("#layer_moreopts").contextMenu({menu:"cmenu_layers",inSpeed:0,allowLeft:!0},wd),a(".contextMenu li").mousedown(function(a){a.preventDefault()}),a("#cmenu_canvas li").disableContextMenu(),R.enableContextMenuItems("#delete,#cut,#copy"),window.addEventListener("beforeunload",function(a){return 0===O.getUndoStackSize()&&(c.showSaveWarning=!1),!l.no_save_warning&&c.showSaveWarning?(a.returnValue=o.notification.unsavedChanges,o.notification.unsavedChanges):void 0},!1),c.openPrep=function(b){a("#main_menu").hide(),0===O.getUndoStackSize()?b(!0):a.confirm(o.notification.QwantToOpen,b)},window.FileReader){var xd=function(b){a.process_cancel(o.notification.loadingImage),b.stopPropagation(),b.preventDefault(),a("#workarea").removeAttr("style"),a("#main_menu").hide();var c="drop"==b.type?b.dataTransfer.files[0]:this.files[0];if(c&&-1!=c.type.indexOf("image")){var e;-1!=c.type.indexOf("svg")?(e=new FileReader,e.onloadend=function(a){d.importSvgString(a.target.result,!0),d.ungroupSelectedElement(),d.ungroupSelectedElement(),d.groupSelectedElements(),d.alignSelectedElements("m","page"),d.alignSelectedElements("c","page")},e.readAsText(c)):(e=new FileReader,e.onloadend=function(a){var b=function(b,c){var e=d.addSvgElementFromJson({element:"image",attr:{x:0,y:0,width:b,height:c,id:d.getNextId(),style:"pointer-events:inherit"}});d.setHref(e,a.target.result),d.selectOnly([e]),d.alignSelectedElements("m","page"),d.alignSelectedElements("c","page"),vb()},c=100,e=100,f=new Image;f.src=a.target.result,f.style.opacity=0,f.onload=function(){c=f.offsetWidth,e=f.offsetHeight,b(c,e)}},e.readAsDataURL(c))}};Q[0].addEventListener("dragenter",z,!1),Q[0].addEventListener("dragover",A,!1),Q[0].addEventListener("dragleave",B,!1),Q[0].addEventListener("drop",xd,!1);var yd=a('<input type="file">').change(function(){var e=this;c.openPrep(function(c){if(c&&(d.clear(),1===e.files.length)){a.process_cancel(o.notification.loadingImage);var f=new FileReader;f.onloadend=function(a){b(a.target.result),sb()},f.readAsText(e.files[0])}})});a("#tool_open").show().prepend(yd);var zd=a('<input type="file">').change(xd);a("#tool_import").show().prepend(zd)}sb(!0),a(function(){window.svgCanvas=d,d.ready=c.ready}),c.setLang=function(b,e){if(c.langChanged=!0,a.pref("lang",b),a("#lang_select").val(b),e){var f=a("#layerlist tr.layersel td.layername").text(),g=f==o.common.layer+" 1";if(a.extend(o,e),d.setUiStrings(e),J.setTitles(),g&&(d.renameCurrentLayer(o.common.layer+" 1"),ib()),Ob.length)for(;Ob.length;){var h=Ob.shift();h.langReady({lang:b,uiStrings:o})}else d.runExtensions("langReady",{lang:b,uiStrings:o});d.runExtensions("langChanged",b),Gb();var i={"#stroke_color":"#tool_stroke .icon_label, #tool_stroke .color_block","#fill_color":"#tool_fill label, #tool_fill .color_block","#linejoin_miter":"#cur_linejoin","#linecap_butt":"#cur_linecap"};a.each(i,function(b,c){a(c).attr("title",a(b)[0].title)}),a("#multiselected_panel div[id^=tool_align]").each(function(){a("#tool_pos"+this.id.substr(10))[0].title=this.title})}}},c.ready=function(a){g?a():h.push(a)},c.runCallbacks=function(){a.each(h,function(){this()}),g=!0},c.loadFromString=function(a){c.ready(function(){b(a)})},c.disableUI=function(){},c.loadFromURL=function(d,e){e||(e={});var f=e.cache,g=e.callback;c.ready(function(){a.ajax({url:d,dataType:"text",cache:!!f,beforeSend:function(){a.process_cancel(o.notification.loadingImage)},success:function(a){b(a,g)},error:function(c,d,e){404!=c.status&&c.responseText?b(c.responseText,g):a.alert(o.notification.URLloadFail+": \n"+e,g)},complete:function(){a("#dialog_box").hide()}})})},c.loadFromDataURI=function(a){c.ready(function(){var c="data:image/svg+xml;base64,",d=a.substring(c.length);b(f.decode64(d))})},c.addExtension=function(){var b=arguments;a(function(){d&&d.addExtension.apply(this,b)})},c}(jQuery),$(svgEditor.init))}();
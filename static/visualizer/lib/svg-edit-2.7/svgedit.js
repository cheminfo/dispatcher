svgedit={NS:{HTML:"http://www.w3.org/1999/xhtml",MATH:"http://www.w3.org/1998/Math/MathML",SE:"http://svg-edit.googlecode.com",SVG:"http://www.w3.org/2000/svg",XLINK:"http://www.w3.org/1999/xlink",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"}},svgedit.getReverseNS=function(){var a={};return $.each(this.NS,function(b,c){a[c]=b.toLowerCase()}),a},function(){var a=jQuery.fn.attr;jQuery.fn.attr=function(b,c){var d,e=this.length;if(!e)return a.apply(this,arguments);for(d=0;e>d;++d){var f=this[d];if("http://www.w3.org/2000/svg"!==f.namespaceURI)return a.apply(this,arguments);if(void 0!==c)f.setAttribute(b,c);else if($.isArray(b)){e=b.length;for(var g={};e--;){var h=b[e];((d=f.getAttribute(h))||"0"===d)&&(d=isNaN(d)?d:d-0),g[h]=d}return g}if("object"!=typeof b)return((d=f.getAttribute(b))||"0"===d)&&(d=isNaN(d)?d:d-0),d;for(g in b)f.setAttribute(g,b[g])}return this}}(),jQuery&&function(){var a=$(window),b=$(document);$.extend($.fn,{contextMenu:function(c,d){return void 0==c.menu?!1:(void 0==c.inSpeed&&(c.inSpeed=150),void 0==c.outSpeed&&(c.outSpeed=75),0==c.inSpeed&&(c.inSpeed=-1),0==c.outSpeed&&(c.outSpeed=-1),$(this).each(function(){var e=$(this),f=$(e).offset(),g=$("#"+c.menu);g.addClass("contextMenu"),$(this).bind("mousedown",function(h){$(this).mouseup(function(i){var j=$(this);if(j.unbind("mouseup"),2===h.button||c.allowLeft||h.ctrlKey&&svgedit.browser.isMac()){if(i.stopPropagation(),$(".contextMenu").hide(),e.hasClass("disabled"))return!1;var k=i.pageX,l=i.pageY;i=a.width()-g.width();var m=a.height()-g.height();k>i-15&&(k=i-15),l>m-30&&(l=m-30),b.unbind("click"),g.css({top:l,left:k}).fadeIn(c.inSpeed),g.find("A").mouseover(function(){g.find("LI.hover").removeClass("hover"),$(this).parent().addClass("hover")}).mouseout(function(){g.find("LI.hover").removeClass("hover")}),b.keypress(function(a){switch(a.keyCode){case 38:g.find("LI.hover").length?(g.find("LI.hover").removeClass("hover").prevAll("LI:not(.disabled)").eq(0).addClass("hover"),g.find("LI.hover").length||g.find("LI:last").addClass("hover")):g.find("LI:last").addClass("hover");break;case 40:0==g.find("LI.hover").length?g.find("LI:first").addClass("hover"):(g.find("LI.hover").removeClass("hover").nextAll("LI:not(.disabled)").eq(0).addClass("hover"),g.find("LI.hover").length||g.find("LI:first").addClass("hover"));break;case 13:g.find("LI.hover A").trigger("click");break;case 27:b.trigger("click")}}),g.find("A").unbind("mouseup"),g.find("LI:not(.disabled) A").mouseup(function(){return b.unbind("click").unbind("keypress"),$(".contextMenu").hide(),d&&d($(this).attr("href").substr(1),$(j),{x:k-f.left,y:l-f.top,docX:k,docY:l}),!1}),setTimeout(function(){b.click(function(){return b.unbind("click").unbind("keypress"),g.fadeOut(c.outSpeed),!1})},0)}})}),$("#"+c.menu).each($.browser.mozilla?function(){$(this).css({MozUserSelect:"none"})}:$.browser.msie?function(){$(this).bind("selectstart.disableTextSelect",function(){return!1})}:function(){$(this).bind("mousedown.disableTextSelect",function(){return!1})}),$(e).add($("UL.contextMenu")).bind("contextmenu",function(){return!1})}),$(this))},disableContextMenuItems:function(a){return void 0==a?($(this).find("LI").addClass("disabled"),$(this)):($(this).each(function(){if(void 0!=a)for(var b=a.split(","),c=0;c<b.length;c++)$(this).find('A[href="'+b[c]+'"]').parent().addClass("disabled")}),$(this))},enableContextMenuItems:function(a){return void 0==a?($(this).find("LI.disabled").removeClass("disabled"),$(this)):($(this).each(function(){if(void 0!=a)for(var b=a.split(","),c=0;c<b.length;c++)$(this).find('A[href="'+b[c]+'"]').parent().removeClass("disabled")}),$(this))},disableContextMenu:function(){return $(this).each(function(){$(this).addClass("disabled")}),$(this)},enableContextMenu:function(){return $(this).each(function(){$(this).removeClass("disabled")}),$(this)},destroyContextMenu:function(){return $(this).each(function(){$(this).unbind("mousedown").unbind("mouseup")}),$(this)}})}(jQuery),function(){svgedit.browser||(svgedit.browser={});var a=svgedit.NS,b=!!document.createElementNS&&!!document.createElementNS(a.SVG,"svg").createSVGRect;if(svgedit.browser.supportsSvg=function(){return b},svgedit.browser.supportsSvg()){var c=navigator.userAgent,d=document.createElementNS(a.SVG,"svg"),e=!!window.opera,f=c.indexOf("AppleWebKit")>=0,g=c.indexOf("Gecko/")>=0,h=c.indexOf("MSIE")>=0,i=c.indexOf("Chrome/")>=0,j=c.indexOf("Windows")>=0,k=c.indexOf("Macintosh")>=0,l="ontouchstart"in window,m=!!d.querySelector,n=!!document.evaluate,o=function(){var b=document.createElementNS(a.SVG,"path");b.setAttribute("d","M0,0 10,10");var c=b.pathSegList;b=b.createSVGPathSegLinetoAbs(5,5);try{return c.replaceItem(b,0),!0}catch(d){}return!1}(),p=function(){var b=document.createElementNS(a.SVG,"path");b.setAttribute("d","M0,0 10,10");var c=b.pathSegList;b=b.createSVGPathSegLinetoAbs(5,5);try{return c.insertItemBefore(b,0),!0}catch(d){}return!1}(),q=function(){var b=document.createElementNS(a.SVG,"svg"),c=document.createElementNS(a.SVG,"svg");document.documentElement.appendChild(b),c.setAttribute("x",5),b.appendChild(c);var d=document.createElementNS(a.SVG,"text");return d.textContent="a",c.appendChild(d),c=d.getStartPositionOfChar(0).x,document.documentElement.removeChild(b),0===c}(),r=function(){var b=document.createElementNS(a.SVG,"svg");document.documentElement.appendChild(b);var c=document.createElementNS(a.SVG,"path");return c.setAttribute("d","M0,0 C0,0 10,10 10,0"),b.appendChild(c),c=c.getBBox(),document.documentElement.removeChild(b),c.height>4&&c.height<5}(),s=function(){var b=document.createElementNS(a.SVG,"svg");document.documentElement.appendChild(b);var c=document.createElementNS(a.SVG,"path");c.setAttribute("d","M0,0 10,0");var d=document.createElementNS(a.SVG,"path");d.setAttribute("d","M5,0 15,0");var e=document.createElementNS(a.SVG,"g");return e.appendChild(c),e.appendChild(d),b.appendChild(e),c=e.getBBox(),document.documentElement.removeChild(b),15==c.width}(),t=function(){var b=document.createElementNS(a.SVG,"rect");return b.setAttribute("x",.1),(b=-1==b.cloneNode(!1).getAttribute("x").indexOf(","))||$.alert('NOTE: This version of Opera is known to contain bugs in SVG-edit.\nPlease upgrade to the <a href="http://opera.com">latest version</a> in which the problems have been fixed.'),b}(),u=function(){var b=document.createElementNS(a.SVG,"rect");return b.setAttribute("style","vector-effect:non-scaling-stroke"),"non-scaling-stroke"===b.style.vectorEffect}(),v=function(){var b=document.createElementNS(a.SVG,"rect").transform.baseVal,c=d.createSVGTransform();return b.appendItem(c),b.getItem(0)==c}();svgedit.browser.isOpera=function(){return e},svgedit.browser.isWebkit=function(){return f},svgedit.browser.isGecko=function(){return g},svgedit.browser.isIE=function(){return h},svgedit.browser.isChrome=function(){return i},svgedit.browser.isWindows=function(){return j},svgedit.browser.isMac=function(){return k},svgedit.browser.isTouch=function(){return l},svgedit.browser.supportsSelectors=function(){return m},svgedit.browser.supportsXpath=function(){return n},svgedit.browser.supportsPathReplaceItem=function(){return o},svgedit.browser.supportsPathInsertItemBefore=function(){return p},svgedit.browser.supportsPathBBox=function(){return r},svgedit.browser.supportsHVLineContainerBBox=function(){return s},svgedit.browser.supportsGoodTextCharPos=function(){return q},svgedit.browser.supportsEditableText=function(){return e},svgedit.browser.supportsGoodDecimals=function(){return t},svgedit.browser.supportsNonScalingStroke=function(){return u},svgedit.browser.supportsNativeTransformLists=function(){return v}}else window.location="browser-not-supported.html"}(),function(){svgedit.transformlist||(svgedit.transformlist={});var a=document.createElementNS(svgedit.NS.SVG,"svg"),b={};svgedit.transformlist.SVGTransformList=function(c){this._elem=c||null,this._xforms=[],this._update=function(){var b="";a.createSVGMatrix();var c;for(c=0;c<this.numberOfItems;++c){var d=this._list.getItem(c);b=b,d=d;var e=d.matrix,f="";switch(d.type){case 1:f="matrix("+[e.a,e.b,e.c,e.d,e.e,e.f].join(",")+")";break;case 2:f="translate("+e.e+","+e.f+")";break;case 3:f=e.a==e.d?"scale("+e.a+")":"scale("+e.a+","+e.d+")";break;case 4:var g=0;f=0,0!=d.angle&&(g=1-e.a,f=(g*e.f+e.b*e.e)/(g*g+e.b*e.b),g=(e.e-e.b*f)/g),f="rotate("+d.angle+" "+g+","+f+")"}b+=f+" "}this._elem.setAttribute("transform",b)},this._list=this,this._init=function(){var b=this._elem.getAttribute("transform");if(b)for(var c=/\s*((scale|matrix|rotate|translate)\s*\(.*?\))\s*,?\s*/,d=!0;d;)if(d=b.match(c),b=b.replace(c,""),d&&d[1]){var e=d[1].split(/\s*\(/),f=e[0];e=e[1].match(/\s*(.*?)\s*\)/),e[1]=e[1].replace(/(\d)-/g,"$1 -");var g=e[1].split(/[, ]+/),h="abcdef".split(""),i=a.createSVGMatrix();$.each(g,function(a,b){g[a]=parseFloat(b),"matrix"==f&&(i[h[a]]=g[a])}),e=a.createSVGTransform();var j="set"+f.charAt(0).toUpperCase()+f.slice(1),k="matrix"==f?[i]:g;"scale"==f&&1==k.length?k.push(k[0]):"translate"==f&&1==k.length?k.push(0):"rotate"==f&&1==k.length&&k.push(0,0),e[j].apply(e,k),this._list.appendItem(e)}},this._removeFromOtherLists=function(a){if(a){var c,d=!1;for(c in b){var e,f,g=b[c];for(e=0,f=g._xforms.length;f>e;++e)if(g._xforms[e]==a){d=!0,g.removeItem(e);break}if(d)break}}},this.numberOfItems=0,this.clear=function(){this.numberOfItems=0,this._xforms=[]},this.initialize=function(a){this.numberOfItems=1,this._removeFromOtherLists(a),this._xforms=[a]},this.getItem=function(a){if(a<this.numberOfItems&&a>=0)return this._xforms[a];throw{code:1}},this.insertItemBefore=function(a,b){var c=null;if(b>=0)if(b<this.numberOfItems){this._removeFromOtherLists(a),c=Array(this.numberOfItems+1);var d;for(d=0;b>d;++d)c[d]=this._xforms[d];c[d]=a;var e;for(e=d+1;d<this.numberOfItems;++e,++d)c[e]=this._xforms[d];this.numberOfItems++,this._xforms=c,c=a,this._list._update()}else c=this._list.appendItem(a);return c},this.replaceItem=function(a,b){var c=null;return b<this.numberOfItems&&b>=0&&(this._removeFromOtherLists(a),c=this._xforms[b]=a,this._list._update()),c},this.removeItem=function(a){if(a<this.numberOfItems&&a>=0){var b,c=this._xforms[a],d=Array(this.numberOfItems-1);for(b=0;a>b;++b)d[b]=this._xforms[b];for(a=b;a<this.numberOfItems-1;++a,++b)d[a]=this._xforms[b+1];return this.numberOfItems--,this._xforms=d,this._list._update(),c}throw{code:1}},this.appendItem=function(a){return this._removeFromOtherLists(a),this._xforms.push(a),this.numberOfItems++,this._list._update(),a}},svgedit.transformlist.resetListMap=function(){b={}},svgedit.transformlist.removeElementFromListMap=function(a){a.id&&b[a.id]&&delete b[a.id]},svgedit.transformlist.getTransformList=function(a){if(!svgedit.browser.supportsNativeTransformLists()){var c=a.id||"temp",d=b[c];return d&&"temp"!==c||(b[c]=new svgedit.transformlist.SVGTransformList(a),b[c]._init(),d=b[c]),d}return a.transform?a.transform.baseVal:a.gradientTransform?a.gradientTransform.baseVal:a.patternTransform?a.patternTransform.baseVal:null}}(),function(){svgedit.math||(svgedit.math={});var a=document.createElementNS(svgedit.NS.SVG,"svg");svgedit.math.transformPoint=function(a,b,c){return{x:c.a*a+c.c*b+c.e,y:c.b*a+c.d*b+c.f}},svgedit.math.isIdentity=function(a){return 1===a.a&&0===a.b&&0===a.c&&1===a.d&&0===a.e&&0===a.f},svgedit.math.matrixMultiply=function(){for(var a=arguments,b=a.length,c=a[b-1];b-->1;)c=a[b-1].multiply(c);return Math.abs(c.a)<1e-14&&(c.a=0),Math.abs(c.b)<1e-14&&(c.b=0),Math.abs(c.c)<1e-14&&(c.c=0),Math.abs(c.d)<1e-14&&(c.d=0),Math.abs(c.e)<1e-14&&(c.e=0),Math.abs(c.f)<1e-14&&(c.f=0),c},svgedit.math.hasMatrixTransform=function(a){if(!a)return!1;for(var b=a.numberOfItems;b--;){var c=a.getItem(b);if(1==c.type&&!svgedit.math.isIdentity(c.matrix))return!0}return!1},svgedit.math.transformBox=function(a,b,c,d,e){var f=svgedit.math.transformPoint,g=f(a,b,e),h=f(a+c,b,e),i=f(a,b+d,e);return a=f(a+c,b+d,e),b=Math.min(g.x,h.x,i.x,a.x),c=Math.min(g.y,h.y,i.y,a.y),{tl:g,tr:h,bl:i,br:a,aabox:{x:b,y:c,width:Math.max(g.x,h.x,i.x,a.x)-b,height:Math.max(g.y,h.y,i.y,a.y)-c}}},svgedit.math.transformListToTransform=function(b,c,d){if(null==b)return a.createSVGTransformFromMatrix(a.createSVGMatrix());if(c=c||0,d=d||b.numberOfItems-1,c=parseInt(c,10),d=parseInt(d,10),c>d){var e=d;d=c,c=e}for(e=a.createSVGMatrix(),c=c;d>=c;++c){var f=c>=0&&c<b.numberOfItems?b.getItem(c).matrix:a.createSVGMatrix();e=svgedit.math.matrixMultiply(e,f)}return a.createSVGTransformFromMatrix(e)},svgedit.math.getMatrix=function(a){return a=svgedit.transformlist.getTransformList(a),svgedit.math.transformListToTransform(a).matrix},svgedit.math.snapToAngle=function(a,b,c,d){var e=Math.PI/4;c-=a;var f=d-b;return d=Math.sqrt(c*c+f*f),e=Math.round(Math.atan2(f,c)/e)*e,{x:a+d*Math.cos(e),y:b+d*Math.sin(e),a:e}},svgedit.math.rectsIntersect=function(a,b){return b.x<a.x+a.width&&b.x+b.width>a.x&&b.y<a.y+a.height&&b.y+b.height>a.y}}(),function(){svgedit.units||(svgedit.units={});var a,b=svgedit.NS,c=["x","x1","cx","rx","width"],d=["y","y1","cy","ry","height"],e=["r","radius"].concat(c,d),f={};svgedit.units.init=function(c){a=c,c=document.createElementNS(b.SVG,"svg"),document.body.appendChild(c);var d=document.createElementNS(b.SVG,"rect");d.setAttribute("width","1em"),d.setAttribute("height","1ex"),d.setAttribute("x","1in"),c.appendChild(d),d=d.getBBox(),document.body.removeChild(c),c=d.x,f={em:d.width,ex:d.height,"in":c,cm:c/2.54,mm:c/25.4,pt:c/72,pc:c/6,px:1,"%":0}},svgedit.units.getTypeMap=function(){return f},svgedit.units.shortFloat=function(b){var c=a.getRoundDigits();return isNaN(b)?$.isArray(b)?svgedit.units.shortFloat(b[0])+","+svgedit.units.shortFloat(b[1]):parseFloat(b).toFixed(c)-0:+(+b).toFixed(c)},svgedit.units.convertUnit=function(b,c){return c=c||a.getBaseUnit(),svgedit.units.shortFloat(b/f[c])},svgedit.units.setUnitAttr=function(a,b,c){a.setAttribute(b,c)};var g={line:["x1","x2","y1","y2"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],foreignObject:["x","y","width","height"],rect:["x","y","width","height"],image:["x","y","width","height"],use:["x","y","width","height"],text:["x","y"]};svgedit.units.convertAttrs=function(b){var c=b.tagName,d=a.getBaseUnit();if(c=g[c]){var e,h=c.length;for(e=0;h>e;e++){var i=c[e],j=b.getAttribute(i);j&&(isNaN(j)||b.setAttribute(i,j/f[d]+d))}}},svgedit.units.convertToNum=function(b,e){if(!isNaN(e))return e-0;var g;if("%"===e.substr(-1)){g=e.substr(0,e.length-1)/100;var h=a.getWidth(),i=a.getHeight();return c.indexOf(b)>=0?g*h:d.indexOf(b)>=0?g*i:g*Math.sqrt(h*h+i*i)/Math.sqrt(2)}return h=e.substr(-2),g=e.substr(0,e.length-2),g*f[h]},svgedit.units.isValidUnit=function(b,c,d){var g=!1;if(e.indexOf(b)>=0)isNaN(c)?(c=c.toLowerCase(),$.each(f,function(a){g||RegExp("^-?[\\d\\.]+"+a+"$").test(c)&&(g=!0)})):g=!0;else if("id"==b){b=!1;try{var h=a.getElement(c);b=null==h||h===d}catch(i){}return b}return g=!0}}(),function(){function a(a){if(svgedit.browser.supportsHVLineContainerBBox())try{return a.getBBox()}catch(b){}var c,d=$.data(a,"ref"),e=null;d?(c=$(d).children().clone().attr("visibility","hidden"),$(g).append(c),e=c.filter("line, path")):e=$(a).find("line, path");var f=!1;return e.length?(e.each(function(){var a=this.getBBox();a.width&&a.height||(f=!0)}),f?(a=d?c:$(a).children(),a=getStrokedBBox(a)):a=a.getBBox()):a=a.getBBox(),d&&c.remove(),a}svgedit.utilities||(svgedit.utilities={});var b=svgedit.NS,c="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(","),d=null,e=null,f=null,g=null;svgedit.utilities.init=function(a){d=a,e=a.getDOMDocument(),f=a.getDOMContainer(),g=a.getSVGRoot()},svgedit.utilities.toXml=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/,"&#x27;")},svgedit.utilities.fromXml=function(a){return $("<p/>").html(a).text()},svgedit.utilities.encode64=function(a){if(a=svgedit.utilities.encodeUTF8(a),window.btoa)return window.btoa(a);var b,c,d,e,f,g,h=Array(4*Math.floor((a.length+2)/3)),i=0,j=0;do b=a.charCodeAt(i++),c=a.charCodeAt(i++),d=a.charCodeAt(i++),e=b>>2,b=(3&b)<<4|c>>4,f=(15&c)<<2|d>>6,g=63&d,isNaN(c)?f=g=64:isNaN(d)&&(g=64),h[j++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e),h[j++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b),h[j++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f),h[j++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g);while(i<a.length);return h.join("")},svgedit.utilities.decode64=function(a){if(window.atob)return window.atob(a);var b,c,d,e="",f="",g="",h=0;a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(h++)),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(h++)),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(h++)),g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(h++)),b=b<<2|c>>4,c=(15&c)<<4|d>>2,f=(3&d)<<6|g,e+=String.fromCharCode(b),64!=d&&(e+=String.fromCharCode(c)),64!=g&&(e+=String.fromCharCode(f));while(h<a.length);return unescape(e)},svgedit.utilities.encodeUTF8=function(a){if(null===a||"undefined"==typeof a)return"";a=String(a);var b,c,d="",e=0;b=c=0,e=a.length;var f;for(f=0;e>f;f++){var g=a.charCodeAt(f),h=null;if(128>g)c++;else if(g>127&&2048>g)h=String.fromCharCode(g>>6|192,63&g|128);else if(55296!=(63488&g))h=String.fromCharCode(g>>12|224,g>>6&63|128,63&g|128);else{if(55296!=(64512&g))throw new RangeError("Unmatched trail surrogate at "+f);if(h=a.charCodeAt(++f),56320!=(64512&h))throw new RangeError("Unmatched lead surrogate at "+(f-1));g=((1023&g)<<10)+(1023&h)+65536,h=String.fromCharCode(g>>18|240,g>>12&63|128,g>>6&63|128,63&g|128)}null!==h&&(c>b&&(d+=a.slice(b,c)),d+=h,b=c=f+1)}return c>b&&(d+=a.slice(b,e)),d},svgedit.utilities.convertToXMLReferences=function(a){var b,c="";for(b=0;b<a.length;b++){var d=a.charCodeAt(b);128>d?c+=a[b]:d>127&&(c+="&#"+d+";")}return c},svgedit.utilities.text2xml=function(a){a.indexOf("<svg:svg")>=0&&(a=a.replace(/<(\/?)svg:/g,"<$1").replace("xmlns:svg","xmlns"));var b,c;try{c=window.DOMParser?new DOMParser:new ActiveXObject("Microsoft.XMLDOM"),c.async=!1}catch(d){throw Error("XML Parser could not be instantiated")}try{b=c.loadXML?c.loadXML(a)?c:!1:c.parseFromString(a,"text/xml")}catch(e){throw Error("Error parsing XML string")}return b},svgedit.utilities.bboxToObj=function(a){return{x:a.x,y:a.y,width:a.width,height:a.height}},svgedit.utilities.walkTree=function(a,b){if(a&&1==a.nodeType){b(a);for(var c=a.childNodes.length;c--;)svgedit.utilities.walkTree(a.childNodes.item(c),b)}},svgedit.utilities.walkTreePost=function(a,b){if(a&&1==a.nodeType){for(var c=a.childNodes.length;c--;)svgedit.utilities.walkTree(a.childNodes.item(c),b);b(a)}},svgedit.utilities.getUrlFromAttr=function(a){if(a){if(0===a.indexOf('url("'))return a.substring(5,a.indexOf('"',6));if(0===a.indexOf("url('"))return a.substring(5,a.indexOf("'",6));if(0===a.indexOf("url("))return a.substring(4,a.indexOf(")"))}return null},svgedit.utilities.getHref=function(a){return a.getAttributeNS(b.XLINK,"href")},svgedit.utilities.setHref=function(a,c){a.setAttributeNS(b.XLINK,"xlink:href",c)},svgedit.utilities.findDefs=function(){var a=d.getSVGContent(),c=a.getElementsByTagNameNS(b.SVG,"defs");return c.length>0?c=c[0]:(c=a.ownerDocument.createElementNS(b.SVG,"defs"),a.firstChild?a.insertBefore(c,a.firstChild.nextSibling):a.appendChild(c)),c},svgedit.utilities.getPathBBox=function(a){var b=a.pathSegList,c=b.numberOfItems;a=[[],[]];var d=b.getItem(0),e=[d.x,d.y];for(d=0;c>d;d++){var f=b.getItem(d);if("undefined"!=typeof f.x)if(a[0].push(e[0]),a[1].push(e[1]),f.x1){var g,h=[f.x1,f.y1],i=[f.x2,f.y2],j=[f.x,f.y];for(g=0;2>g;g++){f=function(a){return Math.pow(1-a,3)*e[g]+3*Math.pow(1-a,2)*a*h[g]+3*(1-a)*Math.pow(a,2)*i[g]+Math.pow(a,3)*j[g]};var k=6*e[g]-12*h[g]+6*i[g],l=-3*e[g]+9*h[g]-9*i[g]+3*j[g],m=3*h[g]-3*e[g];if(0==l)0!=k&&(k=-m/k,k>0&&1>k&&a[g].push(f(k)));else if(m=Math.pow(k,2)-4*m*l,!(0>m)){var n=(-k+Math.sqrt(m))/(2*l);n>0&&1>n&&a[g].push(f(n)),k=(-k-Math.sqrt(m))/(2*l),k>0&&1>k&&a[g].push(f(k))}}e=j}else a[0].push(f.x),a[1].push(f.y)}return b=Math.min.apply(null,a[0]),c=Math.max.apply(null,a[0])-b,d=Math.min.apply(null,a[1]),a=Math.max.apply(null,a[1])-d,{x:b,y:d,width:c,height:a}},svgedit.utilities.getBBox=function(b){var e=b||d.geSelectedElements()[0];if(1!=b.nodeType)return null;b=null;var f=e.nodeName;switch(f){case"text":if(""===e.textContent)e.textContent="a",b=e.getBBox(),e.textContent="";else try{b=e.getBBox()}catch(g){}break;case"path":if(svgedit.browser.supportsPathBBox())try{b=e.getBBox()}catch(h){}else b=svgedit.utilities.getPathBBox(e);break;case"g":case"a":b=a(e);break;default:if("use"===f&&(b=a(e,!0)),"use"===f||"foreignObject"===f&&svgedit.browser.isWebkit())b||(b=e.getBBox()),f={},f.width=b.width,f.height=b.height,f.x=b.x+parseFloat(e.getAttribute("x")||0),f.y=b.y+parseFloat(e.getAttribute("y")||0),b=f;else if(~c.indexOf(f))try{b=e.getBBox()}catch(i){if(e=$(e).closest("foreignObject"),e.length)try{b=e[0].getBBox()}catch(j){b=null}else b=null}}return b&&(b=svgedit.utilities.bboxToObj(b)),b},svgedit.utilities.getRotationAngle=function(a,b){var c=a||d.getSelectedElements()[0];if(c=svgedit.transformlist.getTransformList(c),!c)return 0;var e,f=c.numberOfItems;for(e=0;f>e;++e){var g=c.getItem(e);if(4==g.type)return b?g.angle*Math.PI/180:g.angle}return 0},svgedit.utilities.getRefElem=function(a){return svgedit.utilities.getElem(svgedit.utilities.getUrlFromAttr(a).substr(1))},svgedit.utilities.getElem=svgedit.browser.supportsSelectors()?function(a){return g.querySelector("#"+a)}:svgedit.browser.supportsXpath()?function(a){return e.evaluate('svg:svg[@id="svgroot"]//svg:*[@id="'+a+'"]',f,function(){return svgedit.NS.SVG},9,null).singleNodeValue}:function(a){return $(g).find("[id="+a+"]")[0]},svgedit.utilities.assignAttributes=function(a,c,d,e){d||(d=0),svgedit.browser.isOpera()||g.suspendRedraw(d);for(var f in c)(d="xml:"===f.substr(0,4)?b.XML:"xlink:"===f.substr(0,6)?b.XLINK:null)?a.setAttributeNS(d,f,c[f]):e?svgedit.units.setUnitAttr(a,f,c[f]):a.setAttribute(f,c[f]);svgedit.browser.isOpera()||g.unsuspendRedraw(null)},svgedit.utilities.cleanupElement=function(a){var b,c=g.suspendRedraw(60),d={"fill-opacity":1,"stop-opacity":1,opacity:1,stroke:"none","stroke-dasharray":"none","stroke-linejoin":"miter","stroke-linecap":"butt","stroke-opacity":1,"stroke-width":1,rx:0,ry:0};for(b in d){var e=d[b];a.getAttribute(b)==e&&a.removeAttribute(b)}g.unsuspendRedraw(c)},svgedit.utilities.snapToGrid=function(a){var b=d.getSnappingStep(),c=d.getBaseUnit();return"px"!==c&&(b*=svgedit.units.getTypeMap()[c]),a=Math.round(a/b)*b},svgedit.utilities.preg_quote=function(a,b){return String(a).replace(RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\"+(b||"")+"-]","g"),"\\$&")}}(),function(){svgedit.sanitize||(svgedit.sanitize={});var a=svgedit.NS,b=svgedit.getReverseNS(),c={a:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","mask","opacity","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","xlink:href","xlink:title"],circle:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","r","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],clipPath:["class","clipPathUnits","id"],defs:[],style:["type"],desc:[],ellipse:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],feGaussianBlur:["class","color-interpolation-filters","id","requiredFeatures","stdDeviation"],filter:["class","color-interpolation-filters","filterRes","filterUnits","height","id","primitiveUnits","requiredFeatures","width","x","xlink:href","y"],foreignObject:["class","font-size","height","id","opacity","requiredFeatures","style","transform","width","x","y"],g:["class","clip-path","clip-rule","id","display","fill","fill-opacity","fill-rule","filter","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","font-family","font-size","font-style","font-weight","text-anchor"],image:["class","clip-path","clip-rule","filter","height","id","mask","opacity","requiredFeatures","style","systemLanguage","transform","width","x","xlink:href","xlink:title","y"],line:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","x1","x2","y1","y2"],linearGradient:["class","id","gradientTransform","gradientUnits","requiredFeatures","spreadMethod","systemLanguage","x1","x2","xlink:href","y1","y2"],marker:["id","class","markerHeight","markerUnits","markerWidth","orient","preserveAspectRatio","refX","refY","systemLanguage","viewBox"],mask:["class","height","id","maskContentUnits","maskUnits","width","x","y"],metadata:["class","id"],path:["class","clip-path","clip-rule","d","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],pattern:["class","height","id","patternContentUnits","patternTransform","patternUnits","requiredFeatures","style","systemLanguage","viewBox","width","x","xlink:href","y"],polygon:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","id","class","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],polyline:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],radialGradient:["class","cx","cy","fx","fy","gradientTransform","gradientUnits","id","r","requiredFeatures","spreadMethod","systemLanguage","xlink:href"],rect:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","width","x","y"],stop:["class","id","offset","requiredFeatures","stop-color","stop-opacity","style","systemLanguage"],svg:["class","clip-path","clip-rule","filter","id","height","mask","preserveAspectRatio","requiredFeatures","style","systemLanguage","viewBox","width","x","xmlns","xmlns:se","xmlns:xlink","y"],"switch":["class","id","requiredFeatures","systemLanguage"],symbol:["class","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","opacity","preserveAspectRatio","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","viewBox"],text:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","transform","x","xml:space","y"],textPath:["class","id","method","requiredFeatures","spacing","startOffset","style","systemLanguage","transform","xlink:href"],title:[],tspan:["class","clip-path","clip-rule","dx","dy","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","rotate","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","textLength","transform","x","xml:space","y"],use:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","transform","width","x","xlink:href","y"],annotation:["encoding"],"annotation-xml":["encoding"],maction:["actiontype","other","selection"],math:["class","id","display","xmlns"],menclose:["notation"],merror:[],mfrac:["linethickness"],mi:["mathvariant"],mmultiscripts:[],mn:[],mo:["fence","lspace","maxsize","minsize","rspace","stretchy"],mover:[],mpadded:["lspace","width","height","depth","voffset"],mphantom:[],mprescripts:[],mroot:[],mrow:["xlink:href","xlink:type","xmlns:xlink"],mspace:["depth","height","width"],msqrt:[],mstyle:["displaystyle","mathbackground","mathcolor","mathvariant","scriptlevel"],msub:[],msubsup:[],msup:[],mtable:["align","columnalign","columnlines","columnspacing","displaystyle","equalcolumns","equalrows","frame","rowalign","rowlines","rowspacing","width"],mtd:["columnalign","columnspan","rowalign","rowspan"],mtext:[],mtr:["columnalign","rowalign"],munder:[],munderover:[],none:[],semantics:[]},d={};$.each(c,function(b,c){var e={};$.each(c,function(b,c){if(c.indexOf(":")>=0){var d=c.split(":");e[d[1]]=a[d[0].toUpperCase()]}else e[c]="xmlns"==c?a.XMLNS:null}),d[b]=e}),svgedit.sanitize.sanitizeSvg=function(e){if(3==e.nodeType&&(e.nodeValue=e.nodeValue.replace(/^\s+|\s+$/g,""),0===e.nodeValue.length&&e.parentNode.removeChild(e)),1==e.nodeType){var f=e.parentNode;if(e.ownerDocument&&f){var g,h=c[e.nodeName],i=d[e.nodeName];if("undefined"!=typeof h){var j=[];for(g=e.attributes.length;g--;){var k=e.attributes.item(g),l=k.nodeName,m=k.localName,n=k.namespaceURI;if(i.hasOwnProperty(m)&&n==i[m]&&n!=a.XMLNS||n==a.XMLNS&&b[k.nodeValue]||(0===l.indexOf("se:")&&j.push([l,k.nodeValue]),e.removeAttributeNS(n,m)),svgedit.browser.isGecko())switch(l){case"transform":case"gradientTransform":case"patternTransform":m=k.nodeValue.replace(/(\d)-/g,"$1 -"),e.setAttribute(l,m)}if("style"==l){for(k=k.nodeValue.split(";"),l=k.length;l--;)n=k[l].split(":"),m=$.trim(n[0]),n=$.trim(n[1]),h.indexOf(m)>=0&&e.setAttribute(m,n);e.removeAttribute("style")}}if($.each(j,function(b,c){e.setAttributeNS(a.SE,c[0],c[1])}),(g=svgedit.utilities.getHref(e))&&["filter","linearGradient","pattern","radialGradient","textPath","use"].indexOf(e.nodeName)>=0&&"#"!=g[0]&&(svgedit.utilities.setHref(e,""),e.removeAttributeNS(a.XLINK,"href")),"use"!=e.nodeName||svgedit.utilities.getHref(e))for($.each(["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],function(a,b){var c=e.getAttribute(b);c&&(c=svgedit.utilities.getUrlFromAttr(c))&&"#"!==c[0]&&(e.setAttribute(b,""),e.removeAttribute(b))}),g=e.childNodes.length;g--;)svgedit.sanitize.sanitizeSvg(e.childNodes.item(g));else f.removeChild(e)}else{for(h=[];e.hasChildNodes();)h.push(f.insertBefore(e.firstChild,e));for(f.removeChild(e),g=h.length;g--;)svgedit.sanitize.sanitizeSvg(h[g])
}}}}}(),function(){svgedit.history||(svgedit.history={}),svgedit.history.HistoryEventTypes={BEFORE_APPLY:"before_apply",AFTER_APPLY:"after_apply",BEFORE_UNAPPLY:"before_unapply",AFTER_UNAPPLY:"after_unapply"},svgedit.history.MoveElementCommand=function(a,b,c,d){this.elem=a,this.text=d?"Move "+a.tagName+" to "+d:"Move "+a.tagName,this.oldNextSibling=b,this.oldParent=c,this.newNextSibling=a.nextSibling,this.newParent=a.parentNode},svgedit.history.MoveElementCommand.type=function(){return"svgedit.history.MoveElementCommand"},svgedit.history.MoveElementCommand.prototype.type=svgedit.history.MoveElementCommand.type,svgedit.history.MoveElementCommand.prototype.getText=function(){return this.text},svgedit.history.MoveElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this),this.elem=this.newParent.insertBefore(this.elem,this.newNextSibling),a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)},svgedit.history.MoveElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this),this.elem=this.oldParent.insertBefore(this.elem,this.oldNextSibling),a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)},svgedit.history.MoveElementCommand.prototype.elements=function(){return[this.elem]},svgedit.history.InsertElementCommand=function(a,b){this.elem=a,this.text=b||"Create "+a.tagName,this.parent=a.parentNode,this.nextSibling=this.elem.nextSibling},svgedit.history.InsertElementCommand.type=function(){return"svgedit.history.InsertElementCommand"},svgedit.history.InsertElementCommand.prototype.type=svgedit.history.InsertElementCommand.type,svgedit.history.InsertElementCommand.prototype.getText=function(){return this.text},svgedit.history.InsertElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this),this.elem=this.parent.insertBefore(this.elem,this.nextSibling),a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)},svgedit.history.InsertElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this),this.parent=this.elem.parentNode,this.elem=this.elem.parentNode.removeChild(this.elem),a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)},svgedit.history.InsertElementCommand.prototype.elements=function(){return[this.elem]},svgedit.history.RemoveElementCommand=function(a,b,c,d){this.elem=a,this.text=d||"Delete "+a.tagName,this.nextSibling=b,this.parent=c,svgedit.transformlist.removeElementFromListMap(a)},svgedit.history.RemoveElementCommand.type=function(){return"svgedit.history.RemoveElementCommand"},svgedit.history.RemoveElementCommand.prototype.type=svgedit.history.RemoveElementCommand.type,svgedit.history.RemoveElementCommand.prototype.getText=function(){return this.text},svgedit.history.RemoveElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this),svgedit.transformlist.removeElementFromListMap(this.elem),this.parent=this.elem.parentNode,this.elem=this.parent.removeChild(this.elem),a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)},svgedit.history.RemoveElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this),svgedit.transformlist.removeElementFromListMap(this.elem),null==this.nextSibling&&window.console&&console.log("Error: reference element was lost"),this.parent.insertBefore(this.elem,this.nextSibling),a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)},svgedit.history.RemoveElementCommand.prototype.elements=function(){return[this.elem]},svgedit.history.ChangeElementCommand=function(a,b,c){this.elem=a,this.text=c?"Change "+a.tagName+" "+c:"Change "+a.tagName,this.newValues={},this.oldValues=b;for(var d in b)this.newValues[d]="#text"==d?a.textContent:"#href"==d?svgedit.utilities.getHref(a):a.getAttribute(d)},svgedit.history.ChangeElementCommand.type=function(){return"svgedit.history.ChangeElementCommand"},svgedit.history.ChangeElementCommand.prototype.type=svgedit.history.ChangeElementCommand.type,svgedit.history.ChangeElementCommand.prototype.getText=function(){return this.text},svgedit.history.ChangeElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);var b,c=!1;for(b in this.newValues)this.newValues[b]?"#text"==b?this.elem.textContent=this.newValues[b]:"#href"==b?svgedit.utilities.setHref(this.elem,this.newValues[b]):this.elem.setAttribute(b,this.newValues[b]):"#text"==b?this.elem.textContent="":(this.elem.setAttribute(b,""),this.elem.removeAttribute(b)),"transform"==b&&(c=!0);return c||(c=svgedit.utilities.getRotationAngle(this.elem))&&(b=elem.getBBox(),c=["rotate(",c," ",b.x+b.width/2,",",b.y+b.height/2,")"].join(""),c!=elem.getAttribute("transform")&&elem.setAttribute("transform",c)),a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this),!0},svgedit.history.ChangeElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);var b,c=!1;for(b in this.oldValues)this.oldValues[b]?"#text"==b?this.elem.textContent=this.oldValues[b]:"#href"==b?svgedit.utilities.setHref(this.elem,this.oldValues[b]):this.elem.setAttribute(b,this.oldValues[b]):"#text"==b?this.elem.textContent="":this.elem.removeAttribute(b),"transform"==b&&(c=!0);return c||(c=svgedit.utilities.getRotationAngle(this.elem))&&(b=elem.getBBox(),c=["rotate(",c," ",b.x+b.width/2,",",b.y+b.height/2,")"].join(""),c!=elem.getAttribute("transform")&&elem.setAttribute("transform",c)),svgedit.transformlist.removeElementFromListMap(this.elem),a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this),!0},svgedit.history.ChangeElementCommand.prototype.elements=function(){return[this.elem]},svgedit.history.BatchCommand=function(a){this.text=a||"Batch Command",this.stack=[]},svgedit.history.BatchCommand.type=function(){return"svgedit.history.BatchCommand"},svgedit.history.BatchCommand.prototype.type=svgedit.history.BatchCommand.type,svgedit.history.BatchCommand.prototype.getText=function(){return this.text},svgedit.history.BatchCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);var b,c=this.stack.length;for(b=0;c>b;++b)this.stack[b].apply(a);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)},svgedit.history.BatchCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);var b;for(b=this.stack.length-1;b>=0;b--)this.stack[b].unapply(a);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)},svgedit.history.BatchCommand.prototype.elements=function(){for(var a=[],b=this.stack.length;b--;)for(var c=this.stack[b].elements(),d=c.length;d--;)-1==a.indexOf(c[d])&&a.push(c[d]);return a},svgedit.history.BatchCommand.prototype.addSubCommand=function(a){this.stack.push(a)},svgedit.history.BatchCommand.prototype.isEmpty=function(){return 0===this.stack.length},svgedit.history.UndoManager=function(a){this.handler_=a||null,this.undoStackPointer=0,this.undoStack=[],this.undoChangeStackPointer=-1,this.undoableChangeStack=[]},svgedit.history.UndoManager.prototype.resetUndoStack=function(){this.undoStack=[],this.undoStackPointer=0},svgedit.history.UndoManager.prototype.getUndoStackSize=function(){return this.undoStackPointer},svgedit.history.UndoManager.prototype.getRedoStackSize=function(){return this.undoStack.length-this.undoStackPointer},svgedit.history.UndoManager.prototype.getNextUndoCommandText=function(){return this.undoStackPointer>0?this.undoStack[this.undoStackPointer-1].getText():""},svgedit.history.UndoManager.prototype.getNextRedoCommandText=function(){return this.undoStackPointer<this.undoStack.length?this.undoStack[this.undoStackPointer].getText():""},svgedit.history.UndoManager.prototype.undo=function(){this.undoStackPointer>0&&this.undoStack[--this.undoStackPointer].unapply(this.handler_)},svgedit.history.UndoManager.prototype.redo=function(){this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0&&this.undoStack[this.undoStackPointer++].apply(this.handler_)},svgedit.history.UndoManager.prototype.addCommandToHistory=function(a){this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0&&(this.undoStack=this.undoStack.splice(0,this.undoStackPointer)),this.undoStack.push(a),this.undoStackPointer=this.undoStack.length},svgedit.history.UndoManager.prototype.beginUndoableChange=function(a,b){for(var c=++this.undoChangeStackPointer,d=b.length,e=Array(d),f=Array(d);d--;){var g=b[d];null!=g&&(f[d]=g,e[d]=g.getAttribute(a))}this.undoableChangeStack[c]={attrName:a,oldValues:e,elements:f}},svgedit.history.UndoManager.prototype.finishUndoableChange=function(){for(var a=this.undoChangeStackPointer--,b=this.undoableChangeStack[a],c=b.elements.length,d=b.attrName,e=new svgedit.history.BatchCommand("Change "+d);c--;){var f=b.elements[c];if(null!=f){var g={};g[d]=b.oldValues[c],g[d]!=f.getAttribute(d)&&e.addSubCommand(new svgedit.history.ChangeElementCommand(f,g,d))}}return this.undoableChangeStack[a]=null,e}}();var svgedit=svgedit||{};!function(){svgedit.coords||(svgedit.coords={});var a=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],b=null;svgedit.coords.init=function(a){b=a},svgedit.coords.remapElement=function(c,d,e){var f,g,h=function(a,b){return svgedit.math.transformPoint(a,b,e)},i=b.getGridSnapping()&&"svg"===c.parentNode.parentNode.localName,j=function(){var a;if(i)for(a in d)d[a]=svgedit.utilities.snapToGrid(d[a]);svgedit.utilities.assignAttributes(c,d,1e3,!0)},k=svgedit.utilities.getBBox(c);for(f=0;2>f;f++){g=0===f?"fill":"stroke";var l=c.getAttribute(g);if(l&&0===l.indexOf("url(")&&(e.a<0||e.d<0)){if(l=svgedit.utilities.getRefElem(l).cloneNode(!0),e.a<0){var m=l.getAttribute("x1"),n=l.getAttribute("x2");l.setAttribute("x1",-(m-1)),l.setAttribute("x2",-(n-1))}e.d<0&&(m=l.getAttribute("y1"),n=l.getAttribute("y2"),l.setAttribute("y1",-(m-1)),l.setAttribute("y2",-(n-1))),l.id=b.getDrawing().getNextId(),svgedit.utilities.findDefs().appendChild(l),c.setAttribute(g,"url(#"+l.id+")")}}switch(f=c.tagName,("g"===f||"text"===f||"tspan"==f||"use"===f)&&(1!=e.a||0!=e.b||0!=e.c||1!=e.d||0==e.e&&0==e.f?(g=svgedit.transformlist.getTransformList(c),l=svgroot.createSVGTransform(),l.setMatrix(svgedit.math.matrixMultiply(svgedit.math.transformListToTransform(g).matrix,e)),g.clear(),g.appendItem(l)):(g=svgedit.math.transformListToTransform(c).matrix,g=svgedit.math.matrixMultiply(g.inverse(),e,g),d.x=parseFloat(d.x)+g.e,d.y=parseFloat(d.y)+g.f)),f){case"foreignObject":case"rect":case"image":"image"===f&&(e.a<0||e.d<0)?(g=svgedit.transformlist.getTransformList(c),l=svgroot.createSVGTransform(),l.setMatrix(svgedit.math.matrixMultiply(svgedit.math.transformListToTransform(g).matrix,e)),g.clear(),g.appendItem(l)):(l=h(d.x,d.y),d.width=e.a*d.width,d.height=e.d*d.height,d.x=l.x+Math.min(0,d.width),d.y=l.y+Math.min(0,d.height),d.width=Math.abs(d.width),d.height=Math.abs(d.height)),j();break;case"ellipse":h=h(d.cx,d.cy),d.cx=h.x,d.cy=h.y,d.rx=e.a*d.rx,d.ry=e.d*d.ry,d.rx=Math.abs(d.rx),d.ry=Math.abs(d.ry),j();break;case"circle":h=h(d.cx,d.cy),d.cx=h.x,d.cy=h.y,h=svgedit.math.transformBox(k.x,k.y,k.width,k.height,e),d.r=Math.min((h.tr.x-h.tl.x)/2,(h.bl.y-h.tl.y)/2),d.r&&(d.r=Math.abs(d.r)),j();break;case"line":l=h(d.x1,d.y1),m=h(d.x2,d.y2),d.x1=l.x,d.y1=l.y,d.x2=m.x,d.y2=m.y;case"text":case"tspan":case"use":j();break;case"g":(h=$(c).data("gsvg"))&&svgedit.utilities.assignAttributes(h,d,1e3,!0);break;case"polyline":case"polygon":for(j=d.points.length,f=0;j>f;++f)g=d.points[f],g=h(g.x,g.y),d.points[f].x=g.x,d.points[f].y=g.y;for(j=d.points.length,h="",f=0;j>f;++f)g=d.points[f],h+=g.x+","+g.y+" ";c.setAttribute("points",h);break;case"path":for(g=c.pathSegList,j=g.numberOfItems,d.d=[],f=0;j>f;++f)k=g.getItem(f),d.d[f]={type:k.pathSegType,x:k.x,y:k.y,x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,r1:k.r1,r2:k.r2,angle:k.angle,largeArcFlag:k.largeArcFlag,sweepFlag:k.sweepFlag};for(j=d.d.length,f=d.d[0],n=h(f.x,f.y),d.d[0].x=n.x,d.d[0].y=n.y,f=1;j>f;++f)k=d.d[f],g=k.type,g%2==0?(g=h(void 0!=k.x?k.x:n.x,void 0!=k.y?k.y:n.y),l=h(k.x1,k.y1),m=h(k.x2,k.y2),k.x=g.x,k.y=g.y,k.x1=l.x,k.y1=l.y,k.x2=m.x,k.y2=m.y):(k.x=e.a*k.x,k.y=e.d*k.y,k.x1=e.a*k.x1,k.y1=e.d*k.y1,k.x2=e.a*k.x2,k.y2=e.d*k.y2),k.r1=e.a*k.r1,k.r2=e.d*k.r2;for(h="",j=d.d.length,f=0;j>f;++f)switch(k=d.d[f],g=k.type,h+=a[g],g){case 13:case 12:h+=k.x+" ";break;case 15:case 14:h+=k.y+" ";break;case 3:case 5:case 19:case 2:case 4:case 18:h+=k.x+","+k.y+" ";break;case 7:case 6:h+=k.x1+","+k.y1+" "+k.x2+","+k.y2+" "+k.x+","+k.y+" ";break;case 9:case 8:h+=k.x1+","+k.y1+" "+k.x+","+k.y+" ";break;case 11:case 10:h+=k.r1+","+k.r2+" "+k.angle+" "+ +k.largeArcFlag+" "+ +k.sweepFlag+" "+k.x+","+k.y+" ";break;case 17:case 16:h+=k.x2+","+k.y2+" "+k.x+","+k.y+" "}c.setAttribute("d",h)}}}(),svgedit=svgedit||{},function(){svgedit.recalculate||(svgedit.recalculate={});var a,b=svgedit.NS;svgedit.recalculate.init=function(b){a=b},svgedit.recalculate.updateClipPath=function(b,c,d){b=getRefElem(b).firstChild;var e=svgedit.transformlist.getTransformList(b),f=a.getSVGRoot().createSVGTransform();f.setTranslate(c,d),e.appendItem(f),svgedit.recalculate.recalculateDimensions(b)},svgedit.recalculate.recalculateDimensions=function(c){if(null==c)return null;if("svg"==c.nodeName&&navigator.userAgent.indexOf("Firefox/20")>=0)return null;var d,e=a.getSVGRoot(),f=svgedit.transformlist.getTransformList(c);if(f&&f.numberOfItems>0){for(d=f.numberOfItems;d--;){var g=f.getItem(d);0===g.type?f.removeItem(d):1===g.type?svgedit.math.isIdentity(g.matrix)&&f.removeItem(d):4===g.type&&0===g.angle&&f.removeItem(d)}if(1===f.numberOfItems&&svgedit.utilities.getRotationAngle(c))return null}if(!f||0==f.numberOfItems)return c.setAttribute("transform",""),c.removeAttribute("transform"),null;if(f){d=f.numberOfItems;for(var h=[];d--;)g=f.getItem(d),1===g.type?h.push([g.matrix,d]):h.length&&(h=[]);2===h.length&&(d=e.createSVGTransformFromMatrix(svgedit.math.matrixMultiply(h[1][0],h[0][0])),f.removeItem(h[0][1]),f.removeItem(h[1][1]),f.insertItemBefore(d,h[1][1])),d=f.numberOfItems,d>=2&&1===f.getItem(d-2).type&&2===f.getItem(d-1).type&&(h=e.createSVGTransform(),g=svgedit.math.matrixMultiply(f.getItem(d-2).matrix,f.getItem(d-1).matrix),h.setMatrix(g),f.removeItem(d-2),f.removeItem(d-2),f.appendItem(h))}switch(c.tagName){case"line":case"polyline":case"polygon":case"path":break;default:if(1===f.numberOfItems&&1===f.getItem(0).type||2===f.numberOfItems&&1===f.getItem(0).type&&4===f.getItem(0).type)return null}var i=$(c).data("gsvg");d=new svgedit.history.BatchCommand("Transform");var j={},k=null;switch(g=[],c.tagName){case"line":g=["x1","y1","x2","y2"];break;case"circle":g=["cx","cy","r"];break;case"ellipse":g=["cx","cy","rx","ry"];break;case"foreignObject":case"rect":case"image":g=["width","height","x","y"];break;case"use":case"text":case"tspan":g=["x","y"];break;case"polygon":case"polyline":k={},k.points=c.getAttribute("points"),h=c.points;var l=h.numberOfItems;j.points=Array(l);var m;for(m=0;l>m;++m){var n=h.getItem(m);j.points[m]={x:n.x,y:n.y}}break;case"path":k={},k.d=c.getAttribute("d"),j.d=c.getAttribute("d")}if(g.length?(j=$(c).attr(g),$.each(j,function(a,b){j[a]=svgedit.units.convertToNum(a,b)})):i&&(j={x:$(i).attr("x")||0,y:$(i).attr("y")||0}),null==k&&(k=$.extend(!0,{},j),$.each(k,function(a,b){k[a]=svgedit.units.convertToNum(a,b)})),k.transform=a.getStartTransform()||"","g"==c.tagName&&!i||"a"==c.tagName){h=svgedit.utilities.getBBox(c);var o={x:h.x+h.width/2,y:h.y+h.height/2},p=svgedit.math.transformPoint(h.x+h.width/2,h.y+h.height/2,svgedit.math.transformListToTransform(f).matrix);if(g=e.createSVGMatrix(),h=svgedit.utilities.getRotationAngle(c))for(m=h*Math.PI/180,l=Math.abs(m)>1e-10?Math.sin(m)/(1-Math.cos(m)):2/m,m=0;m<f.numberOfItems;++m)if(g=f.getItem(m),4==g.type){g=g.matrix,o.y=(l*g.e+g.f)/2,o.x=(g.e-l*g.f)/2,f.removeItem(m);break}m=g=i=0;var q=f.numberOfItems;if(q)var r=f.getItem(0).matrix;if(q>=3&&3==f.getItem(q-2).type&&2==f.getItem(q-3).type&&2==f.getItem(q-1).type){m=3;var s=f.getItem(q-3).matrix,t=f.getItem(q-2).matrix,u=f.getItem(q-1).matrix;for(l=c.childNodes,n=l.length;n--;){var v=l.item(n);if(g=i=0,1==v.nodeType){var w=svgedit.transformlist.getTransformList(v);if(w){g=svgedit.math.transformListToTransform(w).matrix,i=svgedit.utilities.getRotationAngle(v);var x=a.getStartTransform(),y=[];if(a.setStartTransform(v.getAttribute("transform")),i||svgedit.math.hasMatrixTransform(w)){var z=e.createSVGTransform();z.setMatrix(svgedit.math.matrixMultiply(s,t,u,g)),w.clear(),w.appendItem(z),y.push(z)}else{i=svgedit.math.matrixMultiply(g.inverse(),u,g),z=e.createSVGMatrix(),z.e=-i.e,z.f=-i.f,g=svgedit.math.matrixMultiply(z.inverse(),g.inverse(),s,t,u,g,i.inverse());var A=e.createSVGTransform(),B=e.createSVGTransform(),C=e.createSVGTransform();A.setTranslate(i.e,i.f),B.setScale(g.a,g.d),C.setTranslate(z.e,z.f),w.appendItem(C),w.appendItem(B),w.appendItem(A),y.push(C),y.push(B),y.push(A)}d.addSubCommand(svgedit.recalculate.recalculateDimensions(v)),a.setStartTransform(x)}}}f.removeItem(q-1),f.removeItem(q-2),f.removeItem(q-3)}else if(q>=3&&1==f.getItem(q-1).type)m=3,g=svgedit.math.transformListToTransform(f).matrix,z=e.createSVGTransform(),z.setMatrix(g),f.clear(),f.appendItem(z);else if((1==q||q>1&&3!=f.getItem(1).type)&&2==f.getItem(0).type){if(m=2,i=svgedit.math.transformListToTransform(f).matrix,f.removeItem(0),g=svgedit.math.transformListToTransform(f).matrix.inverse(),g=svgedit.math.matrixMultiply(g,i),i=g.e,g=g.f,0!=i||0!=g){for(l=c.childNodes,n=l.length,q=[];n--;)if(v=l.item(n),1==v.nodeType&&(v.getAttribute("clip-path")&&(x=v.getAttribute("clip-path"),-1===q.indexOf(x)&&(svgedit.recalculate.updateClipPath(x,i,g),q.push(x))),x=a.getStartTransform(),a.setStartTransform(v.getAttribute("transform")),w=svgedit.transformlist.getTransformList(v))){for(s=e.createSVGTransform(),s.setTranslate(i,g),w.numberOfItems?w.insertItemBefore(s,0):w.appendItem(s),d.addSubCommand(svgedit.recalculate.recalculateDimensions(v)),w=c.getElementsByTagNameNS(b.SVG,"use"),v="#"+v.id,s=w.length;s--;)t=w.item(s),v==svgedit.utilities.getHref(t)&&(u=e.createSVGTransform(),u.setTranslate(-i,-g),svgedit.transformlist.getTransformList(t).insertItemBefore(u,0),d.addSubCommand(svgedit.recalculate.recalculateDimensions(t)));a.setStartTransform(x)}q=[],a.setStartTransform(x)}}else{if(1!=q||1!=f.getItem(0).type||h)return h&&(e=e.createSVGTransform(),e.setRotate(h,p.x,p.y),f.numberOfItems?f.insertItemBefore(e,0):f.appendItem(e)),0==f.numberOfItems&&c.removeAttribute("transform"),null;for(m=1,g=f.getItem(0).matrix,l=c.childNodes,n=l.length;n--;)v=l.item(n),1==v.nodeType&&(x=a.getStartTransform(),a.setStartTransform(v.getAttribute("transform")),(w=svgedit.transformlist.getTransformList(v))&&(i=svgedit.math.matrixMultiply(g,svgedit.math.transformListToTransform(w).matrix),q=e.createSVGTransform(),q.setMatrix(i),w.clear(),w.appendItem(q,0),d.addSubCommand(svgedit.recalculate.recalculateDimensions(v)),a.setStartTransform(x),x=v.getAttribute("stroke-width"),"none"!==v.getAttribute("stroke")&&!isNaN(x)&&v.setAttribute("stroke-width",x*((Math.abs(i.a)+Math.abs(i.d))/2))));f.clear()}if(2==m)h&&(p={x:o.x+r.e,y:o.y+r.f},e=e.createSVGTransform(),e.setRotate(h,p.x,p.y),f.numberOfItems?f.insertItemBefore(e,0):f.appendItem(e));else if(3==m){if(g=svgedit.math.transformListToTransform(f).matrix,r=e.createSVGTransform(),r.setRotate(h,o.x,o.y),r=r.matrix,o=e.createSVGTransform(),o.setRotate(h,p.x,p.y),p=o.matrix.inverse(),x=g.inverse(),p=svgedit.math.matrixMultiply(x,p,r,g),i=p.e,g=p.f,0!=i||0!=g)for(l=c.childNodes,n=l.length;n--;)v=l.item(n),1==v.nodeType&&(x=a.getStartTransform(),a.setStartTransform(v.getAttribute("transform")),w=svgedit.transformlist.getTransformList(v),s=e.createSVGTransform(),s.setTranslate(i,g),w.numberOfItems?w.insertItemBefore(s,0):w.appendItem(s),d.addSubCommand(svgedit.recalculate.recalculateDimensions(v)),a.setStartTransform(x));h&&(f.numberOfItems?f.insertItemBefore(o,0):f.appendItem(o))}}else{if(h=svgedit.utilities.getBBox(c),!h&&"path"!=c.tagName)return null;if(g=e.createSVGMatrix(),i=svgedit.utilities.getRotationAngle(c))for(o={x:h.x+h.width/2,y:h.y+h.height/2},p=svgedit.math.transformPoint(h.x+h.width/2,h.y+h.height/2,svgedit.math.transformListToTransform(f).matrix),m=i*Math.PI/180,l=Math.abs(m)>1e-10?Math.sin(m)/(1-Math.cos(m)):2/m,m=0;m<f.numberOfItems;++m)if(g=f.getItem(m),4==g.type){g=g.matrix,o.y=(l*g.e+g.f)/2,o.x=(g.e-l*g.f)/2,f.removeItem(m);break}if(m=0,q=f.numberOfItems,svgedit.browser.isWebkit()||(r=c.getAttribute("fill"))&&0===r.indexOf("url(")&&(r=getRefElem(r),x="pattern",r.tagName!==x&&(x="gradient"),"userSpaceOnUse"===r.getAttribute(x+"Units")&&(g=svgedit.math.transformListToTransform(f).matrix,h=svgedit.transformlist.getTransformList(r),h=svgedit.math.transformListToTransform(h).matrix,g=svgedit.math.matrixMultiply(g,h),h="matrix("+[g.a,g.b,g.c,g.d,g.e,g.f].join(",")+")",r.setAttribute(x+"Transform",h))),q>=3&&3==f.getItem(q-2).type&&2==f.getItem(q-3).type&&2==f.getItem(q-1).type)m=3,g=svgedit.math.transformListToTransform(f,q-3,q-1).matrix,f.removeItem(q-1),f.removeItem(q-2),f.removeItem(q-3);else if(4==q&&1==f.getItem(q-1).type)m=3,g=svgedit.math.transformListToTransform(f).matrix,z=e.createSVGTransform(),z.setMatrix(g),f.clear(),f.appendItem(z),g=e.createSVGMatrix();else if((1==q||q>1&&3!=f.getItem(1).type)&&2==f.getItem(0).type)m=2,r=f.getItem(0).matrix,x=svgedit.math.transformListToTransform(f,1).matrix,h=x.inverse(),g=svgedit.math.matrixMultiply(h,r,x),f.removeItem(0);else{if(1!=q||1!=f.getItem(0).type||i)return m=4,i&&(e=e.createSVGTransform(),e.setRotate(i,p.x,p.y),f.numberOfItems?f.insertItemBefore(e,0):f.appendItem(e)),0==f.numberOfItems&&c.removeAttribute("transform"),null;switch(g=svgedit.math.transformListToTransform(f).matrix,c.tagName){case"line":j=$(c).attr(["x1","y1","x2","y2"]);case"polyline":case"polygon":if(j.points=c.getAttribute("points"),j.points)for(h=c.points,l=h.numberOfItems,j.points=Array(l),m=0;l>m;++m)n=h.getItem(m),j.points[m]={x:n.x,y:n.y};case"path":j.d=c.getAttribute("d"),m=1,f.clear()}}if((1==m||2==m||3==m)&&svgedit.coords.remapElement(c,j,g),2==m){if(i&&(svgedit.math.hasMatrixTransform(f)||(p={x:o.x+g.e,y:o.y+g.f}),e=e.createSVGTransform(),e.setRotate(i,p.x,p.y),f.numberOfItems?f.insertItemBefore(e,0):f.appendItem(e)),"text"==c.tagName)for(l=c.childNodes,n=l.length;n--;)v=l.item(n),"tspan"==v.tagName&&(e={x:$(v).attr("x")||0,y:$(v).attr("y")||0},svgedit.coords.remapElement(v,e,g))}else 3==m&&i&&(g=svgedit.math.transformListToTransform(f).matrix,r=e.createSVGTransform(),r.setRotate(i,o.x,o.y),r=r.matrix,o=e.createSVGTransform(),o.setRotate(i,p.x,p.y),p=o.matrix.inverse(),x=g.inverse(),p=svgedit.math.matrixMultiply(x,p,r,g),svgedit.coords.remapElement(c,j,p),i&&(f.numberOfItems?f.insertItemBefore(o,0):f.appendItem(o)))}return 0==f.numberOfItems&&c.removeAttribute("transform"),d.addSubCommand(new svgedit.history.ChangeElementCommand(c,k)),d}}(),function(){svgedit.select||(svgedit.select={});var a,b,c,d=svgedit.browser.isTouch()?10:4;svgedit.select.Selector=function(b,c){this.id=b,this.selectedElement=c,this.locked=!0,this.selectorGroup=a.createSVGElement({element:"g",attr:{id:"selectorGroup"+this.id}}),this.selectorRect=this.selectorGroup.appendChild(a.createSVGElement({element:"path",attr:{id:"selectedBox"+this.id,fill:"none",stroke:"#22C","stroke-width":"1","stroke-dasharray":"5,5",style:"pointer-events:none"}})),this.gripCoords={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null},this.reset(this.selectedElement)},svgedit.select.Selector.prototype.reset=function(a){this.locked=!0,this.selectedElement=a,this.resize(),this.selectorGroup.setAttribute("display","inline")},svgedit.select.Selector.prototype.updateGripCursors=function(a){var b,d=[];a=Math.round(a/45),0>a&&(a+=8);for(b in c.selectorGrips)d.push(b);for(;a>0;)d.push(d.shift()),a--;a=0;for(b in c.selectorGrips)c.selectorGrips[b].setAttribute("style","cursor:"+d[a]+"-resize"),a++},svgedit.select.Selector.prototype.showGrips=function(a){c.selectorGripsGroup.setAttribute("display",a?"inline":"none");var b=this.selectedElement;this.hasGrips=a,b&&a&&(this.selectorGroup.appendChild(c.selectorGripsGroup),this.updateGripCursors(svgedit.utilities.getRotationAngle(b)))},svgedit.select.Selector.prototype.resize=function(){var b=this.selectorRect,e=c,f=e.selectorGrips,g=this.selectedElement,h=g.getAttribute("stroke-width"),i=a.currentZoom(),j=1/i;"none"===g.getAttribute("stroke")||isNaN(h)||(j+=h/2);var k=g.tagName;"text"===k&&(j+=2/i),h=svgedit.transformlist.getTransformList(g),h=svgedit.math.transformListToTransform(h).matrix,h.e*=i,h.f*=i;var l=svgedit.utilities.getBBox(g);"g"!==k||$.data(g,"gsvg")||(k=a.getStrokedBBox(g.childNodes))&&(l=k),k=l.x;var m=l.y,n=l.width;l=l.height,j*=i,i=svgedit.math.transformBox(k*i,m*i,n*i,l*i,h),h=i.aabox,k=h.x-j,m=h.y-j,n=h.width+2*j;var o=h.height+2*j;if(h=k+n/2,l=m+o/2,g=svgedit.utilities.getRotationAngle(g)){k=a.svgRoot().createSVGTransform(),k.setRotate(-g,h,l),k=k.matrix,i.tl=svgedit.math.transformPoint(i.tl.x,i.tl.y,k),i.tr=svgedit.math.transformPoint(i.tr.x,i.tr.y,k),i.bl=svgedit.math.transformPoint(i.bl.x,i.bl.y,k),i.br=svgedit.math.transformPoint(i.br.x,i.br.y,k),k=i.tl,n=k.x,o=k.y;var p=k.x,q=k.y;k=Math.min,m=Math.max,n=k(n,k(i.tr.x,k(i.bl.x,i.br.x)))-j,o=k(o,k(i.tr.y,k(i.bl.y,i.br.y)))-j,p=m(p,m(i.tr.x,m(i.bl.x,i.br.x)))+j,q=m(q,m(i.tr.y,m(i.bl.y,i.br.y)))+j,k=n,m=o,n=p-n,o=q-o}j=a.svgRoot().suspendRedraw(100),b.setAttribute("d","M"+k+","+m+" L"+(k+n)+","+m+" "+(k+n)+","+(m+o)+" "+k+","+(m+o)+"z"),this.selectorGroup.setAttribute("transform",g?"rotate("+[g,h,l].join(",")+")":""),this.gripCoords={nw:[k,m],ne:[k+n,m],sw:[k,m+o],se:[k+n,m+o],n:[k+n/2,m],w:[k,m+o/2],e:[k+n,m+o/2],s:[k+n/2,m+o]};for(var r in this.gripCoords)b=this.gripCoords[r],f[r].setAttribute("cx",b[0]),f[r].setAttribute("cy",b[1]);e.rotateGripConnector.setAttribute("x1",k+n/2),e.rotateGripConnector.setAttribute("y1",m),e.rotateGripConnector.setAttribute("x2",k+n/2),e.rotateGripConnector.setAttribute("y2",m-5*d),e.rotateGrip.setAttribute("cx",k+n/2),e.rotateGrip.setAttribute("cy",m-5*d),a.svgRoot().unsuspendRedraw(j)},svgedit.select.SelectorManager=function(){this.rubberBandBox=this.selectorParentGroup=null,this.selectors=[],this.selectorMap={},this.selectorGrips={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null},this.rotateGrip=this.rotateGripConnector=this.selectorGripsGroup=null,this.initGroup()},svgedit.select.SelectorManager.prototype.initGroup=function(){this.selectorParentGroup&&this.selectorParentGroup.parentNode&&this.selectorParentGroup.parentNode.removeChild(this.selectorParentGroup),this.selectorParentGroup=a.createSVGElement({element:"g",attr:{id:"selectorParentGroup"}}),this.selectorGripsGroup=a.createSVGElement({element:"g",attr:{display:"none"}}),this.selectorParentGroup.appendChild(this.selectorGripsGroup),a.svgRoot().appendChild(this.selectorParentGroup),this.selectorMap={},this.selectors=[],this.rubberBandBox=null;for(var c in this.selectorGrips){var e=a.createSVGElement({element:"circle",attr:{id:"selectorGrip_resize_"+c,fill:"#22C",r:d,style:"cursor:"+c+"-resize","stroke-width":2,"pointer-events":"all"}});$.data(e,"dir",c),$.data(e,"type","resize"),this.selectorGrips[c]=this.selectorGripsGroup.appendChild(e)}this.rotateGripConnector=this.selectorGripsGroup.appendChild(a.createSVGElement({element:"line",attr:{id:"selectorGrip_rotateconnector",stroke:"#22C","stroke-width":"1"}})),this.rotateGrip=this.selectorGripsGroup.appendChild(a.createSVGElement({element:"circle",attr:{id:"selectorGrip_rotate",fill:"lime",r:d,stroke:"#22C","stroke-width":2,style:"cursor:url("+b.imgPath+"rotate.png) 12 12, auto;"}})),$.data(this.rotateGrip,"type","rotate"),$("#canvasBackground").length||(c=b.dimensions,c=a.createSVGElement({element:"svg",attr:{id:"canvasBackground",width:c[0],height:c[1],x:0,y:0,overflow:svgedit.browser.isWebkit()?"none":"visible",style:"pointer-events:none"}}),e=a.createSVGElement({element:"rect",attr:{width:"100%",height:"100%",x:0,y:0,"stroke-width":1,stroke:"#000",fill:"#FFF",style:"pointer-events:none"}}),c.appendChild(e),a.svgRoot().insertBefore(c,a.svgContent()))},svgedit.select.SelectorManager.prototype.requestSelector=function(a){if(null==a)return null;var b,c=this.selectors.length;if("object"==typeof this.selectorMap[a.id])return this.selectorMap[a.id].locked=!0,this.selectorMap[a.id];for(b=0;c>b;++b)if(this.selectors[b]&&!this.selectors[b].locked)return this.selectors[b].locked=!0,this.selectors[b].reset(a),this.selectorMap[a.id]=this.selectors[b],this.selectors[b];return this.selectors[c]=new svgedit.select.Selector(c,a),this.selectorParentGroup.appendChild(this.selectors[c].selectorGroup),this.selectorMap[a.id]=this.selectors[c],this.selectors[c]},svgedit.select.SelectorManager.prototype.releaseSelector=function(a){if(null!=a){var b,c=this.selectors.length,d=this.selectorMap[a.id];for(b=0;c>b;++b)if(this.selectors[b]&&this.selectors[b]==d){0==d.locked&&console.log("WARNING! selector was released but was already unlocked"),delete this.selectorMap[a.id],d.locked=!1,d.selectedElement=null,d.showGrips(!1);try{d.selectorGroup.setAttribute("display","none")}catch(e){}break}}},svgedit.select.SelectorManager.prototype.getRubberBandBox=function(){return this.rubberBandBox||(this.rubberBandBox=this.selectorParentGroup.appendChild(a.createSVGElement({element:"rect",attr:{id:"selectorRubberBand",fill:"#22C","fill-opacity":.15,stroke:"#22C","stroke-width":.5,display:"none",style:"pointer-events:none"}}))),this.rubberBandBox},svgedit.select.init=function(d,e){b=d,a=e,c=new svgedit.select.SelectorManager},svgedit.select.getSelectorManager=function(){return c}}(),function(){svgedit.draw||(svgedit.draw={});var a=svgedit.NS,b="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(","),c={LET_DOCUMENT_DECIDE:0,ALWAYS_RANDOMIZE:1,NEVER_RANDOMIZE:2},d=c.LET_DOCUMENT_DECIDE;svgedit.draw.Layer=function(a,b){this.name_=a,this.group_=b},svgedit.draw.Layer.prototype.getName=function(){return this.name_},svgedit.draw.Layer.prototype.getGroup=function(){return this.group_},svgedit.draw.randomizeIds=function(a,b){d=a===!1?c.NEVER_RANDOMIZE:c.ALWAYS_RANDOMIZE,d!=c.ALWAYS_RANDOMIZE||b.getNonce()?d==c.NEVER_RANDOMIZE&&b.getNonce()&&b.clearNonce():b.setNonce(Math.floor(100001*Math.random()))},svgedit.draw.Drawing=function(b,e){if(!b||!b.tagName||!b.namespaceURI||"svg"!=b.tagName||b.namespaceURI!=a.SVG)throw"Error: svgedit.draw.Drawing instance initialized without a <svg> element";this.svgElem_=b,this.obj_num=0,this.idPrefix=e||"svg_",this.releasedNums=[],this.all_layers=[],this.current_layer=null,this.nonce_="";var f=this.svgElem_.getAttributeNS(a.SE,"nonce");f&&d!=c.NEVER_RANDOMIZE?this.nonce_=f:d==c.ALWAYS_RANDOMIZE&&this.setNonce(Math.floor(100001*Math.random()))},svgedit.draw.Drawing.prototype.getElem_=function(a){return this.svgElem_.querySelector?this.svgElem_.querySelector("#"+a):$(this.svgElem_).find("[id="+a+"]")[0]},svgedit.draw.Drawing.prototype.getSvgElem=function(){return this.svgElem_},svgedit.draw.Drawing.prototype.getNonce=function(){return this.nonce_},svgedit.draw.Drawing.prototype.setNonce=function(b){this.svgElem_.setAttributeNS(a.XMLNS,"xmlns:se",a.SE),this.svgElem_.setAttributeNS(a.SE,"se:nonce",b),this.nonce_=b},svgedit.draw.Drawing.prototype.clearNonce=function(){this.nonce_=""},svgedit.draw.Drawing.prototype.getId=function(){return this.nonce_?this.idPrefix+this.nonce_+"_"+this.obj_num:this.idPrefix+this.obj_num},svgedit.draw.Drawing.prototype.getNextId=function(){var a=this.obj_num,b=!1;this.releasedNums.length>0?(this.obj_num=this.releasedNums.pop(),b=!0):this.obj_num++;
for(var c=this.getId();this.getElem_(c);)b&&(this.obj_num=a,b=!1),this.obj_num++,c=this.getId();return b&&(this.obj_num=a),c},svgedit.draw.Drawing.prototype.releaseId=function(a){var b=this.idPrefix+(this.nonce_?this.nonce_+"_":"");return"string"!=typeof a||0!==a.indexOf(b)?!1:(a=parseInt(a.substr(b.length),10),"number"!=typeof a||0>=a||-1!=this.releasedNums.indexOf(a)?!1:(this.releasedNums.push(a),!0))},svgedit.draw.Drawing.prototype.getNumLayers=function(){return this.all_layers.length},svgedit.draw.Drawing.prototype.hasLayer=function(a){var b;for(b=0;b<this.getNumLayers();b++)if(this.all_layers[b][0]==a)return!0;return!1},svgedit.draw.Drawing.prototype.getLayerName=function(a){return a>=0&&a<this.getNumLayers()?this.all_layers[a][0]:""},svgedit.draw.Drawing.prototype.getCurrentLayer=function(){return this.current_layer},svgedit.draw.Drawing.prototype.getCurrentLayerName=function(){var a;for(a=0;a<this.getNumLayers();++a)if(this.all_layers[a][1]==this.current_layer)return this.getLayerName(a);return""},svgedit.draw.Drawing.prototype.setCurrentLayer=function(a){var b;for(b=0;b<this.getNumLayers();++b)if(a==this.getLayerName(b))return this.current_layer!=this.all_layers[b][1]&&(this.current_layer.setAttribute("style","pointer-events:none"),this.current_layer=this.all_layers[b][1],this.current_layer.setAttribute("style","pointer-events:all")),!0;return!1},svgedit.draw.Drawing.prototype.deleteCurrentLayer=function(){if(this.current_layer&&this.getNumLayers()>1){var a=this.current_layer.parentNode.removeChild(this.current_layer);return this.identifyLayers(),a}return null},svgedit.draw.Drawing.prototype.identifyLayers=function(){this.all_layers=[];var c,d=this.svgElem_.childNodes.length,e=[],f=[],g=null,h=!1;for(c=0;d>c;++c){var i=this.svgElem_.childNodes.item(c);if(i&&1==i.nodeType)if("g"==i.tagName){h=!0;var j=$("title",i).text();!j&&svgedit.browser.isOpera()&&i.querySelectorAll&&(j=$(i.querySelectorAll("title")).text()),j?(f.push(j),this.all_layers.push([j,i]),g=i,svgedit.utilities.walkTree(i,function(a){a.setAttribute("style","pointer-events:inherit")}),g.setAttribute("style","pointer-events:none")):e.push(i)}else~b.indexOf(i.nodeName)&&(svgedit.utilities.getBBox(i),e.push(i))}if(d=this.svgElem_.ownerDocument,e.length>0||!h){for(c=1;f.indexOf("Layer "+c)>=0;)c++;for(f="Layer "+c,g=d.createElementNS(a.SVG,"g"),h=d.createElementNS(a.SVG,"title"),h.textContent=f,g.appendChild(h),h=0;h<e.length;++h)g.appendChild(e[h]);this.svgElem_.appendChild(g),this.all_layers.push([f,g])}svgedit.utilities.walkTree(g,function(a){a.setAttribute("style","pointer-events:inherit")}),this.current_layer=g,this.current_layer.setAttribute("style","pointer-events:all")},svgedit.draw.Drawing.prototype.createLayer=function(b){var c=this.svgElem_.ownerDocument,d=c.createElementNS(a.SVG,"g");return c=c.createElementNS(a.SVG,"title"),c.textContent=b,d.appendChild(c),this.svgElem_.appendChild(d),this.identifyLayers(),d},svgedit.draw.Drawing.prototype.getLayerVisibility=function(a){var b,c=null;for(b=0;b<this.getNumLayers();++b)if(this.getLayerName(b)==a){c=this.all_layers[b][1];break}return c?"none"!==c.getAttribute("display"):!1},svgedit.draw.Drawing.prototype.setLayerVisibility=function(a,b){if("boolean"!=typeof b)return null;var c,d=null;for(c=0;c<this.getNumLayers();++c)if(this.getLayerName(c)==a){d=this.all_layers[c][1];break}return d?(d.getAttribute("display"),d.setAttribute("display",b?"inline":"none"),d):null},svgedit.draw.Drawing.prototype.getLayerOpacity=function(a){var b;for(b=0;b<this.getNumLayers();++b)if(this.getLayerName(b)==a)return(a=this.all_layers[b][1].getAttribute("opacity"))||(a="1.0"),parseFloat(a);return null},svgedit.draw.Drawing.prototype.setLayerOpacity=function(a,b){if(!("number"!=typeof b||0>b||b>1)){var c;for(c=0;c<this.getNumLayers();++c)if(this.getLayerName(c)==a){this.all_layers[c][1].setAttribute("opacity",b);break}}}}(),function(){svgedit.path||(svgedit.path={});var a=svgedit.NS,b={pathNodeTooltip:"Drag node to move it. Double-click node to change segment type",pathCtrlPtTooltip:"Drag control point to adjust curve properties"},c={2:["x","y"],4:["x","y"],6:["x","y","x1","y1","x2","y2"],8:["x","y","x1","y1"],10:["x","y","r1","r2","angle","largeArcFlag","sweepFlag"],12:["x"],14:["y"],16:["x","y","x2","y2"],18:["x","y"]},d=[],e=!0,f={};svgedit.path.setLinkControlPoints=function(a){e=a};var g=svgedit.path.path=null;svgedit.path.init=function(a){g=a,d=[0,"ClosePath"],$.each(["Moveto","Lineto","CurvetoCubic","CurvetoQuadratic","Arc","LinetoHorizontal","LinetoVertical","CurvetoCubicSmooth","CurvetoQuadraticSmooth"],function(a,b){d.push(b+"Abs"),d.push(b+"Rel")})},svgedit.path.insertItemBefore=function(a,b,c){if(a=a.pathSegList,svgedit.browser.supportsPathInsertItemBefore())a.insertItemBefore(b,c);else{var d,e=a.numberOfItems,f=[];for(d=0;e>d;d++){var g=a.getItem(d);f.push(g)}for(a.clear(),d=0;e>d;d++)d==c&&a.appendItem(b),a.appendItem(f[d])}},svgedit.path.ptObjToArr=function(a,b){var d,e=c[a],f=e.length,g=[];for(d=0;f>d;d++)g[d]=b[e[d]];return g},svgedit.path.getGripPt=function(a,b){var c={x:b?b.x:a.item.x,y:b?b.y:a.item.y},d=a.path;return d.matrix&&(c=svgedit.math.transformPoint(c.x,c.y,d.matrix)),c.x*=g.getCurrentZoom(),c.y*=g.getCurrentZoom(),c},svgedit.path.getPointFromGrip=function(a,b){var c={x:a.x,y:a.y};return b.matrix&&(a=svgedit.math.transformPoint(c.x,c.y,b.imatrix),c.x=a.x,c.y=a.y),c.x/=g.getCurrentZoom(),c.y/=g.getCurrentZoom(),c},svgedit.path.addPointGrip=function(c,d,e){var f=svgedit.path.getGripContainer(),g=svgedit.utilities.getElem("pathpointgrip_"+c);return g||(g=document.createElementNS(a.SVG,"circle"),svgedit.utilities.assignAttributes(g,{id:"pathpointgrip_"+c,display:"none",r:4,fill:"#0FF",stroke:"#00F","stroke-width":2,cursor:"move",style:"pointer-events:all","xlink:title":b.pathNodeTooltip}),g=f.appendChild(g),$("#pathpointgrip_"+c).dblclick(function(){svgedit.path.path&&svgedit.path.path.setSegType()})),d&&e&&svgedit.utilities.assignAttributes(g,{cx:d,cy:e,display:"inline"}),g},svgedit.path.getGripContainer=function(){var b=svgedit.utilities.getElem("pathpointgrip_container");return b||(b=svgedit.utilities.getElem("selectorParentGroup").appendChild(document.createElementNS(a.SVG,"g")),b.id="pathpointgrip_container"),b},svgedit.path.addCtrlGrip=function(c){var d=svgedit.utilities.getElem("ctrlpointgrip_"+c);return d?d:(d=document.createElementNS(a.SVG,"circle"),svgedit.utilities.assignAttributes(d,{id:"ctrlpointgrip_"+c,display:"none",r:4,fill:"#0FF",stroke:"#55F","stroke-width":1,cursor:"move",style:"pointer-events:all","xlink:title":b.pathCtrlPtTooltip}),svgedit.path.getGripContainer().appendChild(d),d)},svgedit.path.getCtrlLine=function(b){var c=svgedit.utilities.getElem("ctrlLine_"+b);return c?c:(c=document.createElementNS(a.SVG,"line"),svgedit.utilities.assignAttributes(c,{id:"ctrlLine_"+b,stroke:"#555","stroke-width":1,style:"pointer-events:none"}),svgedit.path.getGripContainer().appendChild(c),c)},svgedit.path.getPointGrip=function(a,b){var c=svgedit.path.addPointGrip(a.index);if(b){var d=svgedit.path.getGripPt(a);svgedit.utilities.assignAttributes(c,{cx:d.x,cy:d.y,display:"inline"})}return c},svgedit.path.getControlPoints=function(a){var b=a.item,c=a.index;if(!("x1"in b&&"x2"in b))return null;var d={};svgedit.path.getGripContainer();var e,f=[svgedit.path.path.segs[c-1].item,b];for(e=1;3>e;e++){var g=c+"c"+e,h=d["c"+e+"_line"]=svgedit.path.getCtrlLine(g),i=svgedit.path.getGripPt(a,{x:b["x"+e],y:b["y"+e]}),j=svgedit.path.getGripPt(a,{x:f[e-1].x,y:f[e-1].y});svgedit.utilities.assignAttributes(h,{x1:i.x,y1:i.y,x2:j.x,y2:j.y,display:"inline"}),d["c"+e+"_line"]=h,g=d["c"+e]=svgedit.path.addCtrlGrip(g),svgedit.utilities.assignAttributes(g,{cx:i.x,cy:i.y,display:"inline"}),d["c"+e]=g}return d},svgedit.path.replacePathSeg=function(a,b,c,e){if(e=e||svgedit.path.path.elem,a=e["createSVGPathSeg"+d[a]].apply(e,c),svgedit.browser.supportsPathReplaceItem())e.pathSegList.replaceItem(a,b);else{c=e.pathSegList,e=c.numberOfItems;var f,g=[];for(f=0;e>f;f++){var h=c.getItem(f);g.push(h)}for(c.clear(),f=0;e>f;f++)c.appendItem(f==b?a:g[f])}},svgedit.path.getSegSelector=function(b,c){var d=b.index,e=svgedit.utilities.getElem("segline_"+d);if(!e){var f=svgedit.path.getGripContainer();e=document.createElementNS(a.SVG,"path"),svgedit.utilities.assignAttributes(e,{id:"segline_"+d,display:"none",fill:"none",stroke:"#0FF","stroke-width":2,style:"pointer-events:none",d:"M0,0 0,0"}),f.appendChild(e)}if(c){if(d=b.prev,!d)return e.setAttribute("display","none"),e;d=svgedit.path.getGripPt(d),svgedit.path.replacePathSeg(2,0,[d.x,d.y],e),f=svgedit.path.ptObjToArr(b.type,b.item,!0);var g;for(g=0;g<f.length;g+=2)d=svgedit.path.getGripPt(b,{x:f[g],y:f[g+1]}),f[g]=d.x,f[g+1]=d.y;svgedit.path.replacePathSeg(b.type,1,f,e)}return e},svgedit.path.smoothControlPoints=function(a,b,c){var d=a.x-c.x,e=a.y-c.y,f=b.x-c.x,h=b.y-c.y;if(!(0==d&&0==e||0==f&&0==h)){a=Math.atan2(e,d),b=Math.atan2(h,f),d=Math.sqrt(d*d+e*e),f=Math.sqrt(f*f+h*h),e=g.getSVGRoot().createSVGPoint(),h=g.getSVGRoot().createSVGPoint(),0>a&&(a+=2*Math.PI),0>b&&(b+=2*Math.PI);var i=Math.abs(a-b),j=Math.abs(Math.PI-i)/2;return a-b>0?(a=i<Math.PI?a+j:a-j,b=i<Math.PI?b-j:b+j):(a=i<Math.PI?a-j:a+j,b=i<Math.PI?b+j:b-j),e.x=d*Math.cos(a)+c.x,e.y=d*Math.sin(a)+c.y,h.x=f*Math.cos(b)+c.x,h.y=f*Math.sin(b)+c.y,[e,h]}},svgedit.path.Segment=function(a,b){this.selected=!1,this.index=a,this.item=b,this.type=b.pathSegType,this.ctrlpts=[],this.segsel=this.ptgrip=null},svgedit.path.Segment.prototype.showCtrlPts=function(a){for(var b in this.ctrlpts)this.ctrlpts.hasOwnProperty(b)&&this.ctrlpts[b].setAttribute("display",a?"inline":"none")},svgedit.path.Segment.prototype.selectCtrls=function(a){$("#ctrlpointgrip_"+this.index+"c1, #ctrlpointgrip_"+this.index+"c2").attr("fill",a?"#0FF":"#EEE")},svgedit.path.Segment.prototype.show=function(a){this.ptgrip&&(this.ptgrip.setAttribute("display",a?"inline":"none"),this.segsel.setAttribute("display",a?"inline":"none"),this.showCtrlPts(a))},svgedit.path.Segment.prototype.select=function(a){this.ptgrip&&(this.ptgrip.setAttribute("stroke",a?"#0FF":"#00F"),this.segsel.setAttribute("display",a?"inline":"none"),this.ctrlpts&&this.selectCtrls(a),this.selected=a)},svgedit.path.Segment.prototype.addGrip=function(){this.ptgrip=svgedit.path.getPointGrip(this,!0),this.ctrlpts=svgedit.path.getControlPoints(this,!0),this.segsel=svgedit.path.getSegSelector(this,!0)},svgedit.path.Segment.prototype.update=function(a){if(this.ptgrip){var b=svgedit.path.getGripPt(this);svgedit.utilities.assignAttributes(this.ptgrip,{cx:b.x,cy:b.y}),svgedit.path.getSegSelector(this,!0),this.ctrlpts&&(a&&(this.item=svgedit.path.path.elem.pathSegList.getItem(this.index),this.type=this.item.pathSegType),svgedit.path.getControlPoints(this))}},svgedit.path.Segment.prototype.move=function(a,b){var c;c=this.item,c=this.ctrlpts?[c.x+=a,c.y+=b,c.x1,c.y1,c.x2+=a,c.y2+=b]:[c.x+=a,c.y+=b],svgedit.path.replacePathSeg(this.type,this.index,c),this.next&&this.next.ctrlpts&&(c=this.next.item,c=[c.x,c.y,c.x1+=a,c.y1+=b,c.x2,c.y2],svgedit.path.replacePathSeg(this.next.type,this.next.index,c)),this.mate&&(c=this.mate.item,c=[c.x+=a,c.y+=b],svgedit.path.replacePathSeg(this.mate.type,this.mate.index,c)),this.update(!0),this.next&&this.next.update(!0)},svgedit.path.Segment.prototype.setLinked=function(a){var b,c,d;if(2==a){if(c=1,b=this.next,!b)return;d=this.item}else{if(c=2,b=this.prev,!b)return;d=b.item}var e=b.item;e["x"+c]=d.x+(d.x-this.item["x"+a]),e["y"+c]=d.y+(d.y-this.item["y"+a]),svgedit.path.replacePathSeg(b.type,b.index,[e.x,e.y,e.x1,e.y1,e.x2,e.y2]),b.update(!0)},svgedit.path.Segment.prototype.moveCtrl=function(a,b,c){var d=this.item;d["x"+a]+=b,d["y"+a]+=c,svgedit.path.replacePathSeg(this.type,this.index,[d.x,d.y,d.x1,d.y1,d.x2,d.y2]),this.update(!0)},svgedit.path.Segment.prototype.setType=function(a,b){svgedit.path.replacePathSeg(a,this.index,b),this.type=a,this.item=svgedit.path.path.elem.pathSegList.getItem(this.index),this.showCtrlPts(6===a),this.ctrlpts=svgedit.path.getControlPoints(this),this.update(!0)},svgedit.path.Path=function(a){if(!a||"path"!==a.tagName)throw"svgedit.path.Path constructed without a <path> element";this.elem=a,this.segs=[],this.selected_pts=[],svgedit.path.path=this,this.init()},svgedit.path.Path.prototype.init=function(){$(svgedit.path.getGripContainer()).find("*").attr("display","none");var a=this.elem.pathSegList,b=a.numberOfItems;this.segs=[],this.selected_pts=[],this.first_seg=null;var c;for(c=0;b>c;c++){var d=a.getItem(c);d=new svgedit.path.Segment(c,d),d.path=this,this.segs.push(d)}for(a=this.segs,d=null,c=0;b>c;c++){var e=a[c],f=c+1>=b?null:a[c+1],g=0>c-1?null:a[c-1];2===e.type?(g&&1!==g.type&&(f=a[d],f.next=a[d+1],f.next.prev=f,f.addGrip()),d=c):f&&1===f.type?(e.next=a[d+1],e.next.prev=e,e.mate=a[d],e.addGrip(),null==this.first_seg&&(this.first_seg=e)):f?1!==e.type&&(e.addGrip(),f&&2!==f.type&&(e.next=f,e.next.prev=e)):1!==e.type&&(f=a[d],f.next=a[d+1],f.next.prev=f,f.addGrip(),e.addGrip(),this.first_seg||(this.first_seg=a[d]))}return this},svgedit.path.Path.prototype.eachSeg=function(a){var b,c=this.segs.length;for(b=0;c>b&&a.call(this.segs[b],b)!==!1;b++);},svgedit.path.Path.prototype.addSeg=function(a){var b=this.segs[a];if(b.prev){var c,d,e,f=b.prev;switch(b.item.pathSegType){case 4:d=(b.item.x+f.item.x)/2,e=(b.item.y+f.item.y)/2,c=this.elem.createSVGPathSegLinetoAbs(d,e);break;case 6:c=(f.item.x+b.item.x1)/2;var g=(b.item.x1+b.item.x2)/2,h=(b.item.x2+b.item.x)/2,i=(c+g)/2;g=(g+h)/2,d=(i+g)/2;var j=(f.item.y+b.item.y1)/2,k=(b.item.y1+b.item.y2)/2;f=(b.item.y2+b.item.y)/2;var l=(j+k)/2;k=(k+f)/2,e=(l+k)/2,c=this.elem.createSVGPathSegCurvetoCubicAbs(d,e,c,j,i,l),svgedit.path.replacePathSeg(b.type,a,[b.item.x,b.item.y,g,k,h,f])}svgedit.path.insertItemBefore(this.elem,c,a)}},svgedit.path.Path.prototype.deleteSeg=function(a){var b=this.segs[a],c=this.elem.pathSegList;b.show(!1);var d,e=b.next;b.mate?(d=[e.item.x,e.item.y],svgedit.path.replacePathSeg(2,e.index,d),svgedit.path.replacePathSeg(4,b.index,d),c.removeItem(b.mate.index)):(b.prev||(d=[e.item.x,e.item.y],svgedit.path.replacePathSeg(2,b.next.index,d)),c.removeItem(a))},svgedit.path.Path.prototype.subpathIsClosed=function(a){var b=!1;return svgedit.path.path.eachSeg(function(c){return a>=c?!0:2===this.type?!1:1===this.type?(b=!0,!1):void 0}),b},svgedit.path.Path.prototype.removePtFromSelection=function(a){var b=this.selected_pts.indexOf(a);-1!=b&&(this.segs[a].select(!1),this.selected_pts.splice(b,1))},svgedit.path.Path.prototype.clearSelection=function(){this.eachSeg(function(){this.select(!1)}),this.selected_pts=[]},svgedit.path.Path.prototype.storeD=function(){this.last_d=this.elem.getAttribute("d")},svgedit.path.Path.prototype.show=function(a){return this.eachSeg(function(){this.show(a)}),a&&this.selectPt(this.first_seg.index),this},svgedit.path.Path.prototype.movePts=function(a,b){for(var c=this.selected_pts.length;c--;)this.segs[this.selected_pts[c]].move(a,b)},svgedit.path.Path.prototype.moveCtrl=function(a,b){var c=this.segs[this.selected_pts[0]];c.moveCtrl(this.dragctrl,a,b),e&&c.setLinked(this.dragctrl)},svgedit.path.Path.prototype.setSegType=function(a){this.storeD();for(var b,c=this.selected_pts.length;c--;){var d=this.segs[this.selected_pts[c]],e=d.prev;if(e){a||(b="Toggle Path Segment Type",a=6==d.type?4:6),a=Number(a);var f=d.item.x,g=d.item.y,h=e.item.x;e=e.item.y;var i;switch(a){case 6:if(d.olditem)h=d.olditem,i=[f,g,h.x1,h.y1,h.x2,h.y2];else{i=f-h;var j=g-e;i=[f,g,h+i/3,e+j/3,f-i/3,g-j/3]}break;case 4:i=[f,g],d.olditem=d.item}d.setType(a,i)}}svgedit.path.path.endChanges(b)},svgedit.path.Path.prototype.selectPt=function(a,b){this.clearSelection(),null==a&&this.eachSeg(function(b){this.prev&&(a=b)}),this.addPtsToSelection(a),b&&(this.dragctrl=b,e&&this.segs[a].setLinked(b))},svgedit.path.Path.prototype.update=function(){var a=this.elem;return svgedit.utilities.getRotationAngle(a)?(this.matrix=svgedit.math.getMatrix(a),this.imatrix=this.matrix.inverse()):this.imatrix=this.matrix=null,this.eachSeg(function(b){this.item=a.pathSegList.getItem(b),this.update()}),this},svgedit.path.getPath_=function(a){var b=f[a.id];return b||(b=f[a.id]=new svgedit.path.Path(a)),b},svgedit.path.removePath_=function(a){a in f&&delete f[a]};var h,i,j,k,l,m=function(a,b){var c=a-j,d=b-k,e=Math.sqrt(c*c+d*d);return d=Math.atan2(d,c)+l,c=e*Math.cos(d)+j,d=e*Math.sin(d)+k,c-=h,d-=i,e=Math.sqrt(c*c+d*d),d=Math.atan2(d,c)-l,{x:e*Math.cos(d)+h,y:e*Math.sin(d)+i}};svgedit.path.recalcRotatedPath=function(){var a=svgedit.path.path.elem;if(l=svgedit.utilities.getRotationAngle(a,!0)){var b=svgedit.utilities.getBBox(a),c=svgedit.path.path.oldbbox;j=c.x+c.width/2,k=c.y+c.height/2,h=b.x+b.width/2,i=b.y+b.height/2,c=h-j;var d=i-k;for(b=Math.sqrt(c*c+d*d),c=Math.atan2(d,c)+l,h=b*Math.cos(c)+j,i=b*Math.sin(c)+k,b=a.pathSegList,c=b.numberOfItems;c;){c-=1;var e=b.getItem(c);if(d=e.pathSegType,1!=d){var f=m(e.x,e.y);if(f=[f.x,f.y],null!=e.x1&&null!=e.x2){var g=m(e.x1,e.y1);e=m(e.x2,e.y2),f.splice(f.length,0,g.x,g.y,e.x,e.y)}svgedit.path.replacePathSeg(d,c,f)}}svgedit.utilities.getBBox(a),b=svgroot.createSVGTransform(),a=svgedit.transformlist.getTransformList(a),b.setRotate(180*l/Math.PI,h,i),a.replaceItem(b,0)}},svgedit.path.clearData=function(){f={}}}(),function(){window.console||(window.console={},window.console.log=function(){},window.console.dir=function(){}),window.opera&&(window.console.log=function(a){opera.postError(a)},window.console.dir=function(){})}(),$.SvgCanvas=function(a,b){function c(a,b){var c,d=svgedit.utilities.getBBox(a);for(c=0;2>c;c++){var e=0===c?"fill":"stroke",f=a.getAttribute(e);if(f&&0===f.indexOf("url(")&&(f=svgedit.utilities.getRefElem(f),"linearGradient"===f.tagName)){var g=f.getAttribute("x1")||0,h=f.getAttribute("y1")||0,i=f.getAttribute("x2")||1,j=f.getAttribute("y2")||0;g=d.width*g+d.x,h=d.height*h+d.y,i=d.width*i+d.x,j=d.height*j+d.y,g=svgedit.math.transformPoint(g,h,b),j=svgedit.math.transformPoint(i,j,b),i={},i.x1=(g.x-d.x)/d.width,i.y1=(g.y-d.y)/d.height,i.x2=(j.x-d.x)/d.width,i.y2=(j.y-d.y)/d.height,f=f.cloneNode(!0),$(f).attr(i),f.id=rb(),svgedit.utilities.findDefs().appendChild(f),a.setAttribute(e,"url(#"+f.id+")")}}}var d=svgedit.NS,e={show_outside_canvas:!0,selectNew:!0,dimensions:[640,480]};b&&$.extend(e,b);var f=e.dimensions,g=this,h=a.ownerDocument,i=h.importNode(svgedit.utilities.text2xml('<svg id="svgroot" xmlns="'+d.SVG+'" xlinkns="'+d.XLINK+'" width="'+f[0]+'" height="'+f[1]+'" x="'+f[0]+'" y="'+f[1]+'" overflow="visible"><defs><filter id="canvashadow" filterUnits="objectBoundingBox"><feGaussianBlur in="SourceAlpha" stdDeviation="4" result="blur"/><feOffset in="blur" dx="5" dy="5" result="offsetBlur"/><feMerge><feMergeNode in="offsetBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs></svg>').documentElement,!0);a.appendChild(i);var j=h.createElementNS(d.SVG,"svg");(g.clearSvgContentElement=function(){for(;j.firstChild;)j.removeChild(j.firstChild);$(j).attr({id:"svgcontent",width:f[0],height:f[1],x:f[0],y:f[1],overflow:e.show_outside_canvas?"visible":"hidden",xmlns:d.SVG,"xmlns:se":d.SE,"xmlns:xlink":d.XLINK}).appendTo(i);var a=h.createComment(" Created with SVG-edit - http://svg-edit.googlecode.com/ ");j.appendChild(a)})();var k="svg_";g.setIdPrefix=function(a){k=a},g.current_drawing_=new svgedit.draw.Drawing(j,k);var m=g.getCurrentDrawing=function(){return g.current_drawing_},n=1,o=null,p={shape:{fill:("none"==e.initFill.color?"":"#")+e.initFill.color,fill_paint:null,fill_opacity:e.initFill.opacity,stroke:"#"+e.initStroke.color,stroke_paint:null,stroke_opacity:e.initStroke.opacity,stroke_width:e.initStroke.width,stroke_dasharray:"none",stroke_linejoin:"miter",stroke_linecap:"butt",opacity:e.initOpacity}};p.text=$.extend(!0,{},p.shape),$.extend(p.text,{fill:"#000000",stroke_width:0,font_size:24,font_family:"serif"});var q=p.shape,r=Array(1),s=this.addSvgElementFromJson=function(a){var b=svgedit.utilities.getElem(a.attr.id),c=m().getCurrentLayer();return b&&a.element!=b.tagName&&(c.removeChild(b),b=null),b||(b=h.createElementNS(d.SVG,a.element),c&&(o||c).appendChild(b)),a.curStyles&&svgedit.utilities.assignAttributes(b,{fill:q.fill,stroke:q.stroke,"stroke-width":q.stroke_width,"stroke-dasharray":q.stroke_dasharray,"stroke-linejoin":q.stroke_linejoin,"stroke-linecap":q.stroke_linecap,"stroke-opacity":q.stroke_opacity,"fill-opacity":q.fill_opacity,opacity:q.opacity/2,style:"pointer-events:inherit"},100),svgedit.utilities.assignAttributes(b,a.attr,100),svgedit.utilities.cleanupElement(b),b};g.getTransformList=svgedit.transformlist.getTransformList;var t=svgedit.math.transformPoint,u=g.matrixMultiply=svgedit.math.matrixMultiply,v=g.hasMatrixTransform=svgedit.math.hasMatrixTransform,w=g.transformListToTransform=svgedit.math.transformListToTransform;svgedit.units.init({getBaseUnit:function(){return e.baseUnit},getElement:svgedit.utilities.getElem,getHeight:function(){return j.getAttribute("height")/n},getWidth:function(){return j.getAttribute("width")/n},getRoundDigits:function(){return _.round_digits}}),g.convertToNum=svgedit.units.convertToNum,svgedit.utilities.init({getDOMDocument:function(){return h},getDOMContainer:function(){return a},getSVGRoot:function(){return i},getSelectedElements:function(){return r},getSVGContent:function(){return j},getBaseUnit:function(){return e.baseUnit},getStepSize:function(){return e.stepSize}});var z=g.findDefs=svgedit.utilities.findDefs,A=g.getUrlFromAttr=svgedit.utilities.getUrlFromAttr,B=g.getHref=svgedit.utilities.getHref,C=g.setHref=svgedit.utilities.setHref,D=svgedit.utilities.getPathBBox;g.getBBox=svgedit.utilities.getBBox,g.getRotationAngle=svgedit.utilities.getRotationAngle;var E=g.getElem=svgedit.utilities.getElem;g.getRefElem=svgedit.utilities.getRefElem;var F=g.assignAttributes=svgedit.utilities.assignAttributes,G=this.cleanupElement=svgedit.utilities.cleanupElement;svgedit.coords.init({getDrawing:function(){return m()},getGridSnapping:function(){return e.gridSnapping}});var H=this.remapElement=svgedit.coords.remapElement;svgedit.recalculate.init({getSVGRoot:function(){return i},getStartTransform:function(){return bb},setStartTransform:function(a){bb=a}});var I=this.recalculateDimensions=svgedit.recalculate.recalculateDimensions,J=svgedit.getReverseNS(),K=g.sanitizeSvg=svgedit.sanitize.sanitizeSvg,L=svgedit.history.MoveElementCommand,M=svgedit.history.InsertElementCommand,N=svgedit.history.RemoveElementCommand,O=svgedit.history.ChangeElementCommand,P=svgedit.history.BatchCommand;g.undoMgr=new svgedit.history.UndoManager({handleHistoryEvent:function(a,b){var c=svgedit.history.HistoryEventTypes;if(a==c.BEFORE_UNAPPLY||a==c.BEFORE_APPLY)g.clearSelection();else if(a==c.AFTER_APPLY||a==c.AFTER_UNAPPLY){var d=b.elements();g.pathActions.clear(),sb("changed",d),d=b.type(),c=a==c.AFTER_APPLY,d==L.type()?(c?b.newParent:b.oldParent)==j&&g.identifyLayers():d==M.type()||d==N.type()?(b.parent==j&&g.identifyLayers(),d==M.type()?c&&W(b.elem):c||W(b.elem),"use"===b.elem.tagName&&Lb(b.elem)):d==O.type()&&("title"==b.elem.tagName&&b.elem.parentNode.parentNode==j&&g.identifyLayers(),c=c?b.newValues:b.oldValues,c.stdDeviation&&g.setBlurOffsets(b.elem.parentNode,c.stdDeviation))}}});var Q=function(a){g.undoMgr.addCommandToHistory(a)};svgedit.select.init(e,{createSVGElement:function(a){return g.addSvgElementFromJson(a)},svgRoot:function(){return i},svgContent:function(){return j},currentZoom:function(){return n},getStrokedBBox:function(a){return g.getStrokedBBox([a])}});var R=this.selectorManager=svgedit.select.getSelectorManager();svgedit.path.init({getCurrentZoom:function(){return n},getSVGRoot:function(){return i}});var S={exportNoBlur:"Blurred elements will appear as un-blurred",exportNoforeignObject:"foreignObject elements will not appear",exportNoDashArray:"Strokes will appear filled",exportNoText:"Text may not appear as expected"},T=["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],U=$.data,V=document.createElementNS(d.SVG,"animate");$(V).attr({attributeName:"opacity",begin:"indefinite",dur:1,fill:"freeze"}).appendTo(i);var W=function(a){var b,c=$(a).attr(T);for(b in c){var d=c[b];d&&0===d.indexOf("url(")&&(d=svgedit.utilities.getUrlFromAttr(d).substr(1),E(d)||(svgedit.utilities.findDefs().appendChild(mb[d]),delete mb[d]))}if(b=a.getElementsByTagName("*"),b.length)for(a=0,l=b.length;l>a;a++)W(b[a])},X={},Y=e.imgPath+"logo.png",Z=[],_={round_digits:5},ab=!1,bb=null,cb="select",db="none",eb={},fb=p.text,gb=q,hb=null,ib=null,jb=[],kb={},lb=null,mb={};g.clipBoard=[];var nb=this.runExtensions=function(a,b,c){var d=c?[]:!1;return $.each(kb,function(e,f){f&&a in f&&(c?d.push(f[a](b)):d=f[a](b))}),d};this.addExtension=function(a,b){var c;a in kb?console.log('Cannot add extension "'+a+'", an extension by that name already exists"'):(c=$.isFunction(b)?b($.extend(g.getPrivateMethods(),{svgroot:i,svgcontent:j,nonce:m().getNonce(),selectorManager:R})):b,kb[a]=c,sb("extension_added",c))};var ob=this.round=function(a){return parseInt(a*n,10)/n},pb=this.getIntersectionList=function(a){if(null==ib)return null;var b=o||m().getCurrentLayer();jb.length||(jb=wb(b));var c=null;try{c=b.getIntersectionList(a,null)}catch(d){}if(null==c||"function"!=typeof c.item){if(c=[],a)a=a;else{a=ib.getBBox();var e;b={};for(e in a)b[e]=a[e]/n;a=b}for(e=jb.length;e--;)a.width&&svgedit.math.rectsIntersect(a,jb[e].bbox)&&c.push(jb[e].elem)}return c};getStrokedBBox=this.getStrokedBBox=function(a){if(a||(a=vb()),!a.length)return!1;var b,c=function(a){try{var b=svgedit.utilities.getBBox(a),c=svgedit.utilities.getRotationAngle(a);if(c&&c%90||svgedit.math.hasMatrixTransform(svgedit.transformlist.getTransformList(a))){if(c=!1,["ellipse","path","line","polyline","polygon"].indexOf(a.tagName)>=0)b=c=g.convertToPath(a,!0);else if("rect"==a.tagName){var e=a.getAttribute("rx"),f=a.getAttribute("ry");(e||f)&&(b=c=g.convertToPath(a,!0))}if(!c){var h=a.cloneNode(!0),i=document.createElementNS(d.SVG,"g"),j=a.parentNode;j.appendChild(i),i.appendChild(h),b=svgedit.utilities.bboxToObj(i.getBBox()),j.removeChild(i)}}return b}catch(k){return console.log(a,k),null}};if($.each(a,function(){b||this.parentNode&&(b=c(this))}),null==b)return null;var e=b.x+b.width,f=b.y+b.height,h=b.x,i=b.y,j=function(a){var b=a.getAttribute("stroke-width"),c=0;return"none"==a.getAttribute("stroke")||isNaN(b)||(c+=b/2),c},k=[];return $.each(a,function(a,b){var d=c(b);if(d){var e=j(b);h=Math.min(h,d.x-e),i=Math.min(i,d.y-e),k.push(d)}}),b.x=h,b.y=i,$.each(a,function(a,b){var c=k[a];if(c&&1==b.nodeType){var d=j(b);e=Math.max(e,c.x+c.width+d),f=Math.max(f,c.y+c.height+d)}}),b.width=e-h,b.height=f-i,b};var qb,rb,sb,tb,ub,vb=this.getVisibleElements=function(a){a||(a=$(j).children());var b=[];return $(a).children().each(function(a,c){try{c.getBBox()&&b.push(c)}catch(d){}}),b.reverse()},wb=this.getVisibleElementsAndBBoxes=function(a){a||(a=$(j).children());var b=[];return $(a).children().each(function(a,c){try{c.getBBox()&&b.push({elem:c,bbox:getStrokedBBox([c])})}catch(d){}}),b.reverse()},xb=this.groupSvgElem=function(a){var b=document.createElementNS(d.SVG,"g");a.parentNode.replaceChild(b,a),$(b).append(a).data("gsvg",a)[0].id=rb()},yb=function(a){var b=document.createElementNS(a.namespaceURI,a.nodeName);if($.each(a.attributes,function(a,c){"-moz-math-font-style"!=c.localName&&b.setAttributeNS(c.namespaceURI,c.nodeName,c.nodeValue)}),b.removeAttribute("id"),b.id=rb(),svgedit.browser.isWebkit()&&"path"==a.nodeName){var c=ub.convertPath(a);b.setAttribute("d",c)}return $.each(a.childNodes,function(a,c){switch(c.nodeType){case 1:b.appendChild(yb(c));break;case 3:b.textContent=c.nodeValue}}),$(a).data("gsvg")?$(b).data("gsvg",b.firstChild):$(a).data("symbol")?(a=$(a).data("symbol"),$(b).data("ref",a).data("symbol",a)):"image"==b.tagName&&Ib(b),b};!function(a){var b={};qb=a.getId=function(){return m().getId()},rb=a.getNextId=function(){return m().getNextId()},sb=a.call=function(a,c){return b[a]?b[a](this,c):void 0},a.bind=function(a,c){var d=b[a];return b[a]=c,d}}(g),this.prepareSvg=function(a){this.sanitizeSvg(a.documentElement);var b,c,e=a.getElementsByTagNameNS(d.SVG,"path");for(a=0,c=e.length;c>a;++a)b=e[a],b.setAttribute("d",ub.convertPath(b)),ub.fixEnd(b)};var zb=function(a){if(!svgedit.browser.isGecko())return a;var b=a.cloneNode(!0);return a.parentNode.insertBefore(b,a),a.parentNode.removeChild(a),R.releaseSelector(a),r[0]=b,R.requestSelector(b).showGrips(!0),b};this.setRotationAngle=function(a,b){a=parseFloat(a);var c=r[0],d=c.getAttribute("transform"),e=svgedit.utilities.getBBox(c),f=e.x+e.width/2,g=e.y+e.height/2;e=svgedit.transformlist.getTransformList(c),e.numberOfItems>0&&4==e.getItem(0).type&&e.removeItem(0),0!=a?(f=svgedit.math.transformPoint(f,g,svgedit.math.transformListToTransform(e).matrix),g=i.createSVGTransform(),g.setRotate(a,f.x,f.y),e.numberOfItems?e.insertItemBefore(g,0):e.appendItem(g)):0==e.numberOfItems&&c.removeAttribute("transform"),b||(e=c.getAttribute("transform"),c.setAttribute("transform",d),Vb("transform",e,r),sb("changed",r)),svgedit.utilities.getElem("pathpointgrip_container"),c=R.requestSelector(r[0]),c.resize(),c.updateGripCursors(a)};var Ab=this.recalculateAllSelectedDimensions=function(){for(var a=new svgedit.history.BatchCommand("none"==db?"position":"size"),b=r.length;b--;){var c=svgedit.recalculate.recalculateDimensions(r[b]);c&&a.addSubCommand(c)}a.isEmpty()||(Q(a),sb("changed",r))},Bb=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],Cb=function(a){console.log([a.a,a.b,a.c,a.d,a.e,a.f])},Db=null,Eb=this.clearSelection=function(a){if(null!=r[0]){var b,c,d=r.length;for(b=0;d>b&&(c=r[b],null!=c);++b)R.releaseSelector(c),r[b]=null}a||sb("selected",r)},Fb=this.addToSelection=function(a,b){if(0!=a.length){for(var c=0;c<r.length&&null!=r[c];)++c;for(var d=a.length;d--;){var e=a[d];e&&svgedit.utilities.getBBox(e)&&("a"===e.tagName&&1===e.childNodes.length&&(e=e.firstChild),-1==r.indexOf(e)&&(r[c]=e,c++,e=R.requestSelector(e),r.length>1&&e.showGrips(!1)))}for(sb("selected",r),R.requestSelector(r[0]).showGrips(b||1==r.length?!0:!1),r.sort(function(a,b){return a&&b&&a.compareDocumentPosition?3-(6&b.compareDocumentPosition(a)):null==a?1:void 0});null==r[0];)r.shift(0)}},Gb=this.selectOnly=function(a,b){Eb(!0),Fb(a,b)};this.removeFromSelection=function(a){if(null!=r[0]&&0!=a.length){var b,c=0,d=Array(r.length),e=r.length;for(b=0;e>b;++b){var f=r[b];f&&(-1==a.indexOf(f)?(d[c]=f,c++):R.releaseSelector(f))}r=d}},this.selectAllInCurrentLayer=function(){var a=m().getCurrentLayer();a&&(cb="select",Gb($(o||a).children()))};var Hb=this.getMouseTarget=function(b){if(null==b)return null;if(b=b.target,b.correspondingUseElement&&(b=b.correspondingUseElement),[d.MATH,d.HTML].indexOf(b.namespaceURI)>=0&&"svgcanvas"!=b.id)for(;"foreignObject"!=b.nodeName;)if(b=b.parentNode,!b)return i;var c=m().getCurrentLayer();if([i,a,j,c].indexOf(b)>=0)return i;if($(b).closest("#selectorParentGroup").length)return R.selectorParentGroup;for(;b.parentNode!==(o||c);)b=b.parentNode;return b};!function(){var b,c,d=null,f=null,h=null,j=null,k=null,l={},p={minx:null,miny:null,maxx:null,maxy:null},t=0,u={x:0,y:0},v={x:0,y:0},w={x:0,y:0},z={x:0,y:0},A={x:0,y:0},B={x:0,y:0},D=function(a){var b={x:0,y:0},c=u,d=v,e=w,f=z,g=1/6,h=a*a,i=h*a,j=[[-1,3,-3,1],[3,-6,3,0],[-3,0,3,0],[1,4,1,0]];return b.x=g*((c.x*j[0][0]+d.x*j[0][1]+e.x*j[0][2]+f.x*j[0][3])*i+(c.x*j[1][0]+d.x*j[1][1]+e.x*j[1][2]+f.x*j[1][3])*h+(c.x*j[2][0]+d.x*j[2][1]+e.x*j[2][2]+f.x*j[2][3])*a+(c.x*j[3][0]+d.x*j[3][1]+e.x*j[3][2]+f.x*j[3][3])),b.y=g*((c.y*j[0][0]+d.y*j[0][1]+e.y*j[0][2]+f.y*j[0][3])*i+(c.y*j[1][0]+d.y*j[1][1]+e.y*j[1][2]+f.y*j[1][3])*h+(c.y*j[2][0]+d.y*j[2][1]+e.y*j[2][2]+f.y*j[2][3])*a+(c.y*j[3][0]+d.y*j[3][1]+e.y*j[3][2]+f.y*j[3][3])),{x:b.x,y:b.y}};$(a).mousedown(function(a){if(!g.spaceKey&&1!==a.button){var b=2===a.button;a.altKey&&svgCanvas.cloneSelectedElements(0,0),Db=$("#svgcontent g")[0].getScreenCTM().inverse();var c=svgedit.math.transformPoint(a.pageX,a.pageY,Db),m=c.x*n,o=c.y*n;
a.preventDefault(),b&&(cb="select",lb=c),c=m/n,o/=n;var t=Hb(a);"a"===t.tagName&&1===t.childNodes.length&&(t=t.firstChild),j=f=m=c;var u=o;if(k=h=o,e.gridSnapping&&(c=svgedit.utilities.snapToGrid(c),o=svgedit.utilities.snapToGrid(o),f=svgedit.utilities.snapToGrid(f),h=svgedit.utilities.snapToGrid(h)),t==R.selectorParentGroup&&null!=r[0]){t=a.target;var v=U(t,"type");"rotate"==v?cb="rotate":"resize"==v&&(cb="resize",db=U(t,"dir")),t=r[0]}bb=t.getAttribute("transform");var x;switch(v=svgedit.transformlist.getTransformList(t),cb){case"select":if(ab=!0,db="none",b&&(ab=!1),t!=i){if(-1==r.indexOf(t)&&(a.shiftKey||Eb(!0),Fb([t]),hb=t,ub.clear()),!b)for(b=0;b<r.length;++b)null!=r[b]&&(x=svgedit.transformlist.getTransformList(r[b]),x.numberOfItems?x.insertItemBefore(i.createSVGTransform(),0):x.appendItem(i.createSVGTransform()))}else b||(Eb(),cb="multiselect",null==ib&&(ib=R.getRubberBandBox()),j*=n,k*=n,svgedit.utilities.assignAttributes(ib,{x:j,y:k,width:0,height:0,display:"inline"},100));break;case"zoom":ab=!0,null==ib&&(ib=R.getRubberBandBox()),svgedit.utilities.assignAttributes(ib,{x:m*n,y:m*n,width:0,height:0,display:"inline"},100);break;case"resize":ab=!0,f=c,h=o,l=svgedit.utilities.getBBox($("#selectedBox0")[0]);var y={};if($.each(l,function(a,b){y[a]=b/n}),l=y,b=svgedit.utilities.getRotationAngle(t)?1:0,svgedit.math.hasMatrixTransform(v))v.insertItemBefore(i.createSVGTransform(),b),v.insertItemBefore(i.createSVGTransform(),b),v.insertItemBefore(i.createSVGTransform(),b);else if(v.appendItem(i.createSVGTransform()),v.appendItem(i.createSVGTransform()),v.appendItem(i.createSVGTransform()),svgedit.browser.supportsNonScalingStroke())for((c=svgedit.browser.isWebkit())&&(x=function(a){var b=a.getAttributeNS(null,"stroke");a.removeAttributeNS(null,"stroke"),setTimeout(function(){a.setAttributeNS(null,"stroke",b)},0)}),t.style.vectorEffect="non-scaling-stroke",c&&x(t),o=t.getElementsByTagName("*"),m=o.length,b=0;m>b;b++)o[b].style.vectorEffect="non-scaling-stroke",c&&x(o[b]);break;case"fhellipse":case"fhrect":case"fhpath":w.x=m,w.y=u,ab=!0,d=m+","+u+" ",x=0==q.stroke_width?1:q.stroke_width,s({element:"polyline",curStyles:!0,attr:{points:d,id:rb(),fill:"none",opacity:q.opacity/2,"stroke-linecap":"round",style:"pointer-events:none"}}),p.minx=m,p.maxx=m,p.miny=u,p.maxy=u;break;case"image":ab=!0,x=s({element:"image",attr:{x:c,y:o,width:0,height:0,id:rb(),opacity:q.opacity/2,style:"pointer-events:inherit"}}),C(x,Y),Ib(x);break;case"square":case"rect":ab=!0,f=c,h=o,s({element:"rect",curStyles:!0,attr:{x:c,y:o,width:0,height:0,id:rb(),opacity:q.opacity/2}});break;case"line":ab=!0,x=0==q.stroke_width?1:q.stroke_width,s({element:"line",curStyles:!0,attr:{x1:c,y1:o,x2:c,y2:o,id:rb(),stroke:q.stroke,"stroke-width":x,"stroke-dasharray":q.stroke_dasharray,"stroke-linejoin":q.stroke_linejoin,"stroke-linecap":q.stroke_linecap,"stroke-opacity":q.stroke_opacity,fill:"none",opacity:q.opacity/2,style:"pointer-events:none"}});break;case"circle":ab=!0,s({element:"circle",curStyles:!0,attr:{cx:c,cy:o,r:0,id:rb(),opacity:q.opacity/2}});break;case"ellipse":ab=!0,s({element:"ellipse",curStyles:!0,attr:{cx:c,cy:o,rx:0,ry:0,id:rb(),opacity:q.opacity/2}});break;case"text":ab=!0,s({element:"text",curStyles:!0,attr:{x:c,y:o,id:rb(),fill:fb.fill,"stroke-width":fb.stroke_width,"font-size":fb.font_size,"font-family":fb.font_family,"text-anchor":"middle","xml:space":"preserve",opacity:q.opacity}});break;case"path":case"pathedit":f*=n,h*=n,ub.mouseDown(a,t,f,h),ab=!0;break;case"textedit":f*=n,h*=n,tb.mouseDown(a,t,f,h),ab=!0;break;case"rotate":ab=!0,g.undoMgr.beginUndoableChange("transform",r)}a=nb("mouseDown",{event:a,start_x:f,start_y:h,selectedElements:r},!0),$.each(a,function(a,b){b&&b.started&&(ab=!0)})}}).mousemove(function(a){if(ab&&1!==a.button&&!g.spaceKey){var m,o,q,s,C,E=r[0],F=svgedit.math.transformPoint(a.pageX,a.pageY,Db),G=F.x*n;F=F.y*n;var H=svgedit.utilities.getElem(qb());switch(x=o=G/n,y=s=F/n,e.gridSnapping&&(x=svgedit.utilities.snapToGrid(x),y=svgedit.utilities.snapToGrid(y)),a.preventDefault(),cb){case"select":if(null!==r[0]&&(o=x-f,q=y-h,e.gridSnapping&&(o=svgedit.utilities.snapToGrid(o),q=svgedit.utilities.snapToGrid(q)),a.shiftKey&&(m=svgedit.math.snapToAngle(f,h,x,y),x=m.x,y=m.y),0!=o||0!=q)){for(s=r.length,m=0;s>m&&(E=r[m],null!=E);++m){var I=i.createSVGTransform();H=svgedit.transformlist.getTransformList(E),I.setTranslate(o,q),H.numberOfItems?H.replaceItem(I,0):H.appendItem(I),R.requestSelector(E).resize()}sb("transition",r)}break;case"multiselect":for(o*=n,s*=n,svgedit.utilities.assignAttributes(ib,{x:Math.min(j,o),y:Math.min(k,s),width:Math.abs(o-j),height:Math.abs(s-k)},100),H=[],o=[],I=pb(),s=r.length,m=0;s>m;++m)q=I.indexOf(r[m]),-1==q?H.push(r[m]):I[q]=null;for(s=I.length,m=0;s>m;++m)I[m]&&o.push(I[m]);H.length>0&&g.removeFromSelection(H),o.length>0&&Fb(o);break;case"resize":H=svgedit.transformlist.getTransformList(E),q=(m=svgedit.math.hasMatrixTransform(H))?l:svgedit.utilities.getBBox(E),s=q.x,I=q.y;var J=q.width,K=q.height;if(o=x-f,q=y-h,e.gridSnapping&&(o=svgedit.utilities.snapToGrid(o),q=svgedit.utilities.snapToGrid(q),K=svgedit.utilities.snapToGrid(K),J=svgedit.utilities.snapToGrid(J)),C=svgedit.utilities.getRotationAngle(E)){var L=Math.sqrt(o*o+q*q);q=Math.atan2(q,o)-C*Math.PI/180,o=L*Math.cos(q),q=L*Math.sin(q)}-1==db.indexOf("n")&&-1==db.indexOf("s")&&(q=0),-1==db.indexOf("e")&&-1==db.indexOf("w")&&(o=0);var M=L=0,N=K?(K+q)/K:1,O=J?(J+o)/J:1;db.indexOf("n")>=0&&(N=K?(K-q)/K:1,M=K),db.indexOf("w")>=0&&(O=J?(J-o)/J:1,L=J),o=i.createSVGTransform(),q=i.createSVGTransform(),J=i.createSVGTransform(),e.gridSnapping&&(s=svgedit.utilities.snapToGrid(s),L=svgedit.utilities.snapToGrid(L),I=svgedit.utilities.snapToGrid(I),M=svgedit.utilities.snapToGrid(M)),o.setTranslate(-(s+L),-(I+M)),a.shiftKey&&(1==O?O=N:N=O),q.setScale(O,N),J.setTranslate(s+L,I+M),m?(m=C?1:0,H.replaceItem(o,2+m),H.replaceItem(q,1+m),H.replaceItem(J,Number(m))):(m=H.numberOfItems,H.replaceItem(J,m-3),H.replaceItem(q,m-2),H.replaceItem(o,m-1)),R.requestSelector(E).resize(),sb("transition",r);break;case"zoom":o*=n,s*=n,svgedit.utilities.assignAttributes(ib,{x:Math.min(j*n,o),y:Math.min(k*n,s),width:Math.abs(o-j*n),height:Math.abs(s-k*n)},100);break;case"text":svgedit.utilities.assignAttributes(H,{x:x,y:y},1e3);break;case"line":s=null,window.opera||i.suspendRedraw(1e3),e.gridSnapping&&(x=svgedit.utilities.snapToGrid(x),y=svgedit.utilities.snapToGrid(y)),o=x,m=y,a.shiftKey&&(m=svgedit.math.snapToAngle(f,h,o,m),o=m.x,m=m.y),H.setAttributeNS(null,"x2",o),H.setAttributeNS(null,"y2",m),window.opera||i.unsuspendRedraw(s);break;case"foreignObject":case"square":case"rect":case"image":o=Math.abs(x-f),m=Math.abs(y-h),"square"==cb||a.shiftKey?(o=m=Math.max(o,m),s=x>f?f:f-o,I=y>h?h:h-m):(s=Math.min(f,x),I=Math.min(h,y)),e.gridSnapping&&(o=svgedit.utilities.snapToGrid(o),m=svgedit.utilities.snapToGrid(m),s=svgedit.utilities.snapToGrid(s),I=svgedit.utilities.snapToGrid(I)),svgedit.utilities.assignAttributes(H,{width:o,height:m,x:s,y:I},1e3);break;case"circle":m=$(H).attr(["cx","cy"]),o=m.cx,m=m.cy,o=Math.sqrt((x-o)*(x-o)+(y-m)*(y-m)),e.gridSnapping&&(o=svgedit.utilities.snapToGrid(o)),H.setAttributeNS(null,"r",o);break;case"ellipse":m=$(H).attr(["cx","cy"]),o=m.cx,m=m.cy,s=null,window.opera||i.suspendRedraw(1e3),e.gridSnapping&&(x=svgedit.utilities.snapToGrid(x),o=svgedit.utilities.snapToGrid(o),y=svgedit.utilities.snapToGrid(y),m=svgedit.utilities.snapToGrid(m)),H.setAttributeNS(null,"rx",Math.abs(x-o)),H.setAttributeNS(null,"ry",Math.abs(a.shiftKey?x-o:y-m)),window.opera||i.unsuspendRedraw(s);break;case"fhellipse":case"fhrect":p.minx=Math.min(o,p.minx),p.maxx=Math.max(o,p.maxx),p.miny=Math.min(s,p.miny),p.maxy=Math.max(s,p.maxy);case"fhpath":if(z.x=o,z.y=s,u.x&&u.y)for(m=0;9>m;m++)b=m/10,c=(m+1)/10,B=A=D(c),A=D(b),t+=Math.sqrt((B.x-A.x)*(B.x-A.x)+(B.y-A.y)*(B.y-A.y)),t>.8&&(d+=+A.x+","+A.y+" ",H.setAttributeNS(null,"points",d),t-=.8);u={x:v.x,y:v.y},v={x:w.x,y:w.y},w={x:z.x,y:z.y};break;case"path":case"pathedit":x*=n,y*=n,e.gridSnapping&&(x=svgedit.utilities.snapToGrid(x),y=svgedit.utilities.snapToGrid(y),f=svgedit.utilities.snapToGrid(f),h=svgedit.utilities.snapToGrid(h)),a.shiftKey&&((m=svgedit.path.path)?(H=m.dragging?m.dragging[0]:f,m=m.dragging?m.dragging[1]:h):(H=f,m=h),m=svgedit.math.snapToAngle(H,m,x,y),x=m.x,y=m.y),ib&&"none"!==ib.getAttribute("display")&&(o*=n,s*=n,svgedit.utilities.assignAttributes(ib,{x:Math.min(j*n,o),y:Math.min(k*n,s),width:Math.abs(o-j*n),height:Math.abs(s-k*n)},100)),ub.mouseMove(x,y);break;case"textedit":x*=n,y*=n,tb.mouseMove(G,F);break;case"rotate":q=svgedit.utilities.getBBox(E),o=q.x+q.width/2,m=q.y+q.height/2,H=svgedit.math.getMatrix(E),H=svgedit.math.transformPoint(o,m,H),o=H.x,m=H.y,C=(Math.atan2(m-y,o-x)*(180/Math.PI)-90)%360,e.gridSnapping&&(C=svgedit.utilities.snapToGrid(C)),a.shiftKey&&(C=45*Math.round(C/45)),g.setRotationAngle(-180>C?360+C:C,!0),sb("transition",r)}nb("mouseMove",{event:a,mouse_x:G,mouse_y:F,selected:E})}}).click(function(a){return a.preventDefault(),!1}).dblclick(function(a){var b=a.target.parentNode;if(b!==o){var c=Hb(a),d=c.tagName;"text"===d&&"textedit"!==cb&&(a=svgedit.math.transformPoint(a.pageX,a.pageY,Db),tb.select(c,a.x,a.y)),"g"!==d&&"a"!==d||!svgedit.utilities.getRotationAngle(c)||(Wb(c),c=r[0],Eb(!0)),o&&Pb(),"g"!==b.tagName&&"a"!==b.tagName||b===m().getCurrentLayer()||c===R.selectorParentGroup||Qb(c)}}).mouseup(function(a){if(2!==a.button){var b=hb;if(hb=null,ab){var c=svgedit.math.transformPoint(a.pageX,a.pageY,Db),d=c.x*n;c=c.y*n;var f=d/n,h=c/n,i=svgedit.utilities.getElem(qb()),l=!1;switch(ab=!1,cb){case"resize":case"multiselect":null!=ib&&(ib.setAttribute("display","none"),jb=[]),cb="select";case"select":if(null!=r[0]){if(null==r[1]){switch(d=r[0],d.tagName){case"g":case"use":case"image":case"foreignObject":break;default:gb.fill=d.getAttribute("fill"),gb.fill_opacity=d.getAttribute("fill-opacity"),gb.stroke=d.getAttribute("stroke"),gb.stroke_opacity=d.getAttribute("stroke-opacity"),gb.stroke_width=d.getAttribute("stroke-width"),gb.stroke_dasharray=d.getAttribute("stroke-dasharray"),gb.stroke_linejoin=d.getAttribute("stroke-linejoin"),gb.stroke_linecap=d.getAttribute("stroke-linecap")}"text"==d.tagName&&(fb.font_size=d.getAttribute("font-size"),fb.font_family=d.getAttribute("font-family")),R.requestSelector(d).showGrips(!0)}if(Ab(),f!=j||h!=k)for(d=r.length,a=0;d>a&&null!=r[a];++a)r[a].firstChild||R.requestSelector(r[a]).resize();else d=a.target,"path"===r[0].nodeName&&null==r[1]?ub.select(r[0]):a.shiftKey&&b!=d&&g.removeFromSelection([d]);svgedit.browser.supportsNonScalingStroke()&&(a=r[0])&&(a.removeAttribute("style"),svgedit.utilities.walkTree(a,function(a){a.removeAttribute("style")}))}return;case"zoom":return null!=ib&&ib.setAttribute("display","none"),void sb("zoomed",{x:Math.min(j,f),y:Math.min(k,h),width:Math.abs(f-j),height:Math.abs(h-k),factor:a.shiftKey?.5:2});case"fhpath":t=0,u={x:0,y:0},v={x:0,y:0},w={x:0,y:0},z={x:0,y:0},b=i.getAttribute("points"),f=b.indexOf(","),(l=f>=0?b.indexOf(",",f+1)>=0:b.indexOf(" ",b.indexOf(" ")+1)>=0)&&(i=ub.smoothPolylineIntoPath(i));break;case"line":b=$(i).attr(["x1","x2","y1","y2"]),l=b.x1!=b.x2||b.y1!=b.y2;break;case"foreignObject":case"square":case"rect":case"image":b=$(i).attr(["width","height"]),l=0!=b.width||0!=b.height||"image"===cb;break;case"circle":l=0!=i.getAttribute("r");break;case"ellipse":b=$(i).attr(["rx","ry"]),l=null!=b.rx||null!=b.ry;break;case"fhellipse":p.maxx-p.minx>0&&p.maxy-p.miny>0&&(i=s({element:"ellipse",curStyles:!0,attr:{cx:(p.minx+p.maxx)/2,cy:(p.miny+p.maxy)/2,rx:(p.maxx-p.minx)/2,ry:(p.maxy-p.miny)/2,id:qb()}}),sb("changed",[i]),l=!0);break;case"fhrect":p.maxx-p.minx>0&&p.maxy-p.miny>0&&(i=s({element:"rect",curStyles:!0,attr:{x:p.minx,y:p.miny,width:p.maxx-p.minx,height:p.maxy-p.miny,id:qb()}}),sb("changed",[i]),l=!0);break;case"text":l=!0,Gb([i]),tb.start(i);break;case"path":i=null,ab=!0,b=ub.mouseUp(a,i,d,c),i=b.element,l=b.keep;break;case"pathedit":l=!0,i=null,ub.mouseUp(a);break;case"textedit":l=!1,i=null,tb.mouseUp(a,d,c);break;case"rotate":l=!0,i=null,cb="select",b=g.undoMgr.finishUndoableChange(),b.isEmpty()||Q(b),Ab(),sb("changed",r)}if(d=nb("mouseUp",{event:a,mouse_x:d,mouse_y:c},!0),$.each(d,function(a,b){b&&(l=b.keep||l,i=b.element,ab=b.started||ab)}),l||null==i){if(null!=i){g.addedNew=!0,a=.2;var o;if(V.beginElement&&i.getAttribute("opacity")!=q.opacity){o=$(V).clone().attr({to:q.opacity,dur:a}).appendTo(i);try{o[0].beginElement()}catch(x){}}else a=0;setTimeout(function(){o&&o.remove(),i.setAttribute("opacity",q.opacity),i.setAttribute("style","pointer-events:inherit"),G(i),"path"===cb?ub.toEditMode(i):e.selectNew&&Gb([i],!0),Q(new svgedit.history.InsertElementCommand(i)),sb("changed",[i])},1e3*a)}}else{for(m().releaseId(qb()),i.parentNode.removeChild(i),i=null,d=a.target;"g"==d.parentNode.parentNode.tagName;)d=d.parentNode;"path"==cb&&drawn_path||"selectorParentGroup"==d.parentNode.id||"svgcanvas"==d.id||"svgroot"==d.id||(g.setMode("select"),Gb([d],!0))}bb=null}}}),$(a).bind("mousewheel DOMMouseScroll",function(a){a.preventDefault(),a=a.originalEvent,Db=$("#svgcontent g")[0].getScreenCTM().inverse();var b=svgedit.math.transformPoint(a.pageX,a.pageY,Db);b={x:b.x,y:b.y,width:0,height:0},(a=a.wheelDelta?a.wheelDelta:a.detail?-a.detail:0)&&(b.factor=Math.max(.75,Math.min(4/3,a)),sb("zoomed",b))})}();var Ib=function(a){$(a).click(function(a){a.preventDefault()})};tb=g.textActions=function(){function a(a){var b=""===m.value;if($(m).focus(),!arguments.length)if(b)a=0;else{if(m.selectionEnd!==m.selectionStart)return;a=m.selectionEnd}var c;c=x[a],b||m.setSelectionRange(a,a),o=svgedit.utilities.getElem("text_cursor"),o||(o=document.createElementNS(d.SVG,"line"),svgedit.utilities.assignAttributes(o,{id:"text_cursor",stroke:"#333","stroke-width":1}),o=svgedit.utilities.getElem("selectorParentGroup").appendChild(o)),q||(q=setInterval(function(){var a="none"===o.getAttribute("display");o.setAttribute("display",a?"inline":"none")},600)),b=h(c.x,s.y),c=h(c.x,s.y+s.height),svgedit.utilities.assignAttributes(o,{x1:b.x,y1:b.y,x2:c.x,y2:c.y,visibility:"visible",display:"inline"}),p&&p.setAttribute("d","")}function b(b,c,e){if(b===c)a(c);else{e||m.setSelectionRange(b,c),p=svgedit.utilities.getElem("text_selectblock"),p||(p=document.createElementNS(d.SVG,"path"),svgedit.utilities.assignAttributes(p,{id:"text_selectblock",fill:"green",opacity:.5,style:"pointer-events:none"}),svgedit.utilities.getElem("selectorParentGroup").appendChild(p)),b=x[b];var f=x[c];o.setAttribute("visibility","hidden"),c=h(b.x,s.y),e=h(b.x+(f.x-b.x),s.y);var g=h(b.x,s.y+s.height);b=h(b.x+(f.x-b.x),s.y+s.height),svgedit.utilities.assignAttributes(p,{d:"M"+c.x+","+c.y+" L"+e.x+","+e.y+" "+b.x+","+b.y+" "+g.x+","+g.y+"z",display:"inline"})}}function c(a,b){var c=i.createSVGPoint();if(c.x=a,c.y=b,1==x.length)return 0;c=l.getCharNumAtPosition(c),0>c?(c=x.length-2,a<=x[0].x&&(c=0)):c>=x.length-2&&(c=x.length-2);var d=x[c];return a>d.x+d.width/2&&c++,c}function e(a,d,e){var f=m.selectionStart;a=c(a,d),b(Math.min(f,a),Math.max(f,a),!e)}function f(a,b){var c={x:a,y:b};if(c.x/=n,c.y/=n,t){var d=svgedit.math.transformPoint(c.x,c.y,t.inverse());c.x=d.x,c.y=d.y}return c}function h(a,b){var c={x:a,y:b};if(t){var d=svgedit.math.transformPoint(c.x,c.y,t);c.x=d.x,c.y=d.y}return c.x*=n,c.y*=n,c}function j(a){b(0,l.textContent.length),$(this).unbind(a)}function k(a){if(w&&l){var d=svgedit.math.transformPoint(a.pageX,a.pageY,Db);d=f(d.x*n,d.y*n),d=c(d.x,d.y);var e=l.textContent,g=e.substr(0,d).replace(/[a-z0-9]+$/i,"").length;e=e.substr(d).match(/^[a-z0-9]+/i),b(g,(e?e[0].length:0)+d),$(a.target).click(j),setTimeout(function(){$(a.target).unbind("click",j)},300)}}var l,m,o,p,q,s,t,u,v,w,x=[];return{select:function(a,b,c){l=a,tb.toEditMode(b,c)},start:function(a){l=a,tb.toEditMode()},mouseDown:function(b,d,e,g){b=f(e,g),m.focus(),a(c(b.x,b.y)),u=e,v=g},mouseMove:function(a,b){var c=f(a,b);e(c.x,c.y)},mouseUp:function(a,b,c){var d=f(b,c);e(d.x,d.y,!0),a.target!==l&&u+2>b&&b>u-2&&v+2>c&&c>v-2&&tb.toSelectMode(!0)},setCursor:a,toEditMode:function(b,d){if(w=!1,cb="textedit",R.requestSelector(l).showGrips(!1),R.requestSelector(l),tb.init(),$(l).css("cursor","text"),arguments.length){var e=f(b,d);a(c(e.x,e.y))}else a();setTimeout(function(){w=!0},300)},toSelectMode:function(a){cb="select",clearInterval(q),q=null,p&&$(p).attr("display","none"),o&&$(o).attr("visibility","hidden"),$(l).css("cursor","move"),a&&(Eb(),$(l).css("cursor","move"),sb("selected",[l]),Fb([l],!0)),l&&!l.textContent.length&&g.deleteSelectedElements(),$(m).blur(),l=!1},setInputElem:function(a){m=a},clear:function(){"textedit"==cb&&tb.toSelectMode()},init:function(){if(l){var a,c;l.parentNode||(l=r[0],R.requestSelector(l).showGrips(!1));var d=l.textContent.length;for(a=l.getAttribute("transform"),s=svgedit.utilities.getBBox(l),t=a?svgedit.math.getMatrix(l):null,x=Array(d),m.focus(),$(l).unbind("dblclick",k).dblclick(k),d||(c={x:s.x+s.width/2,width:0}),a=0;d>a;a++){var e=l.getStartPositionOfChar(a);if(c=l.getEndPositionOfChar(a),!svgedit.browser.supportsGoodTextCharPos()){var f=g.contentW*n;e.x-=f,c.x-=f,e.x/=n,c.x/=n}x[a]={x:e.x,y:s.y,width:c.x-e.x,height:s.height}}x.push({x:c.x,width:0}),b(m.selectionStart,m.selectionEnd,!0)}}}}(),ub=g.pathActions=function(){var b,f,h,i=!1;svgedit.path.Path.prototype.endChanges=function(a){if(svgedit.browser.isWebkit()){var b=this.elem;b.setAttribute("d",ub.convertPath(b))}a=new svgedit.history.ChangeElementCommand(this.elem,{d:this.last_d},a),Q(a),sb("changed",[this.elem])},svgedit.path.Path.prototype.addPtsToSelection=function(a){var b,c;for($.isArray(a)||(a=[a]),b=0;b<a.length;b++){var d=a[b];c=this.segs[d],c.ptgrip&&-1==this.selected_pts.indexOf(d)&&d>=0&&this.selected_pts.push(d)}for(this.selected_pts.sort(),b=this.selected_pts.length,a=Array(b);b--;)c=this.segs[this.selected_pts[b]],c.select(!0),a[b]=c.ptgrip;ub.canDeleteNodes=!0,ub.closed_subpath=this.subpathIsClosed(this.selected_pts[0]),sb("selected",a)};var j=b=null,k=!1;return{mouseDown:function(b,c,g,h){var k;if("path"===cb){mouse_x=g,mouse_y=h,h=mouse_x/n,c=mouse_y/n,g=svgedit.utilities.getElem("path_stretch_line"),f=[h,c],e.gridSnapping&&(h=svgedit.utilities.snapToGrid(h),c=svgedit.utilities.snapToGrid(c),mouse_x=svgedit.utilities.snapToGrid(mouse_x),mouse_y=svgedit.utilities.snapToGrid(mouse_y)),g||(g=document.createElementNS(d.SVG,"path"),svgedit.utilities.assignAttributes(g,{id:"path_stretch_line",stroke:"#22C","stroke-width":"0.5",fill:"none"}),g=svgedit.utilities.getElem("selectorParentGroup").appendChild(g)),g.setAttribute("display","inline");var l=null;if(j){l=j.pathSegList;var m=l.numberOfItems;k=6/n;for(var o=!1;m;){m--;var p=l.getItem(m),r=p.x;if(p=p.y,h>=r-k&&r+k>=h&&c>=p-k&&p+k>=c){o=!0;break}}if(k=qb(),svgedit.path.removePath_(k),k=svgedit.utilities.getElem(k),r=l.numberOfItems,o){if(1>=m&&r>=2)h=l.getItem(0).x,c=l.getItem(0).y,b=g.pathSegList.getItem(1),b=4===b.pathSegType?j.createSVGPathSegLinetoAbs(h,c):j.createSVGPathSegCurvetoCubicAbs(h,c,b.x1/n,b.y1/n,h,c),h=j.createSVGPathSegClosePath(),l.appendItem(b),l.appendItem(h);else if(3>r)return l=!1;if($(g).remove(),element=k,j=null,ab=!1,i)return svgedit.path.path.matrix&&svgedit.coords.remapElement(k,{},svgedit.path.path.matrix.inverse()),g=k.getAttribute("d"),b=$(svgedit.path.path.elem).attr("d"),$(svgedit.path.path.elem).attr("d",b+g),$(k).remove(),svgedit.path.path.matrix&&svgedit.path.recalcRotatedPath(),svgedit.path.path.init(),ub.toEditMode(svgedit.path.path.elem),svgedit.path.path.selectPt(),!1}else{if(!$.contains(a,Hb(b)))return console.log("Clicked outside canvas"),!1;l=j.pathSegList.numberOfItems,m=j.pathSegList.getItem(l-1),k=m.x,m=m.y,b.shiftKey&&(b=svgedit.math.snapToAngle(k,m,h,c),h=b.x,c=b.y),b=g.pathSegList.getItem(1),b=4===b.pathSegType?j.createSVGPathSegLinetoAbs(ob(h),ob(c)):j.createSVGPathSegCurvetoCubicAbs(ob(h),ob(c),b.x1/n,b.y1/n,b.x2/n,b.y2/n),j.pathSegList.appendItem(b),h*=n,c*=n,g.setAttribute("d",["M",h,c,h,c].join(" ")),g=l,i&&(g+=svgedit.path.path.segs.length),svgedit.path.addPointGrip(g,h,c)}}else d_attr="M"+h+","+c+" ",j=s({element:"path",curStyles:!0,attr:{d:d_attr,id:rb(),opacity:q.opacity/2}}),g.setAttribute("d",["M",mouse_x,mouse_y,mouse_x,mouse_y].join(" ")),g=i?svgedit.path.path.segs.length:0,svgedit.path.addPointGrip(g,mouse_x,mouse_y)}else svgedit.path.path&&(svgedit.path.path.storeD(),k=b.target.id,"pathpointgrip_"==k.substr(0,14)?(c=svgedit.path.path.cur_pt=parseInt(k.substr(14)),svgedit.path.path.dragging=[g,h],l=svgedit.path.path.segs[c],b.shiftKey?l.selected?svgedit.path.path.removePtFromSelection(c):svgedit.path.path.addPtsToSelection(c):((svgedit.path.path.selected_pts.length<=1||!l.selected)&&svgedit.path.path.clearSelection(),svgedit.path.path.addPtsToSelection(c))):0==k.indexOf("ctrlpointgrip_")&&(svgedit.path.path.dragging=[g,h],b=k.split("_")[1].split("c"),c=Number(b[0]),svgedit.path.path.selectPt(c,Number(b[1]))),svgedit.path.path.dragging||(null==ib&&(ib=R.getRubberBandBox()),svgedit.utilities.assignAttributes(ib,{x:g*n,y:h*n,width:0,height:0,display:"inline"},100)))},mouseMove:function(a,b){if(k=!0,"path"===cb){if(j){var c=j.pathSegList,d=c.numberOfItems-1;if(f){var e=svgedit.path.addCtrlGrip("1c1"),g=svgedit.path.addCtrlGrip("0c2");e.setAttribute("cx",a),e.setAttribute("cy",b),e.setAttribute("display","inline"),e=f[0];var i=f[1];c.getItem(d);var l=e+(e-a/n),m=i+(i-b/n);if(g.setAttribute("cx",l*n),g.setAttribute("cy",m*n),g.setAttribute("display","inline"),g=svgedit.path.getCtrlLine(1),svgedit.utilities.assignAttributes(g,{x1:a,y1:b,x2:l*n,y2:m*n,display:"inline"}),0===d)h=[a,b];else{c=c.getItem(d-1),g=c.x;var o=c.y;6===c.pathSegType?(g+=g-c.x2,o+=o-c.y2):h&&(g=h[0]/n,o=h[1]/n),svgedit.path.replacePathSeg(6,d,[e,i,g,o,l,m],j)}}else(e=svgedit.utilities.getElem("path_stretch_line"))&&(d=c.getItem(d),6===d.pathSegType?svgedit.path.replacePathSeg(6,1,[a,b,(d.x+(d.x-d.x2))*n,(d.y+(d.y-d.y2))*n,a,b],e):h?svgedit.path.replacePathSeg(6,1,[a,b,h[0],h[1],a,b],e):svgedit.path.replacePathSeg(4,1,[a,b],e))}}else svgedit.path.path.dragging?(e=svgedit.path.getPointFromGrip({x:svgedit.path.path.dragging[0],y:svgedit.path.path.dragging[1]},svgedit.path.path),i=svgedit.path.getPointFromGrip({x:a,y:b},svgedit.path.path),d=i.x-e.x,e=i.y-e.y,svgedit.path.path.dragging=[a,b],svgedit.path.path.dragctrl?svgedit.path.path.moveCtrl(d,e):svgedit.path.path.movePts(d,e)):(svgedit.path.path.selected_pts=[],svgedit.path.path.eachSeg(function(){if(this.next||this.prev){var a=ib.getBBox(),b=svgedit.path.getGripPt(this);a=svgedit.math.rectsIntersect(a,{x:b.x,y:b.y,width:0,height:0}),this.select(a),a&&svgedit.path.path.selected_pts.push(this.index)}}))},mouseUp:function(a,b){if("path"===cb)return f=null,j||(b=svgedit.utilities.getElem(qb()),ab=!1,h=null),{keep:!0,element:b};if(svgedit.path.path.dragging){var c=svgedit.path.path.cur_pt;svgedit.path.path.dragging=!1,svgedit.path.path.dragctrl=!1,svgedit.path.path.update(),k&&svgedit.path.path.endChanges("Move path point(s)"),!a.shiftKey&&!k&&svgedit.path.path.selectPt(c)}else ib&&"none"!=ib.getAttribute("display")?(ib.setAttribute("display","none"),ib.getAttribute("width")<=2&&ib.getAttribute("height")<=2&&ub.toSelectMode(a.target)):ub.toSelectMode(a.target);k=!1},toEditMode:function(a){svgedit.path.path=svgedit.path.getPath_(a),cb="pathedit",Eb(),svgedit.path.path.show(!0).update(),svgedit.path.path.oldbbox=svgedit.utilities.getBBox(svgedit.path.path.elem),i=!1},toSelectMode:function(a){var c=a==svgedit.path.path.elem;cb="select",svgedit.path.path.show(!1),b=!1,Eb(),svgedit.path.path.matrix&&svgedit.path.recalcRotatedPath(),c&&(sb("selected",[a]),Fb([a],!0))},addSubPath:function(a){a?(cb="path",i=!0):(ub.clear(!0),ub.toEditMode(svgedit.path.path.elem))},select:function(a){b===a?(ub.toEditMode(a),cb="pathedit"):b=a},reorient:function(){var a=r[0];if(a&&0!=svgedit.utilities.getRotationAngle(a)){var b=new svgedit.history.BatchCommand("Reorient path"),c={d:a.getAttribute("d"),transform:a.getAttribute("transform")};b.addSubCommand(new svgedit.history.ChangeElementCommand(a,c)),Eb(),this.resetOrientation(a),Q(b),svgedit.path.getPath_(a).show(!1).matrix=null,this.clear(),Fb([a],!0),sb("changed",r)}},clear:function(){if(b=null,j){var a=svgedit.utilities.getElem(qb());$(svgedit.utilities.getElem("path_stretch_line")).remove(),$(a).remove(),$(svgedit.utilities.getElem("pathpointgrip_container")).find("*").attr("display","none"),j=h=null,ab=!1}else"pathedit"==cb&&this.toSelectMode();svgedit.path.path&&svgedit.path.path.init().show(!1)},resetOrientation:function(a){if(null==a||"path"!=a.nodeName)return!1;var b=svgedit.transformlist.getTransformList(a),d=svgedit.math.transformListToTransform(b).matrix;b.clear(),a.removeAttribute("transform"),b=a.pathSegList;var e,f=b.numberOfItems;for(e=0;f>e;++e){var g=b.getItem(e),h=g.pathSegType;if(1!=h){var i=[];$.each(["",1,2],function(a,b){var c=g["x"+b],e=g["y"+b];void 0!==c&&void 0!==e&&(c=svgedit.math.transformPoint(c,e,d),i.splice(i.length,0,c.x,c.y))}),svgedit.path.replacePathSeg(h,e,i,a)}}c(a,d)},zoomChange:function(){"pathedit"==cb&&svgedit.path.path.update()},getNodePoint:function(){var a=svgedit.path.path.segs[svgedit.path.path.selected_pts.length?svgedit.path.path.selected_pts[0]:1];return{x:a.item.x,y:a.item.y,type:a.type}},linkControlPoints:function(a){svgedit.path.setLinkControlPoints(a)},clonePathNode:function(){svgedit.path.path.storeD();for(var a=svgedit.path.path.selected_pts,b=a.length,c=[];b--;){var d=a[b];svgedit.path.path.addSeg(d),c.push(d+b),c.push(d+b+1)}svgedit.path.path.init().addPtsToSelection(c),svgedit.path.path.endChanges("Clone path node(s)")},opencloseSubPath:function(){var a=svgedit.path.path.selected_pts;if(1===a.length){var b=svgedit.path.path.elem,c=b.pathSegList,d=a[0],e=null,f=null;if(svgedit.path.path.eachSeg(function(a){return 2===this.type&&d>=a&&(f=this.item),d>=a?!0:2===this.type?(e=a,!1):1===this.type?e=!1:void 0}),null==e&&(e=svgedit.path.path.segs.length-1),e!==!1){var g=b.createSVGPathSegLinetoAbs(f.x,f.y),h=b.createSVGPathSegClosePath();e==svgedit.path.path.segs.length-1?(c.appendItem(g),c.appendItem(h)):(svgedit.path.insertItemBefore(b,h,e),svgedit.path.insertItemBefore(b,g,e)),svgedit.path.path.init().selectPt(e+1)}else if(svgedit.path.path.segs[d].mate)c.removeItem(d),c.removeItem(d),svgedit.path.path.init().selectPt(d-1);else{for(a=0;a<c.numberOfItems;a++){var i=c.getItem(a);if(2===i.pathSegType)g=a;else if(a===d)c.removeItem(g);else if(1===i.pathSegType&&a>d){h=a-1,c.removeItem(a);break}}for(a=d-g-1;a--;)svgedit.path.insertItemBefore(b,c.getItem(g),h);b=c.getItem(g),svgedit.path.replacePathSeg(2,g,[b.x,b.y]),a=d,svgedit.path.path.init().selectPt(0)}}},deletePathNode:function(){if(ub.canDeleteNodes){svgedit.path.path.storeD();for(var a=svgedit.path.path.selected_pts,b=a.length;b--;)svgedit.path.path.deleteSeg(a[b]);var c=function(){var a=svgedit.path.path.elem.pathSegList,b=a.numberOfItems,d=function(b,c){for(;c--;)a.removeItem(b)};if(1>=b)return!0;for(;b--;){var e=a.getItem(b);if(1===e.pathSegType){e=a.getItem(b-1);var f=a.getItem(b-2);if(2===e.pathSegType){d(b-1,2),c();break}if(2===f.pathSegType){d(b-2,3),c();break}}else if(2===e.pathSegType&&b>0){if(e=a.getItem(b-1).pathSegType,2===e){d(b-1,1),c();break}if(1===e&&a.numberOfItems-1===b){d(b,1),c();break}}}return!1};c(),svgedit.path.path.elem.pathSegList.numberOfItems<=1?(ub.toSelectMode(svgedit.path.path.elem),g.deleteSelectedElements()):(svgedit.path.path.init(),svgedit.path.path.clearSelection(),window.opera&&(a=$(svgedit.path.path.elem),a.attr("d",a.attr("d"))),svgedit.path.path.endChanges("Delete path node(s)"))}},smoothPolylineIntoPath:function(a){var b=a.points,c=b.numberOfItems;if(c>=4){var d=b.getItem(0),e=null,f=[];for(f.push(["M",d.x,",",d.y," C"].join("")),a=1;c-4>=a;a+=3){var g=b.getItem(a),h=b.getItem(a+1),i=b.getItem(a+2);e&&(d=svgedit.path.smoothControlPoints(e,g,d))&&2==d.length&&(g=f[f.length-1].split(","),g[2]=d[0].x,g[3]=d[0].y,f[f.length-1]=g.join(","),g=d[1]),f.push([g.x,g.y,h.x,h.y,i.x,i.y].join(",")),d=i,e=h}for(f.push("L");c>a;)h=b.getItem(a),f.push([h.x,h.y].join(",")),a++;f=f.join(" "),a=s({element:"path",curStyles:!0,attr:{id:qb(),d:f,fill:"none"}})}return a},setSegType:function(a){svgedit.path.path.setSegType(a)},moveNode:function(a,b){var c=svgedit.path.path.selected_pts;if(c.length){svgedit.path.path.storeD(),c=svgedit.path.path.segs[c[0]];var d={x:0,y:0};d[a]=b-c.item[a],c.move(d.x,d.y),svgedit.path.path.endChanges("Move path point")}},fixEnd:function(a){var b,c,d=a.pathSegList,e=d.numberOfItems;for(b=0;e>b;++b){var f=d.getItem(b);if(2===f.pathSegType&&(c=f),1===f.pathSegType&&(f=d.getItem(b-1),f.x!=c.x||f.y!=c.y)){d=a.createSVGPathSegLinetoAbs(c.x,c.y),svgedit.path.insertItemBefore(a,d,b),ub.fixEnd(a);break}}svgedit.browser.isWebkit()&&a.setAttribute("d",ub.convertPath(a))},convertPath:function(a,b){var c,d=a.pathSegList,e=d.numberOfItems,f=0,g=0,h="",i=null;for(c=0;e>c;++c){var j=d.getItem(c),k=j.x||0,l=j.y||0,m=j.x1||0,n=j.y1||0,o=j.x2||0,p=j.y2||0,q=j.pathSegType,r=Bb[q]["to"+(b?"Lower":"Upper")+"Case"](),s=function(a,b,c){b=b?" "+b.join(" "):"",c=c?" "+svgedit.units.shortFloat(c):"",$.each(a,function(b,c){a[b]=svgedit.units.shortFloat(c)}),h+=r+a.join(" ")+b+c};switch(q){case 1:h+="z";break;case 12:k-=f;case 13:b?(f+=k,r="l"):(k+=f,f=k,r="L"),s([[k,g]]);break;case 14:l-=g;case 15:b?(g+=l,r="l"):(l+=g,g=l,r="L"),s([[f,l]]);break;case 2:case 4:case 18:k-=f,l-=g;case 5:case 3:i&&1===d.getItem(c-1).pathSegType&&!b&&(f=i[0],g=i[1]);case 19:b?(f+=k,g+=l):(k+=f,l+=g,f=k,g=l),3===q&&(i=[f,g]),s([[k,l]]);break;case 6:k-=f,m-=f,o-=f,l-=g,n-=g,p-=g;case 7:b?(f+=k,g+=l):(k+=f,m+=f,o+=f,l+=g,n+=g,p+=g,f=k,g=l),s([[m,n],[o,p],[k,l]]);break;case 8:k-=f,m-=f,l-=g,n-=g;case 9:b?(f+=k,g+=l):(k+=f,m+=f,l+=g,n+=g,f=k,g=l),s([[m,n],[k,l]]);break;case 10:k-=f,l-=g;case 11:b?(f+=k,g+=l):(k+=f,l+=g,f=k,g=l),s([[j.r1,j.r2]],[j.angle,j.largeArcFlag?1:0,j.sweepFlag?1:0],[k,l]);break;case 16:k-=f,o-=f,l-=g,p-=g;case 17:b?(f+=k,g+=l):(k+=f,o+=f,l+=g,p+=g,f=k,g=l),s([[o,p],[k,l]])}}return h}}}();var Jb=this.removeUnusedDefElems=function(){var a=j.getElementsByTagNameNS(d.SVG,"defs");if(!a||!a.length)return 0;var b,c,e=[],f=0,g=["fill","stroke","filter","marker-start","marker-mid","marker-end"],h=g.length,i=j.getElementsByTagNameNS(d.SVG,"*"),k=i.length;for(b=0;k>b;b++){var l=i[b];for(c=0;h>c;c++){var m=svgedit.utilities.getUrlFromAttr(l.getAttribute(g[c]));m&&e.push(m.substr(1))}(c=B(l))&&0===c.indexOf("#")&&e.push(c.substr(1))}for(a=$(a).find("linearGradient, radialGradient, filter, marker, svg, symbol"),b=a.length;b--;)g=a[b],h=g.id,e.indexOf(h)<0&&(mb[h]=g,g.parentNode.removeChild(g),f++);return f};this.svgCanvasToString=function(){for(;Jb()>0;);ub.clear(!0),$.each(j.childNodes,function(a,b){a&&8===b.nodeType&&b.data.indexOf("Created with")>=0&&j.insertBefore(b,j.firstChild)}),o&&(Pb(),Gb([o]));var a=[];$(j).find("g:data(gsvg)").each(function(){var b,c=this.attributes,d=c.length;for(b=0;d>b;b++)("id"==c[b].nodeName||"style"==c[b].nodeName)&&d--;0>=d&&(c=this.firstChild,a.push(c),$(this).replaceWith(c))});var b=this.svgToString(j,0);return a.length&&$(a).each(function(){xb(this)}),b},this.svgToString=function(a,b){var c=[],f=svgedit.utilities.toXml,g=e.baseUnit,h=RegExp("^-?[\\d\\.]+"+g+"$");if(a){G(a);var i,j,k=a.attributes,l=a.childNodes;for(j=0;b>j;j++)c.push(" ");if(c.push("<"),c.push(a.nodeName),"svgcontent"===a.id){j=Rb(),"px"!==g&&(j.w=svgedit.units.convertUnit(j.w,g)+g,j.h=svgedit.units.convertUnit(j.h,g)+g),c.push(' width="'+j.w+'" height="'+j.h+'" xmlns="'+d.SVG+'"');var m={};for($(a).find("*").andSelf().each(function(){var a=this.namespaceURI;a&&!m[a]&&J[a]&&"xmlns"!==J[a]&&"xml"!==J[a]&&(m[a]=!0,c.push(" xmlns:"+J[a]+'="'+a+'"')),$.each(this.attributes,function(a,b){var d=b.namespaceURI;d&&!m[d]&&"xmlns"!==J[d]&&"xml"!==J[d]&&(m[d]=!0,c.push(" xmlns:"+J[d]+'="'+d+'"'))})}),j=k.length,g=["width","height","xmlns","x","y","viewBox","id","overflow"];j--;){i=k.item(j);var n=f(i.nodeValue);0!==i.nodeName.indexOf("xmlns:")&&""!=n&&-1==g.indexOf(i.localName)&&(!i.namespaceURI||J[i.namespaceURI])&&(c.push(" "),c.push(i.nodeName),c.push('="'),c.push(n),c.push('"'))
}}else{if("defs"===a.nodeName&&!a.firstChild)return;var o=["-moz-math-font-style","_moz-math-font-style"];for(j=k.length-1;j>=0;j--)if(i=k.item(j),n=f(i.nodeValue),!(o.indexOf(i.localName)>=0||""==n||0===n.indexOf("pointer-events")||"class"===i.localName&&0===n.indexOf("se_"))){if(c.push(" "),"d"===i.localName&&(n=ub.convertPath(a,!0)),isNaN(n)?h.test(n)&&(n=svgedit.units.shortFloat(n)+g):n=svgedit.units.shortFloat(n),_.apply&&"image"===a.nodeName&&"href"===i.localName&&_.images&&"embed"===_.images){var p=X[n];p&&(n=p)}(!i.namespaceURI||i.namespaceURI==d.SVG||J[i.namespaceURI])&&(c.push(i.nodeName),c.push('="'),c.push(n),c.push('"'))}}if(a.hasChildNodes()){for(c.push(">"),b++,k=!1,j=0;j<l.length;j++)switch(g=l.item(j),g.nodeType){case 1:c.push("\n"),c.push(this.svgToString(l.item(j),b));break;case 3:g=g.nodeValue.replace(/^\s+|\s+$/g,""),""!=g&&(k=!0,c.push(String(f(g))));break;case 4:c.push("\n"),c.push(Array(b+1).join(" ")),c.push("<![CDATA["),c.push(g.nodeValue),c.push("]]>");break;case 8:c.push("\n"),c.push(Array(b+1).join(" ")),c.push("<!--"),c.push(g.data),c.push("-->")}if(b--,!k)for(c.push("\n"),j=0;b>j;j++)c.push(" ");c.push("</"),c.push(a.nodeName),c.push(">")}else c.push("/>")}return c.join("")},this.embedImage=function(a,b){$(new Image).load(function(){var c=document.createElement("canvas");c.width=this.width,c.height=this.height,c.getContext("2d").drawImage(this,0,0);try{var d=";svgedit_url="+encodeURIComponent(a);d=c.toDataURL().replace(";base64",d+";base64"),X[a]=d}catch(e){X[a]=!1}Y=a,b&&b(X[a])}).attr("src",a)},this.setGoodImage=function(a){Y=a},this.open=function(){},this.save=function(a){Eb(),a&&$.extend(_,a),_.apply=!0,a=this.svgCanvasToString(),sb("saved",a)},this.rasterExport=function(a,b){var c="image/"+a.toLowerCase();Eb();var d=[],e={feGaussianBlur:S.exportNoBlur,foreignObject:S.exportNoforeignObject,"[stroke-dasharray]":S.exportNoDashArray},f=$(j);"font"in $("<canvas>")[0].getContext("2d")||(e.text=S.exportNoText),$.each(e,function(a,b){f.find(a).length&&d.push(b)}),e=this.svgCanvasToString(),sb("exported",{svg:e,issues:d,type:a,mimeType:c,quality:b})},this.getSvgString=function(){return _.apply=!1,this.svgCanvasToString()},this.randomizeIds=function(a){arguments.length>0&&0==a?svgedit.draw.randomizeIds(!1,m()):svgedit.draw.randomizeIds(!0,m())};var Kb=this.uniquifyElems=function(a){var b={},c=["filter","linearGradient","pattern","radialGradient","symbol","textPath","use"];svgedit.utilities.walkTree(a,function(a){if(1==a.nodeType){a.id&&(a.id in b||(b[a.id]={elem:null,attrs:[],hrefs:[]}),b[a.id].elem=a),$.each(T,function(c,d){var e=a.getAttributeNode(d);if(e){var f=svgedit.utilities.getUrlFromAttr(e.value);(f=f?f.substr(1):null)&&(f in b||(b[f]={elem:null,attrs:[],hrefs:[]}),b[f].attrs.push(e))}});var d=svgedit.utilities.getHref(a);d&&c.indexOf(a.nodeName)>=0&&(d=d.substr(1))&&(d in b||(b[d]={elem:null,attrs:[],hrefs:[]}),b[d].hrefs.push(a))}});for(var d in b)if(d){var e=b[d].elem;if(e){a=rb(),e.id=a,e=b[d].attrs;for(var f=e.length;f--;){var g=e[f];g.ownerElement.setAttribute(g.name,"url(#"+a+")")}for(e=b[d].hrefs,f=e.length;f--;)svgedit.utilities.setHref(e[f],"#"+a)}}},Lb=this.setUseData=function(a){var b=$(a);"use"!==a.tagName&&(b=b.find("use")),b.each(function(){var a=B(this).substr(1);(a=svgedit.utilities.getElem(a))&&($(this).data("ref",a),("symbol"==a.tagName||"svg"==a.tagName)&&$(this).data("symbol",a).data("ref",a))})},Mb=this.convertGradients=function(a){var b=$(a).find("linearGradient, radialGradient");!b.length&&svgedit.browser.isWebkit()&&(b=$(a).find("*").filter(function(){return this.tagName.indexOf("Gradient")>=0})),b.each(function(){if("userSpaceOnUse"===$(this).attr("gradientUnits")){var a=$(j).find('[fill="url(#'+this.id+')"],[stroke="url(#'+this.id+')"]');if(a.length&&(a=svgedit.utilities.getBBox(a[0]))&&"linearGradient"===this.tagName){var b=$(this).attr(["x1","y1","x2","y2"]),c=this.gradientTransform.baseVal;if(c&&c.numberOfItems>0){var d=svgedit.math.transformListToTransform(c).matrix;c=svgedit.math.transformPoint(b.x1,b.y1,d),d=svgedit.math.transformPoint(b.x2,b.y2,d),b.x1=c.x,b.y1=c.y,b.x2=d.x,b.y2=d.y,this.removeAttribute("gradientTransform")}$(this).attr({x1:(b.x1-a.x)/a.width,y1:(b.y1-a.y)/a.height,x2:(b.x2-a.x)/a.width,y2:(b.y2-a.y)/a.height}),this.removeAttribute("gradientUnits")}}})},Nb=this.convertToGroup=function(a){a||(a=r[0]);var b,c=$(a),e=new svgedit.history.BatchCommand;if(c.data("gsvg")){e=$(a.firstChild).attr(["x","y"]),$(a.firstChild.firstChild).unwrap(),$(a).removeData("gsvg"),b=svgedit.transformlist.getTransformList(a);var f=i.createSVGTransform();f.setTranslate(e.x,e.y),b.appendItem(f),svgedit.recalculate.recalculateDimensions(a),sb("selected",[a])}else if(c.data("symbol")){a=c.data("symbol"),b=c.attr("transform"),f=c.attr(["x","y"]);var g=a.getAttribute("viewBox");g&&(g=g.split(" "),f.x-=+g[0],f.y-=+g[1]),b+=" translate("+(f.x||0)+","+(f.y||0)+")",f=c.prev(),e.addSubCommand(new svgedit.history.RemoveElementCommand(c[0],c[0].nextSibling,c[0].parentNode)),c.remove(),g=$(j).find("use:data(symbol)").length,c=h.createElementNS(d.SVG,"g");var k,l=a.childNodes;for(k=0;k<l.length;k++)c.appendChild(l[k].cloneNode(!0));svgedit.browser.isGecko()&&(l=$(svgedit.utilities.findDefs()).children("linearGradient,radialGradient,pattern").clone(),$(c).append(l)),b&&c.setAttribute("transform",b),b=a.parentNode,Kb(c),svgedit.browser.isGecko()&&$(z()).append($(c).find("linearGradient,radialGradient,pattern")),c.id=rb(),f.after(c),b&&(g||(f=a.nextSibling,b.removeChild(a),e.addSubCommand(new svgedit.history.RemoveElementCommand(a,f,b))),e.addSubCommand(new svgedit.history.InsertElementCommand(c))),Lb(c),Mb(svgedit.browser.isGecko()?svgedit.utilities.findDefs():c),svgedit.utilities.walkTreePost(c,function(a){try{svgedit.recalculate.recalculateDimensions(a)}catch(b){console.log(b)}}),$(c).find("a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use").each(function(){this.id||(this.id=rb())}),Gb([c]),(a=Wb(c,!0))&&e.addSubCommand(a),Q(e)}else console.log("Unexpected element to ungroup:",a)};this.setSvgString=function(a){try{var b=svgedit.utilities.text2xml(a);this.prepareSvg(b);var c=new svgedit.history.BatchCommand("Change Source"),f=j.nextSibling,l=i.removeChild(j);c.addSubCommand(new svgedit.history.RemoveElementCommand(l,f,i)),j=h.adoptNode?h.adoptNode(b.documentElement):h.importNode(b.documentElement,!0),i.appendChild(j);var o=$(j);g.current_drawing_=new svgedit.draw.Drawing(j,k);var p=m().getNonce();p?sb("setnonce",p):sb("unsetnonce"),o.find("image").each(function(){var a=this;Ib(a);var b=B(this);if(b){if(0===b.indexOf("data:")){var c=b.match(/svgedit_url=(.*?);/);if(c){var e=decodeURIComponent(c[1]);$(new Image).load(function(){a.setAttributeNS(d.XLINK,"xlink:href",e)}).attr("src",e)}}g.embedImage(b)}}),o.find("svg").each(function(){if(!$(this).closest("defs").length){Kb(this);var a=this.parentNode;1===a.childNodes.length&&"g"===a.nodeName?($(a).data("gsvg",this),a.id=a.id||rb()):xb(this)}}),svgedit.browser.isGecko()&&o.find("linearGradient, radialGradient, pattern").appendTo(svgedit.utilities.findDefs()),Lb(o),Mb(o[0]),svgedit.utilities.walkTreePost(j,function(a){try{svgedit.recalculate.recalculateDimensions(a)}catch(b){console.log(b)}});var q={id:"svgcontent",overflow:e.show_outside_canvas?"visible":"hidden"},r=!1;if(o.attr("viewBox")){var s=o.attr("viewBox").split(" ");q.width=s[2],q.height=s[3]}else $.each(["width","height"],function(a,b){var c=o.attr(b);c||(c="100%"),"%"===String(c).substr(-1)?r=!0:q[b]=svgedit.units.convertToNum(b,c)});if(Ob(),o.children().find("a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use").each(function(){this.id||(this.id=rb())}),r){var t=getStrokedBBox();q.width=t.width+t.x,q.height=t.height+t.y}q.width<=0&&(q.width=100),q.height<=0&&(q.height=100),o.attr(q),this.contentW=q.width,this.contentH=q.height,c.addSubCommand(new svgedit.history.InsertElementCommand(j));var u=o.attr(["width","height"]);c.addSubCommand(new svgedit.history.ChangeElementCommand(i,u)),n=1,svgedit.transformlist.resetListMap(),Eb(),svgedit.path.clearData(),i.appendChild(R.selectorParentGroup),Q(c),sb("changed",[j])}catch(v){return console.log(v),!1}return!0},this.importSvgString=function(a){var b,c;try{var e=svgedit.utilities.encode64(a.length+a).substr(0,32),f=!1;eb[e]&&$(eb[e].symbol).parents("#svgroot").length&&(f=!0);var g,i=new svgedit.history.BatchCommand("Import SVG");if(f)g=eb[e].symbol,c=eb[e].xform;else{var k=svgedit.utilities.text2xml(a);this.prepareSvg(k);var l;l=h.adoptNode?h.adoptNode(k.documentElement):h.importNode(k.documentElement,!0),Kb(l);var n=svgedit.units.convertToNum("width",l.getAttribute("width")),p=svgedit.units.convertToNum("height",l.getAttribute("height")),q=l.getAttribute("viewBox"),r=q?q.split(" "):[0,0,n,p];for(b=0;4>b;++b)r[b]=+r[b];j.getAttribute("width");var s=+j.getAttribute("height");c=p>n?"scale("+s/3/r[3]+")":"scale("+s/3/r[2]+")",c="translate(0) "+c+" translate(0)",g=h.createElementNS(d.SVG,"symbol");var t=svgedit.utilities.findDefs();for(svgedit.browser.isGecko()&&$(l).find("linearGradient, radialGradient, pattern").appendTo(t);l.firstChild;)g.appendChild(l.firstChild);var u,v=l.attributes;for(u=0;u<v.length;u++){var w=v[u];g.setAttribute(w.nodeName,w.nodeValue)}g.id=rb(),eb[e]={symbol:g,xform:c},svgedit.utilities.findDefs().appendChild(g),i.addSubCommand(new svgedit.history.InsertElementCommand(g))}var x=h.createElementNS(d.SVG,"use");x.id=rb(),C(x,"#"+g.id),(o||m().getCurrentLayer()).appendChild(x),i.addSubCommand(new svgedit.history.InsertElementCommand(x)),Eb(),x.setAttribute("transform",c),svgedit.recalculate.recalculateDimensions(x),$(x).data("symbol",g).data("ref",g),Fb([x]),Q(i),sb("changed",[j])}catch(y){return console.log(y),!1}return!0};var Ob=g.identifyLayers=function(){Pb(),m().identifyLayers()};this.createLayer=function(a){var b=new svgedit.history.BatchCommand("Create Layer");a=m().createLayer(a),b.addSubCommand(new svgedit.history.InsertElementCommand(a)),Q(b),Eb(),sb("changed",[a])},this.cloneLayer=function(a){var b=new svgedit.history.BatchCommand("Duplicate Layer"),c=h.createElementNS(d.SVG,"g"),e=h.createElementNS(d.SVG,"title");e.textContent=a,c.appendChild(e),e=m().getCurrentLayer(),$(e).after(c),e=e.childNodes;var f;for(f=0;f<e.length;f++){var i=e[f];"title"!=i.localName&&c.appendChild(yb(i))}Eb(),Ob(),b.addSubCommand(new svgedit.history.InsertElementCommand(c)),Q(b),g.setCurrentLayer(a),sb("changed",[c])},this.deleteCurrentLayer=function(){var a=m().getCurrentLayer(),b=a.nextSibling,c=a.parentNode;if(a=m().deleteCurrentLayer()){var d=new svgedit.history.BatchCommand("Delete Layer");return d.addSubCommand(new svgedit.history.RemoveElementCommand(a,b,c)),Q(d),Eb(),sb("changed",[c]),!0}return!1},this.setCurrentLayer=function(a){return(a=m().setCurrentLayer(svgedit.utilities.toXml(a)))&&Eb(),a},this.renameCurrentLayer=function(a){var b,c=m();if(c.current_layer){var d=c.current_layer;if(!g.setCurrentLayer(a)){var e=new svgedit.history.BatchCommand("Rename Layer");for(b=0;b<c.getNumLayers()&&c.all_layers[b][1]!=d;++b);var f=c.getLayerName(b);c.all_layers[b][0]=svgedit.utilities.toXml(a);var h=d.childNodes.length;for(b=0;h>b;++b){var i=d.childNodes.item(b);if(i&&"title"==i.tagName){for(;i.firstChild;)i.removeChild(i.firstChild);return i.textContent=a,e.addSubCommand(new svgedit.history.ChangeElementCommand(i,{"#text":f})),Q(e),sb("changed",[d]),!0}}}c.current_layer=d}return!1},this.setCurrentLayerPosition=function(a){var b,c=m();if(c.current_layer&&a>=0&&a<c.getNumLayers()){for(b=0;b<c.getNumLayers()&&c.all_layers[b][1]!=c.current_layer;++b);if(b==c.getNumLayers())return!1;if(b!=a){var d=null,e=c.current_layer.nextSibling;return a>b?a<c.getNumLayers()-1&&(d=c.all_layers[a+1][1]):d=c.all_layers[a][1],j.insertBefore(c.current_layer,d),Q(new svgedit.history.MoveElementCommand(c.current_layer,e,j)),Ob(),g.setCurrentLayer(c.getLayerName(a)),!0}}return!1},this.setLayerVisibility=function(a,b){var c=m(),d=c.getLayerVisibility(a),e=c.setLayerVisibility(a,b);return e?(Q(new svgedit.history.ChangeElementCommand(e,{display:d?"inline":"none"},"Layer Visibility")),e==c.getCurrentLayer()&&(Eb(),ub.clear()),!0):!1},this.moveSelectedToLayer=function(a){var b,c=null,d=m();for(b=0;b<d.getNumLayers();++b)if(d.getLayerName(b)==a){c=d.all_layers[b][1];break}if(!c)return!1;for(a=new svgedit.history.BatchCommand("Move Elements to Layer"),d=r,b=d.length;b--;){var e=d[b];if(e){var f=e.nextSibling,g=e.parentNode;c.appendChild(e),a.addSubCommand(new svgedit.history.MoveElementCommand(e,f,g))}}return Q(a),!0},this.mergeLayer=function(a){var b=new svgedit.history.BatchCommand("Merge Layer"),c=m(),d=$(c.current_layer).prev()[0];if(d){for(b.addSubCommand(new svgedit.history.RemoveElementCommand(c.current_layer,c.current_layer.nextSibling,j));c.current_layer.firstChild;){var e=c.current_layer.firstChild;if("title"==e.localName)b.addSubCommand(new svgedit.history.RemoveElementCommand(e,e.nextSibling,c.current_layer)),c.current_layer.removeChild(e);else{var f=e.nextSibling;d.appendChild(e),b.addSubCommand(new svgedit.history.MoveElementCommand(e,f,c.current_layer))}}return j.removeChild(c.current_layer),a||(Eb(),Ob(),sb("changed",[j]),Q(b)),c.current_layer=d,b}},this.mergeAllLayers=function(){var a=new svgedit.history.BatchCommand("Merge all Layers"),b=m();for(b.current_layer=b.all_layers[b.getNumLayers()-1][1];$(j).children("g").length>1;)a.addSubCommand(g.mergeLayer(!0));Eb(),Ob(),sb("changed",[j]),Q(a)};var Pb=this.leaveContext=function(){var a,b=Z.length;if(b){for(a=0;b>a;a++){var c=Z[a],d=U(c,"orig_opac");1!==d?c.setAttribute("opacity",d):c.removeAttribute("opacity"),c.setAttribute("style","pointer-events: inherit")}Z=[],Eb(!0),sb("contextset",null)}o=null},Qb=this.setContext=function(a){Pb(),"string"==typeof a&&(a=svgedit.utilities.getElem(a)),o=a,$(a).parentsUntil("#svgcontent").andSelf().siblings().each(function(){var a=this.getAttribute("opacity")||1;U(this,"orig_opac",a),this.setAttribute("opacity",.33*a),this.setAttribute("style","pointer-events: none"),Z.push(this)}),Eb(),sb("contextset",o)};this.clear=function(){ub.clear(),Eb(),g.clearSvgContentElement(),g.current_drawing_=new svgedit.draw.Drawing(j),g.createLayer("Layer 1"),g.undoMgr.resetUndoStack(),R.initGroup(),ib=R.getRubberBandBox(),sb("cleared")},this.linkControlPoints=ub.linkControlPoints,this.getContentElem=function(){return j},this.getRootElem=function(){return i},this.getSelectedElems=function(){return r};var Rb=this.getResolution=function(){var a=j.getAttribute("width")/n,b=j.getAttribute("height")/n;return{w:a,h:b,zoom:n}};this.getZoom=function(){return n},this.getVersion=function(){return"svgcanvas.js ($Rev: 2705 $)"},this.setUiStrings=function(a){$.extend(S,a.notification)},this.setConfig=function(a){$.extend(e,a)},this.getTitle=function(a){if(a=a||r[0]){a=$(a).data("gsvg")||$(a).data("symbol")||a;var b=a.childNodes;for(a=0;a<b.length;a++)if("title"==b[a].nodeName)return b[a].textContent;return""}},this.setGroupTitle=function(a){var b=r[0];b=$(b).data("gsvg")||b;var c=$(b).children("title"),e=new svgedit.history.BatchCommand("Set Label");a.length?c.length?(c=c[0],e.addSubCommand(new svgedit.history.ChangeElementCommand(c,{"#text":c.textContent})),c.textContent=a):(c=h.createElementNS(d.SVG,"title"),c.textContent=a,$(b).prepend(c),e.addSubCommand(new svgedit.history.InsertElementCommand(c))):(e.addSubCommand(new svgedit.history.RemoveElementCommand(c[0],c.nextSibling,b)),c.remove()),Q(e)},this.getDocumentTitle=function(){return g.getTitle(j)},this.setDocumentTitle=function(a){var b,c=j.childNodes,e=!1,f="",g=new svgedit.history.BatchCommand("Change Image Title");for(b=0;b<c.length;b++)if("title"==c[b].nodeName){e=c[b],f=e.textContent;break}e||(e=h.createElementNS(d.SVG,"title"),j.insertBefore(e,j.firstChild)),a.length?e.textContent=a:e.parentNode.removeChild(e),g.addSubCommand(new svgedit.history.ChangeElementCommand(e,{"#text":f})),Q(g)},this.getEditorNS=function(a){return a&&j.setAttribute("xmlns:se",d.SE),d.SE},this.setResolution=function(a,b){var c=Rb(),d=c.w;c=c.h;var e;if("fit"==a){var f=getStrokedBBox();if(!f)return!1;e=new svgedit.history.BatchCommand("Fit Canvas to Content");var h=vb();Fb(h);var k=[],l=[];$.each(h,function(){k.push(-1*f.x),l.push(-1*f.y)}),h=g.moveSelectedElements(k,l,!0),e.addSubCommand(h),Eb(),a=Math.round(f.width),b=Math.round(f.height)}return(a!=d||b!=c)&&(h=i.suspendRedraw(1e3),e||(e=new svgedit.history.BatchCommand("Change Image Dimensions")),a=svgedit.units.convertToNum("width",a),b=svgedit.units.convertToNum("height",b),j.setAttribute("width",a),j.setAttribute("height",b),this.contentW=a,this.contentH=b,e.addSubCommand(new svgedit.history.ChangeElementCommand(j,{width:d,height:c})),j.setAttribute("viewBox",[0,0,a/n,b/n].join(" ")),e.addSubCommand(new svgedit.history.ChangeElementCommand(j,{viewBox:["0 0",d,c].join(" ")})),Q(e),i.unsuspendRedraw(h),sb("changed",[j])),!0},this.getOffset=function(){return $(j).attr(["x","y"])},this.setBBoxZoom=function(a,b,c){var d=.85,e=function(a){if(!a)return!1;var e=Math.min(Math.round(b/a.width*100*d)/100,Math.round(c/a.height*100*d)/100);return g.setZoom(e),{zoom:e,bbox:a}};if("object"==typeof a)return a=a,0==a.width||0==a.height?(g.setZoom(a.zoom?a.zoom:n*a.factor),{zoom:n,bbox:a}):e(a);switch(a){case"selection":if(!r[0])return;a=$.map(r,function(a){return a?a:void 0}),a=getStrokedBBox(a);break;case"canvas":a=Rb(),d=.95,a={width:a.w,height:a.h,x:0,y:0};break;case"content":a=getStrokedBBox();break;case"layer":a=getStrokedBBox(vb(m().getCurrentLayer()));break;default:return}return e(a)},this.setZoom=function(a){var b=Rb();j.setAttribute("viewBox","0 0 "+b.w/a+" "+b.h/a),n=a,$.each(r,function(a,b){b&&R.requestSelector(b).resize()}),ub.zoomChange(),nb("zoomChanged",a)},this.getMode=function(){return cb},this.setMode=function(a){ub.clear(!0),tb.clear(),gb=r[0]&&"text"==r[0].nodeName?fb:q,cb=a},this.getColor=function(a){return gb[a]},this.setColor=function(a,b,c){function d(a){"g"!=a.nodeName&&e.push(a)}q[a]=b,gb[a+"_paint"]={type:"solidColor"};for(var e=[],f=r.length;f--;){var g=r[f];g&&("g"==g.tagName?svgedit.utilities.walkTree(g,d):"fill"==a?"polyline"!=g.tagName&&"line"!=g.tagName&&e.push(g):e.push(g))}e.length>0&&(c?Ub(a,b,e):(Vb(a,b,e),sb("changed",e)))};var Sb=this.setGradient=function(a){if(gb[a+"_paint"]&&"solidColor"!=gb[a+"_paint"].type){var b=g[a+"Grad"],c=Tb(b),d=svgedit.utilities.findDefs();c?b=c:(b=d.appendChild(h.importNode(b,!0)),b.id=rb()),g.setColor(a,"url(#"+b.id+")")}},Tb=function(a){var b=svgedit.utilities.findDefs();b=$(b).find("linearGradient, radialGradient");for(var c=b.length,e=["r","cx","cy","fx","fy"];c--;){var f=b[c];if("linearGradient"==a.tagName){if(a.getAttribute("x1")!=f.getAttribute("x1")||a.getAttribute("y1")!=f.getAttribute("y1")||a.getAttribute("x2")!=f.getAttribute("x2")||a.getAttribute("y2")!=f.getAttribute("y2"))continue}else{var g=$(a).attr(e),h=$(f).attr(e),i=!1;if($.each(e,function(a,b){g[b]!=h[b]&&(i=!0)}),i)continue}var j=a.getElementsByTagNameNS(d.SVG,"stop"),k=f.getElementsByTagNameNS(d.SVG,"stop");if(j.length==k.length){for(var l=j.length;l--;){var m=j[l],n=k[l];if(m.getAttribute("offset")!=n.getAttribute("offset")||m.getAttribute("stop-opacity")!=n.getAttribute("stop-opacity")||m.getAttribute("stop-color")!=n.getAttribute("stop-color"))break}if(-1==l)return f}}return null};this.setPaint=function(a,b){var c=new $.jGraduate.Paint(b);switch(this.setPaintOpacity(a,c.alpha/100,!0),gb[a+"_paint"]=c,c.type){case"solidColor":this.setColor(a,"none"!=c.solidColor?"#"+c.solidColor:"none");break;case"linearGradient":case"radialGradient":g[a+"Grad"]=c[c.type],Sb(a)}},this.setStrokePaint=function(a){this.setPaint("stroke",a)},this.setFillPaint=function(a){this.setPaint("fill",a)},this.getStrokeWidth=function(){return gb.stroke_width},this.setStrokeWidth=function(a){function b(a){"g"!=a.nodeName&&c.push(a)}if(0==a&&["line","path"].indexOf(cb)>=0)g.setStrokeWidth(1);else{gb.stroke_width=a;for(var c=[],d=r.length;d--;){var e=r[d];e&&("g"==e.tagName?svgedit.utilities.walkTree(e,b):c.push(e))}c.length>0&&(Vb("stroke-width",a,c),sb("changed",r))}},this.setStrokeAttr=function(a,b){q[a.replace("-","_")]=b;for(var c=[],d=r.length;d--;){var e=r[d];e&&("g"==e.tagName?svgedit.utilities.walkTree(e,function(a){"g"!=a.nodeName&&c.push(a)}):c.push(e))}c.length>0&&(Vb(a,b,c),sb("changed",r))},this.getStyle=function(){return q},this.getOpacity=function(){return q.opacity},this.setOpacity=function(a){q.opacity=a,Vb("opacity",a)},this.getFillOpacity=function(){return q.fill_opacity},this.getStrokeOpacity=function(){return q.stroke_opacity},this.setPaintOpacity=function(a,b,c){q[a+"_opacity"]=b,c?Ub(a+"-opacity",b):Vb(a+"-opacity",b)},this.getPaintOpacity=function(a){return"fill"===a?this.getFillOpacity():this.getStrokeOpacity()},this.getBlur=function(a){var b=0;return a&&a.getAttribute("filter")&&(a=svgedit.utilities.getElem(a.id+"_blur"))&&(b=a.firstChild.getAttribute("stdDeviation")),b},function(){function a(){var a=g.undoMgr.finishUndoableChange();b.addSubCommand(a),Q(b),c=b=null}var b=null,c=null,d=!1;g.setBlurNoUndo=function(a){if(c)if(0===a)Ub("filter",""),d=!0;else{var b=r[0];d&&Ub("filter","url(#"+b.id+"_blur)"),svgedit.browser.isWebkit()&&(console.log("e",b),b.removeAttribute("filter"),b.setAttribute("filter","url(#"+b.id+"_blur)")),Ub("stdDeviation",a,[c.firstChild]),g.setBlurOffsets(c,a)}else g.setBlur(a)},g.setBlurOffsets=function(a,b){b>3?svgedit.utilities.assignAttributes(a,{x:"-50%",y:"-50%",width:"200%",height:"200%"},100):svgedit.browser.isWebkit()||(a.removeAttribute("x"),a.removeAttribute("y"),a.removeAttribute("width"),a.removeAttribute("height"))},g.setBlur=function(d,e){if(b)a();else{var f=r[0],h=f.id;c=svgedit.utilities.getElem(h+"_blur"),d-=0;var i=new svgedit.history.BatchCommand;if(c)0===d&&(c=null);else{var j=s({element:"feGaussianBlur",attr:{"in":"SourceGraphic",stdDeviation:d}});c=s({element:"filter",attr:{id:h+"_blur"}}),c.appendChild(j),svgedit.utilities.findDefs().appendChild(c),i.addSubCommand(new svgedit.history.InsertElementCommand(c))}j={filter:f.getAttribute("filter")},0===d?(f.removeAttribute("filter"),i.addSubCommand(new svgedit.history.ChangeElementCommand(f,j))):(Vb("filter","url(#"+h+"_blur)"),i.addSubCommand(new svgedit.history.ChangeElementCommand(f,j)),g.setBlurOffsets(c,d),b=i,g.undoMgr.beginUndoableChange("stdDeviation",[c?c.firstChild:null]),e&&(g.setBlurNoUndo(d),a()))}}}(),this.getBold=function(){var a=r[0];return null!=a&&"text"==a.tagName&&null==r[1]?"bold"==a.getAttribute("font-weight"):!1},this.setBold=function(a){var b=r[0];null!=b&&"text"==b.tagName&&null==r[1]&&Vb("font-weight",a?"bold":"normal"),r[0].textContent||tb.setCursor()},this.getItalic=function(){var a=r[0];return null!=a&&"text"==a.tagName&&null==r[1]?"italic"==a.getAttribute("font-style"):!1},this.setItalic=function(a){var b=r[0];null!=b&&"text"==b.tagName&&null==r[1]&&Vb("font-style",a?"italic":"normal"),r[0].textContent||tb.setCursor()},this.getFontFamily=function(){return fb.font_family},this.setFontFamily=function(a){fb.font_family=a,Vb("font-family",a),r[0]&&!r[0].textContent&&tb.setCursor()},this.setFontColor=function(a){fb.fill=a,Vb("fill",a)},this.getFontColor=function(){return fb.fill},this.getFontSize=function(){return fb.font_size},this.setFontSize=function(a){fb.font_size=a,Vb("font-size",a),r[0].textContent||tb.setCursor()},this.getText=function(){var a=r[0];return null==a?"":a.textContent},this.setTextContent=function(a){Vb("#text",a),tb.init(a),tb.setCursor()},this.setImageURL=function(a){var b=r[0];if(b){var c=$(b).attr(["width","height"]);c=!c.width||!c.height;var d=B(b);if(d!==a)c=!0;else if(!c)return;var e=new svgedit.history.BatchCommand("Change Image URL");C(b,a),e.addSubCommand(new svgedit.history.ChangeElementCommand(b,{"#href":d})),c?$(new Image).load(function(){var a=$(b).attr(["width","height"]);$(b).attr({width:this.width,height:this.height}),R.requestSelector(b).resize(),e.addSubCommand(new svgedit.history.ChangeElementCommand(b,a)),Q(e),sb("changed",[b])}).attr("src",a):Q(e)}},this.setLinkURL=function(a){var b=r[0];if(b){if("a"!==b.tagName){if(b=$(b).parents("a"),!b.length)return;b=b[0]}var c=B(b);if(c!==a){var d=new svgedit.history.BatchCommand("Change Link URL");C(b,a),d.addSubCommand(new svgedit.history.ChangeElementCommand(b,{"#href":c})),Q(d)}}},this.setRectRadius=function(a){var b=r[0];if(null!=b&&"rect"==b.tagName){var c=b.getAttribute("rx");c!=a&&(b.setAttribute("rx",a),b.setAttribute("ry",a),Q(new svgedit.history.ChangeElementCommand(b,{rx:c,ry:c},"Radius")),sb("changed",[b]))}},this.makeHyperlink=function(a){g.groupSelectedElements("a",a)},this.removeHyperlink=function(){g.ungroupSelectedElement()},this.setSegType=function(a){ub.setSegType(a)},this.convertToPath=function(a,b){if(null==a)$.each(r,function(a,b){b&&g.convertToPath(b)});else{if(!b)var c=new svgedit.history.BatchCommand("Convert element to Path");var d=b?{}:{fill:q.fill,"fill-opacity":q.fill_opacity,stroke:q.stroke,"stroke-width":q.stroke_width,"stroke-dasharray":q.stroke_dasharray,"stroke-linejoin":q.stroke_linejoin,"stroke-linecap":q.stroke_linecap,"stroke-opacity":q.stroke_opacity,opacity:q.opacity,visibility:"hidden"};$.each(["marker-start","marker-end","marker-mid","filter","clip-path"],function(){a.getAttribute(this)&&(d[this]=a.getAttribute(this))});var e=s({element:"path",attr:d}),f=a.getAttribute("transform");f&&e.setAttribute("transform",f);var h=a.id,i=a.parentNode;a.nextSibling?i.insertBefore(e,a):i.appendChild(e);var j,k,l="",m=function(a){$.each(a,function(a,b){var c,d=b[1];for(l+=b[0],c=0;c<d.length;c+=2)l+=d[c]+","+d[c+1]+" "})},n=1.81;switch(a.tagName){case"ellipse":case"circle":j=$(a).attr(["rx","ry","cx","cy"]);var o=j.cx,p=j.cy;k=j.rx,ry=j.ry,"circle"==a.tagName&&(k=ry=$(a).attr("r")),m([["M",[o-k,p]],["C",[o-k,p-ry/n,o-k/n,p-ry,o,p-ry]],["C",[o+k/n,p-ry,o+k,p-ry/n,o+k,p]],["C",[o+k,p+ry/n,o+k/n,p+ry,o,p+ry]],["C",[o-k/n,p+ry,o-k,p+ry/n,o-k,p]],["Z",[]]]);break;case"path":l=a.getAttribute("d");break;case"line":j=$(a).attr(["x1","y1","x2","y2"]),l="M"+j.x1+","+j.y1+"L"+j.x2+","+j.y2;break;case"polyline":case"polygon":l="M"+a.getAttribute("points");break;case"rect":j=$(a).attr(["rx","ry"]),k=j.rx,ry=j.ry;var t=a.getBBox();j=t.x,o=t.y,p=t.width,t=t.height,n=4-n,m(k||ry?[["M",[j,o+ry]],["C",[j,o+ry/n,j+k/n,o,j+k,o]],["L",[j+p-k,o]],["C",[j+p-k/n,o,j+p,o+ry/n,j+p,o+ry]],["L",[j+p,o+t-ry]],["C",[j+p,o+t-ry/n,j+p-k/n,o+t,j+p-k,o+t]],["L",[j+k,o+t]],["C",[j+k/n,o+t,j,o+t-ry/n,j,o+t-ry]],["L",[j,o+ry]],["Z",[]]]:[["M",[j,o]],["L",[j+p,o]],["L",[j+p,o+t]],["L",[j,o+t]],["L",[j,o]],["Z",[]]]);break;default:e.parentNode.removeChild(e)}if(l&&e.setAttribute("d",l),b){ub.resetOrientation(e),c=!1;try{c=e.getBBox()}catch(u){}return e.parentNode.removeChild(e),c}f&&(f=svgedit.transformlist.getTransformList(e),svgedit.math.hasMatrixTransform(f)&&ub.resetOrientation(e)),c.addSubCommand(new svgedit.history.RemoveElementCommand(a,a.nextSibling,i)),c.addSubCommand(new svgedit.history.InsertElementCommand(e)),Eb(),a.parentNode.removeChild(a),e.setAttribute("id",h),e.removeAttribute("visibility"),Fb([e],!0),Q(c)}};var Ub=function(a,b,c){var d=i.suspendRedraw(1e3);"pathedit"==cb&&ub.moveNode(a,b),c=c||r;for(var e=c.length,f=["g","polyline","path"],h=["transform","opacity","filter"];e--;){var j=c[e];if(null!=j)if(("x"===a||"y"===a)&&f.indexOf(j.tagName)>=0){var k=getStrokedBBox([j]);g.moveSelectedElements(("x"===a?b-k.x:0)*n,("y"===a?b-k.y:0)*n,!0)}else if("g"===j.tagName&&h.indexOf(a),k="#text"===a?j.textContent:j.getAttribute(a),null==k&&(k=""),k!==String(b)&&("#text"==a?(svgedit.utilities.getBBox(j),j.textContent=b,/rotate/.test(j.getAttribute("transform"))&&(j=zb(j))):"#href"==a?C(j,b):j.setAttribute(a,b),"textedit"===cb&&"#text"!==a&&j.textContent.length&&tb.toSelectMode(j),svgedit.browser.isGecko()&&"text"===j.nodeName&&/rotate/.test(j.getAttribute("transform"))&&(0===String(b).indexOf("url")||["font-size","font-family","x","y"].indexOf(a)>=0&&j.textContent)&&(j=zb(j)),r.indexOf(j)>=0&&setTimeout(function(){j.parentNode&&R.requestSelector(j).resize()},0),k=svgedit.utilities.getRotationAngle(j),0!=k&&"transform"!=a))for(var l=svgedit.transformlist.getTransformList(j),m=l.numberOfItems;m--;)if(4==l.getItem(m).type){l.removeItem(m);var o=svgedit.utilities.getBBox(j),p=svgedit.math.transformPoint(o.x+o.width/2,o.y+o.height/2,svgedit.math.transformListToTransform(l).matrix);o=p.x,p=p.y;var q=i.createSVGTransform();q.setRotate(k,o,p),l.insertItemBefore(q,m);break}}i.unsuspendRedraw(d)},Vb=this.changeSelectedAttribute=function(a,b,c){c=c||r,g.undoMgr.beginUndoableChange(a,c),Ub(a,b,c),a=g.undoMgr.finishUndoableChange(),a.isEmpty()||Q(a)};this.deleteSelectedElements=function(){var a,b=new svgedit.history.BatchCommand("Delete Elements"),c=r.length,d=[];for(a=0;c>a;++a){var e=r[a];if(null==e)break;var f=e.parentNode,g=e;R.releaseSelector(g),svgedit.path.removePath_(g.id),"a"===f.tagName&&1===f.childNodes.length&&(g=f,f=f.parentNode);var h=g.nextSibling;g=f.removeChild(g),d.push(e),r[a]=null,b.addSubCommand(new N(g,h,f))}b.isEmpty()||Q(b),sb("changed",d),Eb()},this.cutSelectedElements=function(){var a,b=new svgedit.history.BatchCommand("Cut Elements"),c=r.length,d=[];for(a=0;c>a;++a){var e=r[a];if(null==e)break;var f=e.parentNode,h=e;R.releaseSelector(h),svgedit.path.removePath_(h.id);var i=h.nextSibling;h=f.removeChild(h),d.push(e),r[a]=null,b.addSubCommand(new N(h,i,f))}b.isEmpty()||Q(b),sb("changed",d),Eb(),g.clipBoard=d},this.copySelectedElements=function(){g.clipBoard=$.merge([],r)},this.pasteElements=function(a,b,c){var d=g.clipBoard,e=d.length;if(e){for(var f=[],h=new svgedit.history.BatchCommand("Paste elements");e--;){var i=d[e];if(i){var j=yb(i);svgedit.utilities.getElem(i.id)||(j.id=i.id),f.push(j),(o||m().getCurrentLayer()).appendChild(j),h.addSubCommand(new svgedit.history.InsertElementCommand(j))}}if(Gb(f),"in_place"!==a){var k,l;a?"point"===a&&(k=b,l=c):(k=lb.x,l=lb.y),a=getStrokedBBox(f);var n=k-(a.x+a.width/2),p=l-(a.y+a.height/2),q=[],r=[];$.each(f,function(){q.push(n),r.push(p)}),k=g.moveSelectedElements(q,r,!1),h.addSubCommand(k)}Q(h),sb("changed",f)}},this.groupSelectedElements=function(a,b){a||(a="g");var c="";switch(a){case"a":c="Make hyperlink";var d="";arguments.length>1&&(d=b);break;default:a="g",c="Group Elements"}c=new svgedit.history.BatchCommand(c);var e=s({element:a,attr:{id:rb()}});for("a"===a&&C(e,d),c.addSubCommand(new svgedit.history.InsertElementCommand(e)),d=r.length;d--;){var f=r[d];if(null!=f){"a"===f.parentNode.tagName&&1===f.parentNode.childNodes.length&&(f=f.parentNode);var g=f.nextSibling,h=f.parentNode;e.appendChild(f),c.addSubCommand(new svgedit.history.MoveElementCommand(f,g,h))}}c.isEmpty()||Q(c),Gb([e],!0)};var Wb=this.pushGroupProperties=function(a,b){var c,d,e,f=a.childNodes,h=f.length,j=a.getAttribute("transform"),k=svgedit.transformlist.getTransformList(a),l=svgedit.math.transformListToTransform(k).matrix,m=new svgedit.history.BatchCommand("Push group properties"),n=0,o=svgedit.utilities.getRotationAngle(a),p=$(a).attr(["filter","opacity"]);for(n=0;h>n;n++){var q=f[n];if(1===q.nodeType){if(null!==p.opacity&&1!==p.opacity){q.getAttribute("opacity");var r=Math.round((q.getAttribute("opacity")||1)*p.opacity*100)/100;Vb("opacity",r,[q])}if(p.filter&&(e=r=this.getBlur(q),d||(d=this.getBlur(a)),r?r=Number(d)+Number(r):0===r&&(r=d),e?c=svgedit.utilities.getRefElem(q.getAttribute("filter")):c?(c=yb(c),svgedit.utilities.findDefs().appendChild(c)):c=svgedit.utilities.getRefElem(p.filter),c.id=q.id+"_"+("feGaussianBlur"===c.firstChild.tagName?"blur":"filter"),Vb("filter","url(#"+c.id+")",[q]),r&&(Vb("stdDeviation",r,[c.firstChild]),g.setBlurOffsets(c,r))),r=svgedit.transformlist.getTransformList(q),~q.tagName.indexOf("Gradient")&&(r=null),r&&"defs"!==q.tagName&&k.numberOfItems){if(o&&1==k.numberOfItems){var s=k.getItem(0).matrix,t=i.createSVGMatrix();(e=svgedit.utilities.getRotationAngle(q))&&(t=r.getItem(0).matrix);var u=svgedit.utilities.getBBox(q),v=svgedit.math.transformListToTransform(r).matrix,w=svgedit.math.transformPoint(u.x+u.width/2,u.y+u.height/2,v);
u=o+e,v=i.createSVGTransform(),v.setRotate(u,w.x,w.y),s=svgedit.math.matrixMultiply(s,t,v.matrix.inverse()),e&&r.removeItem(0),u&&(r.numberOfItems?r.insertItemBefore(v,0):r.appendItem(v)),(s.e||s.f)&&(e=i.createSVGTransform(),e.setTranslate(s.e,s.f),r.numberOfItems?r.insertItemBefore(e,0):r.appendItem(e))}else s=q.getAttribute("transform"),e={},e.transform=s||"",e=i.createSVGTransform(),s=svgedit.math.transformListToTransform(r).matrix,t=s.inverse(),s=svgedit.math.matrixMultiply(t,l,s),e.setMatrix(s),r.appendItem(e);(q=svgedit.recalculate.recalculateDimensions(q))&&m.addSubCommand(q)}}}return j&&(e={},e.transform=j,a.setAttribute("transform",""),a.removeAttribute("transform"),m.addSubCommand(new svgedit.history.ChangeElementCommand(a,e))),b&&!m.isEmpty()?m:void 0};this.ungroupSelectedElement=function(){var a=r[0];if($(a).data("gsvg")||$(a).data("symbol"))Nb(a);else if("use"===a.tagName){var b=svgedit.utilities.getElem(B(a).substr(1));$(a).data("symbol",b).data("ref",b),Nb(a)}else if(b=$(a).parents("a"),b.length&&(a=b[0]),"g"===a.tagName||"a"===a.tagName){b=new svgedit.history.BatchCommand("Ungroup Elements");var c=Wb(a,!0);c&&b.addSubCommand(c),c=a.parentNode;for(var d=a.nextSibling,e=Array(a.childNodes.length),f=0;a.firstChild;){var g=a.firstChild,h=g.nextSibling,i=g.parentNode;"title"===g.tagName?(b.addSubCommand(new svgedit.history.RemoveElementCommand(g,g.nextSibling,i)),i.removeChild(g)):(e[f++]=g=c.insertBefore(g,d),b.addSubCommand(new svgedit.history.MoveElementCommand(g,h,i)))}Eb(),d=a.nextSibling,a=c.removeChild(a),b.addSubCommand(new svgedit.history.RemoveElementCommand(a,d,c)),b.isEmpty()||Q(b),Fb(e)}},this.moveToTopSelectedElement=function(){var a=r[0];if(null!=a){a=a;var b=a.parentNode,c=a.nextSibling;a=a.parentNode.appendChild(a),c!=a.nextSibling&&(Q(new svgedit.history.MoveElementCommand(a,c,b,"top")),sb("changed",[a]))}},this.moveToBottomSelectedElement=function(){var a=r[0];if(null!=a){a=a;var b=a.parentNode,c=a.nextSibling,d=a.parentNode.firstChild;"title"==d.tagName&&(d=d.nextSibling),"defs"==d.tagName&&(d=d.nextSibling),a=a.parentNode.insertBefore(a,d),c!=a.nextSibling&&(Q(new svgedit.history.MoveElementCommand(a,c,b,"bottom")),sb("changed",[a]))}},this.moveUpDownSelected=function(a){var b=r[0];if(b){jb=[];var c,d,e=$(pb(getStrokedBBox([b]))).toArray();if("Down"==a&&e.reverse(),$.each(e,function(){return d?(c=this,!1):void(this==b&&(d=!0))}),c){e=b.parentNode;var f=b.nextSibling;$(c)["Down"==a?"before":"after"](b),f!=b.nextSibling&&(Q(new svgedit.history.MoveElementCommand(b,f,e,"Move "+a)),sb("changed",[b]))}}},this.moveSelectedElements=function(a,b,c){a.constructor!=Array&&(a/=n,b/=n),c=c||!0;for(var d=new svgedit.history.BatchCommand("position"),e=r.length;e--;){var f=r[e];if(null!=f){var g=i.createSVGTransform(),h=svgedit.transformlist.getTransformList(f);a.constructor==Array?g.setTranslate(a[e],b[e]):g.setTranslate(a,b),h.numberOfItems?h.insertItemBefore(g,0):h.appendItem(g),(g=svgedit.recalculate.recalculateDimensions(f))&&d.addSubCommand(g),R.requestSelector(f).resize()}}return d.isEmpty()?void 0:(c&&Q(d),sb("changed",r),d)},this.cloneSelectedElements=function(a,b){var c,d,e=new svgedit.history.BatchCommand("Clone Elements"),f=r.length;for(r.sort(function(a,b){return $(b).index()-$(a).index()}),c=0;f>c&&(d=r[c],null!=d);++c);for(f=r.slice(0,c),this.clearSelection(!0),c=f.length;c--;)d=f[c]=yb(f[c]),(o||m().getCurrentLayer()).appendChild(d),e.addSubCommand(new svgedit.history.InsertElementCommand(d));e.isEmpty()||(Fb(f.reverse()),this.moveSelectedElements(a,b,!1),Q(e))},this.alignSelectedElements=function(a,b){var c,d,e=[],f=Number.MAX_VALUE,h=Number.MIN_VALUE,i=Number.MAX_VALUE,j=Number.MIN_VALUE,k=Number.MIN_VALUE,l=Number.MIN_VALUE,m=r.length;if(m){for(c=0;m>c&&null!=r[c];++c)switch(d=r[c],e[c]=getStrokedBBox([d]),b){case"smallest":(("l"==a||"c"==a||"r"==a)&&(k==Number.MIN_VALUE||k>e[c].width)||("t"==a||"m"==a||"b"==a)&&(l==Number.MIN_VALUE||l>e[c].height))&&(f=e[c].x,i=e[c].y,h=e[c].x+e[c].width,j=e[c].y+e[c].height,k=e[c].width,l=e[c].height);break;case"largest":(("l"==a||"c"==a||"r"==a)&&(k==Number.MIN_VALUE||k<e[c].width)||("t"==a||"m"==a||"b"==a)&&(l==Number.MIN_VALUE||l<e[c].height))&&(f=e[c].x,i=e[c].y,h=e[c].x+e[c].width,j=e[c].y+e[c].height,k=e[c].width,l=e[c].height);break;default:e[c].x<f&&(f=e[c].x),e[c].y<i&&(i=e[c].y),e[c].x+e[c].width>h&&(h=e[c].x+e[c].width),e[c].y+e[c].height>j&&(j=e[c].y+e[c].height)}for("page"==b&&(i=f=0,h=g.contentW,j=g.contentH),d=Array(m),k=Array(m),c=0;m>c&&null!=r[c];++c)switch(l=e[c],d[c]=0,k[c]=0,a){case"l":d[c]=f-l.x;break;case"c":d[c]=(f+h)/2-(l.x+l.width/2);break;case"r":d[c]=h-(l.x+l.width);break;case"t":k[c]=i-l.y;break;case"m":k[c]=(i+j)/2-(l.y+l.height/2);break;case"b":k[c]=j-(l.y+l.height)}this.moveSelectedElements(d,k)}},this.contentW=Rb().w,this.contentH=Rb().h,this.updateCanvas=function(a,b){i.setAttribute("width",a),i.setAttribute("height",b);var c=$("#canvasBackground")[0],d=j.getAttribute("x"),e=j.getAttribute("y"),f=a/2-this.contentW*n/2,g=b/2-this.contentH*n/2;return svgedit.utilities.assignAttributes(j,{width:this.contentW*n,height:this.contentH*n,x:f,y:g,viewBox:"0 0 "+this.contentW+" "+this.contentH}),svgedit.utilities.assignAttributes(c,{width:j.getAttribute("width"),height:j.getAttribute("height"),x:f,y:g}),(c=svgedit.utilities.getElem("background_image"))&&svgedit.utilities.assignAttributes(c,{width:"100%",height:"100%"}),R.selectorParentGroup.setAttribute("transform","translate("+f+","+g+")"),nb("canvasUpdated",{new_x:f,new_y:g,old_x:d,old_y:e,d_x:f-d,d_y:g-e}),{x:f,y:g,old_x:d,old_y:e,d_x:f-d,d_y:g-e}},this.setBackground=function(a,b){var c=svgedit.utilities.getElem("canvasBackground"),e=$(c).find("rect")[0],f=svgedit.utilities.getElem("background_image");e.setAttribute("fill",a),b?(f||(f=h.createElementNS(d.SVG,"image"),svgedit.utilities.assignAttributes(f,{id:"background_image",width:"100%",height:"100%",preserveAspectRatio:"xMinYMin",style:"pointer-events:none"})),C(f,b),c.appendChild(f)):f&&f.parentNode.removeChild(f)},this.cycleElement=function(a){var b=r[0],c=!1,d=vb(o||m().getCurrentLayer());if(d.length){if(null==b)a=a?d.length-1:0,c=d[a];else for(var e=d.length;e--;)if(d[e]==b){a=a?e-1:e+1,a>=d.length?a=0:0>a&&(a=d.length-1),c=d[a];break}Gb([c],!0),sb("selected",r)}},this.clear(),this.getPrivateMethods=function(){return{addCommandToHistory:Q,setGradient:Sb,addSvgElementFromJson:s,assignAttributes:F,BatchCommand:P,call:sb,ChangeElementCommand:O,copyElem:yb,ffClone:zb,findDefs:z,findDuplicateGradient:Tb,getElem:E,getId:qb,getIntersectionList:pb,getMouseTarget:Hb,getNextId:rb,getPathBBox:D,getUrlFromAttr:A,hasMatrixTransform:v,identifyLayers:Ob,InsertElementCommand:M,isIdentity:svgedit.math.isIdentity,logMatrix:Cb,matrixMultiply:u,MoveElementCommand:L,preventClickDefault:Ib,recalculateAllSelectedDimensions:Ab,recalculateDimensions:I,remapElement:H,RemoveElementCommand:N,removeUnusedDefElems:Jb,round:ob,runExtensions:nb,sanitizeSvg:K,SVGEditTransformList:svgedit.transformlist.SVGTransformList,toString:toString,transformBox:svgedit.math.transformBox,transformListToTransform:w,transformPoint:t,walkTree:svgedit.utilities.walkTree}}},function(){window.svgEditor||(window.svgEditor=function(a){function b(b,c){var e=d.setSvgString(b)!==!1;c=c||a.noop,e?c(!0):a.alert(o.notification.errorLoadingSVG,function(){c(!1)})}var c={};c.tool_scale=1,c.langChanged=!1,c.showSaveWarning=!1,c.storagePromptClosed=!1;var d,e,f=svgedit.utilities,g=!1,h=[],i={},j={lang:"",iconsize:"",bkgd_color:"#FFF",bkgd_url:"",img_save:"embed",save_notice_done:!1,export_notice_done:!1},k={},l={extensions:[],allowedOrigins:[]},m=["ext-overview_window.js","ext-markers.js","ext-connector.js","ext-eyedropper.js","ext-shapes.js","ext-imagelib.js","ext-grid.js","ext-polygon.js","ext-star.js","ext-panning.js","ext-storage.js"],n={canvasName:"default",canvas_expansion:3,initFill:{color:"FF0000",opacity:1},initStroke:{width:5,color:"000000",opacity:1},initOpacity:1,colorPickerCSS:null,initTool:"select",wireframe:!1,showlayers:!1,no_save_warning:!1,imgPath:"images/",langPath:"locale/",extPath:"extensions/",jGraduatePath:"jgraduate/images/",dimensions:[640,480],gridSnapping:!1,gridColor:"#000",baseUnit:"px",snappingStep:10,showRulers:!0,preventAllURLConfig:!1,preventURLContentLoading:!1,lockExtensions:!1,noDefaultExtensions:!1,showGrid:!1,noStorageOnLoad:!1,forceStorage:!1,emptyStorageOnDecline:!1},o=c.uiStrings={common:{ok:"OK",cancel:"Cancel",key_up:"Up",key_down:"Down",key_backspace:"Backspace",key_del:"Del"},layers:{layer:"Layer"},notification:{invalidAttrValGiven:"Invalid value given",noContentToFitTo:"No content to fit to",dupeLayerName:"There is already a layer named that!",enterUniqueLayerName:"Please enter a unique layer name",enterNewLayerName:"Please enter the new layer name",layerHasThatName:"Layer already has that name",QmoveElemsToLayer:"Move selected elements to layer '%s'?",QwantToClear:"Do you want to clear the drawing?\nThis will also erase your undo history!",QwantToOpen:"Do you want to open a new file?\nThis will also erase your undo history!",QerrorsRevertToSource:"There were parsing errors in your SVG source.\nRevert back to original SVG source?",QignoreSourceChanges:"Ignore changes made to SVG source?",featNotSupported:"Feature not supported",enterNewImgURL:"Enter the new image URL",defsFailOnSave:"NOTE: Due to a bug in your browser, this image may appear wrong (missing gradients or elements). It will however appear correct once actually saved.",loadingImage:"Loading image, please wait...",saveFromBrowser:"Select 'Save As...' in your browser to save this image as a %s file.",noteTheseIssues:"Also note the following issues: ",unsavedChanges:"There are unsaved changes.",enterNewLinkURL:"Enter the new hyperlink URL",errorLoadingSVG:"Error: Unable to load SVG data",URLloadFail:"Unable to load from URL",retrieving:"Retrieving '%s' ..."}};return a.pref=function(a,b){return b?(k[a]=b,void(c.curPrefs=k)):a in k?k[a]:j[a]},c.loadContentAndPrefs=function(){if(l.forceStorage||!l.noStorageOnLoad&&document.cookie.match(/(?:^|;\s*)store=(?:prefsAndContent|prefsOnly)/)){if(c.storage&&(l.forceStorage||!l.noStorageOnLoad&&document.cookie.match(/(?:^|;\s*)store=prefsAndContent/))){var a=c.storage.getItem("svgedit-"+l.canvasName);a&&c.loadFromString(a)}for(var b in j)j.hasOwnProperty(b)&&(a="svg-edit-"+b,c.storage?(a=c.storage.getItem(a))&&(j[b]=String(a)):window.widget?j[b]=widget.preferenceForKey(a):(a=document.cookie.match(RegExp("(?:^|;\\s*)"+f.preg_quote(encodeURIComponent(a))+"=([^;]+)")),j[b]=a?decodeURIComponent(a[1]):""))}},c.setConfig=function(b,d){function e(b,c,d){b[c]&&"object"==typeof b[c]?a.extend(!0,b[c],d):b[c]=d}d=d||{},a.each(b,function(c,f){b.hasOwnProperty(c)&&(j.hasOwnProperty(c)?(d.overwrite!==!1||!l.preventAllURLConfig&&!k.hasOwnProperty(c))&&(d.allowInitialUserOverride===!0?j[c]=f:a.pref(c,f)):["extensions","allowedOrigins"].indexOf(c)>-1?d.overwrite===!1&&(l.preventAllURLConfig||"allowedOrigins"===c||"extensions"===c&&l.lockExtensions)||(l[c]=l[c].concat(f)):n.hasOwnProperty(c)&&(d.overwrite!==!1||!l.preventAllURLConfig&&!l.hasOwnProperty(c))&&(l.hasOwnProperty(c)?d.overwrite!==!1&&e(l,c,f):d.allowInitialUserOverride===!0?e(n,c,f):n[c]&&"object"==typeof n[c]?(l[c]={},a.extend(!0,l[c],f)):l[c]=f))}),c.curConfig=l},c.setCustomHandlers=function(b){c.ready(function(){b.open&&(a('#tool_open > input[type="file"]').remove(),a("#tool_open").show(),d.open=b.open),b.save&&(c.showSaveWarning=!1,d.bind("saved",b.save)),(b.exportImage||b.pngsave)&&d.bind("exported",b.exportImage||b.pngsave),i=b})},c.randomizeIds=function(){d.randomizeIds(arguments)},c.init=function(){function g(){l=a.extend(!0,{},n,l),l.noDefaultExtensions||(l.extensions=l.extensions.concat(m)),a.each(["extensions","allowedOrigins"],function(b,c){l[c]=a.grep(l[c],function(a,b){return b===l[c].indexOf(a)})}),c.curConfig=l}function h(b,c){var e=b.id,f=e.split("_"),g=f[0];f=f[1],c&&d.setStrokeAttr("stroke-"+g,f),eb(),A("#cur_"+g,e,20),a(b).addClass("current").siblings().removeClass("current")}function p(b,c){a.pref("bkgd_color",b),a.pref("bkgd_url",c),d.setBackground(b,c)}function q(){var b=d.getHref(U);b=0===b.indexOf("data:")?"":b,a.prompt(o.notification.enterNewImgURL,b,function(a){a&&hb(a)})}function r(b,c){c||(c=d.getZoom()),b||(b=a("#svgcanvas"));var e,f,g=d.getContentElem(),h=svgedit.units.getTypeMap()[l.baseUnit];for(e=0;2>e;e++){var i=0===e,j=i?"x":"y",k=i?"width":"height",m=Number(g.getAttribute(j));j=a("#ruler_"+j+" canvas:first");var n=j.clone();j.replaceWith(n);var o=n[0],p=j=b[k]();o.parentNode.style[k]=p+"px";var q,r,s,t=0,u=o.getContext("2d");if(u.fillStyle="rgb(200,0,0)",u.fillRect(0,0,o.width,o.height),n.siblings().remove(),j>=3e4){s=parseInt(j/3e4,10)+1,q=[],q[0]=u;var v;for(f=1;s>f;f++)o[k]=3e4,v=o.cloneNode(!0),o.parentNode.appendChild(v),q[f]=v.getContext("2d");v[k]=j%3e4,j=3e4}for(o[k]=j,k=h*c,o=50/k,n=1,f=0;f<_.length&&(n=r=_[f],!(r>=o));f++);o=n*k,u.font="9px sans-serif";for(var w=m/k%n*k,x=w-o;p>w;){if(x+=o,f=Math.round(w)+.5,i?(u.moveTo(f,15),u.lineTo(f,0)):(u.moveTo(15,f),u.lineTo(0,f)),r=(x-m)/k,n>=1?f=Math.round(r):(f=String(n).split(".")[1].length,f=r.toFixed(f)),0!==f&&1e3!==f&&f%1e3===0&&(f=f/1e3+"K"),i)u.fillText(f,w+2,8);else for(r=String(f).split(""),f=0;f<r.length;f++)u.fillText(r[f],1,w+9+9*f);for(r=o/10,f=1;10>f;f++){var y=Math.round(w+r*f)+.5;if(q&&y>j){if(t++,u.stroke(),t>=s){f=10,w=p;continue}u=q[t],w-=3e4,y=Math.round(w+r*f)+.5}var z=f%2?12:10;i?(u.moveTo(y,15),u.lineTo(y,z)):(u.moveTo(15,y),u.lineTo(z,y))}w+=o}u.strokeStyle="#000",u.stroke()}}function s(){d.deleteCurrentLayer()&&(lb(),bb(),a("#layerlist tr.layer").removeClass("layersel"),a("#layerlist tr.layer:first").addClass("layersel"))}function t(){var b=d.getCurrentDrawing().getCurrentLayerName()+" copy";a.prompt(o.notification.enterUniqueLayerName,b,function(b){b&&(d.getCurrentDrawing().hasLayer(b)?a.alert(o.notification.dupeLayerName):(d.cloneLayer(b),lb(),bb()))})}function u(b){var c=a("#layerlist tr.layersel").index(),e=d.getCurrentDrawing().getNumLayers();(c>0||e-1>c)&&(c+=b,d.setCurrentLayerPosition(e-c-1),bb())}function v(a){a.stopPropagation(),a.preventDefault()}function w(a){a.stopPropagation(),a.preventDefault()}function x(a){a.stopPropagation(),a.preventDefault()}try{"localStorage"in window&&(c.storage=localStorage)}catch(y){}var z=[];a("#lang_select option").each(function(){z.push(this.value)}),function(){var b,d;if(e=a.deparam.querystring(!0),a.isEmptyObject(e))g(),c.loadContentAndPrefs();else{if(e.dimensions&&(e.dimensions=e.dimensions.split(",")),e.bkgd_color&&(e.bkgd_color="#"+e.bkgd_color),e.extensions&&(e.extensions=e.extensions.match(/[:\/\\]/)?"":e.extensions.split(",")),a.each(["extPath","imgPath","langPath","jGraduatePath"],function(a){e[a]&&delete e[a]}),c.setConfig(e,{overwrite:!1}),g(),!l.preventURLContentLoading){if(b=e.source,d=a.param.querystring(),b||d.indexOf("source=data:")>=0&&(b=d.match(/source=(data:[^&]*)/)[1]),b)return void(0===b.indexOf("data:")?(b=b.replace(/ /g,"+"),c.loadFromDataURI(b)):c.loadFromString(b));if(-1!==d.indexOf("paramurl="))return void c.loadFromURL(d.substr(9));if(e.url)return void c.loadFromURL(e.url)}(!e.noStorageOnLoad||l.forceStorage)&&c.loadContentAndPrefs()}k=a.extend(!0,{},j,k),c.curPrefs=k}(),function(){var a,b=window.opener;if(b)try{a=b.document.createEvent("Event"),a.initEvent("svgEditorReady",!0,!0),b.document.documentElement.dispatchEvent(a)}catch(c){}}();var A=c.setIcon=function(b,c){var d="string"==typeof c?a.getSvgIcon(c,!0):c.clone();d?a(b).empty().append(d):console.log("NOTE: Icon image missing: "+c)},B=function(){a.each(l.extensions,function(){var b=this;b.match(/^ext-.*\.js/)&&a.getScript(l.extPath+b,function(a){a||(a=document.createElement("script"),a.src=l.extPath+b,document.querySelector("head").appendChild(a))})}),c.putLocale(null,z)};"file:"===document.location.protocol?setTimeout(B,100):B(),a.svgIcons(l.imgPath+"svg_edit_icons.svg",{w:24,h:24,id_match:!1,no_img:!svgedit.browser.isWebkit(),fallback_path:l.imgPath,fallback:{new_image:"clear.png",save:"save.png",open:"open.png",source:"source.png",docprops:"document-properties.png",wireframe:"wireframe.png",undo:"undo.png",redo:"redo.png",select:"select.png",select_node:"select_node.png",pencil:"fhpath.png",pen:"line.png",square:"square.png",rect:"rect.png",fh_rect:"freehand-square.png",circle:"circle.png",ellipse:"ellipse.png",fh_ellipse:"freehand-circle.png",path:"path.png",text:"text.png",image:"image.png",zoom:"zoom.png",clone:"clone.png",node_clone:"node_clone.png","delete":"delete.png",node_delete:"node_delete.png",group:"shape_group_elements.png",ungroup:"shape_ungroup.png",move_top:"move_top.png",move_bottom:"move_bottom.png",to_path:"to_path.png",link_controls:"link_controls.png",reorient:"reorient.png",align_left:"align-left.png",align_center:"align-center.png",align_right:"align-right.png",align_top:"align-top.png",align_middle:"align-middle.png",align_bottom:"align-bottom.png",go_up:"go-up.png",go_down:"go-down.png",ok:"save.png",cancel:"cancel.png",arrow_right:"flyouth.png",arrow_down:"dropdown.gif"},placement:{"#logo":"logo","#tool_clear div,#layer_new":"new_image","#tool_save div":"save","#tool_export div":"export","#tool_open div div":"open","#tool_import div div":"import","#tool_source":"source","#tool_docprops > div":"docprops","#tool_wireframe":"wireframe","#tool_undo":"undo","#tool_redo":"redo","#tool_select":"select","#tool_fhpath":"pencil","#tool_line":"pen","#tool_rect,#tools_rect_show":"rect","#tool_square":"square","#tool_fhrect":"fh_rect","#tool_ellipse,#tools_ellipse_show":"ellipse","#tool_circle":"circle","#tool_fhellipse":"fh_ellipse","#tool_path":"path","#tool_text,#layer_rename":"text","#tool_image":"image","#tool_zoom":"zoom","#tool_clone,#tool_clone_multi":"clone","#tool_node_clone":"node_clone","#layer_delete,#tool_delete,#tool_delete_multi":"delete","#tool_node_delete":"node_delete","#tool_add_subpath":"add_subpath","#tool_openclose_path":"open_path","#tool_move_top":"move_top","#tool_move_bottom":"move_bottom","#tool_topath":"to_path","#tool_node_link":"link_controls","#tool_reorient":"reorient","#tool_group_elements":"group_elements","#tool_ungroup":"ungroup","#tool_unlink_use":"unlink_use","#tool_alignleft, #tool_posleft":"align_left","#tool_aligncenter, #tool_poscenter":"align_center","#tool_alignright, #tool_posright":"align_right","#tool_aligntop, #tool_postop":"align_top","#tool_alignmiddle, #tool_posmiddle":"align_middle","#tool_alignbottom, #tool_posbottom":"align_bottom","#cur_position":"align","#linecap_butt,#cur_linecap":"linecap_butt","#linecap_round":"linecap_round","#linecap_square":"linecap_square","#linejoin_miter,#cur_linejoin":"linejoin_miter","#linejoin_round":"linejoin_round","#linejoin_bevel":"linejoin_bevel","#url_notice":"warning","#layer_up":"go_up","#layer_down":"go_down","#layer_moreopts":"context_menu","#layerlist td.layervis":"eye","#tool_source_save,#tool_docprops_save,#tool_prefs_save":"ok","#tool_source_cancel,#tool_docprops_cancel,#tool_prefs_cancel":"cancel","#rwidthLabel, #iwidthLabel":"width","#rheightLabel, #iheightLabel":"height","#cornerRadiusLabel span":"c_radius","#angleLabel":"angle","#linkLabel,#tool_make_link,#tool_make_link_multi":"globe_link","#zoomLabel":"zoom","#tool_fill label":"fill","#tool_stroke .icon_label":"stroke","#group_opacityLabel":"opacity","#blurLabel":"blur","#font_sizeLabel":"fontsize",".flyout_arrow_horiz":"arrow_right",".dropdown button, #main_button .dropdown":"arrow_down","#palette .palette_item:first, #fill_bg, #stroke_bg":"no_color"},resize:{"#logo .svg_icon":28,".flyout_arrow_horiz .svg_icon":5,".layer_button .svg_icon, #layerlist td.layervis .svg_icon":14,".dropdown button .svg_icon":7,"#main_button .dropdown .svg_icon":9,".palette_item:first .svg_icon":15,"#fill_bg .svg_icon, #stroke_bg .svg_icon":16,".toolbar_button button .svg_icon":16,".stroke_tool div div .svg_icon":20,"#tools_bottom label .svg_icon":18},callback:function(){a(".toolbar_button button > svg, .toolbar_button button > img").each(function(){a(this).parent().prepend(this)});var b,d=a("#tools_left");0!==d.length&&(b=d.offset().top+d.outerHeight()),d=a.pref("iconsize"),c.setIconSize(d||(a(window).height()<b?"s":"m")),a(".tools_flyout").each(function(){var b=a("#"+this.id+"_show"),c=b.attr("data-curopt");b.children("svg, img").length||(c=a(c).children().clone(),c.length&&(c[0].removeAttribute("style"),b.append(c)))}),c.runCallbacks(),setTimeout(function(){a(".flyout_arrow_horiz:empty").each(function(){a(this).append(a.getSvgIcon("arrow_right").width(5).height(5))})},1)}}),c.canvas=d=new a.SvgCanvas(document.getElementById("svgcanvas"),l);var C,D,E,F,G,H=svgedit.browser.isMac()?"meta+":"ctrl+",I=d.pathActions,J=d.undoMgr,K=l.imgPath+"logo.png",L=a("#workarea"),M=a("#cmenu_canvas"),N=null,O="crosshair",P="crosshair",Q="toolbars",R="",S={fill:null,stroke:null};!function(){a("#dialog_container").draggable({cancel:"#dialog_content, #dialog_buttons *",containment:"window"});var b=a("#dialog_box"),c=a("#dialog_buttons"),d=a("#dialog_content"),e=function(e,f,g,h,i,j,k){var l,m,n;if(d.html("<p>"+f.replace(/\n/g,"</p><p>")+"</p>").toggleClass("prompt","prompt"==e),c.empty(),l=a('<input type="button" value="'+o.common.ok+'">').appendTo(c),"alert"!==e&&a('<input type="button" value="'+o.common.cancel+'">').appendTo(c).click(function(){b.hide(),g(!1)}),"prompt"===e)m=a('<input type="text">').prependTo(c),m.val(h||""),m.bind("keydown","return",function(){l.click()});else if("select"===e){if(f=a('<div style="text-align:center;">'),m=a("<select>").appendTo(f),k){var p=a("<label>").text(k.label);n=a('<input type="checkbox">').appendTo(p),n.val(k.value),k.tooltip&&p.attr("title",k.tooltip),n.prop("checked",!!k.checked),f.append(a("<div>").append(p))}a.each(i||[],function(b,c){m.append("object"==typeof c?a("<option>").val(c.value).html(c.text):a("<option>").html(c))}),d.append(f),h&&m.val(h),j&&m.bind("change","return",j),m.bind("keydown","return",function(){l.click()})}"process"===e&&l.hide(),b.show(),l.click(function(){b.hide();var a="prompt"===e||"select"===e?m.val():!0;g&&(n?g(a,n.prop("checked")):g(a))}).focus(),("prompt"===e||"select"===e)&&m.focus()};a.alert=function(a,b){e("alert",a,b)},a.confirm=function(a,b){e("confirm",a,b)},a.process_cancel=function(a,b){e("process",a,b)},a.prompt=function(a,b,c){e("prompt",a,c,b)},a.select=function(a,b,c,d,f,g){e("select",a,c,f,b,d,g)}}();var T=function(){var b=a(".tool_button_current");b.length&&"tool_select"!==b[0].id&&(b.removeClass("tool_button_current").addClass("tool_button"),a("#tool_select").addClass("tool_button_current").removeClass("tool_button"),a("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all} #svgcanvas svg{cursor:default}")),d.setMode("select"),L.css("cursor","auto")},U=null,V=!1,W=!1,X=!1,Y=!1,Z="",$=a("title:first").text(),_=[];for(B=.1;1e5>B;B*=10)_.push(B),_.push(2*B),_.push(5*B);var ab=function(a){var b,c=[],e=d.getCurrentDrawing().getNumLayers();for(b=0;e>b;b++)c[b]=d.getCurrentDrawing().getLayerName(b);if(a)for(b=0;e>b;++b)c[b]!=a&&d.getCurrentDrawing().setLayerOpacity(c[b],.5);else for(b=0;e>b;++b)d.getCurrentDrawing().setLayerOpacity(c[b],1)},bb=function(){d.clearSelection();for(var b=a("#layerlist tbody").empty(),c=a("#selLayerNames").empty(),e=d.getCurrentDrawing(),f=e.getCurrentLayerName(),g=d.getCurrentDrawing().getNumLayers(),h=a.getSvgIcon("eye");g--;){var i=e.getLayerName(g),j=a('<tr class="layer">').toggleClass("layersel",i===f),k=a('<td class="layervis">').toggleClass("layerinvis",!e.getLayerVisibility(i)),l=a('<td class="layername">'+i+"</td>");b.append(j.append(k,l)),c.append('<option value="'+i+'">'+i+"</option>")}for(void 0!==h&&(c=h.clone(),a("td.layervis",b).append(c),a.resizeSvgIcons({"td.layervis .svg_icon":14})),a("#layerlist td.layername").mouseup(function(b){a("#layerlist tr.layer").removeClass("layersel"),a(this.parentNode).addClass("layersel"),d.setCurrentLayer(this.textContent),b.preventDefault()}).mouseover(function(){ab(this.textContent)}).mouseout(function(){ab()}),a("#layerlist td.layervis").click(function(){var b=a(this.parentNode).prevAll().length;b=a("#layerlist tr.layer:eq("+b+") td.layername").text();var c=a(this).hasClass("layerinvis");d.setLayerVisibility(b,c),a(this).toggleClass("layerinvis")}),c=5-a("#layerlist tr.layer").size();c-->0;)b.append('<tr><td style="color:white">_</td><td/></tr>')},cb=function(b,c){W||(W=!0,R=d.getSvgString(),a("#save_output_btns").toggle(!!c),a("#tool_source_back").toggle(!c),a("#svg_source_textarea").val(R),a("#svg_source_editor").fadeIn(),a("#svg_source_textarea").focus())},db=function(b,c){a("#path_node_panel").toggle(b),a("#tools_bottom_2,#tools_bottom_3").toggle(!b),b?(a(".tool_button_current").removeClass("tool_button_current").addClass("tool_button"),a("#tool_select").addClass("tool_button_current").removeClass("tool_button"),A("#tool_select","select_node"),V=!1,c.length&&(U=c[0])):setTimeout(function(){A("#tool_select","select")},1e3)},eb=function(){window.opera&&a("<p/>").hide().appendTo("body").remove()},fb=c.toolButtonClick=function(b,c){return a(b).hasClass("disabled")?!1:a(b).parent().hasClass("tools_flyout")?!0:(c||a(".tools_flyout").fadeOut("normal"),a("#styleoverrides").text(""),L.css("cursor","auto"),a(".tool_button_current").removeClass("tool_button_current").addClass("tool_button"),a(b).addClass("tool_button_current").removeClass("tool_button"),!0)},gb=c.clickSelect=function(){fb("#tool_select")&&(d.setMode("select"),a("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all}, #svgcanvas svg{cursor:default}"))},hb=c.setImageURL=function(b){b||(b=K),d.setImageURL(b),a("#image_url").val(b),0===b.indexOf("data:")?(a("#image_url").hide(),a("#change_image_url").show()):(d.embedImage(b,function(c){a("#url_notice").toggle(!c),K=b}),a("#image_url").show(),a("#change_image_url").hide())},ib=function(b){var c=Math.min(Math.max(12+6*b.value.length,50),300);a(b).width(c)},jb=c.updateCanvas=function(b,f){var g=L.width(),h=L.height(),i=g,j=h,k=d.getZoom(),m=a("#svgcanvas"),n={x:L[0].scrollLeft+i/2,y:L[0].scrollTop+j/2},o=l.canvas_expansion;g=Math.max(i,d.contentW*k*o),h=Math.max(j,d.contentH*k*o),g==i&&h==j?L.css("overflow","hidden"):L.css("overflow","scroll"),o=m.height()/2;var p=m.width()/2;m.width(g).height(h);var q=h/2,s=g/2,t=d.updateCanvas(g,h),u=s/p;g=g/2-i/2,h=h/2-j/2,f?(f.x+=t.x,f.y+=t.y):f={x:s+(n.x-p)*u,y:q+(n.y-o)*u},b?d.contentW>L.width()?(L[0].scrollLeft=t.x-10,L[0].scrollTop=t.y-10):(L[0].scrollLeft=g,L[0].scrollTop=h):(L[0].scrollLeft=f.x-i/2,L[0].scrollTop=f.y-j/2),l.showRulers&&(r(m,k),L.scroll()),e.storagePrompt!==!0&&!c.storagePromptClosed&&a("#dialog_box").hide()},kb=function(){var b,c,e="none"==d.getColor("fill"),f="none"==d.getColor("stroke"),g=["#tool_fhpath","#tool_line"],h=["#tools_rect .tool_button","#tools_ellipse .tool_button","#tool_text","#tool_path"];if(f)for(b in g)c=g[b],a(c).hasClass("tool_button_current")&&gb(),a(c).addClass("disabled");else for(b in g)c=g[b],a(c).removeClass("disabled");if(f&&e)for(b in h)c=h[b],a(c).hasClass("tool_button_current")&&gb(),a(c).addClass("disabled");else for(b in h)c=h[b],a(c).removeClass("disabled");d.runExtensions("toolButtonStateUpdate",{nofill:e,nostroke:f}),a(".tools_flyout").each(function(){var b=a("#"+this.id+"_show"),c=!1;a(this).children().each(function(){a(this).hasClass("disabled")||(c=!0)}),b.toggleClass("disabled",!c)}),eb()},lb=function(){var b=U;null==b||b.parentNode||(b=null);var c=d.getCurrentDrawing().getCurrentLayerName(),e=d.getMode(),f="px"!==l.baseUnit?l.baseUnit:null,g="pathedit"==e,h=a("#cmenu_canvas li");if(a("#selected_panel, #multiselected_panel, #g_panel, #rect_panel, #circle_panel,#ellipse_panel, #line_panel, #text_panel, #image_panel, #container_panel, #use_panel, #a_panel").hide(),null!=b){var i=b.nodeName,j=d.getRotationAngle(b);a("#angle").val(j);var k=d.getBlur(b);if(a("#blur").val(k),a("#blur_slider").slider("option","value",k),d.addedNew&&"image"===i&&0!==d.getHref(b).indexOf("data:")&&q(),g||"pathedit"==e)return c=I.getNodePoint(),a("#tool_add_subpath").removeClass("push_button_pressed").addClass("tool_button"),a("#tool_node_delete").toggleClass("disabled",!I.canDeleteNodes),A("#tool_openclose_path",I.closed_subpath?"open_path":"close_path"),void(c&&(g=a("#seg_type"),f&&(c.x=svgedit.units.convertUnit(c.x),c.y=svgedit.units.convertUnit(c.y)),a("#path_node_x").val(c.x),a("#path_node_y").val(c.y),c.type?g.val(c.type).removeAttr("disabled"):g.val(4).attr("disabled","disabled")));if(a("#selected_panel").show(),["line","circle","ellipse"].indexOf(i)>=0)a("#xy_panel").hide();else{var m,n;["g","polyline","path"].indexOf(i)>=0?(e=d.getStrokedBBox([b]))&&(m=e.x,n=e.y):(m=b.getAttribute("x"),n=b.getAttribute("y")),f&&(m=svgedit.units.convertUnit(m),n=svgedit.units.convertUnit(n)),a("#selected_x").val(m||0),a("#selected_y").val(n||0),a("#xy_panel").show()}f=-1==["image","text","path","g","use"].indexOf(i),a("#tool_topath").toggle(f),a("#tool_reorient").toggle("path"===i),a("#tool_reorient").toggleClass("disabled",0===j),f={g:[],a:[],rect:["rx","width","height"],image:["width","height"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],line:["x1","y1","x2","y2"],text:[],use:[]};var o=b.tagName;i=null,"a"===o&&(i=d.getHref(b),a("#g_panel").show()),"a"===b.parentNode.tagName&&(a(b).siblings().length||(a("#a_panel").show(),i=d.getHref(b.parentNode))),a("#tool_make_link, #tool_make_link").toggle(!i),i&&a("#link_url").val(i),f[o]&&(f=f[o],a("#"+o+"_panel").show(),a.each(f,function(c,d){var e=b.getAttribute(d);"px"!==l.baseUnit&&b[d]&&(e=svgedit.units.convertUnit(b[d].baseVal.value)),a("#"+o+"_"+d).val(e||0)}),"text"==o?(a("#text_panel").css("display","inline"),d.getItalic()?a("#tool_italic").addClass("push_button_pressed").removeClass("tool_button"):a("#tool_italic").removeClass("push_button_pressed").addClass("tool_button"),d.getBold()?a("#tool_bold").addClass("push_button_pressed").removeClass("tool_button"):a("#tool_bold").removeClass("push_button_pressed").addClass("tool_button"),a("#font_family").val(b.getAttribute("font-family")),a("#font_size").val(b.getAttribute("font-size")),a("#text").val(b.textContent),d.addedNew&&setTimeout(function(){a("#text").focus().select()},100)):"image"==o?hb(d.getHref(b)):("g"===o||"use"===o)&&(a("#container_panel").show(),f=d.getTitle(),i=a("#g_title")[0],i.value=f,ib(i),a("#g_title").prop("disabled","use"==o))),h[("g"===o?"en":"dis")+"ableContextMenuItems"]("#ungroup"),h[("g"!==o&&V?"en":"dis")+"ableContextMenuItems"]("#group")}else V?(a("#multiselected_panel").show(),h.enableContextMenuItems("#group").disableContextMenuItems("#ungroup")):h.disableContextMenuItems("#delete,#cut,#copy,#group,#ungroup,#move_front,#move_up,#move_down,#move_back");a("#tool_undo").toggleClass("disabled",0===J.getUndoStackSize()),a("#tool_redo").toggleClass("disabled",0===J.getRedoStackSize()),d.addedNew=!1,b&&!g||V?(a("#selLayerNames").removeAttr("disabled").val(c),M.enableContextMenuItems("#delete,#cut,#copy,#move_front,#move_up,#move_down,#move_back")):a("#selLayerNames").attr("disabled","disabled")},mb=function(){if(!C){var b="#workarea.wireframe #svgcontent * { stroke-width: "+1/d.getZoom()+"px; }";a("#wireframe_rules").text(L.hasClass("wireframe")?b:"")}},nb=function(b){b=b||d.getDocumentTitle(),b=$+(b?": "+b:""),a("title:first").text(b)},ob=d.zoomChanged=function(b,c,e){(c=d.setBBoxZoom(c,L.width()-15,L.height()-15))&&(b=c.zoom,c=c.bbox,.001>b?E({value:.1}):(a("#zoom").val((100*b).toFixed(1)),e?jb():jb(!1,{x:c.x*b+c.width*b/2,y:c.y*b+c.height*b/2}),"zoom"==d.getMode()&&c.width&&T(),mb()))};E=function(a){var b=a.value/100;.001>b?a.value=.1:(a=d.getZoom(),ob(window,{width:0,height:0,x:(L[0].scrollLeft+L.width()/2)/a,y:(L[0].scrollTop+L.height()/2)/a,zoom:b},!0))},a("#cur_context_panel").delegate("a","click",function(){var b=a(this);return b.attr("data-root")?d.leaveContext():d.setContext(b.text()),d.clearSelection(),!1});var pb={},qb=function(){a(".tools_flyout").each(function(){var b=a("#"+this.id+"_show");
if(!b.data("isLibrary")){var c=[];a(this).children().each(function(){c.push(this.title)}),b[0].title=c.join(" / ")}})},rb=function(){a(".tools_flyout").each(function(){var b=a("#"+this.id+"_show"),d=b.offset();b=b.outerWidth(),a(this).css({left:(d.left+b)*c.tool_scale,top:d.top})})},sb=function(b){a.each(b,function(c,d){var e=a(c).children(),f=c+"_show",g=a(f),h=!1;e.addClass("tool_button").unbind("click mousedown mouseup").each(function(c){var e=d[c];pb[e.sel]=e.fn,e.isDefault&&(h=c),c=function(c){var d=e;if("keydown"===c.type){var h=a(d.parent+"_show").hasClass("tool_button_current"),i=a(d.parent+"_show").attr("data-curopt");a.each(b[e.parent],function(a,f){f.sel==i&&(d=c.shiftKey&&h?b[e.parent][a+1]||b[e.parent][0]:f)})}if(a(this).hasClass("disabled"))return!1;fb(f)&&d.fn();var j;j=d.icon?a.getSvgIcon(d.icon,!0):a(d.sel).children().eq(0).clone(),j[0].setAttribute("width",g.width()),j[0].setAttribute("height",g.height()),g.children(":not(.flyout_arrow_horiz)").remove(),g.append(j).attr("data-curopt",d.sel)},a(this).mouseup(c),e.key&&a(document).bind("keydown",e.key[0]+" shift+"+e.key[0],c)}),h?g.attr("data-curopt",d[h].sel):g.attr("data-curopt")||g.attr("data-curopt",d[0].sel);var i,j=a(f).position();g.mousedown(function(b){if(g.hasClass("disabled"))return!1;var d=a(c),e=j.left+34,f=-1*d.width(),h=d.data("shown_popop")?200:0;i=setTimeout(function(){g.data("isLibrary")?d.css("left",e).show():d.css("left",f).show().animate({left:e},150),d.data("shown_popop",!0)},h),b.preventDefault()}).mouseup(function(){clearTimeout(i);var b=a(this).attr("data-curopt");g.data("isLibrary")&&a(f.replace("_show","")).is(":visible")?fb(f,!0):fb(f)&&pb[b]&&pb[b]()})}),qb(),rb()},tb=function(b,c){return a("<div>",{"class":"tools_flyout",id:b}).appendTo("#svg_editor").append(c)},ub=function(){var a,b=/^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/,c=document.getElementsByTagName("script")[0];for(a in c.style)if(b.test(a))return a.match(b)[0];return"WebkitOpacity"in c.style?"Webkit":"KhtmlOpacity"in c.style?"Khtml":""}(),vb=function(b,c){var d=["top","left","bottom","right"];b.each(function(){var b,e=a(this),f=e.outerWidth()*(c-1),g=e.outerHeight()*(c-1);for(b=0;4>b;b++){var h=d[b],i=e.data("orig_margin-"+h);null==i&&(i=parseInt(e.css("margin-"+h),10),e.data("orig_margin-"+h,i)),i*=c,"right"===h?i+=f:"bottom"===h&&(i+=g),e.css("margin-"+h,i)}})},wb=c.setIconSize=function(b){var d=a("#tools_top .toolset, #editor_panel > *, #history_panel > *,				#main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,				#g_panel > *, #tool_font_size > *, .tools_flyout"),e=1;e="number"==typeof b?b:{s:.75,m:1,l:1.25,xl:1.5}[b],c.tool_scale=e,rb();var f=d.parents(":hidden");if(f.css("visibility","hidden").show(),vb(d,e),f.css("visibility","visible").hide(),a.pref("iconsize",b),a("#iconsize").val(b),f={"#tools_top":{left:50,height:72},"#tools_left":{width:31,top:74},"div#workarea":{left:38,top:74}},d=a("#tool_size_rules"),d.length?d.empty():d=a('<style id="tool_size_rules"></style>').appendTo("head"),"m"!==b){var g="";a.each(f,function(c,d){c="#svg_editor "+c.replace(/,/g,", #svg_editor"),g+=c+"{",a.each(d,function(a,c){var d;"number"==typeof c?d=c*e+"px":(c[b]||c.all)&&(d=c[b]||c.all),g+=a+":"+d+";"}),g+="}"}),f="-"+ub.toLowerCase()+"-",g+="#tools_top .toolset, #editor_panel > *, #history_panel > *,				#main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,				#g_panel > *, #tool_font_size > *, .tools_flyout{"+f+"transform: scale("+e+");} #svg_editor div.toolset .toolset {"+f+"transform: scale(1); margin: 1px !important;} #svg_editor .ui-slider {"+f+"transform: scale("+1/e+");}",d.text(g)}rb()},xb=function(b,c,d,e){var f=a(b);c=a(c);var g=!1,h=e.dropUp;h&&a(b).addClass("dropup"),c.find("li").bind("mouseup",function(){e.seticon&&(A("#cur_"+f[0].id,a(this).children()),a(this).addClass("current").siblings().removeClass("current")),d.apply(this,arguments)}),a(window).mouseup(function(){g||(f.removeClass("down"),c.hide(),c.css({top:0,left:0})),g=!1}),f.bind("mousedown",function(){var a=f.offset();h?(a.top-=c.height(),a.left+=8):a.top+=f.height(),c.offset(a),f.hasClass("down")?(c.hide(),c.css({top:0,left:0})):(c.show(),g=!0),f.toggleClass("down")}).hover(function(){g=!0}).mouseout(function(){g=!1}),e.multiclick&&c.mousedown(function(){g=!0})},yb=[],zb=function(b,c,e){return c={alpha:c},0===b.indexOf("url(#")?(b=(b=d.getRefElem(b))?b.cloneNode(!0):a("#"+e+"_color defs *")[0],c[b.tagName]=b):c.solidColor=0===b.indexOf("#")?b.substr(1):"none",new a.jGraduate.Paint(c)};a("#text").focus(function(){}),a("#text").blur(function(){}),d.bind("selected",function(b,c){var e=d.getMode();if("select"===e&&T(),e="pathedit"==e,U=1===c.length||null==c[1]?c[0]:null,V=c.length>=2&&null!=c[1],null!=U&&!e){var f,g;if(null!=U)switch(U.tagName){case"use":case"image":case"foreignObject":break;case"g":case"a":var i=null,j=U.getElementsByTagName("*");for(f=0,g=j.length;g>f;f++){var k=j[f].getAttribute("stroke-width");0===f?i=k:i!==k&&(i=null)}a("#stroke_width").val(null===i?"":i),S.fill.update(!0),S.stroke.update(!0);break;default:S.fill.update(!0),S.stroke.update(!0),a("#stroke_width").val(U.getAttribute("stroke-width")||1),a("#stroke_style").val(U.getAttribute("stroke-dasharray")||"none"),f=U.getAttribute("stroke-linejoin")||"miter",0!=a("#linejoin_"+f).length&&h(a("#linejoin_"+f)[0]),f=U.getAttribute("stroke-linecap")||"butt",0!=a("#linecap_"+f).length&&h(a("#linecap_"+f)[0])}null!=U&&(f=100*(U.getAttribute("opacity")||1),a("#group_opacity").val(f),a("#opac_slider").slider("option","value",f),a("#elem_id").val(U.id)),kb()}db(e,c),lb(),d.runExtensions("selectedChanged",{elems:c,selectedElement:U,multiselected:V})}),d.bind("transition",function(b,c){var e=d.getMode(),f=c[0];if(f){if(V=c.length>=2&&null!=c[1],!V)switch(e){case"rotate":e=d.getRotationAngle(f),a("#angle").val(e),a("#tool_reorient").toggleClass("disabled",0===e)}d.runExtensions("elementTransition",{elems:c})}}),d.bind("changed",function(a,b){var e,f=d.getMode();for("select"===f&&T(),e=0;e<b.length;++e){var g=b[e];g&&"svg"===g.tagName?(bb(),jb()):g&&U&&null==U.parentNode&&(U=g)}c.showSaveWarning=!0,lb(),U&&"select"===f&&(S.fill.update(),S.stroke.update()),d.runExtensions("elementChanged",{elems:b})}),d.bind("saved",function(b,d){if(c.showSaveWarning=!1,d='<?xml version="1.0"?>\n'+d,svgedit.browser.isIE())cb(0,!0);else{var e=b.open("data:image/svg+xml;base64,"+f.encode64(d)),g=a.pref("save_notice_done");if("all"!==g){var h=o.notification.saveFromBrowser.replace("%s","SVG");svgedit.browser.isGecko()?-1!==d.indexOf("<defs")?(h+="\n\n"+o.notification.defsFailOnSave,a.pref("save_notice_done","all"),g="all"):a.pref("save_notice_done","part"):a.pref("save_notice_done","all"),"part"!==g&&e.alert(h)}}}),d.bind("exported",function(b,c){var e=c.issues,f=c.type||"PNG",g=("ICO"===f?"BMP":f).toLowerCase();a("#export_canvas").length||a("<canvas>",{id:"export_canvas"}).hide().appendTo("body");var h=a("#export_canvas")[0];h.width=d.contentW,h.height=d.contentH,canvg(h,c.svg,{renderCallback:function(){var b=c.quality?h.toDataURL("image/"+g,c.quality):h.toDataURL("image/"+g);N.location.href=b,"all"!==a.pref("export_notice_done")&&(b=o.notification.saveFromBrowser.replace("%s",f),e.length&&(b+="\n\n"+o.notification.noteTheseIssues+"\n  "+e.join("\n  ")),a.pref("export_notice_done","all"),N.alert(b))}})}),d.bind("zoomed",ob),d.bind("contextset",function(b,c){var e="";if(c){var f="";e='<a href="#" data-root="y">'+d.getCurrentDrawing().getCurrentLayerName()+"</a>",a(c).parentsUntil("#svgcontent > g").andSelf().each(function(){this.id&&(f+=" > "+this.id,e+=this!==c?' > <a href="#">'+this.id+"</a>":" > "+this.id)}),Z=f}else Z=null;a("#cur_context_panel").toggle(!!c).html(e),nb()}),d.bind("extension_added",function(b,d){function e(){D&&(clearTimeout(D),D=null),g||(D=setTimeout(function(){g=!0,wb(a.pref("iconsize"))},50))}if(d){var f=!1,g=!1,h=!0;if(d.langReady)if(c.langChanged){var i=a.pref("lang");d.langReady({lang:i,uiStrings:o})}else yb.push(d);var j=function(){d.callback&&!f&&h&&(f=!0,d.callback())},k=[];if(d.context_tools&&a.each(d.context_tools,function(b,c){var d,e=c.container_id?' id="'+c.container_id+'"':"",f=a("#"+c.panel);switch(f.length||(f=a("<div>",{id:c.panel}).appendTo("#tools_top")),c.type){case"tool_button":d='<div class="tool_button">'+c.id+"</div>";var g=a(d).appendTo(f);c.events&&a.each(c.events,function(b,c){a(g).bind(b,c)});break;case"select":d="<label"+e+'><select id="'+c.id+'">',a.each(c.options,function(a,b){d+='<option value="'+a+'"'+(a==c.defval?" selected":"")+">"+b+"</option>"}),d+="</select></label>";var h=a(d).appendTo(f).find("select");a.each(c.events,function(b,c){a(h).bind(b,c)});break;case"button-select":d='<div id="'+c.id+'" class="dropdown toolset" title="'+c.title+'"><div id="cur_'+c.id+'" class="icon_label"></div><button></button></div>',e=a('<ul id="'+c.id+'_opts"></ul>').appendTo("#option_lists"),c.colnum&&e.addClass("optcols"+c.colnum),a(d).appendTo(f).children(),k.push({elem:"#"+c.id,list:"#"+c.id+"_opts",title:c.title,callback:c.events.change,cur:"#cur_"+c.id});break;case"input":d="<label"+e+'><span id="'+c.id+'_label">'+c.label+':</span><input id="'+c.id+'" title="'+c.title+'" size="'+(c.size||"4")+'" value="'+(c.defval||"")+'" type="text"/></label>';var i=a(d).appendTo(f).find("input");c.spindata&&i.SpinButton(c.spindata),c.events&&a.each(c.events,function(a,b){i.bind(a,b)})}}),d.buttons){var l={},m={},n=d.svgicons,p={};a.each(d.buttons,function(b,c){var d,e,f,g=c.id;for(e=b;a("#"+g).length;)g=c.id+"_"+ ++e;n?(l[g]=c.icon,e=c.svgicon||c.id,"app_menu"==c.type?m["#"+g+" > div"]=e:m["#"+g]=e):d=a('<img src="'+c.icon+'">');var h,i;switch(c.type){case"mode_flyout":case"mode":h="tool_button",i="#tools_left";break;case"context":h="tool_button",i="#"+c.panel,a(i).length||a("<div>",{id:c.panel}).appendTo("#tools_top");break;case"app_menu":h="",i="#main_menu ul"}var j,k,o=a(c.list||"app_menu"==c.type?"<li/>":"<div/>").attr("id",g).attr("title",c.title).addClass(h);c.includeWith||c.list?c.list?(o.addClass("push_button"),a("#"+c.list+"_opts").append(o),c.isDefault&&(a("#cur_"+c.list).append(o.children().clone()),e=c.svgicon||c.id,m["#cur_"+c.list]=e)):c.includeWith&&(i=c.includeWith,k=a(i.button),h=k.parent(),k.parent().hasClass("tools_flyout")||(f=k[0].id.replace("tool_","tools_"),e=k.clone().attr("id",f+"_show").append(a("<div>",{"class":"flyout_arrow_horiz"})),k.before(e),h=tb(f,k)),j=F.getButtonData(i.button),i.isDefault&&(m["#"+f+"_show"]=c.id),f=p["#"+h[0].id]=[{sel:"#"+g,fn:c.events.click,icon:c.id,key:c.key,isDefault:c.includeWith?c.includeWith.isDefault:0},j],g="position"in i?i.position:"last",j=h.children().length,!isNaN(g)&&g>=0&&j>g?h.children().eq(g).before(o):(h.append(o),f.reverse())):("position"in c?a(i).children().eq(c.position).length?a(i).children().eq(c.position).before(o):a(i).children().last().before(o):o.appendTo(i),"mode_flyout"==c.type?(k=a(o),h=k.parent(),k.parent().hasClass("tools_flyout")||(f=k[0].id.replace("tool_","tools_"),e=k.clone().attr("id",f+"_show").append(a("<div>",{"class":"flyout_arrow_horiz"})),k.before(e),h=tb(f,k),h.data("isLibrary",!0),e.data("isLibrary",!0)),m["#"+f+"_show"]=c.id,f=p["#"+h[0].id]=[{sel:"#"+g,fn:c.events.click,icon:c.id,isDefault:!0},j]):"app_menu"==c.type&&o.append("<div>").append(c.title)),n||o.append(d),c.list||a.each(c.events,function(b,d){"click"==b&&"mode"==c.type?(c.includeWith?o.bind(b,d):o.bind(b,function(){fb(o)&&d()}),c.key&&(a(document).bind("keydown",c.key,d),c.title&&o.attr("title",c.title+" ["+c.key+"]"))):o.bind(b,d)}),sb(p)}),a.each(k,function(){xb(this.elem,this.list,this.callback,{seticon:!0})}),n&&(h=!1),a.svgIcons(n,{w:24,h:24,id_match:!1,no_img:!svgedit.browser.isWebkit(),fallback:l,placement:m,callback:function(){"m"!==a.pref("iconsize")&&e(),h=!0,j()}})}j()}}),d.textActions.setInputElem(a("#text")[0]);var Ab='<div class="palette_item" data-rgb="none"></div>';a.each(["#000000","#3f3f3f","#7f7f7f","#bfbfbf","#ffffff","#ff0000","#ff7f00","#ffff00","#7fff00","#00ff00","#00ff7f","#00ffff","#007fff","#0000ff","#7f00ff","#ff00ff","#ff007f","#7f0000","#7f3f00","#7f7f00","#3f7f00","#007f00","#007f3f","#007f7f","#003f7f","#00007f","#3f007f","#7f007f","#7f003f","#ffaaaa","#ffd4aa","#ffffaa","#d4ffaa","#aaffaa","#aaffd4","#aaffff","#aad4ff","#aaaaff","#d4aaff","#ffaaff","#ffaad4"],function(a,b){Ab+='<div class="palette_item" style="background-color: '+b+';" data-rgb="'+b+'"></div>'}),a("#palette").append(Ab),Ab="",a.each(["#FFF","#888","#000"],function(){Ab+='<div class="color_block" style="background-color:'+this+';"></div>'}),a("#bg_blocks").append(Ab);var Bb=a("#bg_blocks div");Bb.each(function(){a(this).click(function(){Bb.removeClass("cur_background"),a(this).addClass("cur_background")})}),p(a.pref("bkgd_color"),a.pref("bkgd_url")),a("#image_save_opts input").val([a.pref("img_save")]);var Cb=function(b,c){null==c&&(c=b.value),a("#group_opacity").val(c),b&&b.handle||a("#opac_slider").slider("option","value",c),d.setOpacity(c/100)},Db=function(b,c,e){null==c&&(c=b.value),a("#blur").val(c);var f=!1;b&&b.handle||(a("#blur_slider").slider("option","value",c),f=!0),e?d.setBlurNoUndo(c):d.setBlur(c,f)};a("#stroke_style").change(function(){d.setStrokeAttr("stroke-dasharray",a(this).val()),eb()}),a("#stroke_linejoin").change(function(){d.setStrokeAttr("stroke-linejoin",a(this).val()),eb()}),a("select").change(function(){a(this).blur()});var Eb=!1;a("#selLayerNames").change(function(){var b=this.options[this.selectedIndex].value,c=o.notification.QmoveElemsToLayer.replace("%s",b),e=function(a){a&&(Eb=!0,d.moveSelectedToLayer(b),d.clearSelection(),bb())};b&&(Eb?e(!0):a.confirm(c,e))}),a("#font_family").change(function(){d.setFontFamily(this.value)}),a("#seg_type").change(function(){d.setSegType(a(this).val())}),a("#text").keyup(function(){d.setTextContent(this.value)}),a("#image_url").change(function(){hb(this.value)}),a("#link_url").change(function(){this.value.length?d.setLinkURL(this.value):d.removeHyperlink()}),a("#g_title").change(function(){d.setGroupTitle(this.value)}),a(".attr_changer").change(function(){var b=this.getAttribute("data-attr"),c=this.value;if(!svgedit.units.isValidUnit(b,c,U))return a.alert(o.notification.invalidAttrValGiven),this.value=U.getAttribute(b),!1;if("id"!==b)if(isNaN(c))c=d.convertToNum(b,c);else if("px"!==l.baseUnit){var e=svgedit.units.getTypeMap();(U[b]||"pathedit"===d.getMode()||"x"===b||"y"===b)&&(c*=e[l.baseUnit])}"id"===b?(b=U,d.clearSelection(),b.id=c,d.addToSelection([b],!0)):d.changeSelectedAttribute(b,c),this.blur()}),a("#palette").mouseover(function(){var b=a('<input type="hidden">');a(this).append(b),b.focus().remove()}),a(".palette_item").mousedown(function(b){b=b.shiftKey||2===b.button?"stroke":"fill";var c,e=a(this).data("rgb");"none"===e||"transparent"===e||"initial"===e?(e="none",c=new a.jGraduate.Paint):c=new a.jGraduate.Paint({alpha:100,solidColor:e.substr(1)}),S[b].setPaint(c),d.setColor(b,e),"none"!==e&&1!==d.getPaintOpacity(b)&&d.setPaintOpacity(b,1),kb()}).bind("contextmenu",function(a){a.preventDefault()}),a("#toggle_stroke_tools").on("click",function(){a("#tools_bottom").toggleClass("expanded")}),function(){var b=null,e=null,f=L[0],g=!1,h=!1;a("#svgcanvas").bind("mousemove mouseup",function(a){return g!==!1?(f.scrollLeft-=a.clientX-b,f.scrollTop-=a.clientY-e,b=a.clientX,e=a.clientY,"mouseup"===a.type&&(g=!1),!1):void 0}).mousedown(function(a){return 1===a.button||h===!0?(g=!0,b=a.clientX,e=a.clientY,!1):void 0}),a(window).mouseup(function(){g=!1}),a(document).bind("keydown","space",function(a){d.spaceKey=h=!0,a.preventDefault()}).bind("keyup","space",function(a){a.preventDefault(),d.spaceKey=h=!1}).bind("keydown","shift",function(){"zoom"===d.getMode()&&L.css("cursor",P)}).bind("keyup","shift",function(){"zoom"===d.getMode()&&L.css("cursor",O)}),c.setPanning=function(a){d.spaceKey=h=a}}(),function(){var b=a("#main_icon"),c=a("#main_icon span"),d=a("#main_menu"),e=!1,f=0,g=!0,h=!1;a(window).mouseup(function(c){e||(b.removeClass("buttondown"),"INPUT"!=c.target.tagName?d.fadeOut(200):h||(h=!0,a(c.target).click(function(){d.css("margin-left","-9999px").show()}))),e=!1}).mousedown(function(b){a(b.target).closest("div.tools_flyout, .contextMenu").length||a(".tools_flyout:visible,.contextMenu").fadeOut(250)}),c.bind("mousedown",function(){b.hasClass("buttondown")?d.fadeOut(200):(d.css("margin-left",0).show(),f||(f=d.height()),d.css("height",0).animate({height:f},200),e=!0),b.toggleClass("buttondown buttonup")}).hover(function(){e=!0}).mouseout(function(){e=!1});var i=a("#main_menu li");i.mouseover(function(){g="rgba(0, 0, 0, 0)"==a(this).css("background-color"),i.unbind("mouseover"),g&&i.mouseover(function(){this.style.backgroundColor="#FFC"}).mouseout(function(){return this.style.backgroundColor="transparent",!0})})}(),c.addDropDown=function(b,c,d){if(0!=a(b).length){var e=a(b).find("button"),f=a(b).find("ul").attr("id",a(b)[0].id+"-list"),g=!1;d?a(b).addClass("dropup"):a("#option_lists").append(f),f.find("li").bind("mouseup",c),a(window).mouseup(function(){g||(e.removeClass("down"),f.hide()),g=!1}),e.bind("mousedown",function(){if(e.hasClass("down"))f.hide();else{if(!d){var c=a(b).position();f.css({top:c.top+24,left:c.left-10})}f.show(),g=!0}e.toggleClass("down")}).hover(function(){g=!0}).mouseout(function(){g=!1})}},c.addDropDown("#font_family_dropdown",function(){a("#font_family").val(a(this).text()).change()}),c.addDropDown("#opacity_dropdown",function(){if(!a(this).find("div").length){var b=parseInt(a(this).text().split("%")[0],10);Cb(!1,b)}},!0),a("#opac_slider").slider({start:function(){a("#opacity_dropdown li:not(.special)").hide()},stop:function(){a("#opacity_dropdown li").show(),a(window).mouseup()},slide:function(a,b){Cb(b)}}),c.addDropDown("#blur_dropdown",a.noop);var Fb=!1;a("#blur_slider").slider({max:10,step:.1,stop:function(b,c){Fb=!1,Db(c),a("#blur_dropdown li").show(),a(window).mouseup()},start:function(){Fb=!0},slide:function(a,b){Db(b,null,Fb)}}),c.addDropDown("#zoom_dropdown",function(){var b=a(this),c=b.data("val");c?ob(window,c):E({value:parseFloat(b.text())})},!0),xb("#stroke_linecap","#linecap_opts",function(){h(this,!0)},{dropUp:!0}),xb("#stroke_linejoin","#linejoin_opts",function(){h(this,!0)},{dropUp:!0}),xb("#tool_position","#position_opts",function(){var a=this.id.replace("tool_pos","").charAt(0);d.alignSelectedElements(a,"page")},{multiclick:!0}),function(){var b,c=function(){a(b).blur()};a("#svg_editor").find("button, select, input:not(#text)").focus(function(){b=this,Q="toolbars",L.mousedown(c)}).blur(function(){Q="canvas",L.unbind("mousedown",c),"textedit"==d.getMode()&&a("#text").focus()})}();var Gb=function(){fb("#tool_fhpath")&&d.setMode("fhpath")},Hb=function(){fb("#tool_line")&&d.setMode("line")},Ib=function(){fb("#tool_square")&&d.setMode("square")},Jb=function(){fb("#tool_rect")&&d.setMode("rect")},Kb=function(){fb("#tool_fhrect")&&d.setMode("fhrect")},Lb=function(){fb("#tool_circle")&&d.setMode("circle")},Mb=function(){fb("#tool_ellipse")&&d.setMode("ellipse")},Nb=function(){fb("#tool_fhellipse")&&d.setMode("fhellipse")},Ob=function(){fb("#tool_image")&&d.setMode("image")},Pb=function(){fb("#tool_zoom")&&(d.setMode("zoom"),L.css("cursor",O))},Qb=function(b){var c=d.getResolution();b=b?c.zoom*b:1,a("#zoom").val(100*b),d.setZoom(b),mb(),jb(!0)},Rb=function(){fb("#tool_zoom")&&(Qb(),T())},Sb=function(){fb("#tool_text")&&d.setMode("text")},Tb=function(){fb("#tool_path")&&d.setMode("path")},Ub=function(){(null!=U||V)&&d.deleteSelectedElements()},Vb=function(){(null!=U||V)&&d.cutSelectedElements()},Wb=function(){(null!=U||V)&&d.copySelectedElements()},Xb=function(){var a=d.getZoom(),b=(L[0].scrollLeft+L.width()/2)/a-d.contentW;a=(L[0].scrollTop+L.height()/2)/a-d.contentH,d.pasteElements("point",b,a)},Yb=function(){null!=U&&d.moveToTopSelectedElement()},Zb=function(){null!=U&&d.moveToBottomSelectedElement()},$b=function(a){null!=U&&d.moveUpDownSelected(a)},_b=function(){null!=U&&d.convertToPath()},ac=function(){null!=U&&I.reorient()},bc=function(){(null!=U||V)&&a.prompt(o.notification.enterNewLinkURL,"http://",function(a){a&&d.makeHyperlink(a)})},cc=function(a,b){if(null!=U||V){if(l.gridSnapping){var c=d.getZoom()*l.snappingStep;a*=c,b*=c}d.moveSelectedElements(a,b)}},dc=function(){a("#tool_node_link").toggleClass("push_button_pressed tool_button");var b=a("#tool_node_link").hasClass("push_button_pressed");I.linkControlPoints(b)},ec=function(){I.getNodePoint()&&I.clonePathNode()},fc=function(){I.getNodePoint()&&I.deletePathNode()},gc=function(){var b=a("#tool_add_subpath"),c=!b.hasClass("push_button_pressed");b.toggleClass("push_button_pressed tool_button"),I.addSubPath(c)},hc=function(){I.opencloseSubPath()},ic=function(){d.cycleElement(1)},jc=function(){d.cycleElement(0)},kc=function(b,c){if(null!=U&&!V){b||(c*=-1);var e=parseFloat(a("#angle").val())+c;d.setRotationAngle(e),lb()}},lc=function(){var b=l.dimensions;a.confirm(o.notification.QwantToClear,function(a){a&&(T(),d.clear(),d.setResolution(b[0],b[1]),jb(!0),Qb(),bb(),lb(),S.fill.prep(),S.stroke.prep(),d.runExtensions("onNewDocument"))})},mc=function(){return d.setBold(!d.getBold()),lb(),!1},nc=function(){return d.setItalic(!d.getItalic()),lb(),!1},oc=function(){a.select("Select an image type for export: ",["PNG","JPEG","BMP","WEBP"],function(b){if(b){if(!i.exportImage&&!i.pngsave){var c=o.notification.loadingImage;N=window.open("data:text/html;charset=utf-8,<title>"+c+"</title><h1>"+c+"</h1>")}var e=parseInt(a("#image-slider").val(),10)/100;window.canvg?d.rasterExport(b,e):a.getScript("canvg/rgbcolor.js",function(){a.getScript("canvg/canvg.js",function(){d.rasterExport(b,e)})})}},function(){var b=a(this);"JPEG"===b.val()||"WEBP"===b.val()?a("#image-slider").length||a('<div><label>Quality: <input id="image-slider" type="range" min="1" max="100" value="92" /></label></div>').appendTo(b.parent()):a("#image-slider").parent().remove()})},pc=function(){d.open()},qc=function(){},rc=function(){J.getUndoStackSize()>0&&(J.undo(),bb())},sc=function(){J.getRedoStackSize()>0&&(J.redo(),bb())},tc=function(){V?d.groupSelectedElements():U&&d.ungroupSelectedElement()},uc=function(){d.cloneSelectedElements(20,20)},vc=function(){var b=this.id.replace("tool_align","").charAt(0);d.alignSelectedElements(b,a("#align_relative_to").val())},wc=function(){if(a("#tool_wireframe").toggleClass("push_button_pressed tool_button"),L.toggleClass("wireframe"),!C){var b=a("#wireframe_rules");b.length?b.empty():a('<style id="wireframe_rules"></style>').appendTo("head"),mb()}};a("#svg_docprops_container, #svg_prefs_container").draggable({cancel:"button,fieldset",containment:"window"});var xc=function(){if(!X){X=!0,a("#image_save_opts input").val([a.pref("img_save")]);var b=d.getResolution();"px"!==l.baseUnit&&(b.w=svgedit.units.convertUnit(b.w)+l.baseUnit,b.h=svgedit.units.convertUnit(b.h)+l.baseUnit),a("#canvas_width").val(b.w),a("#canvas_height").val(b.h),a("#canvas_title").val(d.getDocumentTitle()),a("#svg_docprops").show()}},yc=function(){if(!Y){Y=!0,a("#main_menu").hide();var b=a("#bg_blocks div"),c=k.bkgd_color,d=a.pref("bkgd_url");b.each(function(){var b=a(this),d=b.css("background-color")==c;b.toggleClass("cur_background",d),d&&a("#canvas_bg_url").removeClass("cur_background")}),c||b.eq(0).addClass("cur_background"),d&&a("#canvas_bg_url").val(d),a("#grid_snapping_on").prop("checked",l.gridSnapping),a("#grid_snapping_step").attr("value",l.snappingStep),a("#grid_color").attr("value",l.gridColor),a("#svg_prefs").show()}},zc=function(){a("#svg_source_editor").hide(),W=!1,a("#svg_source_textarea").blur()},Ac=function(){if(W){var b=function(){d.clearSelection(),zc(),Qb(),bb(),nb(),S.fill.prep(),S.stroke.prep()};d.setSvgString(a("#svg_source_textarea").val())?b():a.confirm(o.notification.QerrorsRevertToSource,function(a){return a?void b():!1}),T()}},Bc=function(){a("#svg_docprops").hide(),a("#canvas_width,#canvas_height").removeAttr("disabled"),a("#resolution")[0].selectedIndex=0,a("#image_save_opts input").val([a.pref("img_save")]),X=!1},Cc=function(){a("#svg_prefs").hide(),Y=!1},Dc=function(){var b=a("#canvas_title").val();nb(b),d.setDocumentTitle(b),b=a("#canvas_width");var c=b.val(),e=a("#canvas_height"),f=e.val();return"fit"==c||svgedit.units.isValidUnit("width",c)?(b.parent().removeClass("error"),"fit"==f||svgedit.units.isValidUnit("height",f)?(e.parent().removeClass("error"),d.setResolution(c,f)?(a.pref("img_save",a("#image_save_opts :checked").val()),jb(),void Bc()):(a.alert(o.notification.noContentToFitTo),!1)):(a.alert(o.notification.invalidAttrValGiven),e.parent().addClass("error"),!1)):(a.alert(o.notification.invalidAttrValGiven),b.parent().addClass("error"),!1)},Ec=c.savePreferences=function(){var b=a("#bg_blocks div.cur_background").css("background-color")||"#FFF";p(b,a("#canvas_bg_url").val()),b=a("#lang_select").val(),b!==a.pref("lang")&&c.putLocale(b,z),wb(a("#iconsize").val()),l.gridSnapping=a("#grid_snapping_on")[0].checked,l.snappingStep=a("#grid_snapping_step").val(),l.gridColor=a("#grid_color").val(),l.showRulers=a("#show_rulers")[0].checked,a("#rulers").toggle(l.showRulers),l.showRulers&&r(),l.baseUnit=a("#base_unit").val(),d.setConfig(l),jb(),Cc()},Fc=a.noop,Gc=function(){a("#dialog_box").hide(),W||X||Y?(W?R!==a("#svg_source_textarea").val()?a.confirm(o.notification.QignoreSourceChanges,function(a){a&&zc()}):zc():X?Bc():Y&&Cc(),Fc()):Z&&d.leaveContext()},Hc={width:a(window).width(),height:a(window).height()};if(svgedit.browser.isIE()&&function(){Fc=function(){0===L[0].scrollLeft&&0===L[0].scrollTop&&(L[0].scrollLeft=G.left,L[0].scrollTop=G.top)},G={left:L[0].scrollLeft,top:L[0].scrollTop},a(window).resize(Fc),c.ready(function(){setTimeout(function(){Fc()},500)}),L.scroll(function(){G={left:L[0].scrollLeft,top:L[0].scrollTop}})}(),a(window).resize(function(){a.each(Hc,function(b,c){var d=a(window)[b]();L[0]["scroll"+("width"===b?"Left":"Top")]-=(d-c)/2,Hc[b]=d}),rb()}),function(){L.scroll(function(){0!=a("#ruler_x").length&&(a("#ruler_x")[0].scrollLeft=L[0].scrollLeft),0!=a("#ruler_y").length&&(a("#ruler_y")[0].scrollTop=L[0].scrollTop)})}(),a("#url_notice").click(function(){a.alert(this.title)}),a("#change_image_url").click(q),function(){var b=["clear","open","save","source","delete","delete_multi","paste","clone","clone_multi","move_top","move_bottom"],c="";a.each(b,function(a,d){c+="#tool_"+d+(a==b.length-1?",":"")}),a(c).mousedown(function(){a(this).addClass("tool_button_current")}).bind("mousedown mouseout",function(){a(this).removeClass("tool_button_current")}),a("#tool_undo, #tool_redo").mousedown(function(){a(this).hasClass("disabled")||a(this).addClass("tool_button_current")}).bind("mousedown mouseout",function(){a(this).removeClass("tool_button_current")})}(),svgedit.browser.isMac()&&!window.opera){var Ic=["tool_clear","tool_save","tool_source","tool_undo","tool_redo","tool_clone"];for(B=Ic.length;B--;){var Jc=document.getElementById(Ic[B]);if(Jc){var Kc=Jc.title,Lc=Kc.indexOf("Ctrl+");Jc.title=[Kc.substr(0,Lc),"Cmd+",Kc.substr(Lc+5)].join("")}}}var Mc=function(b){var c="stroke_color"==b.attr("id")?"stroke":"fill",e=S[c].paint,f="stroke"==c?"Pick a Stroke Paint and Opacity":"Pick a Fill Paint and Opacity";b=b.offset(),a("#color_picker").draggable({cancel:".jGraduate_tabs, .jGraduate_colPick, .jGraduate_gradPick, .jPicker",containment:"window"}).css(l.colorPickerCSS||{left:b.left-140,bottom:40}).jGraduate({paint:e,window:{pickerTitle:f},images:{clientPath:l.jGraduatePath},newstop:"inverse"},function(b){e=new a.jGraduate.Paint(b),S[c].setPaint(e),d.setPaint(c,e),a("#color_picker").hide()},function(){a("#color_picker").hide()})};B=function(b,c){var e,f,g=l["fill"===c?"initFill":"initStroke"],h=(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg"><rect width="16.5" height="16.5"					fill="#'+g.color+'" opacity="'+g.opacity+'"/>					<defs><linearGradient id="gradbox_"/></defs></svg>',"text/xml").documentElement;h=a(b)[0].appendChild(document.importNode(h,!0)),h.setAttribute("width",16.5),this.rect=h.firstChild,this.defs=h.getElementsByTagName("defs")[0],this.grad=this.defs.firstChild,this.paint=new a.jGraduate.Paint({solidColor:g.color}),this.type=c,this.setPaint=function(a,b){this.paint=a;var c="none",g=a.type,h=a.alpha/100;switch(g){case"solidColor":c="none"!=a[g]?"#"+a[g]:a[g];break;case"linearGradient":case"radialGradient":this.defs.removeChild(this.grad),this.grad=this.defs.appendChild(a[g]),c="url(#"+(this.grad.id="gradbox_"+this.type)+")"}this.rect.setAttribute("fill",c),this.rect.setAttribute("opacity",h),b&&(d.setColor(this.type,e,!0),d.setPaintOpacity(this.type,f,!0))},this.update=function(a){if(U){var b,c,g=this.type;switch(U.tagName){case"use":case"image":case"foreignObject":return;case"g":case"a":var h=null,i=U.getElementsByTagName("*");for(b=0,c=i.length;c>b;b++){var j=i[b].getAttribute(g);if(0===b)h=j;else if(h!==j){h=null;break}}if(null===h)return void(e=null);e=h,f=1;break;default:f=parseFloat(U.getAttribute(g+"-opacity")),isNaN(f)&&(f=1),b="fill"===g?"black":"none",e=U.getAttribute(g)||b}a&&(d.setColor(g,e,!0),d.setPaintOpacity(g,f,!0)),f*=100,this.setPaint(zb(e,f,g))}},this.prep=function(){switch(this.paint.type){case"linearGradient":case"radialGradient":var b=new a.jGraduate.Paint({copy:this.paint});d.setPaint(c,b)}}},S.fill=new B("#fill_color","fill"),S.stroke=new B("#stroke_color","stroke"),a("#stroke_width").val(l.initStroke.width),a("#group_opacity").val(100*l.initOpacity),B=S.fill.rect.cloneNode(!1),B.setAttribute("style","vector-effect:non-scaling-stroke"),C="non-scaling-stroke"===B.style.vectorEffect,B.removeAttribute("style"),B=S.fill.rect.ownerDocument.createElementNS(svgedit.NS.SVG,"feGaussianBlur"),void 0===B.stdDeviationX&&a("#tool_blur").hide(),a(B).remove(),function(){var a="-"+ub.toLowerCase()+"-zoom-",b=a+"in";L.css("cursor",b),L.css("cursor")===b&&(O=b,P=a+"out"),L.css("cursor","auto")}(),setTimeout(function(){d.embedImage("images/logo.png",function(b){b||(a("#image_save_opts [value=embed]").attr("disabled","disabled"),a("#image_save_opts input").val(["ref"]),a.pref("img_save","ref"),a("#image_opt_embed").css("color","#666").attr("title",o.notification.featNotSupported))})},1e3),a("#fill_color, #tool_fill .icon_label").click(function(){Mc(a("#fill_color")),kb()}),a("#stroke_color, #tool_stroke .icon_label").click(function(){Mc(a("#stroke_color")),kb()}),a("#group_opacityLabel").click(function(){a("#opacity_dropdown button").mousedown(),a(window).mouseup()}),a("#zoomLabel").click(function(){a("#zoom_dropdown button").mousedown(),a(window).mouseup()}),a("#tool_move_top").mousedown(function(b){a("#tools_stacking").show(),b.preventDefault()}),a(".layer_button").mousedown(function(){a(this).addClass("layer_buttonpressed")}).mouseout(function(){a(this).removeClass("layer_buttonpressed")}).mouseup(function(){a(this).removeClass("layer_buttonpressed")}),a(".push_button").mousedown(function(){a(this).hasClass("disabled")||a(this).addClass("push_button_pressed").removeClass("push_button")}).mouseout(function(){a(this).removeClass("push_button_pressed").addClass("push_button")}).mouseup(function(){a(this).removeClass("push_button_pressed").addClass("push_button")}),a("#layer_new").click(function(){var b,c=d.getCurrentDrawing().getNumLayers();do b=o.layers.layer+" "+ ++c;while(d.getCurrentDrawing().hasLayer(b));a.prompt(o.notification.enterUniqueLayerName,b,function(b){b&&(d.getCurrentDrawing().hasLayer(b)?a.alert(o.notification.dupeLayerName):(d.createLayer(b),lb(),bb()))})}),a("#layer_delete").click(s),a("#layer_up").click(function(){u(-1)}),a("#layer_down").click(function(){u(1)}),a("#layer_rename").click(function(){var b=a("#layerlist tr.layersel td.layername").text();a.prompt(o.notification.enterNewLayerName,"",function(c){c&&(b==c||d.getCurrentDrawing().hasLayer(c)?a.alert(o.notification.layerHasThatName):(d.renameCurrentLayer(c),bb()))})});var Nc=-1,Oc=!1,Pc=!1,Qc=function(b){var c=a("#ruler_x");a("#sidepanels").width("+="+b),a("#layerpanel").width("+="+b),c.css("right",parseInt(c.css("right"),10)+b),L.css("right",parseInt(L.css("right"),10)+b),d.runExtensions("workareaResized")
},Rc=function(b){if(Pc&&-1!=Nc){Oc=!0,b=Nc-b.pageX;var c=a("#sidepanels").width();c+b>300?b=300-c:2>c+b&&(b=2-c),0!=b&&(Nc-=b,Qc(b))}},Sc=function(b){var c=a("#sidepanels").width();Qc((c>2||b?2:150)-c)};a("#sidepanel_handle").mousedown(function(b){Nc=b.pageX,a(window).mousemove(Rc),Pc=!1,setTimeout(function(){Pc=!0},20)}).mouseup(function(){Oc||Sc(),Nc=-1,Oc=!1}),a(window).mouseup(function(){Nc=-1,Oc=!1,a("#svg_editor").unbind("mousemove",Rc)}),bb(),a(window).bind("load resize",function(){L.css("line-height",L.height()+"px")}),a("#resolution").change(function(){var b=a("#canvas_width,#canvas_height");if(this.selectedIndex)if("content"==this.value)b.val("fit").attr("disabled","disabled");else{var c=this.value.split("x");a("#canvas_width").val(c[0]),a("#canvas_height").val(c[1]),b.removeAttr("disabled")}else"fit"==a("#canvas_width").val()&&b.removeAttr("disabled").val(100)}),a("input,select").attr("autocomplete","off"),F=function(){var b=[{sel:"#tool_select",fn:gb,evt:"click",key:["V",!0]},{sel:"#tool_fhpath",fn:Gb,evt:"click",key:["Q",!0]},{sel:"#tool_line",fn:Hb,evt:"click",key:["L",!0]},{sel:"#tool_rect",fn:Jb,evt:"mouseup",key:["R",!0],parent:"#tools_rect",icon:"rect"},{sel:"#tool_square",fn:Ib,evt:"mouseup",parent:"#tools_rect",icon:"square"},{sel:"#tool_fhrect",fn:Kb,evt:"mouseup",parent:"#tools_rect",icon:"fh_rect"},{sel:"#tool_ellipse",fn:Mb,evt:"mouseup",key:["E",!0],parent:"#tools_ellipse",icon:"ellipse"},{sel:"#tool_circle",fn:Lb,evt:"mouseup",parent:"#tools_ellipse",icon:"circle"},{sel:"#tool_fhellipse",fn:Nb,evt:"mouseup",parent:"#tools_ellipse",icon:"fh_ellipse"},{sel:"#tool_path",fn:Tb,evt:"click",key:["P",!0]},{sel:"#tool_text",fn:Sb,evt:"click",key:["T",!0]},{sel:"#tool_image",fn:Ob,evt:"mouseup"},{sel:"#tool_zoom",fn:Pb,evt:"mouseup",key:["Z",!0]},{sel:"#tool_clear",fn:lc,evt:"mouseup",key:["N",!0]},{sel:"#tool_save",fn:function(){if(W)Ac();else{var b={images:a.pref("img_save"),round_digits:6};d.save(b)}},evt:"mouseup",key:["S",!0]},{sel:"#tool_export",fn:oc,evt:"mouseup"},{sel:"#tool_open",fn:pc,evt:"mouseup",key:["O",!0]},{sel:"#tool_import",fn:qc,evt:"mouseup"},{sel:"#tool_source",fn:cb,evt:"click",key:["U",!0]},{sel:"#tool_wireframe",fn:wc,evt:"click",key:["F",!0]},{sel:"#tool_source_cancel,.overlay,#tool_docprops_cancel,#tool_prefs_cancel",fn:Gc,evt:"click",key:["esc",!1,!1],hidekey:!0},{sel:"#tool_source_save",fn:Ac,evt:"click"},{sel:"#tool_docprops_save",fn:Dc,evt:"click"},{sel:"#tool_docprops",fn:xc,evt:"mouseup"},{sel:"#tool_prefs_save",fn:Ec,evt:"click"},{sel:"#tool_prefs_option",fn:function(){return yc(),!1},evt:"mouseup"},{sel:"#tool_delete,#tool_delete_multi",fn:Ub,evt:"click",key:["del/backspace",!0]},{sel:"#tool_reorient",fn:ac,evt:"click"},{sel:"#tool_node_link",fn:dc,evt:"click"},{sel:"#tool_node_clone",fn:ec,evt:"click"},{sel:"#tool_node_delete",fn:fc,evt:"click"},{sel:"#tool_openclose_path",fn:hc,evt:"click"},{sel:"#tool_add_subpath",fn:gc,evt:"click"},{sel:"#tool_move_top",fn:Yb,evt:"click",key:"ctrl+shift+]"},{sel:"#tool_move_bottom",fn:Zb,evt:"click",key:"ctrl+shift+["},{sel:"#tool_topath",fn:_b,evt:"click"},{sel:"#tool_make_link,#tool_make_link_multi",fn:bc,evt:"click"},{sel:"#tool_undo",fn:rc,evt:"click",key:["Z",!0]},{sel:"#tool_redo",fn:sc,evt:"click",key:["Y",!0]},{sel:"#tool_clone,#tool_clone_multi",fn:uc,evt:"click",key:["D",!0]},{sel:"#tool_group_elements",fn:tc,evt:"click",key:["G",!0]},{sel:"#tool_ungroup",fn:tc,evt:"click"},{sel:"#tool_unlink_use",fn:tc,evt:"click"},{sel:"[id^=tool_align]",fn:vc,evt:"click"},{sel:"#tool_bold",fn:mc,evt:"mousedown"},{sel:"#tool_italic",fn:nc,evt:"mousedown"},{sel:"#sidepanel_handle",fn:Sc,key:["X"]},{sel:"#copy_save_done",fn:Gc,evt:"click"},{key:"ctrl+left",fn:function(){kc(0,1)}},{key:"ctrl+right",fn:function(){kc(1,1)}},{key:"ctrl+shift+left",fn:function(){kc(0,5)}},{key:"ctrl+shift+right",fn:function(){kc(1,5)}},{key:"shift+O",fn:jc},{key:"shift+P",fn:ic},{key:[H+"up",!0],fn:function(){Qb(2)}},{key:[H+"down",!0],fn:function(){Qb(.5)}},{key:[H+"]",!0],fn:function(){$b("Up")}},{key:[H+"[",!0],fn:function(){$b("Down")}},{key:["up",!0],fn:function(){cc(0,-1)}},{key:["down",!0],fn:function(){cc(0,1)}},{key:["left",!0],fn:function(){cc(-1,0)}},{key:["right",!0],fn:function(){cc(1,0)}},{key:"shift+up",fn:function(){cc(0,-10)}},{key:"shift+down",fn:function(){cc(0,10)}},{key:"shift+left",fn:function(){cc(-10,0)}},{key:"shift+right",fn:function(){cc(10,0)}},{key:["alt+up",!0],fn:function(){d.cloneSelectedElements(0,-1)}},{key:["alt+down",!0],fn:function(){d.cloneSelectedElements(0,1)}},{key:["alt+left",!0],fn:function(){d.cloneSelectedElements(-1,0)}},{key:["alt+right",!0],fn:function(){d.cloneSelectedElements(1,0)}},{key:["alt+shift+up",!0],fn:function(){d.cloneSelectedElements(0,-10)}},{key:["alt+shift+down",!0],fn:function(){d.cloneSelectedElements(0,10)}},{key:["alt+shift+left",!0],fn:function(){d.cloneSelectedElements(-10,0)}},{key:["alt+shift+right",!0],fn:function(){d.cloneSelectedElements(10,0)}},{key:"A",fn:function(){d.selectAllInCurrentLayer()}},{key:H+"z",fn:rc},{key:H+"shift+z",fn:sc},{key:H+"y",fn:sc},{key:H+"x",fn:Vb},{key:H+"c",fn:Wb},{key:H+"v",fn:Xb}],c={"4/Shift+4":"#tools_rect_show","5/Shift+5":"#tools_ellipse_show"};return{setAll:function(){var d={};a.each(b,function(b,e){var f;if(e.sel){if(f=a(e.sel),0==f.length)return!0;if(e.evt&&(svgedit.browser.isTouch()&&"click"===e.evt&&(e.evt="mousedown"),f[e.evt](e.fn)),e.parent&&0!=a(e.parent+"_show").length){var g=a(e.parent);g.length||(g=tb(e.parent.substr(1))),g.append(f),a.isArray(d[e.parent])||(d[e.parent]=[]),d[e.parent].push(e)}}if(e.key){var h=e.fn,i=!1;if(a.isArray(e.key)?(g=e.key[0],e.key.length>1&&(i=e.key[1])):g=e.key,g+="",a.each(g.split("/"),function(b,c){a(document).bind("keydown",c,function(a){return h(),i&&a.preventDefault(),!1})}),e.sel&&!e.hidekey&&f.attr("title")){var j=f.attr("title").split("[")[0]+" ("+g+")";c[g]=e.sel,f.parents("#main_menu").length||f.attr("title",j)}}}),sb(d),a(".attr_changer, #image_url").bind("keydown","return",function(b){a(this).change(),b.preventDefault()}),a(window).bind("keydown","tab",function(a){"canvas"===Q&&(a.preventDefault(),ic())}).bind("keydown","shift+tab",function(a){"canvas"===Q&&(a.preventDefault(),jc())}),a("#tool_zoom").dblclick(Rb)},setTitles:function(){a.each(c,function(b,c){var d=a(c).parents("#main_menu").length;a(c).each(function(){var c;c=d?a(this).text().split(" [")[0]:this.title.split(" [")[0];var e="";a.each(b.split("/"),function(a,b){var c=b.split("+"),d="";c.length>1&&(d=c[0]+"+",b=c[1]),e+=(a?"/":"")+d+(o["key_"+b]||b)}),d?this.lastChild.textContent=c+" ["+e+"]":this.title=c+" ["+e+"]"})})},getButtonData:function(c){var d;return a.each(b,function(a,b){b.sel===c&&(d=b)}),d}}}(),F.setAll(),c.ready(function(){var b=l.initTool,c=a("#tools_left, #svg_editor .tools_flyout"),d=c.find("#tool_"+b);b=c.find("#"+b),(d.length?d:b.length?b:a("#tool_select")).click().mouseup(),l.wireframe&&a("#tool_wireframe").click(),l.showlayers&&Sc(),a("#rulers").toggle(!!l.showRulers),l.showRulers&&(a("#show_rulers")[0].checked=!0),l.baseUnit&&a("#base_unit").val(l.baseUnit),l.gridSnapping&&(a("#grid_snapping_on")[0].checked=!0),l.snappingStep&&a("#grid_snapping_step").val(l.snappingStep),l.gridColor&&a("#grid_color").val(l.gridColor)}),a("#rect_rx").SpinButton({min:0,max:1e3,callback:function(a){d.setRectRadius(a.value)}}),a("#stroke_width").SpinButton({min:0,max:99,smallStep:.1,callback:function(a){var b=a.value;0==b&&U&&["line","polyline"].indexOf(U.nodeName)>=0&&(b=a.value=1),d.setStrokeWidth(b)}}),a("#angle").SpinButton({min:-180,max:180,step:5,callback:function(b){d.setRotationAngle(b.value),a("#tool_reorient").toggleClass("disabled",0===parseInt(b.value,10))}}),a("#font_size").SpinButton({min:.001,stepfunc:function(a,b){var c=Number(a.value),d=c+b,e=d>=c;return 0===b?c:c>=24?Math.round(e?1.1*c:c/1.1):1>=c?e?2*c:c/2:d},callback:function(a){d.setFontSize(a.value)}}),a("#group_opacity").SpinButton({min:0,max:100,step:5,callback:Cb}),a("#blur").SpinButton({min:0,max:10,step:.1,callback:Db}),a("#zoom").SpinButton({min:.001,max:1e4,step:50,stepfunc:function(a,b){var c=Number(a.value);if(0===c)return 100;var d=c+b;return 0===b?c:c>=100?d:d>=c?2*c:c/2},callback:E}).val(100*d.getZoom()),a("#workarea").contextMenu({menu:"cmenu_canvas",inSpeed:0},function(a){switch(a){case"delete":Ub();break;case"cut":Vb();break;case"copy":Wb();break;case"paste":d.pasteElements();break;case"paste_in_place":d.pasteElements("in_place");break;case"group_elements":d.groupSelectedElements();break;case"ungroup":d.ungroupSelectedElement();break;case"move_front":Yb();break;case"move_up":$b("Up");break;case"move_down":$b("Down");break;case"move_back":Zb();break;default:svgedit.contextmenu&&svgedit.contextmenu.hasCustomHandler(a)&&svgedit.contextmenu.getCustomHandler(a).call()}d.clipBoard.length&&M.enableContextMenuItems("#paste,#paste_in_place")}),B=function(b){switch(b){case"dupe":t();break;case"delete":s();break;case"merge_down":a("#layerlist tr.layersel").index()!=d.getCurrentDrawing().getNumLayers()-1&&(d.mergeLayer(),lb(),bb());break;case"merge_all":d.mergeAllLayers(),lb(),bb()}},a("#layerlist").contextMenu({menu:"cmenu_layers",inSpeed:0},B),a("#layer_moreopts").contextMenu({menu:"cmenu_layers",inSpeed:0,allowLeft:!0},B),a(".contextMenu li").mousedown(function(a){a.preventDefault()}),a("#cmenu_canvas li").disableContextMenu(),M.enableContextMenuItems("#delete,#cut,#copy"),window.addEventListener("beforeunload",function(a){return 0===J.getUndoStackSize()&&(c.showSaveWarning=!1),!l.no_save_warning&&c.showSaveWarning?a.returnValue=o.notification.unsavedChanges:void 0},!1),c.openPrep=function(b){a("#main_menu").hide(),0===J.getUndoStackSize()?b(!0):a.confirm(o.notification.QwantToOpen,b)},window.FileReader&&(B=function(b){if(a.process_cancel(o.notification.loadingImage),b.stopPropagation(),b.preventDefault(),a("#workarea").removeAttr("style"),a("#main_menu").hide(),(b="drop"==b.type?b.dataTransfer.files[0]:this.files[0])&&-1!=b.type.indexOf("image")){var c;-1!=b.type.indexOf("svg")?(c=new FileReader,c.onloadend=function(a){d.importSvgString(a.target.result,!0),d.ungroupSelectedElement(),d.ungroupSelectedElement(),d.groupSelectedElements(),d.alignSelectedElements("m","page"),d.alignSelectedElements("c","page")},c.readAsText(b)):(c=new FileReader,c.onloadend=function(a){var b=100,c=100,e=new Image;e.src=a.target.result,e.style.opacity=0,e.onload=function(){b=e.offsetWidth,c=e.offsetHeight;var f=d.addSvgElementFromJson({element:"image",attr:{x:0,y:0,width:b,height:c,id:d.getNextId(),style:"pointer-events:inherit"}});d.setHref(f,a.target.result),d.selectOnly([f]),d.alignSelectedElements("m","page"),d.alignSelectedElements("c","page"),lb()}},c.readAsDataURL(b))}},L[0].addEventListener("dragenter",v,!1),L[0].addEventListener("dragover",w,!1),L[0].addEventListener("dragleave",x,!1),L[0].addEventListener("drop",B,!1),Ic=a('<input type="file">').change(function(){var e=this;c.openPrep(function(c){c&&(d.clear(),1===e.files.length&&(a.process_cancel(o.notification.loadingImage),c=new FileReader,c.onloadend=function(a){b(a.target.result),jb()},c.readAsText(e.files[0])))})}),a("#tool_open").show().prepend(Ic),B=a('<input type="file">').change(B),a("#tool_import").show().prepend(B)),jb(!0),a(function(){window.svgCanvas=d,d.ready=c.ready}),c.setLang=function(b,e){if(c.langChanged=!0,a.pref("lang",b),a("#lang_select").val(b),e){var f=a("#layerlist tr.layersel td.layername").text()==o.common.layer+" 1";if(a.extend(o,e),d.setUiStrings(e),F.setTitles(),f&&(d.renameCurrentLayer(o.common.layer+" 1"),bb()),yb.length)for(;yb.length;)yb.shift().langReady({lang:b,uiStrings:o});else d.runExtensions("langReady",{lang:b,uiStrings:o});d.runExtensions("langChanged",b),qb(),a.each({"#stroke_color":"#tool_stroke .icon_label, #tool_stroke .color_block","#fill_color":"#tool_fill label, #tool_fill .color_block","#linejoin_miter":"#cur_linejoin","#linecap_butt":"#cur_linecap"},function(b,c){a(c).attr("title",a(b)[0].title)}),a("#multiselected_panel div[id^=tool_align]").each(function(){a("#tool_pos"+this.id.substr(10))[0].title=this.title})}}},c.ready=function(a){g?a():h.push(a)},c.runCallbacks=function(){a.each(h,function(){this()}),g=!0},c.loadFromString=function(a){c.ready(function(){b(a)})},c.disableUI=function(){},c.loadFromURL=function(d,e){e||(e={});var f=e.cache,g=e.callback;c.ready(function(){a.ajax({url:d,dataType:"text",cache:!!f,beforeSend:function(){a.process_cancel(o.notification.loadingImage)},success:function(a){b(a,g)},error:function(c,d,e){404!=c.status&&c.responseText?b(c.responseText,g):a.alert(o.notification.URLloadFail+": \n"+e,g)},complete:function(){a("#dialog_box").hide()}})})},c.loadFromDataURI=function(a){c.ready(function(){var c=a.substring(26);b(f.decode64(c))})},c.addExtension=function(){var b=arguments;a(function(){d&&d.addExtension.apply(this,b)})},c}(jQuery),$(svgEditor.init))}();var svgEditor=function(a,b){function c(b,c,d){var e,f,g,h,i,j=a("#svg_editor").parent();for(f in c)if((g=c[f])||console.log(f),d&&(f="#"+f),e=j.find(f),e.length)switch(h=j.find(f)[0],b){case"content":for(e=0;e<h.childNodes.length;e++)if(i=h.childNodes[e],3===i.nodeType&&i.textContent.replace(/\s/g,"")){i.textContent=g;break}break;case"title":h.title=g}else console.log("Missing: "+f)}var d;return b.readLang=function(e){var f=b.canvas.runExtensions("addlangData",d,!0);if(a.each(f,function(b,c){c.data&&(e=a.merge(e,c.data))}),e.tools){var g=e.tools;f=e.properties;var h=e.config,i=e.layers,j=e.common,k=e.ui;c("content",{curve_segments:f.curve_segments,fitToContent:g.fitToContent,fit_to_all:g.fit_to_all,fit_to_canvas:g.fit_to_canvas,fit_to_layer_content:g.fit_to_layer_content,fit_to_sel:g.fit_to_sel,icon_large:h.icon_large,icon_medium:h.icon_medium,icon_small:h.icon_small,icon_xlarge:h.icon_xlarge,image_opt_embed:h.image_opt_embed,image_opt_ref:h.image_opt_ref,includedImages:h.included_images,largest_object:g.largest_object,layersLabel:i.layers,page:g.page,relativeToLabel:g.relativeTo,selLayerLabel:i.move_elems_to,selectedPredefined:h.select_predefined,selected_objects:g.selected_objects,smallest_object:g.smallest_object,straight_segments:f.straight_segments,svginfo_bg_url:h.editor_img_url+":",svginfo_bg_note:h.editor_bg_note,svginfo_change_background:h.background,svginfo_dim:h.doc_dims,svginfo_editor_prefs:h.editor_prefs,svginfo_height:j.height,svginfo_icons:h.icon_size,svginfo_image_props:h.image_props,svginfo_lang:h.language,svginfo_title:h.doc_title,svginfo_width:j.width,tool_docprops_cancel:j.cancel,tool_docprops_save:j.ok,tool_source_cancel:j.cancel,tool_source_save:j.ok,tool_prefs_cancel:j.cancel,tool_prefs_save:j.ok,sidepanel_handle:i.layers.split("").join(" "),tool_clear:g.new_doc,tool_docprops:g.docprops,tool_export:g.export_img,tool_import:g.import_doc,tool_imagelib:g.imagelib,tool_open:g.open_doc,tool_save:g.save_doc,svginfo_units_rulers:h.units_and_rulers,svginfo_rulers_onoff:h.show_rulers,svginfo_unit:h.base_unit,svginfo_grid_settings:h.grid,svginfo_snap_onoff:h.snapping_onoff,svginfo_snap_step:h.snapping_stepsize,svginfo_grid_color:h.grid_color},!0);var l,m={};for(l in e.shape_cats)m['#shape_cats [data-cat="'+l+'"]']=e.shape_cats[l];setTimeout(function(){c("content",m)},2e3);var n={};a.each(["cut","copy","paste","paste_in_place","delete","group","ungroup","move_front","move_up","move_down","move_back"],function(){n['#cmenu_canvas a[href="#'+this+'"]']=g[this]}),a.each(["dupe","merge_down","merge_all"],function(){n['#cmenu_layers a[href="#'+this+'"]']=i[this]}),n['#cmenu_layers a[href="#delete"]']=i.del,c("content",n),c("title",{align_relative_to:g.align_relative_to,circle_cx:f.circle_cx,circle_cy:f.circle_cy,circle_r:f.circle_r,cornerRadiusLabel:f.corner_radius,ellipse_cx:f.ellipse_cx,ellipse_cy:f.ellipse_cy,ellipse_rx:f.ellipse_rx,ellipse_ry:f.ellipse_ry,fill_color:f.fill_color,font_family:f.font_family,idLabel:f.id,image_height:f.image_height,image_url:f.image_url,image_width:f.image_width,layer_delete:i.del,layer_down:i.move_down,layer_new:i["new"],layer_rename:i.rename,layer_moreopts:j.more_opts,layer_up:i.move_up,line_x1:f.line_x1,line_x2:f.line_x2,line_y1:f.line_y1,line_y2:f.line_y2,linecap_butt:f.linecap_butt,linecap_round:f.linecap_round,linecap_square:f.linecap_square,linejoin_bevel:f.linejoin_bevel,linejoin_miter:f.linejoin_miter,linejoin_round:f.linejoin_round,main_icon:g.main_menu,mode_connect:g.mode_connect,tools_shapelib_show:g.mode_shapelib,palette:k.palette_info,zoom_panel:k.zoom_level,path_node_x:f.node_x,path_node_y:f.node_y,rect_height_tool:f.rect_height,rect_width_tool:f.rect_width,seg_type:f.seg_type,selLayerNames:i.move_selected,selected_x:f.pos_x,selected_y:f.pos_y,stroke_color:f.stroke_color,stroke_style:f.stroke_style,stroke_width:f.stroke_width,svginfo_title:h.doc_title,text:f.text_contents,toggle_stroke_tools:k.toggle_stroke_tools,tool_add_subpath:g.add_subpath,tool_alignbottom:g.align_bottom,tool_aligncenter:g.align_center,tool_alignleft:g.align_left,tool_alignmiddle:g.align_middle,tool_alignright:g.align_right,tool_aligntop:g.align_top,tool_angle:f.angle,tool_blur:f.blur,tool_bold:f.bold,tool_circle:g.mode_circle,tool_clone:g.clone,tool_clone_multi:g.clone,tool_delete:g.del,tool_delete_multi:g.del,tool_ellipse:g.mode_ellipse,tool_eyedropper:g.mode_eyedropper,tool_fhellipse:g.mode_fhellipse,tool_fhpath:g.mode_fhpath,tool_fhrect:g.mode_fhrect,tool_font_size:f.font_size,tool_group_elements:g.group_elements,tool_make_link:g.make_link,tool_link_url:g.set_link_url,tool_image:g.mode_image,tool_italic:f.italic,tool_line:g.mode_line,tool_move_bottom:g.move_bottom,tool_move_top:g.move_top,tool_node_clone:g.node_clone,tool_node_delete:g.node_delete,tool_node_link:g.node_link,tool_opacity:f.opacity,tool_openclose_path:g.openclose_path,tool_path:g.mode_path,tool_position:g.align_to_page,tool_rect:g.mode_rect,tool_redo:g.redo,tool_reorient:g.reorient_path,tool_select:g.mode_select,tool_source:g.source_save,tool_square:g.mode_square,tool_text:g.mode_text,tool_topath:g.to_path,tool_undo:g.undo,tool_ungroup:g.ungroup,tool_wireframe:g.wireframe_mode,view_grid:g.toggle_grid,tool_zoom:g.mode_zoom,url_notice:g.no_embed},!0),b.setLang(d,e)}},b.putLocale=function(c,e){if(c)d=c;else{if(d=a.pref("lang"),!d&&(navigator.userLanguage?d=navigator.userLanguage:navigator.language&&(d=navigator.language),null==d))return;console.log("Lang: "+d),-1===a.inArray(d,e)&&"test"!==d&&(d="en")}var f=b.curConfig.langPath+"lang."+d+".js";a.getScript(f,function(a){a||(a=document.createElement("script"),a.src=f,document.querySelector("head").appendChild(a))})},b}(jQuery,svgEditor);svgedit=svgedit||{},function(){var a=this;svgedit.contextmenu||(svgedit.contextmenu={}),a.contextMenuExtensions={},svgEditor.ready(function(){for(var b in contextMenuExtensions){var c=contextMenuExtensions[b];0===Object.keys(a.contextMenuExtensions).length&&$("#cmenu_canvas").append("<li class='separator'>");var d=c.shortcut||"";$("#cmenu_canvas").append("<li class='disabled'><a href='#"+c.id+"'>"+c.label+"<span class='shortcut'>"+d+"</span></a></li>")}}),svgedit.contextmenu.resetCustomMenus=function(){a.contextMenuExtensions={}},svgedit.contextmenu.add=function(b){b&&b.id&&b.label&&b.action&&"function"==typeof b.action?b.id in a.contextMenuExtensions?console.error('Cannot add extension "'+b.id+'", an extension by that name already exists"'):(console.log("Registed contextmenu item: {id:"+b.id+", label:"+b.label+"}"),a.contextMenuExtensions[b.id]=b):console.error("Menu items must be defined and have at least properties: id, label, action, where action must be a function")},svgedit.contextmenu.hasCustomHandler=function(b){return a.contextMenuExtensions[b]&&!0},svgedit.contextmenu.getCustomHandler=function(b){return a.contextMenuExtensions[b].action}}(),svgedit={NS:{HTML:"http://www.w3.org/1999/xhtml",MATH:"http://www.w3.org/1998/Math/MathML",SE:"http://svg-edit.googlecode.com",SVG:"http://www.w3.org/2000/svg",XLINK:"http://www.w3.org/1999/xlink",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"}},svgedit.getReverseNS=function(){var a={};return $.each(this.NS,function(b,c){a[c]=b.toLowerCase()}),a};
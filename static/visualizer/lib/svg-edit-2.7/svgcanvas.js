!function(){window.console||(window.console={},window.console.log=function(){},window.console.dir=function(){}),window.opera&&(window.console.log=function(a){opera.postError(a)},window.console.dir=function(){})}(),$.SvgCanvas=function(a,b){function c(a,b){var c,d=svgedit.utilities.getBBox(a);for(c=0;2>c;c++){var e=0===c?"fill":"stroke",f=a.getAttribute(e);if(f&&0===f.indexOf("url(")){var g=svgedit.utilities.getRefElem(f);if("linearGradient"===g.tagName){var h=g.getAttribute("x1")||0,i=g.getAttribute("y1")||0,j=g.getAttribute("x2")||1,k=g.getAttribute("y2")||0;h=d.width*h+d.x,i=d.height*i+d.y,j=d.width*j+d.x,k=d.height*k+d.y;var l=svgedit.math.transformPoint(h,i,b),m=svgedit.math.transformPoint(j,k,b),n={};n.x1=(l.x-d.x)/d.width,n.y1=(l.y-d.y)/d.height,n.x2=(m.x-d.x)/d.width,n.y2=(m.y-d.y)/d.height;var o=g.cloneNode(!0);$(o).attr(n),o.id=tb(),svgedit.utilities.findDefs().appendChild(o),a.setAttribute(e,"url(#"+o.id+")")}}}}var d=svgedit.NS,e={show_outside_canvas:!0,selectNew:!0,dimensions:[640,480]};b&&$.extend(e,b);var f=e.dimensions,g=this,h=a.ownerDocument,i=h.importNode(svgedit.utilities.text2xml('<svg id="svgroot" xmlns="'+d.SVG+'" xlinkns="'+d.XLINK+'" width="'+f[0]+'" height="'+f[1]+'" x="'+f[0]+'" y="'+f[1]+'" overflow="visible"><defs><filter id="canvashadow" filterUnits="objectBoundingBox"><feGaussianBlur in="SourceAlpha" stdDeviation="4" result="blur"/><feOffset in="blur" dx="5" dy="5" result="offsetBlur"/><feMerge><feMergeNode in="offsetBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs></svg>').documentElement,!0);a.appendChild(i);var j=h.createElementNS(d.SVG,"svg"),k=g.clearSvgContentElement=function(){for(;j.firstChild;)j.removeChild(j.firstChild);$(j).attr({id:"svgcontent",width:f[0],height:f[1],x:f[0],y:f[1],overflow:e.show_outside_canvas?"visible":"hidden",xmlns:d.SVG,"xmlns:se":d.SE,"xmlns:xlink":d.XLINK}).appendTo(i);var a=h.createComment(" Created with SVG-edit - http://svg-edit.googlecode.com/ ");j.appendChild(a)};k();var m="svg_";g.setIdPrefix=function(a){m=a},g.current_drawing_=new svgedit.draw.Drawing(j,m);var n=g.getCurrentDrawing=function(){return g.current_drawing_},o=1,p=null,q={shape:{fill:("none"==e.initFill.color?"":"#")+e.initFill.color,fill_paint:null,fill_opacity:e.initFill.opacity,stroke:"#"+e.initStroke.color,stroke_paint:null,stroke_opacity:e.initStroke.opacity,stroke_width:e.initStroke.width,stroke_dasharray:"none",stroke_linejoin:"miter",stroke_linecap:"butt",opacity:e.initOpacity}};q.text=$.extend(!0,{},q.shape),$.extend(q.text,{fill:"#000000",stroke_width:0,font_size:24,font_family:"serif"});{var r=q.shape,s=new Array(1),t=this.addSvgElementFromJson=function(a){var b=svgedit.utilities.getElem(a.attr.id),c=n().getCurrentLayer();return b&&a.element!=b.tagName&&(c.removeChild(b),b=null),b||(b=h.createElementNS(d.SVG,a.element),c&&(p||c).appendChild(b)),a.curStyles&&svgedit.utilities.assignAttributes(b,{fill:r.fill,stroke:r.stroke,"stroke-width":r.stroke_width,"stroke-dasharray":r.stroke_dasharray,"stroke-linejoin":r.stroke_linejoin,"stroke-linecap":r.stroke_linecap,"stroke-opacity":r.stroke_opacity,"fill-opacity":r.fill_opacity,opacity:r.opacity/2,style:"pointer-events:inherit"},100),svgedit.utilities.assignAttributes(b,a.attr,100),svgedit.utilities.cleanupElement(b),b},u=(g.getTransformList=svgedit.transformlist.getTransformList,svgedit.math.transformPoint),v=g.matrixMultiply=svgedit.math.matrixMultiply,w=g.hasMatrixTransform=svgedit.math.hasMatrixTransform,z=g.transformListToTransform=svgedit.math.transformListToTransform;svgedit.math.snapToAngle,svgedit.math.getMatrix}svgedit.units.init({getBaseUnit:function(){return e.baseUnit},getElement:svgedit.utilities.getElem,getHeight:function(){return j.getAttribute("height")/o},getWidth:function(){return j.getAttribute("width")/o},getRoundDigits:function(){return bb.round_digits}});g.convertToNum=svgedit.units.convertToNum;svgedit.utilities.init({getDOMDocument:function(){return h},getDOMContainer:function(){return a},getSVGRoot:function(){return i},getSelectedElements:function(){return s},getSVGContent:function(){return j},getBaseUnit:function(){return e.baseUnit},getStepSize:function(){return e.stepSize}});var A=g.findDefs=svgedit.utilities.findDefs,B=g.getUrlFromAttr=svgedit.utilities.getUrlFromAttr,C=g.getHref=svgedit.utilities.getHref,D=g.setHref=svgedit.utilities.setHref,E=svgedit.utilities.getPathBBox,F=(g.getBBox=svgedit.utilities.getBBox,g.getRotationAngle=svgedit.utilities.getRotationAngle,g.getElem=svgedit.utilities.getElem),G=(g.getRefElem=svgedit.utilities.getRefElem,g.assignAttributes=svgedit.utilities.assignAttributes),H=this.cleanupElement=svgedit.utilities.cleanupElement;svgedit.coords.init({getDrawing:function(){return n()},getGridSnapping:function(){return e.gridSnapping}});var I=this.remapElement=svgedit.coords.remapElement;svgedit.recalculate.init({getSVGRoot:function(){return i},getStartTransform:function(){return db},setStartTransform:function(a){db=a}});var J=this.recalculateDimensions=svgedit.recalculate.recalculateDimensions,K=svgedit.getReverseNS(),L=g.sanitizeSvg=svgedit.sanitize.sanitizeSvg,M=svgedit.history.MoveElementCommand,N=svgedit.history.InsertElementCommand,O=svgedit.history.RemoveElementCommand,P=svgedit.history.ChangeElementCommand,Q=svgedit.history.BatchCommand;g.undoMgr=new svgedit.history.UndoManager({handleHistoryEvent:function(a,b){var c=svgedit.history.HistoryEventTypes;if(a==c.BEFORE_UNAPPLY||a==c.BEFORE_APPLY)g.clearSelection();else if(a==c.AFTER_APPLY||a==c.AFTER_UNAPPLY){var d=b.elements();g.pathActions.clear(),ub("changed",d);var e=b.type(),f=a==c.AFTER_APPLY;if(e==M.type()){var h=f?b.newParent:b.oldParent;h==j&&g.identifyLayers()}else if(e==N.type()||e==O.type())b.parent==j&&g.identifyLayers(),e==N.type()?f&&Y(b.elem):f||Y(b.elem),"use"===b.elem.tagName&&Nb(b.elem);else if(e==P.type()){"title"==b.elem.tagName&&b.elem.parentNode.parentNode==j&&g.identifyLayers();var i=f?b.newValues:b.oldValues;i.stdDeviation&&g.setBlurOffsets(b.elem.parentNode,i.stdDeviation)}}}});var R=function(a){g.undoMgr.addCommandToHistory(a)};svgedit.select.init(e,{createSVGElement:function(a){return g.addSvgElementFromJson(a)},svgRoot:function(){return i},svgContent:function(){return j},currentZoom:function(){return o},getStrokedBBox:function(a){return g.getStrokedBBox([a])}});var S=this.selectorManager=svgedit.select.getSelectorManager();svgedit.path.init({getCurrentZoom:function(){return o},getSVGRoot:function(){return i}});var T={exportNoBlur:"Blurred elements will appear as un-blurred",exportNoforeignObject:"foreignObject elements will not appear",exportNoDashArray:"Strokes will appear filled",exportNoText:"Text may not appear as expected"},U="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use",V=["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],W=$.data,X=document.createElementNS(d.SVG,"animate");$(X).attr({attributeName:"opacity",begin:"indefinite",dur:1,fill:"freeze"}).appendTo(i);var Y=function(a){var b,c,d=$(a).attr(V);for(b in d){var e=d[b];if(e&&0===e.indexOf("url(")){var f=svgedit.utilities.getUrlFromAttr(e).substr(1),g=F(f);g||(svgedit.utilities.findDefs().appendChild(ob[f]),delete ob[f])}}var h=a.getElementsByTagName("*");if(h.length)for(c=0,l=h.length;l>c;c++)Y(h[c])},Z={},_=e.imgPath+"logo.png",ab=[],bb={round_digits:5},cb=!1,db=null,eb="select",fb="none",gb={},hb=q.text,ib=r,jb=null,kb=null,lb=[],mb={},nb=null,ob={};g.clipBoard=[];var pb=this.runExtensions=function(a,b,c){var d=c?[]:!1;return $.each(mb,function(e,f){f&&a in f&&(c?d.push(f[a](b)):d=f[a](b))}),d};this.addExtension=function(a,b){var c;a in mb?console.log('Cannot add extension "'+a+'", an extension by that name already exists"'):(c=$.isFunction(b)?b($.extend(g.getPrivateMethods(),{svgroot:i,svgcontent:j,nonce:n().getNonce(),selectorManager:S})):b,mb[a]=c,ub("extension_added",c))};var qb=this.round=function(a){return parseInt(a*o,10)/o},rb=this.getIntersectionList=function(a){if(null==kb)return null;var b=p||n().getCurrentLayer();lb.length||(lb=yb(b));var c=null;try{c=b.getIntersectionList(a,null)}catch(d){}if(null==c||"function"!=typeof c.item){c=[];var e;if(a)e=a;else{e=kb.getBBox();var f,g={};for(f in e)g[f]=e[f]/o;e=g}for(var h=lb.length;h--;)e.width&&svgedit.math.rectsIntersect(e,lb[h].bbox)&&c.push(lb[h].elem)}return c};getStrokedBBox=this.getStrokedBBox=function(a){if(a||(a=xb()),!a.length)return!1;var b,c=function(a){try{var b=svgedit.utilities.getBBox(a),c=svgedit.utilities.getRotationAngle(a);if(c&&c%90||svgedit.math.hasMatrixTransform(svgedit.transformlist.getTransformList(a))){var e=!1,f=["ellipse","path","line","polyline","polygon"];if(f.indexOf(a.tagName)>=0)b=e=g.convertToPath(a,!0);else if("rect"==a.tagName){var h=a.getAttribute("rx"),i=a.getAttribute("ry");(h||i)&&(b=e=g.convertToPath(a,!0))}if(!e){var j=a.cloneNode(!0),k=document.createElementNS(d.SVG,"g"),l=a.parentNode;l.appendChild(k),k.appendChild(j),b=svgedit.utilities.bboxToObj(k.getBBox()),l.removeChild(k)}}return b}catch(m){return console.log(a,m),null}};if($.each(a,function(){b||this.parentNode&&(b=c(this))}),null==b)return null;var e=b.x+b.width,f=b.y+b.height,h=b.x,i=b.y,j=function(a){var b=a.getAttribute("stroke-width"),c=0;return"none"==a.getAttribute("stroke")||isNaN(b)||(c+=b/2),c},k=[];return $.each(a,function(a,b){var d=c(b);if(d){var e=j(b);h=Math.min(h,d.x-e),i=Math.min(i,d.y-e),k.push(d)}}),b.x=h,b.y=i,$.each(a,function(a,b){var c=k[a];if(c&&1==b.nodeType){var d=j(b);e=Math.max(e,c.x+c.width+d),f=Math.max(f,c.y+c.height+d)}}),b.width=e-h,b.height=f-i,b};var sb,tb,ub,vb,wb,xb=this.getVisibleElements=function(a){a||(a=$(j).children());var b=[];return $(a).children().each(function(a,c){try{c.getBBox()&&b.push(c)}catch(d){}}),b.reverse()},yb=this.getVisibleElementsAndBBoxes=function(a){a||(a=$(j).children());var b=[];return $(a).children().each(function(a,c){try{c.getBBox()&&b.push({elem:c,bbox:getStrokedBBox([c])})}catch(d){}}),b.reverse()},zb=this.groupSvgElem=function(a){var b=document.createElementNS(d.SVG,"g");a.parentNode.replaceChild(b,a),$(b).append(a).data("gsvg",a)[0].id=tb()},Ab=function(a){var b=document.createElementNS(a.namespaceURI,a.nodeName);if($.each(a.attributes,function(a,c){"-moz-math-font-style"!=c.localName&&b.setAttributeNS(c.namespaceURI,c.nodeName,c.nodeValue)}),b.removeAttribute("id"),b.id=tb(),svgedit.browser.isWebkit()&&"path"==a.nodeName){var c=wb.convertPath(a);b.setAttribute("d",c)}if($.each(a.childNodes,function(a,c){switch(c.nodeType){case 1:b.appendChild(Ab(c));break;case 3:b.textContent=c.nodeValue}}),$(a).data("gsvg"))$(b).data("gsvg",b.firstChild);else if($(a).data("symbol")){var d=$(a).data("symbol");$(b).data("ref",d).data("symbol",d)}else"image"==b.tagName&&Kb(b);return b};!function(a){var b={};sb=a.getId=function(){return n().getId()},tb=a.getNextId=function(){return n().getNextId()},ub=a.call=function(a,c){return b[a]?b[a](this,c):void 0},a.bind=function(a,c){var d=b[a];return b[a]=c,d}}(g),this.prepareSvg=function(a){svgedit.options.sanitize&&this.sanitizeSvg(a.documentElement);var b,c,e,f=a.getElementsByTagNameNS(d.SVG,"path");for(b=0,e=f.length;e>b;++b)c=f[b],c.setAttribute("d",wb.convertPath(c)),wb.fixEnd(c)};var Bb=function(a){if(!svgedit.browser.isGecko())return a;var b=a.cloneNode(!0);return a.parentNode.insertBefore(b,a),a.parentNode.removeChild(a),S.releaseSelector(a),s[0]=b,S.requestSelector(b).showGrips(!0),b};this.setRotationAngle=function(a,b){a=parseFloat(a);var c=s[0],d=c.getAttribute("transform"),e=svgedit.utilities.getBBox(c),f=e.x+e.width/2,g=e.y+e.height/2,h=svgedit.transformlist.getTransformList(c);if(h.numberOfItems>0){var j=h.getItem(0);4==j.type&&h.removeItem(0)}if(0!=a){var k=svgedit.math.transformPoint(f,g,svgedit.math.transformListToTransform(h).matrix),l=i.createSVGTransform();l.setRotate(a,k.x,k.y),h.numberOfItems?h.insertItemBefore(l,0):h.appendItem(l)}else 0==h.numberOfItems&&c.removeAttribute("transform");if(!b){var m=c.getAttribute("transform");c.setAttribute("transform",d),Xb("transform",m,s),ub("changed",s)}var n=(svgedit.utilities.getElem("pathpointgrip_container"),S.requestSelector(s[0]));n.resize(),n.updateGripCursors(a)};{var Cb=this.recalculateAllSelectedDimensions=function(){for(var a="none"==fb?"position":"size",b=new svgedit.history.BatchCommand(a),c=s.length;c--;){var d=s[c],e=svgedit.recalculate.recalculateDimensions(d);e&&b.addSubCommand(e)}b.isEmpty()||(R(b),ub("changed",s))},Db=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],Eb=function(a){console.log([a.a,a.b,a.c,a.d,a.e,a.f])},Fb=null,Gb=this.clearSelection=function(a){if(null!=s[0]){var b,c,d=s.length;for(b=0;d>b&&(c=s[b],null!=c);++b)S.releaseSelector(c),s[b]=null}a||ub("selected",s)},Hb=this.addToSelection=function(a,b){if(0!=a.length){for(var c=0;c<s.length&&null!=s[c];)++c;for(var d=a.length;d--;){var e=a[d];if(e&&svgedit.utilities.getBBox(e)&&("a"===e.tagName&&1===e.childNodes.length&&(e=e.firstChild),-1==s.indexOf(e))){s[c]=e,c++;var f=S.requestSelector(e);s.length>1&&f.showGrips(!1)}}for(ub("selected",s),S.requestSelector(s[0]).showGrips(b||1==s.length?!0:!1),s.sort(function(a,b){return a&&b&&a.compareDocumentPosition?3-(6&b.compareDocumentPosition(a)):null==a?1:void 0});null==s[0];)s.shift(0)}},Ib=this.selectOnly=function(a,b){Gb(!0),Hb(a,b)};this.removeFromSelection=function(a){if(null!=s[0]&&0!=a.length){var b,c=0,d=new Array(s.length),e=s.length;for(b=0;e>b;++b){var f=s[b];f&&(-1==a.indexOf(f)?(d[c]=f,c++):S.releaseSelector(f))}s=d}}}this.selectAllInCurrentLayer=function(){var a=n().getCurrentLayer();a&&(eb="select",Ib($(p||a).children()))};var Jb=this.getMouseTarget=function(b){if(null==b)return null;var c=b.target;if(c.correspondingUseElement&&(c=c.correspondingUseElement),[d.MATH,d.HTML].indexOf(c.namespaceURI)>=0&&"svgcanvas"!=c.id)for(;"foreignObject"!=c.nodeName;)if(c=c.parentNode,!c)return i;var e=n().getCurrentLayer();if([i,a,j,e].indexOf(c)>=0)return i;var f=$(c);if(f.closest("#selectorParentGroup").length)return S.selectorParentGroup;for(;c.parentNode!==(p||e);)c=c.parentNode;return c};!function(){var b,c,d=null,f=null,h=null,j=null,k=null,l={},m={minx:null,miny:null,maxx:null,maxy:null},q=0,u={x:0,y:0},v={x:0,y:0},w={x:0,y:0},z={x:0,y:0},A={x:0,y:0},B={x:0,y:0},C=.8,E=10,F=function(a){var b={x:0,y:0},c=u,d=v,e=w,f=z,g=1/6,h=a*a,i=h*a,j=[[-1,3,-3,1],[3,-6,3,0],[-3,0,3,0],[1,4,1,0]];return b.x=g*((c.x*j[0][0]+d.x*j[0][1]+e.x*j[0][2]+f.x*j[0][3])*i+(c.x*j[1][0]+d.x*j[1][1]+e.x*j[1][2]+f.x*j[1][3])*h+(c.x*j[2][0]+d.x*j[2][1]+e.x*j[2][2]+f.x*j[2][3])*a+(c.x*j[3][0]+d.x*j[3][1]+e.x*j[3][2]+f.x*j[3][3])),b.y=g*((c.y*j[0][0]+d.y*j[0][1]+e.y*j[0][2]+f.y*j[0][3])*i+(c.y*j[1][0]+d.y*j[1][1]+e.y*j[1][2]+f.y*j[1][3])*h+(c.y*j[2][0]+d.y*j[2][1]+e.y*j[2][2]+f.y*j[2][3])*a+(c.y*j[3][0]+d.y*j[3][1]+e.y*j[3][2]+f.y*j[3][3])),{x:b.x,y:b.y}},G=function(a){if(!g.spaceKey&&1!==a.button){var b=2===a.button;a.altKey&&svgCanvas.cloneSelectedElements(0,0),Fb=$("#svgcontent g")[0].getScreenCTM().inverse();var c=svgedit.math.transformPoint(a.pageX,a.pageY,Fb),n=c.x*o,p=c.y*o;a.preventDefault(),b&&(eb="select",nb=c);var q=n/o,u=p/o,v=Jb(a);"a"===v.tagName&&1===v.childNodes.length&&(v=v.firstChild);var x=q;j=f=q;var y=u;if(k=h=u,e.gridSnapping&&(q=svgedit.utilities.snapToGrid(q),u=svgedit.utilities.snapToGrid(u),f=svgedit.utilities.snapToGrid(f),h=svgedit.utilities.snapToGrid(h)),v==S.selectorParentGroup&&null!=s[0]){var z=a.target,A=W(z,"type");"rotate"==A?eb="rotate":"resize"==A&&(eb="resize",fb=W(z,"dir")),v=s[0]}db=v.getAttribute("transform");var B,C,E=svgedit.transformlist.getTransformList(v);switch(eb){case"select":if(cb=!0,fb="none",b&&(cb=!1),v!=i){if(-1==s.indexOf(v)&&(a.shiftKey||Gb(!0),Hb([v]),jb=v,wb.clear()),!b)for(B=0;B<s.length;++B)if(null!=s[B]){var F=svgedit.transformlist.getTransformList(s[B]);F.numberOfItems?F.insertItemBefore(i.createSVGTransform(),0):F.appendItem(i.createSVGTransform())}}else b||(Gb(),eb="multiselect",null==kb&&(kb=S.getRubberBandBox()),j*=o,k*=o,svgedit.utilities.assignAttributes(kb,{x:j,y:k,width:0,height:0,display:"inline"},100));break;case"zoom":cb=!0,null==kb&&(kb=S.getRubberBandBox()),svgedit.utilities.assignAttributes(kb,{x:x*o,y:x*o,width:0,height:0,display:"inline"},100);break;case"resize":cb=!0,f=q,h=u,l=svgedit.utilities.getBBox($("#selectedBox0")[0]);var G={};$.each(l,function(a,b){G[a]=b/o}),l=G;var H=svgedit.utilities.getRotationAngle(v)?1:0;if(svgedit.math.hasMatrixTransform(E))E.insertItemBefore(i.createSVGTransform(),H),E.insertItemBefore(i.createSVGTransform(),H),E.insertItemBefore(i.createSVGTransform(),H);else if(E.appendItem(i.createSVGTransform()),E.appendItem(i.createSVGTransform()),E.appendItem(i.createSVGTransform()),svgedit.browser.supportsNonScalingStroke()){var I=svgedit.browser.isWebkit();if(I)var J=function(a){var b=a.getAttributeNS(null,"stroke");a.removeAttributeNS(null,"stroke"),setTimeout(function(){a.setAttributeNS(null,"stroke",b)},0)};v.style.vectorEffect="non-scaling-stroke",I&&J(v);var K=v.getElementsByTagName("*"),L=K.length;for(B=0;L>B;B++)K[B].style.vectorEffect="non-scaling-stroke",I&&J(K[B])}break;case"fhellipse":case"fhrect":case"fhpath":w.x=x,w.y=y,cb=!0,d=x+","+y+" ",C=0==r.stroke_width?1:r.stroke_width,t({element:"polyline",curStyles:!0,attr:{points:d,id:tb(),fill:"none",opacity:r.opacity/2,"stroke-linecap":"round",style:"pointer-events:none"}}),m.minx=x,m.maxx=x,m.miny=y,m.maxy=y;break;case"image":cb=!0;var M=t({element:"image",attr:{x:q,y:u,width:0,height:0,id:tb(),opacity:r.opacity/2,style:"pointer-events:inherit"}});D(M,_),Kb(M);break;case"square":case"rect":cb=!0,f=q,h=u,t({element:"rect",curStyles:!0,attr:{x:q,y:u,width:0,height:0,id:tb(),opacity:r.opacity/2}});break;case"line":cb=!0,C=0==r.stroke_width?1:r.stroke_width,t({element:"line",curStyles:!0,attr:{x1:q,y1:u,x2:q,y2:u,id:tb(),stroke:r.stroke,"stroke-width":C,"stroke-dasharray":r.stroke_dasharray,"stroke-linejoin":r.stroke_linejoin,"stroke-linecap":r.stroke_linecap,"stroke-opacity":r.stroke_opacity,fill:"none",opacity:r.opacity/2,style:"pointer-events:none"}});break;case"circle":cb=!0,t({element:"circle",curStyles:!0,attr:{cx:q,cy:u,r:0,id:tb(),opacity:r.opacity/2}});break;case"ellipse":cb=!0,t({element:"ellipse",curStyles:!0,attr:{cx:q,cy:u,rx:0,ry:0,id:tb(),opacity:r.opacity/2}});break;case"text":cb=!0;{t({element:"text",curStyles:!0,attr:{x:q,y:u,id:tb(),fill:hb.fill,"stroke-width":hb.stroke_width,"font-size":hb.font_size,"font-family":hb.font_family,"text-anchor":"middle","xml:space":"preserve",opacity:r.opacity}})}break;case"path":case"pathedit":f*=o,h*=o,wb.mouseDown(a,v,f,h),cb=!0;break;case"textedit":f*=o,h*=o,vb.mouseDown(a,v,f,h),cb=!0;break;case"rotate":cb=!0,g.undoMgr.beginUndoableChange("transform",s)}var N=pb("mouseDown",{event:a,start_x:f,start_y:h,selectedElements:s},!0);$.each(N,function(a,b){b&&b.started&&(cb=!0)})}},I=function(a){if(cb&&1!==a.button&&!g.spaceKey){var n,p,r,t,D,G,H,I,J,K,L=s[0],M=svgedit.math.transformPoint(a.pageX,a.pageY,Fb),N=M.x*o,O=M.y*o,P=svgedit.utilities.getElem(sb()),Q=N/o;x=Q;var R=O/o;y=R,e.gridSnapping&&(x=svgedit.utilities.snapToGrid(x),y=svgedit.utilities.snapToGrid(y)),a.preventDefault();var T;switch(eb){case"select":if(null!==s[0]&&(G=x-f,H=y-h,e.gridSnapping&&(G=svgedit.utilities.snapToGrid(G),H=svgedit.utilities.snapToGrid(H)),a.shiftKey&&(p=svgedit.math.snapToAngle(f,h,x,y),x=p.x,y=p.y),0!=G||0!=H)){for(I=s.length,n=0;I>n&&(L=s[n],null!=L);++n){var U=i.createSVGTransform();T=svgedit.transformlist.getTransformList(L),U.setTranslate(G,H),T.numberOfItems?T.replaceItem(U,0):T.appendItem(U),S.requestSelector(L).resize()}ub("transition",s)}break;case"multiselect":Q*=o,R*=o,svgedit.utilities.assignAttributes(kb,{x:Math.min(j,Q),y:Math.min(k,R),width:Math.abs(Q-j),height:Math.abs(R-k)},100);var V=[],W=[],X=rb();for(I=s.length,n=0;I>n;++n){var Y=X.indexOf(s[n]);-1==Y?V.push(s[n]):X[Y]=null}for(I=X.length,n=0;I>n;++n)X[n]&&W.push(X[n]);V.length>0&&g.removeFromSelection(V),W.length>0&&Hb(W);break;case"resize":T=svgedit.transformlist.getTransformList(L);var Z=svgedit.math.hasMatrixTransform(T);K=Z?l:svgedit.utilities.getBBox(L);var _=K.x,ab=K.y,bb=K.width,db=K.height;if(G=x-f,H=y-h,e.gridSnapping&&(G=svgedit.utilities.snapToGrid(G),H=svgedit.utilities.snapToGrid(H),db=svgedit.utilities.snapToGrid(db),bb=svgedit.utilities.snapToGrid(bb)),J=svgedit.utilities.getRotationAngle(L)){var gb=Math.sqrt(G*G+H*H),hb=Math.atan2(H,G)-J*Math.PI/180;G=gb*Math.cos(hb),H=gb*Math.sin(hb)}-1==fb.indexOf("n")&&-1==fb.indexOf("s")&&(H=0),-1==fb.indexOf("e")&&-1==fb.indexOf("w")&&(G=0);var ib=0,jb=0,lb=db?(db+H)/db:1,mb=bb?(bb+G)/bb:1;fb.indexOf("n")>=0&&(lb=db?(db-H)/db:1,jb=db),fb.indexOf("w")>=0&&(mb=bb?(bb-G)/bb:1,ib=bb);var nb=i.createSVGTransform(),ob=i.createSVGTransform(),qb=i.createSVGTransform();if(e.gridSnapping&&(_=svgedit.utilities.snapToGrid(_),ib=svgedit.utilities.snapToGrid(ib),ab=svgedit.utilities.snapToGrid(ab),jb=svgedit.utilities.snapToGrid(jb)),nb.setTranslate(-(_+ib),-(ab+jb)),a.shiftKey&&(1==mb?mb=lb:lb=mb),ob.setScale(mb,lb),qb.setTranslate(_+ib,ab+jb),Z){var tb=J?1:0;T.replaceItem(nb,2+tb),T.replaceItem(ob,1+tb),T.replaceItem(qb,Number(tb))}else{var xb=T.numberOfItems;T.replaceItem(qb,xb-3),T.replaceItem(ob,xb-2),T.replaceItem(nb,xb-1)}S.requestSelector(L).resize(),ub("transition",s);break;case"zoom":Q*=o,R*=o,svgedit.utilities.assignAttributes(kb,{x:Math.min(j*o,Q),y:Math.min(k*o,R),width:Math.abs(Q-j*o),height:Math.abs(R-k*o)},100);break;case"text":svgedit.utilities.assignAttributes(P,{x:x,y:y},1e3);break;case"line":var yb=null;window.opera||i.suspendRedraw(1e3),e.gridSnapping&&(x=svgedit.utilities.snapToGrid(x),y=svgedit.utilities.snapToGrid(y));var zb=x,Ab=y;a.shiftKey&&(p=svgedit.math.snapToAngle(f,h,zb,Ab),zb=p.x,Ab=p.y),P.setAttributeNS(null,"x2",zb),P.setAttributeNS(null,"y2",Ab),window.opera||i.unsuspendRedraw(yb);break;case"foreignObject":case"square":case"rect":case"image":var Bb,Cb,Db="square"==eb||a.shiftKey,Eb=Math.abs(x-f),Gb=Math.abs(y-h);Db?(Eb=Gb=Math.max(Eb,Gb),Bb=x>f?f:f-Eb,Cb=y>h?h:h-Gb):(Bb=Math.min(f,x),Cb=Math.min(h,y)),e.gridSnapping&&(Eb=svgedit.utilities.snapToGrid(Eb),Gb=svgedit.utilities.snapToGrid(Gb),Bb=svgedit.utilities.snapToGrid(Bb),Cb=svgedit.utilities.snapToGrid(Cb)),svgedit.utilities.assignAttributes(P,{width:Eb,height:Gb,x:Bb,y:Cb},1e3);break;case"circle":r=$(P).attr(["cx","cy"]),t=r.cx,D=r.cy;var Ib=Math.sqrt((x-t)*(x-t)+(y-D)*(y-D));e.gridSnapping&&(Ib=svgedit.utilities.snapToGrid(Ib)),P.setAttributeNS(null,"r",Ib);break;case"ellipse":r=$(P).attr(["cx","cy"]),t=r.cx,D=r.cy,yb=null,window.opera||i.suspendRedraw(1e3),e.gridSnapping&&(x=svgedit.utilities.snapToGrid(x),t=svgedit.utilities.snapToGrid(t),y=svgedit.utilities.snapToGrid(y),D=svgedit.utilities.snapToGrid(D)),P.setAttributeNS(null,"rx",Math.abs(x-t));var Jb=Math.abs(a.shiftKey?x-t:y-D);P.setAttributeNS(null,"ry",Jb),window.opera||i.unsuspendRedraw(yb);break;case"fhellipse":case"fhrect":m.minx=Math.min(Q,m.minx),m.maxx=Math.max(Q,m.maxx),m.miny=Math.min(R,m.miny),m.maxy=Math.max(R,m.maxy);case"fhpath":if(z.x=Q,z.y=R,u.x&&u.y)for(n=0;E-1>n;n++)b=n/E,c=(n+1)/E,A=F(c),B=A,A=F(b),q+=Math.sqrt((B.x-A.x)*(B.x-A.x)+(B.y-A.y)*(B.y-A.y)),q>C&&(d+=+A.x+","+A.y+" ",P.setAttributeNS(null,"points",d),q-=C);u={x:v.x,y:v.y},v={x:w.x,y:w.y},w={x:z.x,y:z.y};break;case"path":case"pathedit":if(x*=o,y*=o,e.gridSnapping&&(x=svgedit.utilities.snapToGrid(x),y=svgedit.utilities.snapToGrid(y),f=svgedit.utilities.snapToGrid(f),h=svgedit.utilities.snapToGrid(h)),a.shiftKey){var Kb,Lb,Mb=svgedit.path.path;Mb?(Kb=Mb.dragging?Mb.dragging[0]:f,Lb=Mb.dragging?Mb.dragging[1]:h):(Kb=f,Lb=h),p=svgedit.math.snapToAngle(Kb,Lb,x,y),x=p.x,y=p.y}kb&&"none"!==kb.getAttribute("display")&&(Q*=o,R*=o,svgedit.utilities.assignAttributes(kb,{x:Math.min(j*o,Q),y:Math.min(k*o,R),width:Math.abs(Q-j*o),height:Math.abs(R-k*o)},100)),wb.mouseMove(x,y);break;case"textedit":x*=o,y*=o,vb.mouseMove(N,O);break;case"rotate":K=svgedit.utilities.getBBox(L),t=K.x+K.width/2,D=K.y+K.height/2;var Nb=svgedit.math.getMatrix(L),Ob=svgedit.math.transformPoint(t,D,Nb);if(t=Ob.x,D=Ob.y,J=(Math.atan2(D-y,t-x)*(180/Math.PI)-90)%360,e.gridSnapping&&(J=svgedit.utilities.snapToGrid(J)),a.shiftKey){var Pb=45;J=Math.round(J/Pb)*Pb}g.setRotationAngle(-180>J?360+J:J,!0),ub("transition",s)}pb("mouseMove",{event:a,mouse_x:N,mouse_y:O,selected:L})}},J=function(a){if(2!==a.button){var b=jb;if(jb=null,cb){var c=svgedit.math.transformPoint(a.pageX,a.pageY,Fb),d=c.x*o,f=c.y*o,h=d/o,i=f/o,l=svgedit.utilities.getElem(sb()),p=!1,x=h,y=i,A=!1;cb=!1;var B,C;switch(eb){case"resize":case"multiselect":null!=kb&&(kb.setAttribute("display","none"),lb=[]),eb="select";case"select":if(null!=s[0]){if(null==s[1]){var D=s[0];switch(D.tagName){case"g":case"use":case"image":case"foreignObject":break;default:ib.fill=D.getAttribute("fill"),ib.fill_opacity=D.getAttribute("fill-opacity"),ib.stroke=D.getAttribute("stroke"),ib.stroke_opacity=D.getAttribute("stroke-opacity"),ib.stroke_width=D.getAttribute("stroke-width"),ib.stroke_dasharray=D.getAttribute("stroke-dasharray"),ib.stroke_linejoin=D.getAttribute("stroke-linejoin"),ib.stroke_linecap=D.getAttribute("stroke-linecap")}"text"==D.tagName&&(hb.font_size=D.getAttribute("font-size"),hb.font_family=D.getAttribute("font-family")),S.requestSelector(D).showGrips(!0)}if(Cb(),x!=j||y!=k){var E,F=s.length;for(E=0;F>E&&null!=s[E];++E)s[E].firstChild||S.requestSelector(s[E]).resize()}else C=a.target,"path"===s[0].nodeName&&null==s[1]?wb.select(s[0]):a.shiftKey&&b!=C&&g.removeFromSelection([C]);if(svgedit.browser.supportsNonScalingStroke()){var G=s[0];G&&(G.removeAttribute("style"),svgedit.utilities.walkTree(G,function(a){a.removeAttribute("style")}))}}return;case"zoom":null!=kb&&kb.setAttribute("display","none");var I=a.shiftKey?.5:2;return void ub("zoomed",{x:Math.min(j,x),y:Math.min(k,y),width:Math.abs(x-j),height:Math.abs(y-k),factor:I});case"fhpath":q=0,u={x:0,y:0},v={x:0,y:0},w={x:0,y:0},z={x:0,y:0};var J=l.getAttribute("points"),K=J.indexOf(",");p=K>=0?J.indexOf(",",K+1)>=0:J.indexOf(" ",J.indexOf(" ")+1)>=0,p&&(l=wb.smoothPolylineIntoPath(l));break;case"line":B=$(l).attr(["x1","x2","y1","y2"]),p=B.x1!=B.x2||B.y1!=B.y2;break;case"foreignObject":case"square":case"rect":case"image":B=$(l).attr(["width","height"]),p=0!=B.width||0!=B.height||"image"===eb;break;case"circle":p=0!=l.getAttribute("r");break;case"ellipse":B=$(l).attr(["rx","ry"]),p=null!=B.rx||null!=B.ry;break;case"fhellipse":m.maxx-m.minx>0&&m.maxy-m.miny>0&&(l=t({element:"ellipse",curStyles:!0,attr:{cx:(m.minx+m.maxx)/2,cy:(m.miny+m.maxy)/2,rx:(m.maxx-m.minx)/2,ry:(m.maxy-m.miny)/2,id:sb()}}),ub("changed",[l]),p=!0);break;case"fhrect":m.maxx-m.minx>0&&m.maxy-m.miny>0&&(l=t({element:"rect",curStyles:!0,attr:{x:m.minx,y:m.miny,width:m.maxx-m.minx,height:m.maxy-m.miny,id:sb()}}),ub("changed",[l]),p=!0);break;case"text":p=!0,Ib([l]),vb.start(l);break;case"path":l=null,cb=!0;var L=wb.mouseUp(a,l,d,f);l=L.element,p=L.keep;break;case"pathedit":p=!0,l=null,wb.mouseUp(a);break;case"textedit":p=!1,l=null,vb.mouseUp(a,d,f);break;case"rotate":p=!0,l=null,eb="select";var M=g.undoMgr.finishUndoableChange();M.isEmpty()||R(M),Cb(),ub("changed",s)}var N=pb("mouseUp",{event:a,mouse_x:d,mouse_y:f},!0);if($.each(N,function(a,b){b&&(p=b.keep||p,l=b.element,cb=b.started||cb)}),p||null==l){if(null!=l){g.addedNew=!0,A&&svgedit.units.convertAttrs(l);var O,P=.2;if(X.beginElement&&l.getAttribute("opacity")!=r.opacity){O=$(X).clone().attr({to:r.opacity,dur:P}).appendTo(l);try{O[0].beginElement()}catch(Q){}}else P=0;setTimeout(function(){O&&O.remove(),l.setAttribute("opacity",r.opacity),l.setAttribute("style","pointer-events:inherit"),H(l),"path"===eb?wb.toEditMode(l):e.selectNew&&Ib([l],!0),R(new svgedit.history.InsertElementCommand(l)),ub("changed",[l])},1e3*P)}}else{for(n().releaseId(sb()),l.parentNode.removeChild(l),l=null,C=a.target;"g"==C.parentNode.parentNode.tagName;)C=C.parentNode;"path"==eb&&drawn_path||"selectorParentGroup"==C.parentNode.id||"svgcanvas"==C.id||"svgroot"==C.id||(g.setMode("select"),Ib([C],!0))}db=null}}},K=function(a){var b=a.target,c=b.parentNode;if(c!==p){var d=Jb(a),e=d.tagName;if("text"===e&&"textedit"!==eb){var f=svgedit.math.transformPoint(a.pageX,a.pageY,Fb);vb.select(d,f.x,f.y)}"g"!==e&&"a"!==e||!svgedit.utilities.getRotationAngle(d)||(Yb(d),d=s[0],Gb(!0)),p&&Rb(),"g"!==c.tagName&&"a"!==c.tagName||c===n().getCurrentLayer()||d===S.selectorParentGroup||Sb(d)}},L=function(a){return a.preventDefault(),!1};$(a).mousedown(G).mousemove(I).click(L).dblclick(K).mouseup(J),$(a).bind("mousewheel DOMMouseScroll",function(a){a.preventDefault();var b=a.originalEvent;Fb=$("#svgcontent g")[0].getScreenCTM().inverse();var c=svgedit.math.transformPoint(b.pageX,b.pageY,Fb),d={x:c.x,y:c.y,width:0,height:0},e=b.wheelDelta?b.wheelDelta:b.detail?-b.detail:0;e&&(d.factor=Math.max(.75,Math.min(4/3,e)),ub("zoomed",d))})}();var Kb=function(a){$(a).click(function(a){a.preventDefault()})};vb=g.textActions=function(){function a(a){var b=""===n.value;if($(n).focus(),!arguments.length)if(b)a=0;else{if(n.selectionEnd!==n.selectionStart)return;a=n.selectionEnd}var c;c=y[a],b||n.setSelectionRange(a,a),p=svgedit.utilities.getElem("text_cursor"),p||(p=document.createElementNS(d.SVG,"line"),svgedit.utilities.assignAttributes(p,{id:"text_cursor",stroke:"#333","stroke-width":1}),p=svgedit.utilities.getElem("selectorParentGroup").appendChild(p)),r||(r=setInterval(function(){var a="none"===p.getAttribute("display");p.setAttribute("display",a?"inline":"none")},600));var e=j(c.x,t.y),f=j(c.x,t.y+t.height);svgedit.utilities.assignAttributes(p,{x1:e.x,y1:e.y,x2:f.x,y2:f.y,visibility:"visible",display:"inline"}),q&&q.setAttribute("d","")}function b(b,c,e){if(b===c)return void a(c);e||n.setSelectionRange(b,c),q=svgedit.utilities.getElem("text_selectblock"),q||(q=document.createElementNS(d.SVG,"path"),svgedit.utilities.assignAttributes(q,{id:"text_selectblock",fill:"green",opacity:.5,style:"pointer-events:none"}),svgedit.utilities.getElem("selectorParentGroup").appendChild(q));var f=y[b],g=y[c];p.setAttribute("visibility","hidden");var h=j(f.x,t.y),i=j(f.x+(g.x-f.x),t.y),k=j(f.x,t.y+t.height),l=j(f.x+(g.x-f.x),t.y+t.height),m="M"+h.x+","+h.y+" L"+i.x+","+i.y+" "+l.x+","+l.y+" "+k.x+","+k.y+"z";svgedit.utilities.assignAttributes(q,{d:m,display:"inline"})}function c(a,b){var c=i.createSVGPoint();if(c.x=a,c.y=b,1==y.length)return 0;var d=m.getCharNumAtPosition(c);0>d?(d=y.length-2,a<=y[0].x&&(d=0)):d>=y.length-2&&(d=y.length-2);var e=y[d],f=e.x+e.width/2;return a>f&&d++,d}function e(b,d){a(c(b,d))}function f(a,d,e){var f=n.selectionStart,g=c(a,d),h=Math.min(f,g),i=Math.max(f,g);b(h,i,!e)}function h(a,b){var c={x:a,y:b};if(c.x/=o,c.y/=o,u){var d=svgedit.math.transformPoint(c.x,c.y,u.inverse());c.x=d.x,c.y=d.y}return c}function j(a,b){var c={x:a,y:b};if(u){var d=svgedit.math.transformPoint(c.x,c.y,u);c.x=d.x,c.y=d.y}return c.x*=o,c.y*=o,c}function k(a){b(0,m.textContent.length),$(this).unbind(a)}function l(a){if(x&&m){var d=svgedit.math.transformPoint(a.pageX,a.pageY,Fb),e=d.x*o,f=d.y*o,g=h(e,f),i=c(g.x,g.y),j=m.textContent,l=j.substr(0,i).replace(/[a-z0-9]+$/i,"").length,n=j.substr(i).match(/^[a-z0-9]+/i),p=(n?n[0].length:0)+i;b(l,p),$(a.target).click(k),setTimeout(function(){$(a.target).unbind("click",k)},300)}}var m,n,p,q,r,t,u,v,w,x,y=[];return{select:function(a,b,c){m=a,vb.toEditMode(b,c)},start:function(a){m=a,vb.toEditMode()},mouseDown:function(a,b,c,d){var f=h(c,d);n.focus(),e(f.x,f.y),v=c,w=d},mouseMove:function(a,b){var c=h(a,b);f(c.x,c.y)},mouseUp:function(a,b,c){var d=h(b,c);f(d.x,d.y,!0),a.target!==m&&v+2>b&&b>v-2&&w+2>c&&c>w-2&&vb.toSelectMode(!0)},setCursor:a,toEditMode:function(b,c){x=!1,eb="textedit",S.requestSelector(m).showGrips(!1);S.requestSelector(m).selectorRect;if(vb.init(),$(m).css("cursor","text"),arguments.length){var d=h(b,c);e(d.x,d.y)}else a();setTimeout(function(){x=!0},300)},toSelectMode:function(a){eb="select",clearInterval(r),r=null,q&&$(q).attr("display","none"),p&&$(p).attr("visibility","hidden"),$(m).css("cursor","move"),a&&(Gb(),$(m).css("cursor","move"),ub("selected",[m]),Hb([m],!0)),m&&!m.textContent.length&&g.deleteSelectedElements(),$(n).blur(),m=!1
},setInputElem:function(a){n=a},clear:function(){"textedit"==eb&&vb.toSelectMode()},init:function(){if(m){var a,c;m.parentNode||(m=s[0],S.requestSelector(m).showGrips(!1));var d=m.textContent,e=d.length,f=m.getAttribute("transform");for(t=svgedit.utilities.getBBox(m),u=f?svgedit.math.getMatrix(m):null,y=new Array(e),n.focus(),$(m).unbind("dblclick",l).dblclick(l),e||(c={x:t.x+t.width/2,width:0}),a=0;e>a;a++){var h=m.getStartPositionOfChar(a);if(c=m.getEndPositionOfChar(a),!svgedit.browser.supportsGoodTextCharPos()){var i=g.contentW*o;h.x-=i,c.x-=i,h.x/=o,c.x/=o}y[a]={x:h.x,y:t.y,width:c.x-h.x,height:t.height}}y.push({x:c.x,width:0}),b(n.selectionStart,n.selectionEnd,!0)}}}}(),wb=g.pathActions=function(){function b(a){a.setAttribute("d",wb.convertPath(a))}var f,h,i,j=!1;svgedit.path.Path.prototype.endChanges=function(a){svgedit.browser.isWebkit()&&b(this.elem);var c=new svgedit.history.ChangeElementCommand(this.elem,{d:this.last_d},a);R(c),ub("changed",[this.elem])},svgedit.path.Path.prototype.addPtsToSelection=function(a){var b,c;for($.isArray(a)||(a=[a]),b=0;b<a.length;b++){var d=a[b];c=this.segs[d],c.ptgrip&&-1==this.selected_pts.indexOf(d)&&d>=0&&this.selected_pts.push(d)}this.selected_pts.sort(),b=this.selected_pts.length;for(var e=new Array(b);b--;){var f=this.selected_pts[b];c=this.segs[f],c.select(!0),e[b]=c.ptgrip}wb.canDeleteNodes=!0,wb.closed_subpath=this.subpathIsClosed(this.selected_pts[0]),ub("selected",e)},f=null;var k=null,l=!1,m=function(a){var b,c=a.points,d=c.numberOfItems;if(d>=4){var e=c.getItem(0),f=null,g=[];for(g.push(["M",e.x,",",e.y," C"].join("")),b=1;d-4>=b;b+=3){var h=c.getItem(b),i=c.getItem(b+1),j=c.getItem(b+2);if(f){var k=svgedit.path.smoothControlPoints(f,h,e);if(k&&2==k.length){var l=g[g.length-1].split(",");l[2]=k[0].x,l[3]=k[0].y,g[g.length-1]=l.join(","),h=k[1]}}g.push([h.x,h.y,i.x,i.y,j.x,j.y].join(",")),e=j,f=i}for(g.push("L");d>b;){var m=c.getItem(b);g.push([m.x,m.y].join(",")),b++}g=g.join(" "),a=t({element:"path",curStyles:!0,attr:{id:sb(),d:g,fill:"none"}})}return a};return{mouseDown:function(b,c,f,g){var i;if("path"!==eb){if(svgedit.path.path){svgedit.path.path.storeD(),i=b.target.id;var l;if("pathpointgrip_"==i.substr(0,14)){l=svgedit.path.path.cur_pt=parseInt(i.substr(14)),svgedit.path.path.dragging=[f,g];var m=svgedit.path.path.segs[l];b.shiftKey?m.selected?svgedit.path.path.removePtFromSelection(l):svgedit.path.path.addPtsToSelection(l):((svgedit.path.path.selected_pts.length<=1||!m.selected)&&svgedit.path.path.clearSelection(),svgedit.path.path.addPtsToSelection(l))}else if(0==i.indexOf("ctrlpointgrip_")){svgedit.path.path.dragging=[f,g];var n=i.split("_")[1].split("c");l=Number(n[0]);var p=Number(n[1]);svgedit.path.path.selectPt(l,p)}svgedit.path.path.dragging||(null==kb&&(kb=S.getRubberBandBox()),svgedit.utilities.assignAttributes(kb,{x:f*o,y:g*o,width:0,height:0,display:"inline"},100))}}else{mouse_x=f,mouse_y=g;var q=mouse_x/o,s=mouse_y/o,u=svgedit.utilities.getElem("path_stretch_line");h=[q,s],e.gridSnapping&&(q=svgedit.utilities.snapToGrid(q),s=svgedit.utilities.snapToGrid(s),mouse_x=svgedit.utilities.snapToGrid(mouse_x),mouse_y=svgedit.utilities.snapToGrid(mouse_y)),u||(u=document.createElementNS(d.SVG,"path"),svgedit.utilities.assignAttributes(u,{id:"path_stretch_line",stroke:"#22C","stroke-width":"0.5",fill:"none"}),u=svgedit.utilities.getElem("selectorParentGroup").appendChild(u)),u.setAttribute("display","inline");var v,w=null;if(k){for(var x=k.pathSegList,y=x.numberOfItems,z=6/o,A=!1;y;){y--;var B=x.getItem(y),C=B.x,D=B.y;if(q>=C-z&&C+z>=q&&s>=D-z&&D+z>=s){A=!0;break}}i=sb(),svgedit.path.removePath_(i);var E,F,G=svgedit.utilities.getElem(i),H=x.numberOfItems;if(A){if(1>=y&&H>=2){var I=x.getItem(0).x,J=x.getItem(0).y;F=u.pathSegList.getItem(1),E=4===F.pathSegType?k.createSVGPathSegLinetoAbs(I,J):k.createSVGPathSegCurvetoCubicAbs(I,J,F.x1/o,F.y1/o,I,J);var K=k.createSVGPathSegClosePath();x.appendItem(E),x.appendItem(K)}else if(3>H)return w=!1;if($(u).remove(),element=G,k=null,cb=!1,j){svgedit.path.path.matrix&&svgedit.coords.remapElement(G,{},svgedit.path.path.matrix.inverse());var L=G.getAttribute("d"),M=$(svgedit.path.path.elem).attr("d");return $(svgedit.path.path.elem).attr("d",M+L),$(G).remove(),svgedit.path.path.matrix&&svgedit.path.recalcRotatedPath(),svgedit.path.path.init(),wb.toEditMode(svgedit.path.path.elem),svgedit.path.path.selectPt(),!1}}else{if(!$.contains(a,Jb(b)))return console.log("Clicked outside canvas"),!1;var N=k.pathSegList.numberOfItems,O=k.pathSegList.getItem(N-1),P=O.x,Q=O.y;if(b.shiftKey){var R=svgedit.math.snapToAngle(P,Q,q,s);q=R.x,s=R.y}F=u.pathSegList.getItem(1),E=4===F.pathSegType?k.createSVGPathSegLinetoAbs(qb(q),qb(s)):k.createSVGPathSegCurvetoCubicAbs(qb(q),qb(s),F.x1/o,F.y1/o,F.x2/o,F.y2/o),k.pathSegList.appendItem(E),q*=o,s*=o,u.setAttribute("d",["M",q,s,q,s].join(" ")),v=N,j&&(v+=svgedit.path.path.segs.length),svgedit.path.addPointGrip(v,q,s)}}else d_attr="M"+q+","+s+" ",k=t({element:"path",curStyles:!0,attr:{d:d_attr,id:tb(),opacity:r.opacity/2}}),u.setAttribute("d",["M",mouse_x,mouse_y,mouse_x,mouse_y].join(" ")),v=j?svgedit.path.path.segs.length:0,svgedit.path.addPointGrip(v,mouse_x,mouse_y)}},mouseMove:function(a,b){if(l=!0,"path"!==eb)if(svgedit.path.path.dragging){var c=svgedit.path.getPointFromGrip({x:svgedit.path.path.dragging[0],y:svgedit.path.path.dragging[1]},svgedit.path.path),d=svgedit.path.getPointFromGrip({x:a,y:b},svgedit.path.path),e=d.x-c.x,f=d.y-c.y;svgedit.path.path.dragging=[a,b],svgedit.path.path.dragctrl?svgedit.path.path.moveCtrl(e,f):svgedit.path.path.movePts(e,f)}else svgedit.path.path.selected_pts=[],svgedit.path.path.eachSeg(function(){var a=this;if(a.next||a.prev){var b=(a.item,kb.getBBox()),c=svgedit.path.getGripPt(a),d={x:c.x,y:c.y,width:0,height:0},e=svgedit.math.rectsIntersect(b,d);this.select(e),e&&svgedit.path.path.selected_pts.push(a.index)}});else{if(!k)return;var g=k.pathSegList,j=g.numberOfItems-1;if(h){var m=svgedit.path.addCtrlGrip("1c1"),n=svgedit.path.addCtrlGrip("0c2");m.setAttribute("cx",a),m.setAttribute("cy",b),m.setAttribute("display","inline");var p=h[0],q=h[1],r=(g.getItem(j),a/o),s=b/o,t=p+(p-r),u=q+(q-s);n.setAttribute("cx",t*o),n.setAttribute("cy",u*o),n.setAttribute("display","inline");var v=svgedit.path.getCtrlLine(1);if(svgedit.utilities.assignAttributes(v,{x1:a,y1:b,x2:t*o,y2:u*o,display:"inline"}),0===j)i=[a,b];else{var w=g.getItem(j-1),x=w.x,y=w.y;6===w.pathSegType?(x+=x-w.x2,y+=y-w.y2):i&&(x=i[0]/o,y=i[1]/o),svgedit.path.replacePathSeg(6,j,[p,q,x,y,t,u],k)}}else{var z=svgedit.utilities.getElem("path_stretch_line");if(z){var A=g.getItem(j);if(6===A.pathSegType){var B=A.x+(A.x-A.x2),C=A.y+(A.y-A.y2);svgedit.path.replacePathSeg(6,1,[a,b,B*o,C*o,a,b],z)}else i?svgedit.path.replacePathSeg(6,1,[a,b,i[0],i[1],a,b],z):svgedit.path.replacePathSeg(4,1,[a,b],z)}}}},mouseUp:function(a,b){if("path"===eb)return h=null,k||(b=svgedit.utilities.getElem(sb()),cb=!1,i=null),{keep:!0,element:b};if(svgedit.path.path.dragging){var c=svgedit.path.path.cur_pt;svgedit.path.path.dragging=!1,svgedit.path.path.dragctrl=!1,svgedit.path.path.update(),l&&svgedit.path.path.endChanges("Move path point(s)"),a.shiftKey||l||svgedit.path.path.selectPt(c)}else kb&&"none"!=kb.getAttribute("display")?(kb.setAttribute("display","none"),kb.getAttribute("width")<=2&&kb.getAttribute("height")<=2&&wb.toSelectMode(a.target)):wb.toSelectMode(a.target);l=!1},toEditMode:function(a){svgedit.path.path=svgedit.path.getPath_(a),eb="pathedit",Gb(),svgedit.path.path.show(!0).update(),svgedit.path.path.oldbbox=svgedit.utilities.getBBox(svgedit.path.path.elem),j=!1},toSelectMode:function(a){var b=a==svgedit.path.path.elem;eb="select",svgedit.path.path.show(!1),f=!1,Gb(),svgedit.path.path.matrix&&svgedit.path.recalcRotatedPath(),b&&(ub("selected",[a]),Hb([a],!0))},addSubPath:function(a){a?(eb="path",j=!0):(wb.clear(!0),wb.toEditMode(svgedit.path.path.elem))},select:function(a){f===a?(wb.toEditMode(a),eb="pathedit"):f=a},reorient:function(){var a=s[0];if(a){var b=svgedit.utilities.getRotationAngle(a);if(0!=b){var c=new svgedit.history.BatchCommand("Reorient path"),d={d:a.getAttribute("d"),transform:a.getAttribute("transform")};c.addSubCommand(new svgedit.history.ChangeElementCommand(a,d)),Gb(),this.resetOrientation(a),R(c),svgedit.path.getPath_(a).show(!1).matrix=null,this.clear(),Hb([a],!0),ub("changed",s)}}},clear:function(){if(f=null,k){var a=svgedit.utilities.getElem(sb());$(svgedit.utilities.getElem("path_stretch_line")).remove(),$(a).remove(),$(svgedit.utilities.getElem("pathpointgrip_container")).find("*").attr("display","none"),k=i=null,cb=!1}else"pathedit"==eb&&this.toSelectMode();svgedit.path.path&&svgedit.path.path.init().show(!1)},resetOrientation:function(a){if(null==a||"path"!=a.nodeName)return!1;var b=svgedit.transformlist.getTransformList(a),d=svgedit.math.transformListToTransform(b).matrix;b.clear(),a.removeAttribute("transform");var e,f=a.pathSegList,g=f.numberOfItems;for(e=0;g>e;++e){var h=f.getItem(e),i=h.pathSegType;if(1!=i){var j=[];$.each(["",1,2],function(a,b){var c=h["x"+b],e=h["y"+b];if(void 0!==c&&void 0!==e){var f=svgedit.math.transformPoint(c,e,d);j.splice(j.length,0,f.x,f.y)}}),svgedit.path.replacePathSeg(i,e,j,a)}}c(a,d)},zoomChange:function(){"pathedit"==eb&&svgedit.path.path.update()},getNodePoint:function(){var a=svgedit.path.path.selected_pts.length?svgedit.path.path.selected_pts[0]:1,b=svgedit.path.path.segs[a];return{x:b.item.x,y:b.item.y,type:b.type}},linkControlPoints:function(a){svgedit.path.setLinkControlPoints(a)},clonePathNode:function(){svgedit.path.path.storeD();for(var a=svgedit.path.path.selected_pts,b=(svgedit.path.path.segs,a.length),c=[];b--;){var d=a[b];svgedit.path.path.addSeg(d),c.push(d+b),c.push(d+b+1)}svgedit.path.path.init().addPtsToSelection(c),svgedit.path.path.endChanges("Clone path node(s)")},opencloseSubPath:function(){var a=svgedit.path.path.selected_pts;if(1===a.length){var b=svgedit.path.path.elem,c=b.pathSegList,d=(c.numberOfItems,a[0]),e=null,f=null;if(svgedit.path.path.eachSeg(function(a){return 2===this.type&&d>=a&&(f=this.item),d>=a?!0:2===this.type?(e=a,!1):1===this.type?(e=!1,!1):void 0}),null==e&&(e=svgedit.path.path.segs.length-1),e!==!1){var g=b.createSVGPathSegLinetoAbs(f.x,f.y),h=b.createSVGPathSegClosePath();return e==svgedit.path.path.segs.length-1?(c.appendItem(g),c.appendItem(h)):(svgedit.path.insertItemBefore(b,h,e),svgedit.path.insertItemBefore(b,g,e)),void svgedit.path.path.init().selectPt(e+1)}var i=svgedit.path.path.segs[d];if(i.mate)return c.removeItem(d),c.removeItem(d),void svgedit.path.path.init().selectPt(d-1);var j,k,l;for(j=0;j<c.numberOfItems;j++){var m=c.getItem(j);if(2===m.pathSegType)k=j;else if(j===d)c.removeItem(k);else if(1===m.pathSegType&&j>d){l=j-1,c.removeItem(j);break}}for(var n=d-k-1;n--;)svgedit.path.insertItemBefore(b,c.getItem(k),l);var o=c.getItem(k);svgedit.path.replacePathSeg(2,k,[o.x,o.y]),j=d,svgedit.path.path.init().selectPt(0)}},deletePathNode:function(){if(wb.canDeleteNodes){svgedit.path.path.storeD();for(var a=svgedit.path.path.selected_pts,b=a.length;b--;){var c=a[b];svgedit.path.path.deleteSeg(c)}var d=function(){var a=svgedit.path.path.elem.pathSegList,b=a.numberOfItems,c=function(b,c){for(;c--;)a.removeItem(b)};if(1>=b)return!0;for(;b--;){var e=a.getItem(b);if(1===e.pathSegType){var f=a.getItem(b-1),g=a.getItem(b-2);if(2===f.pathSegType){c(b-1,2),d();break}if(2===g.pathSegType){c(b-2,3),d();break}}else if(2===e.pathSegType&&b>0){var h=a.getItem(b-1).pathSegType;if(2===h){c(b-1,1),d();break}if(1===h&&a.numberOfItems-1===b){c(b,1),d();break}}}return!1};if(d(),svgedit.path.path.elem.pathSegList.numberOfItems<=1)return wb.toSelectMode(svgedit.path.path.elem),void g.deleteSelectedElements();if(svgedit.path.path.init(),svgedit.path.path.clearSelection(),window.opera){var e=$(svgedit.path.path.elem);e.attr("d",e.attr("d"))}svgedit.path.path.endChanges("Delete path node(s)")}},smoothPolylineIntoPath:m,setSegType:function(a){svgedit.path.path.setSegType(a)},moveNode:function(a,b){var c=svgedit.path.path.selected_pts;if(c.length){svgedit.path.path.storeD();var d=svgedit.path.path.segs[c[0]],e={x:0,y:0};e[a]=b-d.item[a],d.move(e.x,e.y),svgedit.path.path.endChanges("Move path point")}},fixEnd:function(a){var c,d,e=a.pathSegList,f=e.numberOfItems;for(c=0;f>c;++c){var g=e.getItem(c);if(2===g.pathSegType&&(d=g),1===g.pathSegType){var h=e.getItem(c-1);if(h.x!=d.x||h.y!=d.y){var i=a.createSVGPathSegLinetoAbs(d.x,d.y);svgedit.path.insertItemBefore(a,i,c),wb.fixEnd(a);break}}}svgedit.browser.isWebkit()&&b(a)},convertPath:function(a,b){var c,d=a.pathSegList,e=d.numberOfItems,f=0,g=0,h="",i=null;for(c=0;e>c;++c){var j=d.getItem(c),k=j.x||0,l=j.y||0,m=j.x1||0,n=j.y1||0,o=j.x2||0,p=j.y2||0,q=j.pathSegType,r=Db[q]["to"+(b?"Lower":"Upper")+"Case"](),s=function(a,b,c){b=b?" "+b.join(" "):"",c=c?" "+svgedit.units.shortFloat(c):"",$.each(a,function(b,c){a[b]=svgedit.units.shortFloat(c)}),h+=r+a.join(" ")+b+c};switch(q){case 1:h+="z";break;case 12:k-=f;case 13:b?(f+=k,r="l"):(k+=f,f=k,r="L"),s([[k,g]]);break;case 14:l-=g;case 15:b?(g+=l,r="l"):(l+=g,g=l,r="L"),s([[f,l]]);break;case 2:case 4:case 18:k-=f,l-=g;case 5:case 3:i&&1===d.getItem(c-1).pathSegType&&!b&&(f=i[0],g=i[1]);case 19:b?(f+=k,g+=l):(k+=f,l+=g,f=k,g=l),3===q&&(i=[f,g]),s([[k,l]]);break;case 6:k-=f,m-=f,o-=f,l-=g,n-=g,p-=g;case 7:b?(f+=k,g+=l):(k+=f,m+=f,o+=f,l+=g,n+=g,p+=g,f=k,g=l),s([[m,n],[o,p],[k,l]]);break;case 8:k-=f,m-=f,l-=g,n-=g;case 9:b?(f+=k,g+=l):(k+=f,m+=f,l+=g,n+=g,f=k,g=l),s([[m,n],[k,l]]);break;case 10:k-=f,l-=g;case 11:b?(f+=k,g+=l):(k+=f,l+=g,f=k,g=l),s([[j.r1,j.r2]],[j.angle,j.largeArcFlag?1:0,j.sweepFlag?1:0],[k,l]);break;case 16:k-=f,o-=f,l-=g,p-=g;case 17:b?(f+=k,g+=l):(k+=f,o+=f,l+=g,p+=g,f=k,g=l),s([[o,p],[k,l]])}}return h}}}();var Lb=this.removeUnusedDefElems=function(){var a=j.getElementsByTagNameNS(d.SVG,"defs");if(!a||!a.length)return 0;var b,c,e=[],f=0,g=["fill","stroke","filter","marker-start","marker-mid","marker-end"],h=g.length,i=j.getElementsByTagNameNS(d.SVG,"*"),k=i.length;for(b=0;k>b;b++){var l=i[b];for(c=0;h>c;c++){var m=svgedit.utilities.getUrlFromAttr(l.getAttribute(g[c]));m&&e.push(m.substr(1))}var n=C(l);n&&0===n.indexOf("#")&&e.push(n.substr(1))}var o=$(a).find("linearGradient, radialGradient, filter, marker, svg, symbol");for(b=o.length;b--;){var p=o[b],q=p.id;e.indexOf(q)<0&&(ob[q]=p,p.parentNode.removeChild(p),f++)}return f};this.svgCanvasToString=function(){for(;Lb()>0;);wb.clear(!0),$.each(j.childNodes,function(a,b){a&&8===b.nodeType&&b.data.indexOf("Created with")>=0&&j.insertBefore(b,j.firstChild)}),p&&(Rb(),Ib([p]));var a=[];$(j).find("g:data(gsvg)").each(function(){var b,c=this.attributes,d=c.length;for(b=0;d>b;b++)("id"==c[b].nodeName||"style"==c[b].nodeName)&&d--;if(0>=d){var e=this.firstChild;a.push(e),$(this).replaceWith(e)}});var b=this.svgToString(j,0);return a.length&&$(a).each(function(){zb(this)}),b},this.svgToString=function(a,b){var c=[],f=svgedit.utilities.toXml,g=e.baseUnit,h=new RegExp("^-?[\\d\\.]+"+g+"$");if(a){H(a);var i,j,k=a.attributes,l=a.childNodes;for(j=0;b>j;j++)c.push(" ");if(c.push("<"),c.push(a.nodeName),"svgcontent"===a.id){var m=Tb(),n="";"px"!==g&&(m.w=svgedit.units.convertUnit(m.w,g)+g,m.h=svgedit.units.convertUnit(m.h,g)+g),c.push(' width="'+m.w+'" height="'+m.h+'"'+n+' xmlns="'+d.SVG+'"');var o={};$(a).find("*").andSelf().each(function(){var a=this.namespaceURI;a&&!o[a]&&K[a]&&"xmlns"!==K[a]&&"xml"!==K[a]&&(o[a]=!0,c.push(" xmlns:"+K[a]+'="'+a+'"')),$.each(this.attributes,function(a,b){var d=b.namespaceURI;d&&!o[d]&&"xmlns"!==K[d]&&"xml"!==K[d]&&(o[d]=!0,c.push(" xmlns:"+K[d]+'="'+d+'"'))})}),j=k.length;for(var p=["width","height","xmlns","x","y","viewBox","id","overflow"];j--;){i=k.item(j);var q=f(i.nodeValue);0!==i.nodeName.indexOf("xmlns:")&&""!=q&&-1==p.indexOf(i.localName)&&(!i.namespaceURI||K[i.namespaceURI])&&(c.push(" "),c.push(i.nodeName),c.push('="'),c.push(q),c.push('"'))}}else{if("defs"===a.nodeName&&!a.firstChild)return;var r=["-moz-math-font-style","_moz-math-font-style"];for(j=k.length-1;j>=0;j--){i=k.item(j);var q=f(i.nodeValue);if(!(r.indexOf(i.localName)>=0)&&""!=q){if(0===q.indexOf("pointer-events"))continue;if("class"===i.localName&&0===q.indexOf("se_"))continue;if(c.push(" "),"d"===i.localName&&(q=wb.convertPath(a,!0)),isNaN(q)?h.test(q)&&(q=svgedit.units.shortFloat(q)+g):q=svgedit.units.shortFloat(q),bb.apply&&"image"===a.nodeName&&"href"===i.localName&&bb.images&&"embed"===bb.images){var s=Z[q];s&&(q=s)}(!i.namespaceURI||i.namespaceURI==d.SVG||K[i.namespaceURI])&&(c.push(i.nodeName),c.push('="'),c.push(q),c.push('"'))}}}if(a.hasChildNodes()){c.push(">"),b++;var t=!1;for(j=0;j<l.length;j++){var u=l.item(j);switch(u.nodeType){case 1:c.push("\n"),c.push(this.svgToString(l.item(j),b));break;case 3:var v=u.nodeValue.replace(/^\s+|\s+$/g,"");""!=v&&(t=!0,c.push(String(f(v))));break;case 4:c.push("\n"),c.push(new Array(b+1).join(" ")),c.push("<![CDATA["),c.push(u.nodeValue),c.push("]]>");break;case 8:c.push("\n"),c.push(new Array(b+1).join(" ")),c.push("<!--"),c.push(u.data),c.push("-->")}}if(b--,!t)for(c.push("\n"),j=0;b>j;j++)c.push(" ");c.push("</"),c.push(a.nodeName),c.push(">")}else c.push("/>")}return c.join("")},this.embedImage=function(a,b){$(new Image).load(function(){var c=document.createElement("canvas");c.width=this.width,c.height=this.height,c.getContext("2d").drawImage(this,0,0);try{var d=";svgedit_url="+encodeURIComponent(a);d=c.toDataURL().replace(";base64",d+";base64"),Z[a]=d}catch(e){Z[a]=!1}_=a,b&&b(Z[a])}).attr("src",a)},this.setGoodImage=function(a){_=a},this.open=function(){},this.save=function(a){Gb(),a&&$.extend(bb,a),bb.apply=!0;var b=this.svgCanvasToString();ub("saved",b)},this.rasterExport=function(a,b){var c="image/"+a.toLowerCase();Gb();var d=[],e={feGaussianBlur:T.exportNoBlur,foreignObject:T.exportNoforeignObject,"[stroke-dasharray]":T.exportNoDashArray},f=$(j);"font"in $("<canvas>")[0].getContext("2d")||(e.text=T.exportNoText),$.each(e,function(a,b){f.find(a).length&&d.push(b)});var g=this.svgCanvasToString();ub("exported",{svg:g,issues:d,type:a,mimeType:c,quality:b})},this.getSvgString=function(){return bb.apply=!1,this.svgCanvasToString()},this.randomizeIds=function(a){arguments.length>0&&0==a?svgedit.draw.randomizeIds(!1,n()):svgedit.draw.randomizeIds(!0,n())};var Mb=this.uniquifyElems=function(a){var b={},c=["filter","linearGradient","pattern","radialGradient","symbol","textPath","use"];svgedit.utilities.walkTree(a,function(a){if(1==a.nodeType){a.id&&(a.id in b||(b[a.id]={elem:null,attrs:[],hrefs:[]}),b[a.id].elem=a),$.each(V,function(c,d){var e=a.getAttributeNode(d);if(e){var f=svgedit.utilities.getUrlFromAttr(e.value),g=f?f.substr(1):null;g&&(g in b||(b[g]={elem:null,attrs:[],hrefs:[]}),b[g].attrs.push(e))}});var d=svgedit.utilities.getHref(a);if(d&&c.indexOf(a.nodeName)>=0){var e=d.substr(1);e&&(e in b||(b[e]={elem:null,attrs:[],hrefs:[]}),b[e].hrefs.push(a))}}});var d;for(d in b)if(d){var e=b[d].elem;if(e){var f=tb();e.id=f;for(var g=b[d].attrs,h=g.length;h--;){var i=g[h];i.ownerElement.setAttribute(i.name,"url(#"+f+")")}for(var j=b[d].hrefs,k=j.length;k--;){var l=j[k];svgedit.utilities.setHref(l,"#"+f)}}}},Nb=this.setUseData=function(a){var b=$(a);"use"!==a.tagName&&(b=b.find("use")),b.each(function(){var a=C(this).substr(1),b=svgedit.utilities.getElem(a);b&&($(this).data("ref",b),("symbol"==b.tagName||"svg"==b.tagName)&&$(this).data("symbol",b).data("ref",b))})},Ob=this.convertGradients=function(a){var b=$(a).find("linearGradient, radialGradient");!b.length&&svgedit.browser.isWebkit()&&(b=$(a).find("*").filter(function(){return this.tagName.indexOf("Gradient")>=0})),b.each(function(){var a=this;if("userSpaceOnUse"===$(a).attr("gradientUnits")){var b=$(j).find('[fill="url(#'+a.id+')"],[stroke="url(#'+a.id+')"]');if(!b.length)return;var c=svgedit.utilities.getBBox(b[0]);if(!c)return;if("linearGradient"===a.tagName){var d=$(a).attr(["x1","y1","x2","y2"]),e=a.gradientTransform.baseVal;if(e&&e.numberOfItems>0){var f=svgedit.math.transformListToTransform(e).matrix,g=svgedit.math.transformPoint(d.x1,d.y1,f),h=svgedit.math.transformPoint(d.x2,d.y2,f);d.x1=g.x,d.y1=g.y,d.x2=h.x,d.y2=h.y,a.removeAttribute("gradientTransform")}$(a).attr({x1:(d.x1-c.x)/c.width,y1:(d.y1-c.y)/c.height,x2:(d.x2-c.x)/c.width,y2:(d.y2-c.y)/c.height}),a.removeAttribute("gradientUnits")}}})},Pb=this.convertToGroup=function(a){a||(a=s[0]);var b,c=$(a),e=new svgedit.history.BatchCommand;if(c.data("gsvg")){var f=a.firstChild,g=$(f).attr(["x","y"]);$(a.firstChild.firstChild).unwrap(),$(a).removeData("gsvg");var k=svgedit.transformlist.getTransformList(a),l=i.createSVGTransform();l.setTranslate(g.x,g.y),k.appendItem(l),svgedit.recalculate.recalculateDimensions(a),ub("selected",[a])}else if(c.data("symbol")){a=c.data("symbol"),b=c.attr("transform");var m=c.attr(["x","y"]),n=a.getAttribute("viewBox");if(n){var o=n.split(" ");m.x-=+o[0],m.y-=+o[1]}b+=" translate("+(m.x||0)+","+(m.y||0)+")";var p=c.prev();e.addSubCommand(new svgedit.history.RemoveElementCommand(c[0],c[0].nextSibling,c[0].parentNode)),c.remove();var q,r=$(j).find("use:data(symbol)").length,t=h.createElementNS(d.SVG,"g"),u=a.childNodes;for(q=0;q<u.length;q++)t.appendChild(u[q].cloneNode(!0));if(svgedit.browser.isGecko()){var v=$(svgedit.utilities.findDefs()).children("linearGradient,radialGradient,pattern").clone();$(t).append(v)}b&&t.setAttribute("transform",b);var w=a.parentNode;if(Mb(t),svgedit.browser.isGecko()&&$(A()).append($(t).find("linearGradient,radialGradient,pattern")),t.id=tb(),p.after(t),w){if(!r){var x=a.nextSibling;w.removeChild(a),e.addSubCommand(new svgedit.history.RemoveElementCommand(a,x,w))}e.addSubCommand(new svgedit.history.InsertElementCommand(t))}Nb(t),Ob(svgedit.browser.isGecko()?svgedit.utilities.findDefs():t),svgedit.utilities.walkTreePost(t,function(a){try{svgedit.recalculate.recalculateDimensions(a)}catch(b){console.log(b)}}),$(t).find(U).each(function(){this.id||(this.id=tb())}),Ib([t]);var y=Yb(t,!0);y&&e.addSubCommand(y),R(e)}else console.log("Unexpected element to ungroup:",a)};this.setSvgString=function(a){try{var b=svgedit.utilities.text2xml(a);this.prepareSvg(b);var c=new svgedit.history.BatchCommand("Change Source"),f=j.nextSibling,k=i.removeChild(j);c.addSubCommand(new svgedit.history.RemoveElementCommand(k,f,i)),j=h.adoptNode?h.adoptNode(b.documentElement):h.importNode(b.documentElement,!0),i.appendChild(j);var l=$(j);g.current_drawing_=new svgedit.draw.Drawing(j,m);var p=n().getNonce();p?ub("setnonce",p):ub("unsetnonce"),l.find("image").each(function(){var a=this;Kb(a);var b=C(this);if(b){if(0===b.indexOf("data:")){var c=b.match(/svgedit_url=(.*?);/);if(c){var e=decodeURIComponent(c[1]);$(new Image).load(function(){a.setAttributeNS(d.XLINK,"xlink:href",e)}).attr("src",e)}}g.embedImage(b)}}),l.find("svg").each(function(){if(!$(this).closest("defs").length){Mb(this);var a=this.parentNode;1===a.childNodes.length&&"g"===a.nodeName?($(a).data("gsvg",this),a.id=a.id||tb()):zb(this)}}),svgedit.browser.isGecko()&&l.find("linearGradient, radialGradient, pattern").appendTo(svgedit.utilities.findDefs()),Nb(l),Ob(l[0]),svgedit.utilities.walkTreePost(j,function(a){try{svgedit.recalculate.recalculateDimensions(a)}catch(b){console.log(b)}});var q={id:"svgcontent",overflow:e.show_outside_canvas?"visible":"hidden"},r=!1;if(l.attr("viewBox")){var s=l.attr("viewBox").split(" ");q.width=s[2],q.height=s[3]}else $.each(["width","height"],function(a,b){var c=l.attr(b);c||(c="100%"),"%"===String(c).substr(-1)?r=!0:q[b]=svgedit.units.convertToNum(b,c)});if(Qb(),l.children().find(U).each(function(){this.id||(this.id=tb())}),r){var t=getStrokedBBox();q.width=t.width+t.x,q.height=t.height+t.y}q.width<=0&&(q.width=100),q.height<=0&&(q.height=100),l.attr(q),this.contentW=q.width,this.contentH=q.height,c.addSubCommand(new svgedit.history.InsertElementCommand(j));var u=l.attr(["width","height"]);c.addSubCommand(new svgedit.history.ChangeElementCommand(i,u)),o=1,svgedit.transformlist.resetListMap(),Gb(),svgedit.path.clearData(),i.appendChild(S.selectorParentGroup),R(c),ub("changed",[j])}catch(v){return console.log(v),!1}return!0},this.importSvgString=function(a){var b,c;try{var e=svgedit.utilities.encode64(a.length+a).substr(0,32),f=!1;gb[e]&&$(gb[e].symbol).parents("#svgroot").length&&(f=!0);var g,i=new svgedit.history.BatchCommand("Import SVG");if(f)g=gb[e].symbol,c=gb[e].xform;else{var k=svgedit.utilities.text2xml(a);this.prepareSvg(k);var l;l=h.adoptNode?h.adoptNode(k.documentElement):h.importNode(k.documentElement,!0),Mb(l);var m=svgedit.units.convertToNum("width",l.getAttribute("width")),o=svgedit.units.convertToNum("height",l.getAttribute("height")),q=l.getAttribute("viewBox"),r=q?q.split(" "):[0,0,m,o];for(b=0;4>b;++b)r[b]=+r[b];var s=(+j.getAttribute("width"),+j.getAttribute("height"));c=o>m?"scale("+s/3/r[3]+")":"scale("+s/3/r[2]+")",c="translate(0) "+c+" translate(0)",g=h.createElementNS(d.SVG,"symbol");var t=svgedit.utilities.findDefs();for(svgedit.browser.isGecko()&&$(l).find("linearGradient, radialGradient, pattern").appendTo(t);l.firstChild;){var u=l.firstChild;g.appendChild(u)}var v,w=l.attributes;for(v=0;v<w.length;v++){var x=w[v];g.setAttribute(x.nodeName,x.nodeValue)}g.id=tb(),gb[e]={symbol:g,xform:c},svgedit.utilities.findDefs().appendChild(g),i.addSubCommand(new svgedit.history.InsertElementCommand(g))}var y=h.createElementNS(d.SVG,"use");y.id=tb(),D(y,"#"+g.id),(p||n().getCurrentLayer()).appendChild(y),i.addSubCommand(new svgedit.history.InsertElementCommand(y)),Gb(),y.setAttribute("transform",c),svgedit.recalculate.recalculateDimensions(y),$(y).data("symbol",g).data("ref",g),Hb([y]),R(i),ub("changed",[j])}catch(z){return console.log(z),!1}return!0};var Qb=g.identifyLayers=function(){Rb(),n().identifyLayers()};this.createLayer=function(a){var b=new svgedit.history.BatchCommand("Create Layer"),c=n().createLayer(a);b.addSubCommand(new svgedit.history.InsertElementCommand(c)),R(b),Gb(),ub("changed",[c])},this.cloneLayer=function(a){var b=new svgedit.history.BatchCommand("Duplicate Layer"),c=h.createElementNS(d.SVG,"g"),e=h.createElementNS(d.SVG,"title");e.textContent=a,c.appendChild(e);var f=n().getCurrentLayer();$(f).after(c);var i,j=f.childNodes;for(i=0;i<j.length;i++){var k=j[i];"title"!=k.localName&&c.appendChild(Ab(k))}Gb(),Qb(),b.addSubCommand(new svgedit.history.InsertElementCommand(c)),R(b),g.setCurrentLayer(a),ub("changed",[c])},this.deleteCurrentLayer=function(){var a=n().getCurrentLayer(),b=a.nextSibling,c=a.parentNode;if(a=n().deleteCurrentLayer()){var d=new svgedit.history.BatchCommand("Delete Layer");return d.addSubCommand(new svgedit.history.RemoveElementCommand(a,b,c)),R(d),Gb(),ub("changed",[c]),!0}return!1},this.setCurrentLayer=function(a){var b=n().setCurrentLayer(svgedit.utilities.toXml(a));return b&&Gb(),b},this.renameCurrentLayer=function(a){var b,c=n();if(c.current_layer){var d=c.current_layer;if(!g.setCurrentLayer(a)){var e=new svgedit.history.BatchCommand("Rename Layer");for(b=0;b<c.getNumLayers()&&c.all_layers[b][1]!=d;++b);var f=c.getLayerName(b);c.all_layers[b][0]=svgedit.utilities.toXml(a);var h=d.childNodes.length;for(b=0;h>b;++b){var i=d.childNodes.item(b);if(i&&"title"==i.tagName){for(;i.firstChild;)i.removeChild(i.firstChild);return i.textContent=a,e.addSubCommand(new svgedit.history.ChangeElementCommand(i,{"#text":f})),R(e),ub("changed",[d]),!0}}}c.current_layer=d}return!1},this.setCurrentLayerPosition=function(a){var b,c=n();if(c.current_layer&&a>=0&&a<c.getNumLayers()){for(b=0;b<c.getNumLayers()&&c.all_layers[b][1]!=c.current_layer;++b);if(b==c.getNumLayers())return!1;if(b!=a){var d=null,e=c.current_layer.nextSibling;return a>b?a<c.getNumLayers()-1&&(d=c.all_layers[a+1][1]):d=c.all_layers[a][1],j.insertBefore(c.current_layer,d),R(new svgedit.history.MoveElementCommand(c.current_layer,e,j)),Qb(),g.setCurrentLayer(c.getLayerName(a)),!0}}return!1},this.setLayerVisibility=function(a,b){var c=n(),d=c.getLayerVisibility(a),e=c.setLayerVisibility(a,b);if(!e)return!1;var f=d?"inline":"none";return R(new svgedit.history.ChangeElementCommand(e,{display:f},"Layer Visibility")),e==c.getCurrentLayer()&&(Gb(),wb.clear()),!0},this.moveSelectedToLayer=function(a){var b,c=null,d=n();for(b=0;b<d.getNumLayers();++b)if(d.getLayerName(b)==a){c=d.all_layers[b][1];break}if(!c)return!1;var e=new svgedit.history.BatchCommand("Move Elements to Layer"),f=s;for(b=f.length;b--;){var g=f[b];if(g){var h=g.nextSibling,i=g.parentNode;c.appendChild(g),e.addSubCommand(new svgedit.history.MoveElementCommand(g,h,i))}}return R(e),!0},this.mergeLayer=function(a){var b=new svgedit.history.BatchCommand("Merge Layer"),c=n(),d=$(c.current_layer).prev()[0];if(d){var e=c.current_layer.childNodes,f=(e.length,c.current_layer.nextSibling);for(b.addSubCommand(new svgedit.history.RemoveElementCommand(c.current_layer,f,j));c.current_layer.firstChild;){var g=c.current_layer.firstChild;if("title"!=g.localName){var h=g.nextSibling;d.appendChild(g),b.addSubCommand(new svgedit.history.MoveElementCommand(g,h,c.current_layer))}else{var i=g.nextSibling;b.addSubCommand(new svgedit.history.RemoveElementCommand(g,i,c.current_layer)),c.current_layer.removeChild(g)}}return j.removeChild(c.current_layer),a||(Gb(),Qb(),ub("changed",[j]),R(b)),c.current_layer=d,b}},this.mergeAllLayers=function(){var a=new svgedit.history.BatchCommand("Merge all Layers"),b=n();for(b.current_layer=b.all_layers[b.getNumLayers()-1][1];$(j).children("g").length>1;)a.addSubCommand(g.mergeLayer(!0));Gb(),Qb(),ub("changed",[j]),R(a)};var Rb=this.leaveContext=function(){var a,b=ab.length;if(b){for(a=0;b>a;a++){var c=ab[a],d=W(c,"orig_opac");1!==d?c.setAttribute("opacity",d):c.removeAttribute("opacity"),c.setAttribute("style","pointer-events: inherit")}ab=[],Gb(!0),ub("contextset",null)}p=null},Sb=this.setContext=function(a){Rb(),"string"==typeof a&&(a=svgedit.utilities.getElem(a)),p=a,$(a).parentsUntil("#svgcontent").andSelf().siblings().each(function(){var a=this.getAttribute("opacity")||1;W(this,"orig_opac",a),this.setAttribute("opacity",.33*a),this.setAttribute("style","pointer-events: none"),ab.push(this)}),Gb(),ub("contextset",p)};this.clear=function(){wb.clear(),Gb(),g.clearSvgContentElement(),g.current_drawing_=new svgedit.draw.Drawing(j),g.createLayer("Layer 1"),g.undoMgr.resetUndoStack(),S.initGroup(),kb=S.getRubberBandBox(),ub("cleared")},this.linkControlPoints=wb.linkControlPoints,this.getContentElem=function(){return j},this.getRootElem=function(){return i},this.getSelectedElems=function(){return s};var Tb=this.getResolution=function(){var a=j.getAttribute("width")/o,b=j.getAttribute("height")/o;return{w:a,h:b,zoom:o}};this.getZoom=function(){return o},this.getVersion=function(){return"svgcanvas.js ($Rev: 2705 $)"},this.setUiStrings=function(a){$.extend(T,a.notification)},this.setConfig=function(a){$.extend(e,a)},this.getTitle=function(a){var b;if(a=a||s[0]){a=$(a).data("gsvg")||$(a).data("symbol")||a;var c=a.childNodes;for(b=0;b<c.length;b++)if("title"==c[b].nodeName)return c[b].textContent;return""}},this.setGroupTitle=function(a){var b=s[0];b=$(b).data("gsvg")||b;var c=$(b).children("title"),e=new svgedit.history.BatchCommand("Set Label");if(a.length)if(c.length){var f=c[0];e.addSubCommand(new svgedit.history.ChangeElementCommand(f,{"#text":f.textContent})),f.textContent=a}else f=h.createElementNS(d.SVG,"title"),f.textContent=a,$(b).prepend(f),e.addSubCommand(new svgedit.history.InsertElementCommand(f));else{var g=c.nextSibling;e.addSubCommand(new svgedit.history.RemoveElementCommand(c[0],g,b)),c.remove()}R(e)},this.getDocumentTitle=function(){return g.getTitle(j)},this.setDocumentTitle=function(a){var b,c=j.childNodes,e=!1,f="",g=new svgedit.history.BatchCommand("Change Image Title");for(b=0;b<c.length;b++)if("title"==c[b].nodeName){e=c[b],f=e.textContent;break}e||(e=h.createElementNS(d.SVG,"title"),j.insertBefore(e,j.firstChild)),a.length?e.textContent=a:e.parentNode.removeChild(e),g.addSubCommand(new svgedit.history.ChangeElementCommand(e,{"#text":f})),R(g)},this.getEditorNS=function(a){return a&&j.setAttribute("xmlns:se",d.SE),d.SE
},this.setResolution=function(a,b){var c,d=Tb(),e=d.w,f=d.h;if("fit"==a){var h=getStrokedBBox();if(!h)return!1;c=new svgedit.history.BatchCommand("Fit Canvas to Content");var k=xb();Hb(k);var l=[],m=[];$.each(k,function(){l.push(-1*h.x),m.push(-1*h.y)});var n=g.moveSelectedElements(l,m,!0);c.addSubCommand(n),Gb(),a=Math.round(h.width),b=Math.round(h.height)}if(a!=e||b!=f){var p=i.suspendRedraw(1e3);c||(c=new svgedit.history.BatchCommand("Change Image Dimensions")),a=svgedit.units.convertToNum("width",a),b=svgedit.units.convertToNum("height",b),j.setAttribute("width",a),j.setAttribute("height",b),this.contentW=a,this.contentH=b,c.addSubCommand(new svgedit.history.ChangeElementCommand(j,{width:e,height:f})),j.setAttribute("viewBox",[0,0,a/o,b/o].join(" ")),c.addSubCommand(new svgedit.history.ChangeElementCommand(j,{viewBox:["0 0",e,f].join(" ")})),R(c),i.unsuspendRedraw(p),ub("changed",[j])}return!0},this.getOffset=function(){return $(j).attr(["x","y"])},this.setBBoxZoom=function(a,b,c){var d,e=.85,f=function(a){if(!a)return!1;var d=Math.round(b/a.width*100*e)/100,f=Math.round(c/a.height*100*e)/100,h=Math.min(d,f);return g.setZoom(h),{zoom:h,bbox:a}};if("object"==typeof a){if(d=a,0==d.width||0==d.height){var h=d.zoom?d.zoom:o*d.factor;return g.setZoom(h),{zoom:o,bbox:d}}return f(d)}switch(a){case"selection":if(!s[0])return;var i=$.map(s,function(a){return a?a:void 0});d=getStrokedBBox(i);break;case"canvas":var j=Tb();e=.95,d={width:j.w,height:j.h,x:0,y:0};break;case"content":d=getStrokedBBox();break;case"layer":d=getStrokedBBox(xb(n().getCurrentLayer()));break;default:return}return f(d)},this.setZoom=function(a){var b=Tb();j.setAttribute("viewBox","0 0 "+b.w/a+" "+b.h/a),o=a,$.each(s,function(a,b){b&&S.requestSelector(b).resize()}),wb.zoomChange(),pb("zoomChanged",a)},this.getMode=function(){return eb},this.setMode=function(a){wb.clear(!0),vb.clear(),ib=s[0]&&"text"==s[0].nodeName?hb:r,eb=a},this.getColor=function(a){return ib[a]},this.setColor=function(a,b,c){function d(a){"g"!=a.nodeName&&e.push(a)}r[a]=b,ib[a+"_paint"]={type:"solidColor"};for(var e=[],f=s.length;f--;){var g=s[f];g&&("g"==g.tagName?svgedit.utilities.walkTree(g,d):"fill"==a?"polyline"!=g.tagName&&"line"!=g.tagName&&e.push(g):e.push(g))}e.length>0&&(c?Wb(a,b,e):(Xb(a,b,e),ub("changed",e)))};var Ub=this.setGradient=function(a){if(ib[a+"_paint"]&&"solidColor"!=ib[a+"_paint"].type){var b=g[a+"Grad"],c=Vb(b),d=svgedit.utilities.findDefs();if(c)b=c;else{b=d.appendChild(h.importNode(b,!0)),b.id=tb()}g.setColor(a,"url(#"+b.id+")")}},Vb=function(a){for(var b=svgedit.utilities.findDefs(),c=$(b).find("linearGradient, radialGradient"),e=c.length,f=["r","cx","cy","fx","fy"];e--;){var g=c[e];if("linearGradient"==a.tagName){if(a.getAttribute("x1")!=g.getAttribute("x1")||a.getAttribute("y1")!=g.getAttribute("y1")||a.getAttribute("x2")!=g.getAttribute("x2")||a.getAttribute("y2")!=g.getAttribute("y2"))continue}else{var h=$(a).attr(f),i=$(g).attr(f),j=!1;if($.each(f,function(a,b){h[b]!=i[b]&&(j=!0)}),j)continue}var k=a.getElementsByTagNameNS(d.SVG,"stop"),l=g.getElementsByTagNameNS(d.SVG,"stop");if(k.length==l.length){for(var m=k.length;m--;){var n=k[m],o=l[m];if(n.getAttribute("offset")!=o.getAttribute("offset")||n.getAttribute("stop-opacity")!=o.getAttribute("stop-opacity")||n.getAttribute("stop-color")!=o.getAttribute("stop-color"))break}if(-1==m)return g}}return null};this.setPaint=function(a,b){var c=new $.jGraduate.Paint(b);switch(this.setPaintOpacity(a,c.alpha/100,!0),ib[a+"_paint"]=c,c.type){case"solidColor":this.setColor(a,"none"!=c.solidColor?"#"+c.solidColor:"none");break;case"linearGradient":case"radialGradient":g[a+"Grad"]=c[c.type],Ub(a)}},this.setStrokePaint=function(a){this.setPaint("stroke",a)},this.setFillPaint=function(a){this.setPaint("fill",a)},this.getStrokeWidth=function(){return ib.stroke_width},this.setStrokeWidth=function(a){function b(a){"g"!=a.nodeName&&c.push(a)}if(0==a&&["line","path"].indexOf(eb)>=0)return void g.setStrokeWidth(1);ib.stroke_width=a;for(var c=[],d=s.length;d--;){var e=s[d];e&&("g"==e.tagName?svgedit.utilities.walkTree(e,b):c.push(e))}c.length>0&&(Xb("stroke-width",a,c),ub("changed",s))},this.setStrokeAttr=function(a,b){r[a.replace("-","_")]=b;for(var c=[],d=s.length;d--;){var e=s[d];e&&("g"==e.tagName?svgedit.utilities.walkTree(e,function(a){"g"!=a.nodeName&&c.push(a)}):c.push(e))}c.length>0&&(Xb(a,b,c),ub("changed",s))},this.getStyle=function(){return r},this.getOpacity=function(){return r.opacity},this.setOpacity=function(a){r.opacity=a,Xb("opacity",a)},this.getFillOpacity=function(){return r.fill_opacity},this.getStrokeOpacity=function(){return r.stroke_opacity},this.setPaintOpacity=function(a,b,c){r[a+"_opacity"]=b,c?Wb(a+"-opacity",b):Xb(a+"-opacity",b)},this.getPaintOpacity=function(a){return"fill"===a?this.getFillOpacity():this.getStrokeOpacity()},this.getBlur=function(a){var b=0;if(a){var c=a.getAttribute("filter");if(c){var d=svgedit.utilities.getElem(a.id+"_blur");d&&(b=d.firstChild.getAttribute("stdDeviation"))}}return b},function(){function a(){var a=g.undoMgr.finishUndoableChange();b.addSubCommand(a),R(b),b=null,c=null}var b=null,c=null,d=!1;g.setBlurNoUndo=function(a){if(!c)return void g.setBlur(a);if(0===a)Wb("filter",""),d=!0;else{var b=s[0];d&&Wb("filter","url(#"+b.id+"_blur)"),svgedit.browser.isWebkit()&&(console.log("e",b),b.removeAttribute("filter"),b.setAttribute("filter","url(#"+b.id+"_blur)")),Wb("stdDeviation",a,[c.firstChild]),g.setBlurOffsets(c,a)}},g.setBlurOffsets=function(a,b){b>3?svgedit.utilities.assignAttributes(a,{x:"-50%",y:"-50%",width:"200%",height:"200%"},100):svgedit.browser.isWebkit()||(a.removeAttribute("x"),a.removeAttribute("y"),a.removeAttribute("width"),a.removeAttribute("height"))},g.setBlur=function(d,e){if(b)return void a();var f=s[0],h=f.id;c=svgedit.utilities.getElem(h+"_blur"),d-=0;var i=new svgedit.history.BatchCommand;if(c)0===d&&(c=null);else{var j=t({element:"feGaussianBlur",attr:{"in":"SourceGraphic",stdDeviation:d}});c=t({element:"filter",attr:{id:h+"_blur"}}),c.appendChild(j),svgedit.utilities.findDefs().appendChild(c),i.addSubCommand(new svgedit.history.InsertElementCommand(c))}var k={filter:f.getAttribute("filter")};return 0===d?(f.removeAttribute("filter"),void i.addSubCommand(new svgedit.history.ChangeElementCommand(f,k))):(Xb("filter","url(#"+h+"_blur)"),i.addSubCommand(new svgedit.history.ChangeElementCommand(f,k)),g.setBlurOffsets(c,d),b=i,g.undoMgr.beginUndoableChange("stdDeviation",[c?c.firstChild:null]),void(e&&(g.setBlurNoUndo(d),a())))}}(),this.getBold=function(){var a=s[0];return null!=a&&"text"==a.tagName&&null==s[1]?"bold"==a.getAttribute("font-weight"):!1},this.setBold=function(a){var b=s[0];null!=b&&"text"==b.tagName&&null==s[1]&&Xb("font-weight",a?"bold":"normal"),s[0].textContent||vb.setCursor()},this.getItalic=function(){var a=s[0];return null!=a&&"text"==a.tagName&&null==s[1]?"italic"==a.getAttribute("font-style"):!1},this.setItalic=function(a){var b=s[0];null!=b&&"text"==b.tagName&&null==s[1]&&Xb("font-style",a?"italic":"normal"),s[0].textContent||vb.setCursor()},this.getFontFamily=function(){return hb.font_family},this.setFontFamily=function(a){hb.font_family=a,Xb("font-family",a),s[0]&&!s[0].textContent&&vb.setCursor()},this.setFontColor=function(a){hb.fill=a,Xb("fill",a)},this.getFontColor=function(){return hb.fill},this.getFontSize=function(){return hb.font_size},this.setFontSize=function(a){hb.font_size=a,Xb("font-size",a),s[0].textContent||vb.setCursor()},this.getText=function(){var a=s[0];return null==a?"":a.textContent},this.setTextContent=function(a){Xb("#text",a),vb.init(a),vb.setCursor()},this.setImageURL=function(a){var b=s[0];if(b){var c=$(b).attr(["width","height"]),d=!c.width||!c.height,e=C(b);if(e!==a)d=!0;else if(!d)return;var f=new svgedit.history.BatchCommand("Change Image URL");D(b,a),f.addSubCommand(new svgedit.history.ChangeElementCommand(b,{"#href":e})),d?$(new Image).load(function(){var a=$(b).attr(["width","height"]);$(b).attr({width:this.width,height:this.height}),S.requestSelector(b).resize(),f.addSubCommand(new svgedit.history.ChangeElementCommand(b,a)),R(f),ub("changed",[b])}).attr("src",a):R(f)}},this.setLinkURL=function(a){var b=s[0];if(b){if("a"!==b.tagName){var c=$(b).parents("a");if(!c.length)return;b=c[0]}var d=C(b);if(d!==a){var e=new svgedit.history.BatchCommand("Change Link URL");D(b,a),e.addSubCommand(new svgedit.history.ChangeElementCommand(b,{"#href":d})),R(e)}}},this.setRectRadius=function(a){var b=s[0];if(null!=b&&"rect"==b.tagName){var c=b.getAttribute("rx");c!=a&&(b.setAttribute("rx",a),b.setAttribute("ry",a),R(new svgedit.history.ChangeElementCommand(b,{rx:c,ry:c},"Radius")),ub("changed",[b]))}},this.makeHyperlink=function(a){g.groupSelectedElements("a",a)},this.removeHyperlink=function(){g.ungroupSelectedElement()},this.setSegType=function(a){wb.setSegType(a)},this.convertToPath=function(a,b){if(null==a){return void $.each(s,function(a,b){b&&g.convertToPath(b)})}if(!b)var c=new svgedit.history.BatchCommand("Convert element to Path");var d=b?{}:{fill:r.fill,"fill-opacity":r.fill_opacity,stroke:r.stroke,"stroke-width":r.stroke_width,"stroke-dasharray":r.stroke_dasharray,"stroke-linejoin":r.stroke_linejoin,"stroke-linecap":r.stroke_linecap,"stroke-opacity":r.stroke_opacity,opacity:r.opacity,visibility:"hidden"};$.each(["marker-start","marker-end","marker-mid","filter","clip-path"],function(){a.getAttribute(this)&&(d[this]=a.getAttribute(this))});var e=t({element:"path",attr:d}),f=a.getAttribute("transform");f&&e.setAttribute("transform",f);var h=a.id,i=a.parentNode;a.nextSibling?i.insertBefore(e,a):i.appendChild(e);var j,k,l="",m=function(a){$.each(a,function(a,b){var c,d=b[0],e=b[1];for(l+=d,c=0;c<e.length;c+=2)l+=e[c]+","+e[c+1]+" "})},n=1.81;switch(a.tagName){case"ellipse":case"circle":j=$(a).attr(["rx","ry","cx","cy"]);var o=j.cx,p=j.cy;k=j.rx,ry=j.ry,"circle"==a.tagName&&(k=ry=$(a).attr("r")),m([["M",[o-k,p]],["C",[o-k,p-ry/n,o-k/n,p-ry,o,p-ry]],["C",[o+k/n,p-ry,o+k,p-ry/n,o+k,p]],["C",[o+k,p+ry/n,o+k/n,p+ry,o,p+ry]],["C",[o-k/n,p+ry,o-k,p+ry/n,o-k,p]],["Z",[]]]);break;case"path":l=a.getAttribute("d");break;case"line":j=$(a).attr(["x1","y1","x2","y2"]),l="M"+j.x1+","+j.y1+"L"+j.x2+","+j.y2;break;case"polyline":case"polygon":l="M"+a.getAttribute("points");break;case"rect":var q=$(a).attr(["rx","ry"]);k=q.rx,ry=q.ry;var u=a.getBBox(),v=u.x,w=u.y,x=u.width,y=u.height;n=4-n,m(k||ry?[["M",[v,w+ry]],["C",[v,w+ry/n,v+k/n,w,v+k,w]],["L",[v+x-k,w]],["C",[v+x-k/n,w,v+x,w+ry/n,v+x,w+ry]],["L",[v+x,w+y-ry]],["C",[v+x,w+y-ry/n,v+x-k/n,w+y,v+x-k,w+y]],["L",[v+k,w+y]],["C",[v+k/n,w+y,v,w+y-ry/n,v,w+y-ry]],["L",[v,w+ry]],["Z",[]]]:[["M",[v,w]],["L",[v+x,w]],["L",[v+x,w+y]],["L",[v,w+y]],["L",[v,w]],["Z",[]]]);break;default:e.parentNode.removeChild(e)}if(l&&e.setAttribute("d",l),b){wb.resetOrientation(e);var z=!1;try{z=e.getBBox()}catch(A){}return e.parentNode.removeChild(e),z}if(f){var B=svgedit.transformlist.getTransformList(e);svgedit.math.hasMatrixTransform(B)&&wb.resetOrientation(e)}var C=a.nextSibling;c.addSubCommand(new svgedit.history.RemoveElementCommand(a,C,i)),c.addSubCommand(new svgedit.history.InsertElementCommand(e)),Gb(),a.parentNode.removeChild(a),e.setAttribute("id",h),e.removeAttribute("visibility"),Hb([e],!0),R(c)};var Wb=function(a,b,c){var d=i.suspendRedraw(1e3);"pathedit"==eb&&wb.moveNode(a,b),c=c||s;for(var e=c.length,f=["g","polyline","path"],h=["transform","opacity","filter"];e--;){var j=c[e];if(null!=j)if(("x"===a||"y"===a)&&f.indexOf(j.tagName)>=0){var k=getStrokedBBox([j]),l="x"===a?b-k.x:0,m="y"===a?b-k.y:0;g.moveSelectedElements(l*o,m*o,!0)}else{"g"===j.tagName&&h.indexOf(a)>=0;var n="#text"===a?j.textContent:j.getAttribute(a);if(null==n&&(n=""),n!==String(b)){if("#text"==a){{svgedit.utilities.getBBox(j).width}j.textContent=b,/rotate/.test(j.getAttribute("transform"))&&(j=Bb(j))}else"#href"==a?D(j,b):j.setAttribute(a,b);"textedit"===eb&&"#text"!==a&&j.textContent.length&&vb.toSelectMode(j),svgedit.browser.isGecko()&&"text"===j.nodeName&&/rotate/.test(j.getAttribute("transform"))&&(0===String(b).indexOf("url")||["font-size","font-family","x","y"].indexOf(a)>=0&&j.textContent)&&(j=Bb(j)),s.indexOf(j)>=0&&setTimeout(function(){j.parentNode&&S.requestSelector(j).resize()},0);var p=svgedit.utilities.getRotationAngle(j);if(0!=p&&"transform"!=a)for(var q=svgedit.transformlist.getTransformList(j),r=q.numberOfItems;r--;){var t=q.getItem(r);if(4==t.type){q.removeItem(r);var u=svgedit.utilities.getBBox(j),v=svgedit.math.transformPoint(u.x+u.width/2,u.y+u.height/2,svgedit.math.transformListToTransform(q).matrix),w=v.x,x=v.y,y=i.createSVGTransform();y.setRotate(p,w,x),q.insertItemBefore(y,r);break}}}}}i.unsuspendRedraw(d)},Xb=this.changeSelectedAttribute=function(a,b,c){c=c||s,g.undoMgr.beginUndoableChange(a,c);c.length;Wb(a,b,c);var d=g.undoMgr.finishUndoableChange();d.isEmpty()||R(d)};this.deleteSelectedElements=function(){var a,b=new svgedit.history.BatchCommand("Delete Elements"),c=s.length,d=[];for(a=0;c>a;++a){var e=s[a];if(null==e)break;var f=e.parentNode,g=e;S.releaseSelector(g),svgedit.path.removePath_(g.id),"a"===f.tagName&&1===f.childNodes.length&&(g=f,f=f.parentNode);var h=g.nextSibling,i=f.removeChild(g);d.push(e),s[a]=null,b.addSubCommand(new O(i,h,f))}b.isEmpty()||R(b),ub("changed",d),Gb()},this.cutSelectedElements=function(){var a,b=new svgedit.history.BatchCommand("Cut Elements"),c=s.length,d=[];for(a=0;c>a;++a){var e=s[a];if(null==e)break;var f=e.parentNode,h=e;S.releaseSelector(h),svgedit.path.removePath_(h.id);var i=h.nextSibling,j=f.removeChild(h);d.push(e),s[a]=null,b.addSubCommand(new O(j,i,f))}b.isEmpty()||R(b),ub("changed",d),Gb(),g.clipBoard=d},this.copySelectedElements=function(){g.clipBoard=$.merge([],s)},this.pasteElements=function(a,b,c){var d=g.clipBoard,e=d.length;if(e){for(var f=[],h=new svgedit.history.BatchCommand("Paste elements");e--;){var i=d[e];if(i){var j=Ab(i);svgedit.utilities.getElem(i.id)||(j.id=i.id),f.push(j),(p||n().getCurrentLayer()).appendChild(j),h.addSubCommand(new svgedit.history.InsertElementCommand(j))}}if(Ib(f),"in_place"!==a){var k,l;a?"point"===a&&(k=b,l=c):(k=nb.x,l=nb.y);var m=getStrokedBBox(f),o=k-(m.x+m.width/2),q=l-(m.y+m.height/2),r=[],s=[];$.each(f,function(){r.push(o),s.push(q)});var t=g.moveSelectedElements(r,s,!1);h.addSubCommand(t)}R(h),ub("changed",f)}},this.groupSelectedElements=function(a,b){a||(a="g");var c="";switch(a){case"a":c="Make hyperlink";var d="";arguments.length>1&&(d=b);break;default:a="g",c="Group Elements"}var e=new svgedit.history.BatchCommand(c),f=t({element:a,attr:{id:tb()}});"a"===a&&D(f,d),e.addSubCommand(new svgedit.history.InsertElementCommand(f));for(var g=s.length;g--;){var h=s[g];if(null!=h){"a"===h.parentNode.tagName&&1===h.parentNode.childNodes.length&&(h=h.parentNode);var i=h.nextSibling,j=h.parentNode;f.appendChild(h),e.addSubCommand(new svgedit.history.MoveElementCommand(h,i,j))}}e.isEmpty()||R(e),Ib([f],!0)};var Yb=this.pushGroupProperties=function(a,b){var c,d,e,f=a.childNodes,h=f.length,j=a.getAttribute("transform"),k=svgedit.transformlist.getTransformList(a),l=svgedit.math.transformListToTransform(k).matrix,m=new svgedit.history.BatchCommand("Push group properties"),n=0,o=svgedit.utilities.getRotationAngle(a),p=$(a).attr(["filter","opacity"]);for(n=0;h>n;n++){var q=f[n];if(1===q.nodeType){if(null!==p.opacity&&1!==p.opacity){var r=(q.getAttribute("opacity")||1,Math.round((q.getAttribute("opacity")||1)*p.opacity*100)/100);Xb("opacity",r,[q])}if(p.filter){var s=this.getBlur(q),t=s;d||(d=this.getBlur(a)),s?s=Number(d)+Number(s):0===s&&(s=d),t?c=svgedit.utilities.getRefElem(q.getAttribute("filter")):c?(c=Ab(c),svgedit.utilities.findDefs().appendChild(c)):c=svgedit.utilities.getRefElem(p.filter);var u="feGaussianBlur"===c.firstChild.tagName?"blur":"filter";c.id=q.id+"_"+u,Xb("filter","url(#"+c.id+")",[q]),s&&(Xb("stdDeviation",s,[c.firstChild]),g.setBlurOffsets(c,s))}var v=svgedit.transformlist.getTransformList(q);if(~q.tagName.indexOf("Gradient")&&(v=null),v&&"defs"!==q.tagName&&k.numberOfItems){if(o&&1==k.numberOfItems){var w=k.getItem(0).matrix,x=i.createSVGMatrix(),y=svgedit.utilities.getRotationAngle(q);y&&(x=v.getItem(0).matrix);var z=svgedit.utilities.getBBox(q),A=svgedit.math.transformListToTransform(v).matrix,B=svgedit.math.transformPoint(z.x+z.width/2,z.y+z.height/2,A),C=o+y,D=i.createSVGTransform();D.setRotate(C,B.x,B.y);var E=svgedit.math.matrixMultiply(w,x,D.matrix.inverse());if(y&&v.removeItem(0),C&&(v.numberOfItems?v.insertItemBefore(D,0):v.appendItem(D)),E.e||E.f){var F=i.createSVGTransform();F.setTranslate(E.e,E.f),v.numberOfItems?v.insertItemBefore(F,0):v.appendItem(F)}}else{var G=q.getAttribute("transform");e={},e.transform=G||"";var H=i.createSVGTransform(),I=svgedit.math.transformListToTransform(v).matrix,J=I.inverse(),K=svgedit.math.matrixMultiply(J,l,I);H.setMatrix(K),v.appendItem(H)}var L=svgedit.recalculate.recalculateDimensions(q);L&&m.addSubCommand(L)}}}return j&&(e={},e.transform=j,a.setAttribute("transform",""),a.removeAttribute("transform"),m.addSubCommand(new svgedit.history.ChangeElementCommand(a,e))),b&&!m.isEmpty()?m:void 0};this.ungroupSelectedElement=function(){var a=s[0];if($(a).data("gsvg")||$(a).data("symbol"))return void Pb(a);if("use"===a.tagName){var b=svgedit.utilities.getElem(C(a).substr(1));return $(a).data("symbol",b).data("ref",b),void Pb(a)}var c=$(a).parents("a");if(c.length&&(a=c[0]),"g"===a.tagName||"a"===a.tagName){var d=new svgedit.history.BatchCommand("Ungroup Elements"),e=Yb(a,!0);e&&d.addSubCommand(e);for(var f=a.parentNode,g=a.nextSibling,h=new Array(a.childNodes.length),i=0;a.firstChild;){var j=a.firstChild,k=j.nextSibling,l=j.parentNode;if("title"!==j.tagName)h[i++]=j=f.insertBefore(j,g),d.addSubCommand(new svgedit.history.MoveElementCommand(j,k,l));else{var m=j.nextSibling;d.addSubCommand(new svgedit.history.RemoveElementCommand(j,m,l)),l.removeChild(j)}}Gb();var n=a.nextSibling;a=f.removeChild(a),d.addSubCommand(new svgedit.history.RemoveElementCommand(a,n,f)),d.isEmpty()||R(d),Hb(h)}},this.moveToTopSelectedElement=function(){var a=s[0];if(null!=a){var b=a,c=b.parentNode,d=b.nextSibling;b=b.parentNode.appendChild(b),d!=b.nextSibling&&(R(new svgedit.history.MoveElementCommand(b,d,c,"top")),ub("changed",[b]))}},this.moveToBottomSelectedElement=function(){var a=s[0];if(null!=a){var b=a,c=b.parentNode,d=b.nextSibling,e=b.parentNode.firstChild;"title"==e.tagName&&(e=e.nextSibling),"defs"==e.tagName&&(e=e.nextSibling),b=b.parentNode.insertBefore(b,e),d!=b.nextSibling&&(R(new svgedit.history.MoveElementCommand(b,d,c,"bottom")),ub("changed",[b]))}},this.moveUpDownSelected=function(a){var b=s[0];if(b){lb=[];var c,d,e=$(rb(getStrokedBBox([b]))).toArray();if("Down"==a&&e.reverse(),$.each(e,function(){return d?(c=this,!1):void(this==b&&(d=!0))}),c){var f=b,g=f.parentNode,h=f.nextSibling;$(c)["Down"==a?"before":"after"](f),h!=f.nextSibling&&(R(new svgedit.history.MoveElementCommand(f,h,g,"Move "+a)),ub("changed",[f]))}}},this.moveSelectedElements=function(a,b,c){a.constructor!=Array&&(a/=o,b/=o),c=c||!0;for(var d=new svgedit.history.BatchCommand("position"),e=s.length;e--;){var f=s[e];if(null!=f){var g=i.createSVGTransform(),h=svgedit.transformlist.getTransformList(f);a.constructor==Array?g.setTranslate(a[e],b[e]):g.setTranslate(a,b),h.numberOfItems?h.insertItemBefore(g,0):h.appendItem(g);var j=svgedit.recalculate.recalculateDimensions(f);j&&d.addSubCommand(j),S.requestSelector(f).resize()}}return d.isEmpty()?void 0:(c&&R(d),ub("changed",s),d)},this.cloneSelectedElements=function(a,b){function c(a,b){return $(b).index()-$(a).index()}var d,e,f=new svgedit.history.BatchCommand("Clone Elements"),g=s.length;for(s.sort(c),d=0;g>d&&(e=s[d],null!=e);++d);var h=s.slice(0,d);for(this.clearSelection(!0),d=h.length;d--;)e=h[d]=Ab(h[d]),(p||n().getCurrentLayer()).appendChild(e),f.addSubCommand(new svgedit.history.InsertElementCommand(e));f.isEmpty()||(Hb(h.reverse()),this.moveSelectedElements(a,b,!1),R(f))},this.alignSelectedElements=function(a,b){var c,d,e=[],f=Number.MAX_VALUE,h=Number.MIN_VALUE,i=Number.MAX_VALUE,j=Number.MIN_VALUE,k=Number.MIN_VALUE,l=Number.MIN_VALUE,m=s.length;if(m){for(c=0;m>c&&null!=s[c];++c)switch(d=s[c],e[c]=getStrokedBBox([d]),b){case"smallest":(("l"==a||"c"==a||"r"==a)&&(k==Number.MIN_VALUE||k>e[c].width)||("t"==a||"m"==a||"b"==a)&&(l==Number.MIN_VALUE||l>e[c].height))&&(f=e[c].x,i=e[c].y,h=e[c].x+e[c].width,j=e[c].y+e[c].height,k=e[c].width,l=e[c].height);break;case"largest":(("l"==a||"c"==a||"r"==a)&&(k==Number.MIN_VALUE||k<e[c].width)||("t"==a||"m"==a||"b"==a)&&(l==Number.MIN_VALUE||l<e[c].height))&&(f=e[c].x,i=e[c].y,h=e[c].x+e[c].width,j=e[c].y+e[c].height,k=e[c].width,l=e[c].height);break;default:e[c].x<f&&(f=e[c].x),e[c].y<i&&(i=e[c].y),e[c].x+e[c].width>h&&(h=e[c].x+e[c].width),e[c].y+e[c].height>j&&(j=e[c].y+e[c].height)}"page"==b&&(f=0,i=0,h=g.contentW,j=g.contentH);var n=new Array(m),o=new Array(m);for(c=0;m>c&&null!=s[c];++c){d=s[c];var p=e[c];switch(n[c]=0,o[c]=0,a){case"l":n[c]=f-p.x;break;case"c":n[c]=(f+h)/2-(p.x+p.width/2);break;case"r":n[c]=h-(p.x+p.width);break;case"t":o[c]=i-p.y;break;case"m":o[c]=(i+j)/2-(p.y+p.height/2);break;case"b":o[c]=j-(p.y+p.height)}}this.moveSelectedElements(n,o)}},this.contentW=Tb().w,this.contentH=Tb().h,this.updateCanvas=function(a,b){i.setAttribute("width",a),i.setAttribute("height",b);var c=$("#canvasBackground")[0],d=j.getAttribute("x"),e=j.getAttribute("y"),f=a/2-this.contentW*o/2,g=b/2-this.contentH*o/2;svgedit.utilities.assignAttributes(j,{width:this.contentW*o,height:this.contentH*o,x:f,y:g,viewBox:"0 0 "+this.contentW+" "+this.contentH}),svgedit.utilities.assignAttributes(c,{width:j.getAttribute("width"),height:j.getAttribute("height"),x:f,y:g});var h=svgedit.utilities.getElem("background_image");return h&&svgedit.utilities.assignAttributes(h,{width:"100%",height:"100%"}),S.selectorParentGroup.setAttribute("transform","translate("+f+","+g+")"),pb("canvasUpdated",{new_x:f,new_y:g,old_x:d,old_y:e,d_x:f-d,d_y:g-e}),{x:f,y:g,old_x:d,old_y:e,d_x:f-d,d_y:g-e}},this.setBackground=function(a,b){var c=svgedit.utilities.getElem("canvasBackground"),e=$(c).find("rect")[0],f=svgedit.utilities.getElem("background_image");e.setAttribute("fill",a),b?(f||(f=h.createElementNS(d.SVG,"image"),svgedit.utilities.assignAttributes(f,{id:"background_image",width:"100%",height:"100%",preserveAspectRatio:"xMinYMin",style:"pointer-events:none"})),D(f,b),c.appendChild(f)):f&&f.parentNode.removeChild(f)},this.cycleElement=function(a){var b,c=s[0],d=!1,e=xb(p||n().getCurrentLayer());if(e.length){if(null==c)b=a?e.length-1:0,d=e[b];else for(var f=e.length;f--;)if(e[f]==c){b=a?f-1:f+1,b>=e.length?b=0:0>b&&(b=e.length-1),d=e[b];break}Ib([d],!0),ub("selected",s)}},this.clear(),this.getPrivateMethods=function(){var a={addCommandToHistory:R,setGradient:Ub,addSvgElementFromJson:t,assignAttributes:G,BatchCommand:Q,call:ub,ChangeElementCommand:P,copyElem:Ab,ffClone:Bb,findDefs:A,findDuplicateGradient:Vb,getElem:F,getId:sb,getIntersectionList:rb,getMouseTarget:Jb,getNextId:tb,getPathBBox:E,getUrlFromAttr:B,hasMatrixTransform:w,identifyLayers:Qb,InsertElementCommand:N,isIdentity:svgedit.math.isIdentity,logMatrix:Eb,matrixMultiply:v,MoveElementCommand:M,preventClickDefault:Kb,recalculateAllSelectedDimensions:Cb,recalculateDimensions:J,remapElement:I,RemoveElementCommand:O,removeUnusedDefElems:Lb,round:qb,runExtensions:pb,sanitizeSvg:L,SVGEditTransformList:svgedit.transformlist.SVGTransformList,toString:toString,transformBox:svgedit.math.transformBox,transformListToTransform:z,transformPoint:u,walkTree:svgedit.utilities.walkTree};return a}};
!function(){function a(a){if(svgedit.browser.supportsHVLineContainerBBox())try{return a.getBBox()}catch(b){}var c,d,e=$.data(a,"ref"),f=null;e?(d=$(e).children().clone().attr("visibility","hidden"),$(i).append(d),f=d.filter("line, path")):f=$(a).find("line, path");var g=!1;if(f.length)if(f.each(function(){var a=this.getBBox();a.width&&a.height||(g=!0)}),g){var h=e?d:$(a).children();c=getStrokedBBox(h)}else c=a.getBBox();else c=a.getBBox();return e&&d.remove(),c}svgedit.utilities||(svgedit.utilities={});var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=svgedit.NS,d="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use",e=d.split(","),f=null,g=null,h=null,i=null;svgedit.utilities.init=function(a){f=a,g=a.getDOMDocument(),h=a.getDOMContainer(),i=a.getSVGRoot()},svgedit.utilities.toXml=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/,"&#x27;")},svgedit.utilities.fromXml=function(a){return $("<p/>").html(a).text()},svgedit.utilities.encode64=function(a){if(a=svgedit.utilities.encodeUTF8(a),window.btoa)return window.btoa(a);var c,d,e,f,g,h,i,j=new Array(4*Math.floor((a.length+2)/3)),k=0,l=0;do c=a.charCodeAt(k++),d=a.charCodeAt(k++),e=a.charCodeAt(k++),f=c>>2,g=(3&c)<<4|d>>4,h=(15&d)<<2|e>>6,i=63&e,isNaN(d)?h=i=64:isNaN(e)&&(i=64),j[l++]=b.charAt(f),j[l++]=b.charAt(g),j[l++]=b.charAt(h),j[l++]=b.charAt(i);while(k<a.length);return j.join("")},svgedit.utilities.decode64=function(a){if(window.atob)return window.atob(a);var c,d,e,f,g,h="",i="",j="",k=0;a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do e=b.indexOf(a.charAt(k++)),f=b.indexOf(a.charAt(k++)),g=b.indexOf(a.charAt(k++)),j=b.indexOf(a.charAt(k++)),c=e<<2|f>>4,d=(15&f)<<4|g>>2,i=(3&g)<<6|j,h+=String.fromCharCode(c),64!=g&&(h+=String.fromCharCode(d)),64!=j&&(h+=String.fromCharCode(i)),c=d=i="",e=f=g=j="";while(k<a.length);return unescape(h)},svgedit.utilities.encodeUTF8=function(a){if(null===a||"undefined"==typeof a)return"";var b,c,d=String(a),e="",f=0;b=c=0,f=d.length;var g;for(g=0;f>g;g++){var h=d.charCodeAt(g),i=null;if(128>h)c++;else if(h>127&&2048>h)i=String.fromCharCode(h>>6|192,63&h|128);else if(55296!=(63488&h))i=String.fromCharCode(h>>12|224,h>>6&63|128,63&h|128);else{if(55296!=(64512&h))throw new RangeError("Unmatched trail surrogate at "+g);var j=d.charCodeAt(++g);if(56320!=(64512&j))throw new RangeError("Unmatched lead surrogate at "+(g-1));h=((1023&h)<<10)+(1023&j)+65536,i=String.fromCharCode(h>>18|240,h>>12&63|128,h>>6&63|128,63&h|128)}null!==i&&(c>b&&(e+=d.slice(b,c)),e+=i,b=c=g+1)}return c>b&&(e+=d.slice(b,f)),e},svgedit.utilities.convertToXMLReferences=function(a){var b,c="";for(b=0;b<a.length;b++){var d=a.charCodeAt(b);128>d?c+=a[b]:d>127&&(c+="&#"+d+";")}return c},svgedit.utilities.text2xml=function(a){a.indexOf("<svg:svg")>=0&&(a=a.replace(/<(\/?)svg:/g,"<$1").replace("xmlns:svg","xmlns"));var b,c;try{c=window.DOMParser?new DOMParser:new ActiveXObject("Microsoft.XMLDOM"),c.async=!1}catch(d){throw new Error("XML Parser could not be instantiated")}try{b=c.loadXML?c.loadXML(a)?c:!1:c.parseFromString(a,"text/xml")}catch(e){throw new Error("Error parsing XML string")}return b},svgedit.utilities.bboxToObj=function(a){return{x:a.x,y:a.y,width:a.width,height:a.height}},svgedit.utilities.walkTree=function(a,b){if(a&&1==a.nodeType){b(a);for(var c=a.childNodes.length;c--;)svgedit.utilities.walkTree(a.childNodes.item(c),b)}},svgedit.utilities.walkTreePost=function(a,b){if(a&&1==a.nodeType){for(var c=a.childNodes.length;c--;)svgedit.utilities.walkTree(a.childNodes.item(c),b);b(a)}},svgedit.utilities.getUrlFromAttr=function(a){if(a){if(0===a.indexOf('url("'))return a.substring(5,a.indexOf('"',6));if(0===a.indexOf("url('"))return a.substring(5,a.indexOf("'",6));if(0===a.indexOf("url("))return a.substring(4,a.indexOf(")"))}return null},svgedit.utilities.getHref=function(a){return a.getAttributeNS(c.XLINK,"href")},svgedit.utilities.setHref=function(a,b){a.setAttributeNS(c.XLINK,"xlink:href",b)},svgedit.utilities.findDefs=function(){var a=f.getSVGContent(),b=a.getElementsByTagNameNS(c.SVG,"defs");return b.length>0?b=b[0]:(b=a.ownerDocument.createElementNS(c.SVG,"defs"),a.firstChild?a.insertBefore(b,a.firstChild.nextSibling):a.appendChild(b)),b},svgedit.utilities.getPathBBox=function(a){var b,c=a.pathSegList,d=c.numberOfItems,e=[[],[]],f=c.getItem(0),g=[f.x,f.y];for(b=0;d>b;b++){var h=c.getItem(b);if("undefined"!=typeof h.x)if(e[0].push(g[0]),e[1].push(g[1]),h.x1){var i,j=[h.x1,h.y1],k=[h.x2,h.y2],l=[h.x,h.y];for(i=0;2>i;i++){var m=function(a){return Math.pow(1-a,3)*g[i]+3*Math.pow(1-a,2)*a*j[i]+3*(1-a)*Math.pow(a,2)*k[i]+Math.pow(a,3)*l[i]},n=6*g[i]-12*j[i]+6*k[i],o=-3*g[i]+9*j[i]-9*k[i]+3*l[i],p=3*j[i]-3*g[i];if(0!=o){var q=Math.pow(n,2)-4*p*o;if(!(0>q)){var r=(-n+Math.sqrt(q))/(2*o);r>0&&1>r&&e[i].push(m(r));var s=(-n-Math.sqrt(q))/(2*o);s>0&&1>s&&e[i].push(m(s))}}else{if(0==n)continue;var t=-p/n;t>0&&1>t&&e[i].push(m(t))}}g=l}else e[0].push(h.x),e[1].push(h.y)}var u=Math.min.apply(null,e[0]),v=Math.max.apply(null,e[0])-u,w=Math.min.apply(null,e[1]),x=Math.max.apply(null,e[1])-w;return{x:u,y:w,width:v,height:x}},svgedit.utilities.getBBox=function(b){var c=b||f.geSelectedElements()[0];if(1!=b.nodeType)return null;var d=null,g=c.nodeName;switch(g){case"text":if(""===c.textContent)c.textContent="a",d=c.getBBox(),c.textContent="";else try{d=c.getBBox()}catch(h){}break;case"path":if(svgedit.browser.supportsPathBBox())try{d=c.getBBox()}catch(i){}else d=svgedit.utilities.getPathBBox(c);break;case"g":case"a":d=a(c);break;default:if("use"===g&&(d=a(c,!0)),"use"===g||"foreignObject"===g&&svgedit.browser.isWebkit()){d||(d=c.getBBox());var j={};j.width=d.width,j.height=d.height,j.x=d.x+parseFloat(c.getAttribute("x")||0),j.y=d.y+parseFloat(c.getAttribute("y")||0),d=j}else if(~e.indexOf(g))try{d=c.getBBox()}catch(k){var l=$(c).closest("foreignObject");if(l.length)try{d=l[0].getBBox()}catch(m){d=null}else d=null}}return d&&(d=svgedit.utilities.bboxToObj(d)),d},svgedit.utilities.getRotationAngle=function(a,b){var c=a||f.getSelectedElements()[0],d=svgedit.transformlist.getTransformList(c);if(!d)return 0;var e,g=d.numberOfItems;for(e=0;g>e;++e){var h=d.getItem(e);if(4==h.type)return b?h.angle*Math.PI/180:h.angle}return 0},svgedit.utilities.getRefElem=function(a){return svgedit.utilities.getElem(svgedit.utilities.getUrlFromAttr(a).substr(1))},svgedit.utilities.getElem=svgedit.browser.supportsSelectors()?function(a){return i.querySelector("#"+a)}:svgedit.browser.supportsXpath()?function(a){return g.evaluate('svg:svg[@id="svgroot"]//svg:*[@id="'+a+'"]',h,function(){return svgedit.NS.SVG},9,null).singleNodeValue}:function(a){return $(i).find("[id="+a+"]")[0]},svgedit.utilities.assignAttributes=function(a,b,d,e){d||(d=0);var f=null;svgedit.browser.isOpera()||i.suspendRedraw(d);var g;for(g in b){var h="xml:"===g.substr(0,4)?c.XML:"xlink:"===g.substr(0,6)?c.XLINK:null;h?a.setAttributeNS(h,g,b[g]):e?svgedit.units.setUnitAttr(a,g,b[g]):a.setAttribute(g,b[g])}svgedit.browser.isOpera()||i.unsuspendRedraw(f)},svgedit.utilities.cleanupElement=function(a){var b,c=i.suspendRedraw(60),d={"fill-opacity":1,"stop-opacity":1,opacity:1,stroke:"none","stroke-dasharray":"none","stroke-linejoin":"miter","stroke-linecap":"butt","stroke-opacity":1,"stroke-width":1,rx:0,ry:0};for(b in d){var e=d[b];a.getAttribute(b)==e&&a.removeAttribute(b)}i.unsuspendRedraw(c)},svgedit.utilities.snapToGrid=function(a){var b=f.getSnappingStep(),c=f.getBaseUnit();return"px"!==c&&(b*=svgedit.units.getTypeMap()[c]),a=Math.round(a/b)*b},svgedit.utilities.preg_quote=function(a,b){return String(a).replace(new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\"+(b||"")+"-]","g"),"\\$&")}}();
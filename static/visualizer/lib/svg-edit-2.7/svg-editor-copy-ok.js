!function(){window.svgEditor||(window.svgEditor=function(a){function b(b,c){var e=d.setSvgString(b)!==!1;c=c||a.noop,e?c(!0):a.alert(n.notification.errorLoadingSVG,function(){c(!1)})}var c={};c.tool_scale=1,c.langChanged=!1,c.showSaveWarning=!1,c.storagePromptClosed=!1;var d,e,f=!1,g=[],h={},i={lang:"",iconsize:"",bkgd_color:"#FFF",bkgd_url:"",img_save:"embed",save_notice_done:!1,export_notice_done:!1},j={},k={extensions:[]},l=["ext-overview_window.js","ext-markers.js","ext-connector.js","ext-eyedropper.js","ext-shapes.js","ext-imagelib.js","ext-grid.js","ext-polygon.js","ext-star.js","ext-panning.js","ext-storage.js"],m={canvasName:"default",canvas_expansion:3,initFill:{color:"FF0000",opacity:1},initStroke:{width:5,color:"000000",opacity:1},initOpacity:1,colorPickerCSS:null,initTool:"select",wireframe:!1,showlayers:!1,no_save_warning:!1,imgPath:"images/",langPath:"locale/",extPath:"extensions/",jGraduatePath:"jgraduate/images/",dimensions:[640,480],gridSnapping:!1,gridColor:"#000",baseUnit:"px",snappingStep:10,showRulers:!0,preventAllURLConfig:!1,preventURLContentLoading:!1,lockExtensions:!1,noDefaultExtensions:!1,showGrid:!1,noStorageOnLoad:!1,forceStorage:!1,emptyStorageOnDecline:!1},n=c.uiStrings={common:{ok:"OK",cancel:"Cancel",key_up:"Up",key_down:"Down",key_backspace:"Backspace",key_del:"Del"},layers:{layer:"Layer"},notification:{invalidAttrValGiven:"Invalid value given",noContentToFitTo:"No content to fit to",dupeLayerName:"There is already a layer named that!",enterUniqueLayerName:"Please enter a unique layer name",enterNewLayerName:"Please enter the new layer name",layerHasThatName:"Layer already has that name",QmoveElemsToLayer:"Move selected elements to layer '%s'?",QwantToClear:"Do you want to clear the drawing?\nThis will also erase your undo history!",QwantToOpen:"Do you want to open a new file?\nThis will also erase your undo history!",QerrorsRevertToSource:"There were parsing errors in your SVG source.\nRevert back to original SVG source?",QignoreSourceChanges:"Ignore changes made to SVG source?",featNotSupported:"Feature not supported",enterNewImgURL:"Enter the new image URL",defsFailOnSave:"NOTE: Due to a bug in your browser, this image may appear wrong (missing gradients or elements). It will however appear correct once actually saved.",loadingImage:"Loading image, please wait...",saveFromBrowser:"Select 'Save As...' in your browser to save this image as a %s file.",noteTheseIssues:"Also note the following issues: ",unsavedChanges:"There are unsaved changes.",enterNewLinkURL:"Enter the new hyperlink URL",errorLoadingSVG:"Error: Unable to load SVG data",URLloadFail:"Unable to load from URL",retrieving:"Retrieving '%s' ..."}};return a.pref=function(a,b){return b?(j[a]=b,void(c.curPrefs=j)):a in j?j[a]:i[a]},c.loadContentAndPrefs=function(){if(k.forceStorage||!k.noStorageOnLoad&&document.cookie.match(/(?:^|;\s*)store=(?:prefsAndContent|prefsOnly)/)){if("localStorage"in window&&(k.forceStorage||!k.noStorageOnLoad&&document.cookie.match(/(?:^|;\s*)store=prefsAndContent/))){var a="svgedit-"+k.canvasName,b=window.localStorage.getItem(a);b&&c.loadFromString(b)}var d,e=!1;try{window.localStorage&&(e=localStorage)}catch(f){}c.storage=e;for(d in i)if(i.hasOwnProperty(d)){var g="svg-edit-"+d;if(e){var h=e.getItem(g);h&&(i[d]=String(h))}else if(window.widget)i[d]=widget.preferenceForKey(g);else{var j=document.cookie.match(new RegExp("(?:^|;\\s*)"+g+"=([^;]+)"));i[d]=j?decodeURIComponent(j[1]):""}}}},c.setConfig=function(b,d){function e(b,c,d){b[c]&&"object"==typeof b[c]?a.extend(!0,b[c],d):b[c]=d}d=d||{},a.each(b,function(c,f){if(b.hasOwnProperty(c))if(i.hasOwnProperty(c)){if(d.overwrite===!1&&(k.preventAllURLConfig||j.hasOwnProperty(c)))return;d.allowInitialUserOverride===!0?i[c]=f:a.pref(c,f)}else if("extensions"===c){if(d.overwrite===!1&&(k.preventAllURLConfig||k.lockExtensions))return;k.extensions=k.extensions.concat(f)}else if(m.hasOwnProperty(c)){if(d.overwrite===!1&&(k.preventAllURLConfig||k.hasOwnProperty(c)))return;if(k.hasOwnProperty(c)){if(d.overwrite===!1)return;e(k,c,f)}else d.allowInitialUserOverride===!0?e(m,c,f):m[c]&&"object"==typeof m[c]?(k[c]={},a.extend(!0,k[c],f)):k[c]=f}}),c.curConfig=k},c.setCustomHandlers=function(b){c.ready(function(){b.open&&(a('#tool_open > input[type="file"]').remove(),a("#tool_open").show(),d.open=b.open),b.save&&(c.showSaveWarning=!1,d.bind("saved",b.save)),(b.exportImage||b.pngsave)&&d.bind("exported",b.exportImage||b.pngsave),h=b})},c.randomizeIds=function(){d.randomizeIds(arguments)},c.init=function(){function f(){j=a.extend(!0,{},i,j),c.curPrefs=j}function g(){k=a.extend(!0,{},m,k),k.noDefaultExtensions||(k.extensions=k.extensions.concat(l)),k.extensions=a.grep(k.extensions,function(a,b){return b===k.extensions.indexOf(a)}),c.curConfig=k}function o(b,c){var e=b.id,f=e.split("_"),g=f[0],h=f[1];c&&d.setStrokeAttr("stroke-"+g,h),mb(),C("#cur_"+g,e,20),a(b).addClass("current").siblings().removeClass("current")}function p(b,c){a.pref("bkgd_color",b),a.pref("bkgd_url",c),d.setBackground(b,c)}function q(){var b=d.getHref($);b=0===b.indexOf("data:")?"":b,a.prompt(n.notification.enterNewImgURL,b,function(a){a&&pb(a)})}function r(b,c){c||(c=d.getZoom()),b||(b=a("#svgcanvas"));var e,f,g=3e4,h=d.getContentElem(),i=svgedit.units.getTypeMap(),j=i[k.baseUnit];for(e=0;2>e;e++){var l=0===e,m=l?"x":"y",n=l?"width":"height",o=Number(h.getAttribute(m)),p=a("#ruler_"+m+" canvas:first"),q=p.clone();p.replaceWith(q);var r=q[0],s=b[n](),t=s;r.parentNode.style[n]=t+"px";var u,v,w,x=0,y=r.getContext("2d");if(y.fillStyle="rgb(200,0,0)",y.fillRect(0,0,r.width,r.height),q.siblings().remove(),s>=g){w=parseInt(s/g,10)+1,u=[],u[0]=y;var z;for(f=1;w>f;f++)r[n]=g,z=r.cloneNode(!0),r.parentNode.appendChild(z),u[f]=z.getContext("2d");z[n]=s%g,s=g}r[n]=s;var A=j*c,B=50/A,C=1;for(f=0;f<fb.length&&(v=fb[f],C=v,!(v>=B));f++);var D=C*A;y.font="9px sans-serif";for(var E=o/A%C*A,F=E-D;t>E;){F+=D;var G=Math.round(E)+.5;l?(y.moveTo(G,15),y.lineTo(G,0)):(y.moveTo(15,G),y.lineTo(0,G)),v=(F-o)/A;var H;if(C>=1)H=Math.round(v);else{var I=String(C).split(".")[1].length;H=v.toFixed(I)}if(0!==H&&1e3!==H&&H%1e3===0&&(H=H/1e3+"K"),l)y.fillText(H,E+2,8);else{var J=String(H).split("");for(f=0;f<J.length;f++)y.fillText(J[f],1,E+9+9*f)}var K=D/10;for(f=1;10>f;f++){var L=Math.round(E+K*f)+.5;if(u&&L>s){if(x++,y.stroke(),x>=w){f=10,E=t;continue}y=u[x],E-=g,L=Math.round(E+K*f)+.5}var M=f%2?12:10;l?(y.moveTo(L,15),y.lineTo(L,M)):(y.moveTo(15,L),y.lineTo(M,L))}E+=D}y.strokeStyle="#000",y.stroke()}}function s(){d.deleteCurrentLayer()&&(ub(),hb(),a("#layerlist tr.layer").removeClass("layersel"),a("#layerlist tr.layer:first").addClass("layersel"))}function t(){var b=d.getCurrentDrawing().getCurrentLayerName()+" copy";a.prompt(n.notification.enterUniqueLayerName,b,function(b){if(b){if(d.getCurrentDrawing().hasLayer(b))return void a.alert(n.notification.dupeLayerName);d.cloneLayer(b),ub(),hb()}})}function u(){a("#layerlist tr.layersel").index()!=d.getCurrentDrawing().getNumLayers()-1&&(d.mergeLayer(),ub(),hb())}function v(b){var c=a("#layerlist tr.layersel").index(),e=d.getCurrentDrawing().getNumLayers();(c>0||e-1>c)&&(c+=b,d.setCurrentLayerPosition(e-c-1),hb())}function w(a,b){var c=Number(a.value),d=c+b,e=d>=c;return 0===b?c:c>=24?Math.round(e?1.1*c:c/1.1):1>=c?e?2*c:c/2:d}function x(a,b){var c=Number(a.value);if(0===c)return 100;var d=c+b;return 0===b?c:c>=100?d:d>=c?2*c:c/2}function y(a){a.stopPropagation(),a.preventDefault()}function z(a){a.stopPropagation(),a.preventDefault()}function A(a){a.stopPropagation(),a.preventDefault()}var B=[];a("#lang_select option").each(function(){B.push(this.value)}),function(){var b,d;if(e=a.deparam.querystring(!0),a.isEmptyObject(e))g(),svgEditor.loadContentAndPrefs(),f();else{if(e.dimensions&&(e.dimensions=e.dimensions.split(",")),e.bkgd_color&&(e.bkgd_color="#"+e.bkgd_color),e.extensions&&(e.extensions=e.extensions.match(/[:\/\\]/)?"":e.extensions.split(",")),a.each(["extPath","imgPath","langPath","jGraduatePath"],function(a){e[a]&&delete e[a]}),svgEditor.setConfig(e,{overwrite:!1}),g(),!k.preventURLContentLoading){if(b=e.source,d=a.param.querystring(),b||d.indexOf("source=data:")>=0&&(b=d.match(/source=(data:[^&]*)/)[1]),b)return void(0===b.indexOf("data:")?(b=b.replace(/ /g,"+"),c.loadFromDataURI(b)):c.loadFromString(b));if(-1!==d.indexOf("paramurl="))return void svgEditor.loadFromURL(d.substr(9));if(e.url)return void svgEditor.loadFromURL(e.url)}(!e.noStorageOnLoad||k.forceStorage)&&svgEditor.loadContentAndPrefs(),f()}}(),function(){var a,b=window.opener;if(b)try{a=b.document.createEvent("Event"),a.initEvent("svgEditorReady",!0,!0),b.document.documentElement.dispatchEvent(a)}catch(c){}}();var C=c.setIcon=function(b,c){var d="string"==typeof c?a.getSvgIcon(c,!0):c.clone();return d?void a(b).empty().append(d):void console.log("NOTE: Icon image missing: "+c)},D=function(){a.each(k.extensions,function(){var b=this;a.getScript(k.extPath+b,function(a){if(!a){var c=document.createElement("script");c.src=k.extPath+b,document.querySelector("head").appendChild(c)}})}),c.putLocale(null,B)};"file:"===document.location.protocol?setTimeout(D,100):D(),a.svgIcons(k.imgPath+"svg_edit_icons.svg",{w:24,h:24,id_match:!1,no_img:!svgedit.browser.isWebkit(),fallback_path:k.imgPath,fallback:{new_image:"clear.png",save:"save.png",open:"open.png",source:"source.png",docprops:"document-properties.png",wireframe:"wireframe.png",undo:"undo.png",redo:"redo.png",select:"select.png",select_node:"select_node.png",pencil:"fhpath.png",pen:"line.png",square:"square.png",rect:"rect.png",fh_rect:"freehand-square.png",circle:"circle.png",ellipse:"ellipse.png",fh_ellipse:"freehand-circle.png",path:"path.png",text:"text.png",image:"image.png",zoom:"zoom.png",clone:"clone.png",node_clone:"node_clone.png","delete":"delete.png",node_delete:"node_delete.png",group:"shape_group_elements.png",ungroup:"shape_ungroup.png",move_top:"move_top.png",move_bottom:"move_bottom.png",to_path:"to_path.png",link_controls:"link_controls.png",reorient:"reorient.png",align_left:"align-left.png",align_center:"align-center.png",align_right:"align-right.png",align_top:"align-top.png",align_middle:"align-middle.png",align_bottom:"align-bottom.png",go_up:"go-up.png",go_down:"go-down.png",ok:"save.png",cancel:"cancel.png",arrow_right:"flyouth.png",arrow_down:"dropdown.gif"},placement:{"#logo":"logo","#tool_clear div,#layer_new":"new_image","#tool_save div":"save","#tool_export div":"export","#tool_open div div":"open","#tool_import div div":"import","#tool_source":"source","#tool_docprops > div":"docprops","#tool_wireframe":"wireframe","#tool_undo":"undo","#tool_redo":"redo","#tool_select":"select","#tool_fhpath":"pencil","#tool_line":"pen","#tool_rect,#tools_rect_show":"rect","#tool_square":"square","#tool_fhrect":"fh_rect","#tool_ellipse,#tools_ellipse_show":"ellipse","#tool_circle":"circle","#tool_fhellipse":"fh_ellipse","#tool_path":"path","#tool_text,#layer_rename":"text","#tool_image":"image","#tool_zoom":"zoom","#tool_clone,#tool_clone_multi":"clone","#tool_node_clone":"node_clone","#layer_delete,#tool_delete,#tool_delete_multi":"delete","#tool_node_delete":"node_delete","#tool_add_subpath":"add_subpath","#tool_openclose_path":"open_path","#tool_move_top":"move_top","#tool_move_bottom":"move_bottom","#tool_topath":"to_path","#tool_node_link":"link_controls","#tool_reorient":"reorient","#tool_group_elements":"group_elements","#tool_ungroup":"ungroup","#tool_unlink_use":"unlink_use","#tool_alignleft, #tool_posleft":"align_left","#tool_aligncenter, #tool_poscenter":"align_center","#tool_alignright, #tool_posright":"align_right","#tool_aligntop, #tool_postop":"align_top","#tool_alignmiddle, #tool_posmiddle":"align_middle","#tool_alignbottom, #tool_posbottom":"align_bottom","#cur_position":"align","#linecap_butt,#cur_linecap":"linecap_butt","#linecap_round":"linecap_round","#linecap_square":"linecap_square","#linejoin_miter,#cur_linejoin":"linejoin_miter","#linejoin_round":"linejoin_round","#linejoin_bevel":"linejoin_bevel","#url_notice":"warning","#layer_up":"go_up","#layer_down":"go_down","#layer_moreopts":"context_menu","#layerlist td.layervis":"eye","#tool_source_save,#tool_docprops_save,#tool_prefs_save":"ok","#tool_source_cancel,#tool_docprops_cancel,#tool_prefs_cancel":"cancel","#rwidthLabel, #iwidthLabel":"width","#rheightLabel, #iheightLabel":"height","#cornerRadiusLabel span":"c_radius","#angleLabel":"angle","#linkLabel,#tool_make_link,#tool_make_link_multi":"globe_link","#zoomLabel":"zoom","#tool_fill label":"fill","#tool_stroke .icon_label":"stroke","#group_opacityLabel":"opacity","#blurLabel":"blur","#font_sizeLabel":"fontsize",".flyout_arrow_horiz":"arrow_right",".dropdown button, #main_button .dropdown":"arrow_down","#palette .palette_item:first, #fill_bg, #stroke_bg":"no_color"},resize:{"#logo .svg_icon":28,".flyout_arrow_horiz .svg_icon":5,".layer_button .svg_icon, #layerlist td.layervis .svg_icon":14,".dropdown button .svg_icon":7,"#main_button .dropdown .svg_icon":9,".palette_item:first .svg_icon":15,"#fill_bg .svg_icon, #stroke_bg .svg_icon":16,".toolbar_button button .svg_icon":16,".stroke_tool div div .svg_icon":20,"#tools_bottom label .svg_icon":18},callback:function(){a(".toolbar_button button > svg, .toolbar_button button > img").each(function(){a(this).parent().prepend(this)});var b,c=a("#tools_left");0!==c.length&&(b=c.offset().top+c.outerHeight());var d=a.pref("iconsize");svgEditor.setIconSize(d||(a(window).height()<b?"s":"m")),a(".tools_flyout").each(function(){var b=a("#"+this.id+"_show"),c=b.attr("data-curopt");if(!b.children("svg, img").length){var d=a(c).children().clone();d.length&&(d[0].removeAttribute("style"),b.append(d))}}),svgEditor.runCallbacks(),setTimeout(function(){a(".flyout_arrow_horiz:empty").each(function(){a(this).append(a.getSvgIcon("arrow_right").width(5).height(5))})},1)}}),c.canvas=d=new a.SvgCanvas(document.getElementById("svgcanvas"),k);var E,F,G,H,I,J=["#000000","#3f3f3f","#7f7f7f","#bfbfbf","#ffffff","#ff0000","#ff7f00","#ffff00","#7fff00","#00ff00","#00ff7f","#00ffff","#007fff","#0000ff","#7f00ff","#ff00ff","#ff007f","#7f0000","#7f3f00","#7f7f00","#3f7f00","#007f00","#007f3f","#007f7f","#003f7f","#00007f","#3f007f","#7f007f","#7f003f","#ffaaaa","#ffd4aa","#ffffaa","#d4ffaa","#aaffaa","#aaffd4","#aaffff","#aad4ff","#aaaaff","#d4aaff","#ffaaff","#ffaad4"],K=svgedit.browser.isMac()?"meta+":"ctrl+",L=d.pathActions,M=d.undoMgr,N=svgedit.utilities,O=k.imgPath+"logo.png",P=a("#workarea"),Q=a("#cmenu_canvas"),R=null,S="crosshair",T="crosshair",U="toolbars",V="",W={fill:null,stroke:null};!function(){a("#dialog_container").draggable({cancel:"#dialog_content, #dialog_buttons *",containment:"window"});var b=a("#dialog_box"),c=a("#dialog_buttons"),d=a("#dialog_content"),e=function(e,f,g,h,i,j,k){var l,m,o;if(d.html("<p>"+f.replace(/\n/g,"</p><p>")+"</p>").toggleClass("prompt","prompt"==e),c.empty(),l=a('<input type="button" value="'+n.common.ok+'">').appendTo(c),"alert"!==e&&a('<input type="button" value="'+n.common.cancel+'">').appendTo(c).click(function(){b.hide(),g(!1)}),"prompt"===e)m=a('<input type="text">').prependTo(c),m.val(h||""),m.bind("keydown","return",function(){l.click()});else if("select"===e){var p=a('<div style="text-align:center;">');if(m=a("<select>").appendTo(p),k){var q=a("<label>").text(k.label);o=a('<input type="checkbox">').appendTo(q),o.val(k.value),k.tooltip&&q.attr("title",k.tooltip),o.prop("checked",!!k.checked),p.append(a("<div>").append(q))}a.each(i||[],function(b,c){m.append("object"==typeof c?a("<option>").val(c.value).html(c.text):a("<option>").html(c))}),d.append(p),h&&m.val(h),j&&m.bind("change","return",j),m.bind("keydown","return",function(){l.click()})}"process"===e&&l.hide(),b.show(),l.click(function(){b.hide();var a="prompt"===e||"select"===e?m.val():!0;g&&(o?g(a,o.prop("checked")):g(a))}).focus(),("prompt"===e||"select"===e)&&m.focus()};a.alert=function(a,b){e("alert",a,b)},a.confirm=function(a,b){e("confirm",a,b)},a.process_cancel=function(a,b){e("process",a,b)},a.prompt=function(a,b,c){e("prompt",a,c,b)},a.select=function(a,b,c,d,f,g){e("select",a,c,f,b,d,g)}}();var X,Y=function(){var b=a(".tool_button_current");b.length&&"tool_select"!==b[0].id&&(b.removeClass("tool_button_current").addClass("tool_button"),a("#tool_select").addClass("tool_button_current").removeClass("tool_button"),a("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all} #svgcanvas svg{cursor:default}")),d.setMode("select"),P.css("cursor","auto")},Z=!1,$=null,_=!1,ab=!1,bb=!1,cb=!1,db="",eb=a("title:first").text(),fb=[];for(X=.1;1e5>X;X*=10)fb.push(X),fb.push(2*X),fb.push(5*X);var gb=function(a){var b,c=[],e=d.getCurrentDrawing().getNumLayers();for(b=0;e>b;b++)c[b]=d.getCurrentDrawing().getLayerName(b);if(a)for(b=0;e>b;++b)c[b]!=a&&d.getCurrentDrawing().setLayerOpacity(c[b],.5);else for(b=0;e>b;++b)d.getCurrentDrawing().setLayerOpacity(c[b],1)},hb=function(){d.clearSelection();for(var b=a("#layerlist tbody").empty(),c=a("#selLayerNames").empty(),e=d.getCurrentDrawing(),f=e.getCurrentLayerName(),g=d.getCurrentDrawing().getNumLayers(),h=a.getSvgIcon("eye");g--;){var i=e.getLayerName(g),j=a('<tr class="layer">').toggleClass("layersel",i===f),k=a('<td class="layervis">').toggleClass("layerinvis",!e.getLayerVisibility(i)),l=a('<td class="layername">'+i+"</td>");b.append(j.append(k,l)),c.append('<option value="'+i+'">'+i+"</option>")}if(void 0!==h){var m=h.clone();a("td.layervis",b).append(m),a.resizeSvgIcons({"td.layervis .svg_icon":14})}a("#layerlist td.layername").mouseup(function(b){a("#layerlist tr.layer").removeClass("layersel"),a(this.parentNode).addClass("layersel"),d.setCurrentLayer(this.textContent),b.preventDefault()}).mouseover(function(){gb(this.textContent)}).mouseout(function(){gb()}),a("#layerlist td.layervis").click(function(){var b=a(this.parentNode).prevAll().length,c=a("#layerlist tr.layer:eq("+b+") td.layername").text(),e=a(this).hasClass("layerinvis");d.setLayerVisibility(c,e),a(this).toggleClass("layerinvis")});for(var n=5-a("#layerlist tr.layer").size();n-->0;)b.append('<tr><td style="color:white">_</td><td/></tr>')},ib=function(b,c){ab||(ab=!0,V=d.getSvgString(),a("#save_output_btns").toggle(!!c),a("#tool_source_back").toggle(!c),a("#svg_source_textarea").val(V),a("#svg_source_editor").fadeIn(),a("#svg_source_textarea").focus())},jb=function(b,c){a("#path_node_panel").toggle(b),a("#tools_bottom_2,#tools_bottom_3").toggle(!b),b?(a(".tool_button_current").removeClass("tool_button_current").addClass("tool_button"),a("#tool_select").addClass("tool_button_current").removeClass("tool_button"),C("#tool_select","select_node"),_=!1,c.length&&($=c[0])):setTimeout(function(){C("#tool_select","select")},1e3)},kb=function(b,d){if(c.showSaveWarning=!1,d='<?xml version="1.0"?>\n'+d,svgedit.browser.isIE())return void ib(0,!0);var e=b.open("data:image/svg+xml;base64,"+N.encode64(d)),f=a.pref("save_notice_done");if("all"!==f){var g=n.notification.saveFromBrowser.replace("%s","SVG");svgedit.browser.isGecko()?-1!==d.indexOf("<defs")?(g+="\n\n"+n.notification.defsFailOnSave,a.pref("save_notice_done","all"),f="all"):a.pref("save_notice_done","part"):a.pref("save_notice_done","all"),"part"!==f&&e.alert(g)}},lb=function(b,c){var e=c.issues,f=c.type||"PNG",g=("ICO"===f?"BMP":f).toLowerCase();a("#export_canvas").length||a("<canvas>",{id:"export_canvas"}).hide().appendTo("body");var h=a("#export_canvas")[0];h.width=d.contentW,h.height=d.contentH,canvg(h,c.svg,{renderCallback:function(){var b=c.quality?h.toDataURL("image/"+g,c.quality):h.toDataURL("image/"+g);R.location.href=b;var d=a.pref("export_notice_done");if("all"!==d){var i=n.notification.saveFromBrowser.replace("%s",f);if(e.length){var j="\n â€¢ ";i+="\n\n"+n.notification.noteTheseIssues+j+e.join(j)}a.pref("export_notice_done","all"),R.alert(i)}}})},mb=function(){window.opera&&a("<p/>").hide().appendTo("body").remove()},nb=c.toolButtonClick=function(b,c){if(a(b).hasClass("disabled"))return!1;if(a(b).parent().hasClass("tools_flyout"))return!0;var d="normal";return c||a(".tools_flyout").fadeOut(d),a("#styleoverrides").text(""),P.css("cursor","auto"),a(".tool_button_current").removeClass("tool_button_current").addClass("tool_button"),a(b).addClass("tool_button_current").removeClass("tool_button"),!0},ob=c.clickSelect=function(){nb("#tool_select")&&(d.setMode("select"),a("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all}, #svgcanvas svg{cursor:default}"))},pb=c.setImageURL=function(b){b||(b=O),d.setImageURL(b),a("#image_url").val(b),0===b.indexOf("data:")?(a("#image_url").hide(),a("#change_image_url").show()):(d.embedImage(b,function(c){a("#url_notice").toggle(!c),O=b}),a("#image_url").show(),a("#change_image_url").hide())},qb=function(b){var c=Math.min(Math.max(12+6*b.value.length,50),300);a(b).width(c)},rb=c.updateCanvas=function(b,f){var g=P.width(),h=P.height(),i=g,j=h,l=d.getZoom(),m=P,n=a("#svgcanvas"),o={x:m[0].scrollLeft+i/2,y:m[0].scrollTop+j/2},p=k.canvas_expansion;g=Math.max(i,d.contentW*l*p),h=Math.max(j,d.contentH*l*p),g==i&&h==j?P.css("overflow","hidden"):P.css("overflow","scroll");var q=n.height()/2,s=n.width()/2;n.width(g).height(h);var t=h/2,u=g/2,v=d.updateCanvas(g,h),w=u/s,x=g/2-i/2,y=h/2-j/2;if(f)f.x+=v.x,f.y+=v.y;else{var z=o.x-s,A=u+z*w,B=o.y-q,C=t+B*w;f={x:A,y:C}}b?d.contentW>m.width()?(P[0].scrollLeft=v.x-10,P[0].scrollTop=v.y-10):(m[0].scrollLeft=x,m[0].scrollTop=y):(m[0].scrollLeft=f.x-i/2,m[0].scrollTop=f.y-j/2),k.showRulers&&(r(n,l),P.scroll()),e.storagePrompt===!0||c.storagePromptClosed||a("#dialog_box").hide()},sb=function(){var b,c,e="none"==d.getColor("fill"),f="none"==d.getColor("stroke"),g=["#tool_fhpath","#tool_line"],h=["#tools_rect .tool_button","#tools_ellipse .tool_button","#tool_text","#tool_path"];if(f)for(b in g)c=g[b],a(c).hasClass("tool_button_current")&&ob(),a(c).addClass("disabled");else for(b in g)c=g[b],a(c).removeClass("disabled");if(f&&e)for(b in h)c=h[b],a(c).hasClass("tool_button_current")&&ob(),a(c).addClass("disabled");else for(b in h)c=h[b],a(c).removeClass("disabled");d.runExtensions("toolButtonStateUpdate",{nofill:e,nostroke:f}),a(".tools_flyout").each(function(){var b=a("#"+this.id+"_show"),c=!1;a(this).children().each(function(){a(this).hasClass("disabled")||(c=!0)}),b.toggleClass("disabled",!c)}),mb()},tb=function(){var b,c;if(null!=$)switch($.tagName){case"use":case"image":case"foreignObject":break;case"g":case"a":var d=null,e=$.getElementsByTagName("*");for(b=0,c=e.length;c>b;b++){var f=e[b].getAttribute("stroke-width");0===b?d=f:d!==f&&(d=null)}a("#stroke_width").val(null===d?"":d),W.fill.update(!0),W.stroke.update(!0);break;default:W.fill.update(!0),W.stroke.update(!0),a("#stroke_width").val($.getAttribute("stroke-width")||1),a("#stroke_style").val($.getAttribute("stroke-dasharray")||"none");var g=$.getAttribute("stroke-linejoin")||"miter";0!=a("#linejoin_"+g).length&&o(a("#linejoin_"+g)[0]),g=$.getAttribute("stroke-linecap")||"butt",0!=a("#linecap_"+g).length&&o(a("#linecap_"+g)[0])}if(null!=$){var h=100*($.getAttribute("opacity")||1);a("#group_opacity").val(h),a("#opac_slider").slider("option","value",h),a("#elem_id").val($.id)}sb()},ub=function(){var b=$;null==b||b.parentNode||(b=null);var c=d.getCurrentDrawing().getCurrentLayerName(),e=d.getMode(),f="px"!==k.baseUnit?k.baseUnit:null,g="pathedit"==e,h=a("#cmenu_canvas li");if(a("#selected_panel, #multiselected_panel, #g_panel, #rect_panel, #circle_panel,#ellipse_panel, #line_panel, #text_panel, #image_panel, #container_panel, #use_panel, #a_panel").hide(),null!=b){var i=b.nodeName,j=d.getRotationAngle(b);a("#angle").val(j);var l=d.getBlur(b);if(a("#blur").val(l),a("#blur_slider").slider("option","value",l),d.addedNew&&"image"===i&&0!==d.getHref(b).indexOf("data:")&&q(),g||"pathedit"==e){var m=L.getNodePoint();if(a("#tool_add_subpath").removeClass("push_button_pressed").addClass("tool_button"),a("#tool_node_delete").toggleClass("disabled",!L.canDeleteNodes),C("#tool_openclose_path",L.closed_subpath?"open_path":"close_path"),m){var n=a("#seg_type");f&&(m.x=svgedit.units.convertUnit(m.x),m.y=svgedit.units.convertUnit(m.y)),a("#path_node_x").val(m.x),a("#path_node_y").val(m.y),m.type?n.val(m.type).removeAttr("disabled"):n.val(4).attr("disabled","disabled")}return}if(a("#selected_panel").show(),["line","circle","ellipse"].indexOf(i)>=0)a("#xy_panel").hide();else{var o,p;if(["g","polyline","path"].indexOf(i)>=0){var r=d.getStrokedBBox([b]);r&&(o=r.x,p=r.y)}else o=b.getAttribute("x"),p=b.getAttribute("y");f&&(o=svgedit.units.convertUnit(o),p=svgedit.units.convertUnit(p)),a("#selected_x").val(o||0),a("#selected_y").val(p||0),a("#xy_panel").show()}var s=-1==["image","text","path","g","use"].indexOf(i);a("#tool_topath").toggle(s),a("#tool_reorient").toggle("path"===i),a("#tool_reorient").toggleClass("disabled",0===j);var t={g:[],a:[],rect:["rx","width","height"],image:["width","height"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],line:["x1","y1","x2","y2"],text:[],use:[]},u=b.tagName,v=null;if("a"===u&&(v=d.getHref(b),a("#g_panel").show()),"a"===b.parentNode.tagName&&(a(b).siblings().length||(a("#a_panel").show(),v=d.getHref(b.parentNode))),a("#tool_make_link, #tool_make_link").toggle(!v),v&&a("#link_url").val(v),t[u]){var w=t[u];if(a("#"+u+"_panel").show(),a.each(w,function(c,d){var e=b.getAttribute(d);if("px"!==k.baseUnit&&b[d]){var f=b[d].baseVal.value;e=svgedit.units.convertUnit(f)}a("#"+u+"_"+d).val(e||0)}),"text"==u)a("#text_panel").css("display","inline"),d.getItalic()?a("#tool_italic").addClass("push_button_pressed").removeClass("tool_button"):a("#tool_italic").removeClass("push_button_pressed").addClass("tool_button"),d.getBold()?a("#tool_bold").addClass("push_button_pressed").removeClass("tool_button"):a("#tool_bold").removeClass("push_button_pressed").addClass("tool_button"),a("#font_family").val(b.getAttribute("font-family")),a("#font_size").val(b.getAttribute("font-size")),a("#text").val(b.textContent),d.addedNew&&setTimeout(function(){a("#text").focus().select()},100);else if("image"==u)pb(d.getHref(b));else if("g"===u||"use"===u){a("#container_panel").show();var x=d.getTitle(),y=a("#g_title")[0];y.value=x,qb(y),a("#g_title").prop("disabled","use"==u)}}h[("g"===u?"en":"dis")+"ableContextMenuItems"]("#ungroup"),h[("g"!==u&&_?"en":"dis")+"ableContextMenuItems"]("#group")}else _?(a("#multiselected_panel").show(),h.enableContextMenuItems("#group").disableContextMenuItems("#ungroup")):h.disableContextMenuItems("#delete,#cut,#copy,#group,#ungroup,#move_front,#move_up,#move_down,#move_back");a("#tool_undo").toggleClass("disabled",0===M.getUndoStackSize()),a("#tool_redo").toggleClass("disabled",0===M.getRedoStackSize()),d.addedNew=!1,b&&!g||_?(a("#selLayerNames").removeAttr("disabled").val(c),Q.enableContextMenuItems("#delete,#cut,#copy,#move_front,#move_up,#move_down,#move_back")):a("#selLayerNames").attr("disabled","disabled")},vb=function(){if(!E){var b="#workarea.wireframe #svgcontent * { stroke-width: "+1/d.getZoom()+"px; }";a("#wireframe_rules").text(P.hasClass("wireframe")?b:"")}},wb=function(b){b=b||d.getDocumentTitle();var c=eb+(b?": "+b:"");a("title:first").text(c)},xb=function(a,b){var c=d.getMode();"select"===c&&Y();var e="pathedit"==c;$=1===b.length||null==b[1]?b[0]:null,_=b.length>=2&&null!=b[1],null!=$&&(e||tb()),jb(e,b),ub(),d.runExtensions("selectedChanged",{elems:b,selectedElement:$,multiselected:_})},yb=function(b,c){var e=d.getMode(),f=c[0];if(f){if(_=c.length>=2&&null!=c[1],!_)switch(e){case"rotate":var g=d.getRotationAngle(f);a("#angle").val(g),a("#tool_reorient").toggleClass("disabled",0===g)}d.runExtensions("elementTransition",{elems:c})}},zb=function(a,b){var e,f=d.getMode();for("select"===f&&Y(),e=0;e<b.length;++e){var g=b[e];g&&"svg"===g.tagName?(hb(),rb()):g&&$&&null==$.parentNode&&($=g)}c.showSaveWarning=!0,ub(),$&&"select"===f&&(W.fill.update(),W.stroke.update()),d.runExtensions("elementChanged",{elems:b})},Ab=function(){vb()},Bb=d.zoomChanged=function(b,c,e){var f=15,g=P,h=d.setBBoxZoom(c,g.width()-f,g.height()-f);if(h){var i=h.zoom,j=h.bbox;if(.001>i)return void G({value:.1});a("#zoom").val((100*i).toFixed(1)),e?rb():rb(!1,{x:j.x*i+j.width*i/2,y:j.y*i+j.height*i/2}),"zoom"==d.getMode()&&j.width&&Y(),Ab()}};G=function(a){var b=a.value/100;if(.001>b)return void(a.value=.1);var c=d.getZoom(),e=P;Bb(window,{width:0,height:0,x:(e[0].scrollLeft+e.width()/2)/c,y:(e[0].scrollTop+e.height()/2)/c,zoom:b},!0)},a("#cur_context_panel").delegate("a","click",function(){var b=a(this);return b.attr("data-root")?d.leaveContext():d.setContext(b.text()),d.clearSelection(),!1});var Cb=function(b,c){var e="";if(c){var f="";e='<a href="#" data-root="y">'+d.getCurrentDrawing().getCurrentLayerName()+"</a>",a(c).parentsUntil("#svgcontent > g").andSelf().each(function(){this.id&&(f+=" > "+this.id,e+=this!==c?' > <a href="#">'+this.id+"</a>":" > "+this.id)}),db=f}else db=null;a("#cur_context_panel").toggle(!!c).html(e),wb()},Db=function(){W.fill.prep(),W.stroke.prep()},Eb={},Fb=function(){a(".tools_flyout").each(function(){var b=a("#"+this.id+"_show");if(!b.data("isLibrary")){var c=[];a(this).children().each(function(){c.push(this.title)}),b[0].title=c.join(" / ")}})},Gb=function(){a(".tools_flyout").each(function(){var b=a("#"+this.id+"_show"),d=b.offset(),e=b.outerWidth();a(this).css({left:(d.left+e)*c.tool_scale,top:d.top})})},Hb=function(b){a.each(b,function(c,d){var e=a(c).children(),f=c+"_show",g=a(f),h=!1;e.addClass("tool_button").unbind("click mousedown mouseup").each(function(c){var e=d[c];Eb[e.sel]=e.fn,e.isDefault&&(h=c);var i=function(c){var d=e;if("keydown"===c.type){var h=a(d.parent+"_show").hasClass("tool_button_current"),i=a(d.parent+"_show").attr("data-curopt");a.each(b[e.parent],function(a,f){f.sel==i&&(d=c.shiftKey&&h?b[e.parent][a+1]||b[e.parent][0]:f)})}if(a(this).hasClass("disabled"))return!1;nb(f)&&d.fn();var j;j=d.icon?a.getSvgIcon(d.icon,!0):a(d.sel).children().eq(0).clone(),j[0].setAttribute("width",g.width()),j[0].setAttribute("height",g.height()),g.children(":not(.flyout_arrow_horiz)").remove(),g.append(j).attr("data-curopt",d.sel)};a(this).mouseup(i),e.key&&a(document).bind("keydown",e.key[0]+" shift+"+e.key[0],i)}),h?g.attr("data-curopt",d[h].sel):g.attr("data-curopt")||g.attr("data-curopt",d[0].sel);var i,j=a(f).position();g.mousedown(function(b){if(g.hasClass("disabled"))return!1;var d=a(c),e=j.left+34,f=-1*d.width(),h=d.data("shown_popop")?200:0;i=setTimeout(function(){g.data("isLibrary")?d.css("left",e).show():d.css("left",f).show().animate({left:e},150),d.data("shown_popop",!0)},h),b.preventDefault()}).mouseup(function(){clearTimeout(i);var b=a(this).attr("data-curopt");return g.data("isLibrary")&&a(f.replace("_show","")).is(":visible")?void nb(f,!0):void(nb(f)&&Eb[b]&&Eb[b]())})}),Fb(),Gb()},Ib=function(b,c){var d=a("<div>",{"class":"tools_flyout",id:b}).appendTo("#svg_editor").append(c);return d},Jb=function(){var a,b=/^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/,c=document.getElementsByTagName("script")[0];for(a in c.style)if(b.test(a))return a.match(b)[0];return"WebkitOpacity"in c.style?"Webkit":"KhtmlOpacity"in c.style?"Khtml":""}(),Kb=function(b,c){var d=["top","left","bottom","right"];b.each(function(){var b,e=a(this),f=e.outerWidth()*(c-1),g=e.outerHeight()*(c-1);for(b=0;4>b;b++){var h=d[b],i=e.data("orig_margin-"+h);null==i&&(i=parseInt(e.css("margin-"+h),10),e.data("orig_margin-"+h,i));var j=i*c;"right"===h?j+=f:"bottom"===h&&(j+=g),e.css("margin-"+h,j)}})},Lb=c.setIconSize=function(b){var d="#tools_top .toolset, #editor_panel > *, #history_panel > *,				#main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,				#g_panel > *, #tool_font_size > *, .tools_flyout",e=a(d),f=1;if("number"==typeof b)f=b;else{var g={s:.75,m:1,l:1.25,xl:1.5};f=g[b]}c.tool_scale=f,Gb();var h=e.parents(":hidden");h.css("visibility","hidden").show(),Kb(e,f),h.css("visibility","visible").hide(),a.pref("iconsize",b),a("#iconsize").val(b);var i={"#tools_top":{left:50,height:72},"#tools_left":{width:31,top:74},"div#workarea":{left:38,top:74}},j=a("#tool_size_rules");
if(j.length?j.empty():j=a('<style id="tool_size_rules"></style>').appendTo("head"),"m"!==b){var k="";a.each(i,function(c,d){c="#svg_editor "+c.replace(/,/g,", #svg_editor"),k+=c+"{",a.each(d,function(a,c){var d;"number"==typeof c?d=c*f+"px":(c[b]||c.all)&&(d=c[b]||c.all),k+=a+":"+d+";"}),k+="}"});var l="-"+Jb.toLowerCase()+"-";k+=d+"{"+l+"transform: scale("+f+");} #svg_editor div.toolset .toolset {"+l+"transform: scale(1); margin: 1px !important;} #svg_editor .ui-slider {"+l+"transform: scale("+1/f+");}",j.text(k)}Gb()},Mb=function(b,c,d,e){var f=a(b);c=a(c);var g=!1,h=e.dropUp;h&&a(b).addClass("dropup"),c.find("li").bind("mouseup",function(){e.seticon&&(C("#cur_"+f[0].id,a(this).children()),a(this).addClass("current").siblings().removeClass("current")),d.apply(this,arguments)}),a(window).mouseup(function(){g||(f.removeClass("down"),c.hide(),c.css({top:0,left:0})),g=!1}),f.bind("mousedown",function(){var a=f.offset();h?(a.top-=c.height(),a.left+=8):a.top+=f.height(),c.offset(a),f.hasClass("down")?(c.hide(),c.css({top:0,left:0})):(c.show(),g=!0),f.toggleClass("down")}).hover(function(){g=!0}).mouseout(function(){g=!1}),e.multiclick&&c.mousedown(function(){g=!0})},Nb=[],Ob=function(b,d){function e(){F&&(clearTimeout(F),F=null),g||(F=setTimeout(function(){g=!0,Lb(a.pref("iconsize"))},50))}if(d){var f=!1,g=!1,h=!0;if(d.langReady)if(c.langChanged){var i=a.pref("lang");d.langReady({lang:i,uiStrings:n})}else Nb.push(d);var j=function(){d.callback&&!f&&h&&(f=!0,d.callback())},k=[];if(d.context_tools&&a.each(d.context_tools,function(b,c){var d,e=c.container_id?' id="'+c.container_id+'"':"",f=a("#"+c.panel);switch(f.length||(f=a("<div>",{id:c.panel}).appendTo("#tools_top")),c.type){case"tool_button":d='<div class="tool_button">'+c.id+"</div>";var g=a(d).appendTo(f);c.events&&a.each(c.events,function(b,c){a(g).bind(b,c)});break;case"select":d="<label"+e+'><select id="'+c.id+'">',a.each(c.options,function(a,b){var e=a==c.defval?" selected":"";d+='<option value="'+a+'"'+e+">"+b+"</option>"}),d+="</select></label>";var h=a(d).appendTo(f).find("select");a.each(c.events,function(b,c){a(h).bind(b,c)});break;case"button-select":d='<div id="'+c.id+'" class="dropdown toolset" title="'+c.title+'"><div id="cur_'+c.id+'" class="icon_label"></div><button></button></div>';var i=a('<ul id="'+c.id+'_opts"></ul>').appendTo("#option_lists");c.colnum&&i.addClass("optcols"+c.colnum);{a(d).appendTo(f).children()}k.push({elem:"#"+c.id,list:"#"+c.id+"_opts",title:c.title,callback:c.events.change,cur:"#cur_"+c.id});break;case"input":d="<label"+e+'><span id="'+c.id+'_label">'+c.label+':</span><input id="'+c.id+'" title="'+c.title+'" size="'+(c.size||"4")+'" value="'+(c.defval||"")+'" type="text"/></label>';var j=a(d).appendTo(f).find("input");c.spindata&&j.SpinButton(c.spindata),c.events&&a.each(c.events,function(a,b){j.bind(a,b)})}}),d.buttons){var l={},m={},o=d.svgicons,p={};a.each(d.buttons,function(b,c){for(var d,e,f,g=c.id,h=b;a("#"+g).length;)g=c.id+"_"+ ++h;o?(l[g]=c.icon,e=c.svgicon||c.id,"app_menu"==c.type?m["#"+g+" > div"]=e:m["#"+g]=e):d=a('<img src="'+c.icon+'">');var i,j;switch(c.type){case"mode_flyout":case"mode":i="tool_button",j="#tools_left";break;case"context":i="tool_button",j="#"+c.panel,a(j).length||a("<div>",{id:c.panel}).appendTo("#tools_top");break;case"app_menu":i="",j="#main_menu ul"}var k,n,q,r,s,t=a(c.list||"app_menu"==c.type?"<li/>":"<div/>").attr("id",g).attr("title",c.title).addClass(i);if(c.includeWith||c.list){if(c.list)t.addClass("push_button"),a("#"+c.list+"_opts").append(t),c.isDefault&&(a("#cur_"+c.list).append(t.children().clone()),e=c.svgicon||c.id,m["#cur_"+c.list]=e);else if(c.includeWith){var u=c.includeWith;s=a(u.button),k=s.parent(),s.parent().hasClass("tools_flyout")||(f=s[0].id.replace("tool_","tools_"),q=s.clone().attr("id",f+"_show").append(a("<div>",{"class":"flyout_arrow_horiz"})),s.before(q),k=Ib(f,s)),r=H.getButtonData(u.button),u.isDefault&&(m["#"+f+"_show"]=c.id),n=p["#"+k[0].id]=[{sel:"#"+g,fn:c.events.click,icon:c.id,key:c.key,isDefault:c.includeWith?c.includeWith.isDefault:0},r];var v="position"in u?u.position:"last",w=k.children().length;!isNaN(v)&&v>=0&&w>v?k.children().eq(v).before(t):(k.append(t),n.reverse())}}else"position"in c?a(j).children().eq(c.position).length?a(j).children().eq(c.position).before(t):a(j).children().last().before(t):t.appendTo(j),"mode_flyout"==c.type?(s=a(t),k=s.parent(),s.parent().hasClass("tools_flyout")||(f=s[0].id.replace("tool_","tools_"),q=s.clone().attr("id",f+"_show").append(a("<div>",{"class":"flyout_arrow_horiz"})),s.before(q),k=Ib(f,s),k.data("isLibrary",!0),q.data("isLibrary",!0)),m["#"+f+"_show"]=c.id,n=p["#"+k[0].id]=[{sel:"#"+g,fn:c.events.click,icon:c.id,isDefault:!0},r]):"app_menu"==c.type&&t.append("<div>").append(c.title);o||t.append(d),c.list||a.each(c.events,function(b,d){"click"==b&&"mode"==c.type?(c.includeWith?t.bind(b,d):t.bind(b,function(){nb(t)&&d()}),c.key&&(a(document).bind("keydown",c.key,d),c.title&&t.attr("title",c.title+" ["+c.key+"]"))):t.bind(b,d)}),Hb(p)}),a.each(k,function(){Mb(this.elem,this.list,this.callback,{seticon:!0})}),o&&(h=!1),a.svgIcons(o,{w:24,h:24,id_match:!1,no_img:!svgedit.browser.isWebkit(),fallback:l,placement:m,callback:function(){"m"!==a.pref("iconsize")&&e(),h=!0,j()}})}j()}},Pb=function(b,c,e){var f={alpha:c};if(0===b.indexOf("url(#")){var g=d.getRefElem(b);g=g?g.cloneNode(!0):a("#"+e+"_color defs *")[0],f[g.tagName]=g}else f.solidColor=0===b.indexOf("#")?b.substr(1):"none";return new a.jGraduate.Paint(f)};a("#text").focus(function(){Z=!0}),a("#text").blur(function(){Z=!1}),d.bind("selected",xb),d.bind("transition",yb),d.bind("changed",zb),d.bind("saved",kb),d.bind("exported",lb),d.bind("zoomed",Bb),d.bind("contextset",Cb),d.bind("extension_added",Ob),d.textActions.setInputElem(a("#text")[0]);var Qb='<div class="palette_item" data-rgb="none"></div>';a.each(J,function(a,b){Qb+='<div class="palette_item" style="background-color: '+b+';" data-rgb="'+b+'"></div>'}),a("#palette").append(Qb);var Rb=["#FFF","#888","#000"];Qb="",a.each(Rb,function(){Qb+='<div class="color_block" style="background-color:'+this+';"></div>'}),a("#bg_blocks").append(Qb);var Sb=a("#bg_blocks div"),Tb="cur_background";Sb.each(function(){var b=a(this);b.click(function(){Sb.removeClass(Tb),a(this).addClass(Tb)})}),p(a.pref("bkgd_color"),a.pref("bkgd_url")),a("#image_save_opts input").val([a.pref("img_save")]);var Ub=function(a){d.setRectRadius(a.value)},Vb=function(a){d.setFontSize(a.value)},Wb=function(a){var b=a.value;0==b&&$&&["line","polyline"].indexOf($.nodeName)>=0&&(b=a.value=1),d.setStrokeWidth(b)},Xb=function(b){d.setRotationAngle(b.value),a("#tool_reorient").toggleClass("disabled",0===parseInt(b.value,10))},Yb=function(b,c){null==c&&(c=b.value),a("#group_opacity").val(c),b&&b.handle||a("#opac_slider").slider("option","value",c),d.setOpacity(c/100)},Zb=function(b,c,e){null==c&&(c=b.value),a("#blur").val(c);var f=!1;b&&b.handle||(a("#blur_slider").slider("option","value",c),f=!0),e?d.setBlurNoUndo(c):d.setBlur(c,f)};a("#stroke_style").change(function(){d.setStrokeAttr("stroke-dasharray",a(this).val()),mb()}),a("#stroke_linejoin").change(function(){d.setStrokeAttr("stroke-linejoin",a(this).val()),mb()}),a("select").change(function(){a(this).blur()});var $b=!1;a("#selLayerNames").change(function(){var b=this.options[this.selectedIndex].value,c=n.notification.QmoveElemsToLayer.replace("%s",b),e=function(a){a&&($b=!0,d.moveSelectedToLayer(b),d.clearSelection(),hb())};b&&($b?e(!0):a.confirm(c,e))}),a("#font_family").change(function(){d.setFontFamily(this.value)}),a("#seg_type").change(function(){d.setSegType(a(this).val())}),a("#text").keyup(function(){d.setTextContent(this.value)}),a("#image_url").change(function(){pb(this.value)}),a("#link_url").change(function(){this.value.length?d.setLinkURL(this.value):d.removeHyperlink()}),a("#g_title").change(function(){d.setGroupTitle(this.value)}),a(".attr_changer").change(function(){var b=this.getAttribute("data-attr"),c=this.value,e=svgedit.units.isValidUnit(b,c,$);if(!e)return a.alert(n.notification.invalidAttrValGiven),this.value=$.getAttribute(b),!1;if("id"!==b)if(isNaN(c))c=d.convertToNum(b,c);else if("px"!==k.baseUnit){var f=svgedit.units.getTypeMap();($[b]||"pathedit"===d.getMode()||"x"===b||"y"===b)&&(c*=f[k.baseUnit])}if("id"===b){var g=$;d.clearSelection(),g.id=c,d.addToSelection([g],!0)}else d.changeSelectedAttribute(b,c);this.blur()}),a("#palette").mouseover(function(){var b=a('<input type="hidden">');a(this).append(b),b.focus().remove()}),a(".palette_item").mousedown(function(b){var c,e=b.shiftKey||2===b.button?"stroke":"fill",f=a(this).data("rgb");"none"===f||"transparent"===f||"initial"===f?(f="none",c=new a.jGraduate.Paint):c=new a.jGraduate.Paint({alpha:100,solidColor:f.substr(1)}),W[e].setPaint(c),d.setColor(e,f),"none"!==f&&1!==d.getPaintOpacity(e)&&d.setPaintOpacity(e,1),sb()}).bind("contextmenu",function(a){a.preventDefault()}),a("#toggle_stroke_tools").on("click",function(){a("#tools_bottom").toggleClass("expanded")}),function(){var b=null,e=null,f=P[0],g=!1,h=!1;a("#svgcanvas").bind("mousemove mouseup",function(a){return g!==!1?(f.scrollLeft-=a.clientX-b,f.scrollTop-=a.clientY-e,b=a.clientX,e=a.clientY,"mouseup"===a.type&&(g=!1),!1):void 0}).mousedown(function(a){return 1===a.button||h===!0?(g=!0,b=a.clientX,e=a.clientY,!1):void 0}),a(window).mouseup(function(){g=!1}),a(document).bind("keydown","space",function(a){d.spaceKey=h=!0,a.preventDefault()}).bind("keyup","space",function(a){a.preventDefault(),d.spaceKey=h=!1}).bind("keydown","shift",function(){"zoom"===d.getMode()&&P.css("cursor",T)}).bind("keyup","shift",function(){"zoom"===d.getMode()&&P.css("cursor",S)}),c.setPanning=function(a){d.spaceKey=h=a}}(),function(){var b=a("#main_icon"),c=a("#main_icon span"),d=a("#main_menu"),e=!1,f=0,g=!0,h=!1;a(window).mouseup(function(c){e||(b.removeClass("buttondown"),"INPUT"!=c.target.tagName?d.fadeOut(200):h||(h=!0,a(c.target).click(function(){d.css("margin-left","-9999px").show()}))),e=!1}).mousedown(function(b){var c=a(b.target).closest("div.tools_flyout, .contextMenu").length;c||a(".tools_flyout:visible,.contextMenu").fadeOut(250)}),c.bind("mousedown",function(){b.hasClass("buttondown")?d.fadeOut(200):(d.css("margin-left",0).show(),f||(f=d.height()),d.css("height",0).animate({height:f},200),e=!0),b.toggleClass("buttondown buttonup")}).hover(function(){e=!0}).mouseout(function(){e=!1});var i=a("#main_menu li");i.mouseover(function(){g="rgba(0, 0, 0, 0)"==a(this).css("background-color"),i.unbind("mouseover"),g&&i.mouseover(function(){this.style.backgroundColor="#FFC"}).mouseout(function(){return this.style.backgroundColor="transparent",!0})})}(),c.addDropDown=function(b,c,d){if(0!=a(b).length){var e=a(b).find("button"),f=a(b).find("ul").attr("id",a(b)[0].id+"-list"),g=!1;d?a(b).addClass("dropup"):a("#option_lists").append(f),f.find("li").bind("mouseup",c),a(window).mouseup(function(){g||(e.removeClass("down"),f.hide()),g=!1}),e.bind("mousedown",function(){if(e.hasClass("down"))f.hide();else{if(!d){var c=a(b).position();f.css({top:c.top+24,left:c.left-10})}f.show(),g=!0}e.toggleClass("down")}).hover(function(){g=!0}).mouseout(function(){g=!1})}},c.addDropDown("#font_family_dropdown",function(){a("#font_family").val(a(this).text()).change()}),c.addDropDown("#opacity_dropdown",function(){if(!a(this).find("div").length){var b=parseInt(a(this).text().split("%")[0],10);Yb(!1,b)}},!0),a("#opac_slider").slider({start:function(){a("#opacity_dropdown li:not(.special)").hide()},stop:function(){a("#opacity_dropdown li").show(),a(window).mouseup()},slide:function(a,b){Yb(b)}}),c.addDropDown("#blur_dropdown",a.noop);var _b=!1;a("#blur_slider").slider({max:10,step:.1,stop:function(b,c){_b=!1,Zb(c),a("#blur_dropdown li").show(),a(window).mouseup()},start:function(){_b=!0},slide:function(a,b){Zb(b,null,_b)}}),c.addDropDown("#zoom_dropdown",function(){var b=a(this),c=b.data("val");c?Bb(window,c):G({value:parseInt(b.text(),10)})},!0),Mb("#stroke_linecap","#linecap_opts",function(){o(this,!0)},{dropUp:!0}),Mb("#stroke_linejoin","#linejoin_opts",function(){o(this,!0)},{dropUp:!0}),Mb("#tool_position","#position_opts",function(){var a=this.id.replace("tool_pos","").charAt(0);d.alignSelectedElements(a,"page")},{multiclick:!0}),function(){var b,c=function(){a(b).blur()};a("#svg_editor").find("button, select, input:not(#text)").focus(function(){b=this,U="toolbars",P.mousedown(c)}).blur(function(){U="canvas",P.unbind("mousedown",c),"textedit"==d.getMode()&&a("#text").focus()})}();var ac=function(){nb("#tool_fhpath")&&d.setMode("fhpath")},bc=function(){nb("#tool_line")&&d.setMode("line")},cc=function(){nb("#tool_square")&&d.setMode("square")},dc=function(){nb("#tool_rect")&&d.setMode("rect")},ec=function(){nb("#tool_fhrect")&&d.setMode("fhrect")},fc=function(){nb("#tool_circle")&&d.setMode("circle")},gc=function(){nb("#tool_ellipse")&&d.setMode("ellipse")},hc=function(){nb("#tool_fhellipse")&&d.setMode("fhellipse")},ic=function(){nb("#tool_image")&&d.setMode("image")},jc=function(){nb("#tool_zoom")&&(d.setMode("zoom"),P.css("cursor",S))},kc=function(b){var c=d.getResolution();b=b?c.zoom*b:1,a("#zoom").val(100*b),d.setZoom(b),Ab(),rb(!0)},lc=function(){nb("#tool_zoom")&&(kc(),Y())},mc=function(){nb("#tool_text")&&d.setMode("text")},nc=function(){nb("#tool_path")&&d.setMode("path")},oc=function(){(null!=$||_)&&d.deleteSelectedElements()},pc=function(){(null!=$||_)&&d.cutSelectedElements()},qc=function(){(null!=$||_)&&d.copySelectedElements()},rc=function(){var a=d.getZoom(),b=(P[0].scrollLeft+P.width()/2)/a-d.contentW,c=(P[0].scrollTop+P.height()/2)/a-d.contentH;d.pasteElements("point",b,c)},sc=function(){null!=$&&d.moveToTopSelectedElement()},tc=function(){null!=$&&d.moveToBottomSelectedElement()},uc=function(a){null!=$&&d.moveUpDownSelected(a)},vc=function(){null!=$&&d.convertToPath()},wc=function(){null!=$&&L.reorient()},xc=function(){(null!=$||_)&&a.prompt(n.notification.enterNewLinkURL,"http://",function(a){a&&d.makeHyperlink(a)})},yc=function(a,b){if(null!=$||_){if(k.gridSnapping){var c=d.getZoom()*k.snappingStep;a*=c,b*=c}d.moveSelectedElements(a,b)}},zc=function(){a("#tool_node_link").toggleClass("push_button_pressed tool_button");var b=a("#tool_node_link").hasClass("push_button_pressed");L.linkControlPoints(b)},Ac=function(){L.getNodePoint()&&L.clonePathNode()},Bc=function(){L.getNodePoint()&&L.deletePathNode()},Cc=function(){var b=a("#tool_add_subpath"),c=!b.hasClass("push_button_pressed");b.toggleClass("push_button_pressed tool_button"),L.addSubPath(c)},Dc=function(){L.opencloseSubPath()},Ec=function(){d.cycleElement(1)},Fc=function(){d.cycleElement(0)},Gc=function(b,c){if(null!=$&&!_){b||(c*=-1);var e=parseFloat(a("#angle").val())+c;d.setRotationAngle(e),ub()}},Hc=function(){var b=k.dimensions;a.confirm(n.notification.QwantToClear,function(a){a&&(Y(),d.clear(),d.setResolution(b[0],b[1]),rb(!0),kc(),hb(),ub(),Db(),d.runExtensions("onNewDocument"))})},Ic=function(){return d.setBold(!d.getBold()),ub(),!1},Jc=function(){return d.setItalic(!d.getItalic()),ub(),!1},Kc=function(){var b={images:a.pref("img_save"),round_digits:6};d.save(b)},Lc=function(){a.select("Select an image type for export: ",["PNG","JPEG","BMP","WEBP"],function(b){if(b){if(!h.exportImage&&!h.pngsave){var c=n.notification.loadingImage;R=window.open("data:text/html;charset=utf-8,<title>"+c+"</title><h1>"+c+"</h1>")}var e=parseInt(a("#image-slider").val(),10)/100;window.canvg?d.rasterExport(b,e):a.getScript("canvg/rgbcolor.js",function(){a.getScript("canvg/canvg.js",function(){d.rasterExport(b,e)})})}},function(){var b=a(this);"JPEG"===b.val()||"WEBP"===b.val()?a("#image-slider").length||a('<div><label>Quality: <input id="image-slider" type="range" min="1" max="100" value="92" /></label></div>').appendTo(b.parent()):a("#image-slider").parent().remove()})},Mc=function(){d.open()},Nc=function(){},Oc=function(){M.getUndoStackSize()>0&&(M.undo(),hb())},Pc=function(){M.getRedoStackSize()>0&&(M.redo(),hb())},Qc=function(){_?d.groupSelectedElements():$&&d.ungroupSelectedElement()},Rc=function(){d.cloneSelectedElements(20,20)},Sc=function(){var b=this.id.replace("tool_align","").charAt(0);d.alignSelectedElements(b,a("#align_relative_to").val())},Tc=function(){if(a("#tool_wireframe").toggleClass("push_button_pressed tool_button"),P.toggleClass("wireframe"),!E){var b=a("#wireframe_rules");b.length?b.empty():b=a('<style id="wireframe_rules"></style>').appendTo("head"),vb()}};a("#svg_docprops_container, #svg_prefs_container").draggable({cancel:"button,fieldset",containment:"window"});var Uc=function(){if(!bb){bb=!0,a("#image_save_opts input").val([a.pref("img_save")]);var b=d.getResolution();"px"!==k.baseUnit&&(b.w=svgedit.units.convertUnit(b.w)+k.baseUnit,b.h=svgedit.units.convertUnit(b.h)+k.baseUnit),a("#canvas_width").val(b.w),a("#canvas_height").val(b.h),a("#canvas_title").val(d.getDocumentTitle()),a("#svg_docprops").show()}},Vc=function(){if(!cb){cb=!0,a("#main_menu").hide();var b=a("#bg_blocks div"),c="cur_background",d=j.bkgd_color,e=a.pref("bkgd_url");b.each(function(){var b=a(this),e=b.css("background-color")==d;b.toggleClass(c,e),e&&a("#canvas_bg_url").removeClass(c)}),d||b.eq(0).addClass(c),e&&a("#canvas_bg_url").val(e),a("#grid_snapping_on").prop("checked",k.gridSnapping),a("#grid_snapping_step").attr("value",k.snappingStep),a("#grid_color").attr("value",k.gridColor),a("#svg_prefs").show()}},Wc=function(){a("#svg_source_editor").hide(),ab=!1,a("#svg_source_textarea").blur()},Xc=function(){if(ab){var b=function(){d.clearSelection(),Wc(),kc(),hb(),wb(),Db()};d.setSvgString(a("#svg_source_textarea").val())?b():a.confirm(n.notification.QerrorsRevertToSource,function(a){return a?void b():!1}),Y()}},Yc=function(){a("#svg_docprops").hide(),a("#canvas_width,#canvas_height").removeAttr("disabled"),a("#resolution")[0].selectedIndex=0,a("#image_save_opts input").val([a.pref("img_save")]),bb=!1},Zc=function(){a("#svg_prefs").hide(),cb=!1},$c=function(){var b=a("#canvas_title").val();wb(b),d.setDocumentTitle(b);var c=a("#canvas_width"),e=c.val(),f=a("#canvas_height"),g=f.val();return"fit"==e||svgedit.units.isValidUnit("width",e)?(c.parent().removeClass("error"),"fit"==g||svgedit.units.isValidUnit("height",g)?(f.parent().removeClass("error"),d.setResolution(e,g)?(a.pref("img_save",a("#image_save_opts :checked").val()),rb(),void Yc()):(a.alert(n.notification.noContentToFitTo),!1)):(a.alert(n.notification.invalidAttrValGiven),f.parent().addClass("error"),!1)):(a.alert(n.notification.invalidAttrValGiven),c.parent().addClass("error"),!1)},_c=c.savePreferences=function(){var b=a("#bg_blocks div.cur_background").css("background-color")||"#FFF";p(b,a("#canvas_bg_url").val());var e=a("#lang_select").val();e!==a.pref("lang")&&c.putLocale(e,B),Lb(a("#iconsize").val()),k.gridSnapping=a("#grid_snapping_on")[0].checked,k.snappingStep=a("#grid_snapping_step").val(),k.gridColor=a("#grid_color").val(),k.showRulers=a("#show_rulers")[0].checked,a("#rulers").toggle(k.showRulers),k.showRulers&&r(),k.baseUnit=a("#base_unit").val(),d.setConfig(k),rb(),Zc()},ad=a.noop,bd=function(){return a("#dialog_box").hide(),ab||bb||cb?(ab?V!==a("#svg_source_textarea").val()?a.confirm(n.notification.QignoreSourceChanges,function(a){a&&Wc()}):Wc():bb?Yc():cb&&Zc(),void ad()):void(db&&d.leaveContext())},cd={width:a(window).width(),height:a(window).height()};if(svgedit.browser.isIE()&&!function(){ad=function(){0===P[0].scrollLeft&&0===P[0].scrollTop&&(P[0].scrollLeft=I.left,P[0].scrollTop=I.top)},I={left:P[0].scrollLeft,top:P[0].scrollTop},a(window).resize(ad),svgEditor.ready(function(){setTimeout(function(){ad()},500)}),P.scroll(function(){I={left:P[0].scrollLeft,top:P[0].scrollTop}})}(),a(window).resize(function(){a.each(cd,function(b,c){var d=a(window)[b]();P[0]["scroll"+("width"===b?"Left":"Top")]-=(d-c)/2,cd[b]=d}),Gb()}),function(){P.scroll(function(){0!=a("#ruler_x").length&&(a("#ruler_x")[0].scrollLeft=P[0].scrollLeft),0!=a("#ruler_y").length&&(a("#ruler_y")[0].scrollTop=P[0].scrollTop)})}(),a("#url_notice").click(function(){a.alert(this.title)}),a("#change_image_url").click(q),function(){var b=["clear","open","save","source","delete","delete_multi","paste","clone","clone_multi","move_top","move_bottom"],c="",d="tool_button_current";a.each(b,function(a,d){c+="#tool_"+d+(a==b.length-1?",":"")}),a(c).mousedown(function(){a(this).addClass(d)}).bind("mousedown mouseout",function(){a(this).removeClass(d)}),a("#tool_undo, #tool_redo").mousedown(function(){a(this).hasClass("disabled")||a(this).addClass(d)}).bind("mousedown mouseout",function(){a(this).removeClass(d)})}(),svgedit.browser.isMac()&&!window.opera){var dd=["tool_clear","tool_save","tool_source","tool_undo","tool_redo","tool_clone"];for(X=dd.length;X--;){var ed=document.getElementById(dd[X]);if(ed){var fd=ed.title,gd=fd.indexOf("Ctrl+");ed.title=[fd.substr(0,gd),"Cmd+",fd.substr(gd+5)].join("")}}}var hd=function(b){var c="stroke_color"==b.attr("id")?"stroke":"fill",e=W[c].paint,f="stroke"==c?"Pick a Stroke Paint and Opacity":"Pick a Fill Paint and Opacity",g=b.offset();a("#color_picker").draggable({cancel:".jGraduate_tabs, .jGraduate_colPick, .jGraduate_gradPick, .jPicker",containment:"window"}).css(k.colorPickerCSS||{left:g.left-140,bottom:40}).jGraduate({paint:e,window:{pickerTitle:f},images:{clientPath:k.jGraduatePath},newstop:"inverse"},function(b){e=new a.jGraduate.Paint(b),W[c].setPaint(e),d.setPaint(c,e),a("#color_picker").hide()},function(){a("#color_picker").hide()})},id=function(b,c){var e,f,g=k["fill"===c?"initFill":"initStroke"],h=(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg"><rect width="16.5" height="16.5"					fill="#'+g.color+'" opacity="'+g.opacity+'"/>					<defs><linearGradient id="gradbox_"/></defs></svg>',"text/xml"),i=h.documentElement;i=a(b)[0].appendChild(document.importNode(i,!0)),i.setAttribute("width",16.5),this.rect=i.firstChild,this.defs=i.getElementsByTagName("defs")[0],this.grad=this.defs.firstChild,this.paint=new a.jGraduate.Paint({solidColor:g.color}),this.type=c,this.setPaint=function(a,b){this.paint=a;var c="none",g=a.type,h=a.alpha/100;switch(g){case"solidColor":c="none"!=a[g]?"#"+a[g]:a[g];break;case"linearGradient":case"radialGradient":this.defs.removeChild(this.grad),this.grad=this.defs.appendChild(a[g]);var i=this.grad.id="gradbox_"+this.type;c="url(#"+i+")"}this.rect.setAttribute("fill",c),this.rect.setAttribute("opacity",h),b&&(d.setColor(this.type,e,!0),d.setPaintOpacity(this.type,f,!0))},this.update=function(a){if($){var b,c,g=this.type;switch($.tagName){case"use":case"image":case"foreignObject":return;case"g":case"a":var h=null,i=$.getElementsByTagName("*");for(b=0,c=i.length;c>b;b++){var j=i[b],k=j.getAttribute(g);if(0===b)h=k;else if(h!==k){h=null;break}}if(null===h)return void(e=null);e=h,f=1;break;default:f=parseFloat($.getAttribute(g+"-opacity")),isNaN(f)&&(f=1);var l="fill"===g?"black":"none";e=$.getAttribute(g)||l}a&&(d.setColor(g,e,!0),d.setPaintOpacity(g,f,!0)),f*=100;var m=Pb(e,f,g);this.setPaint(m)}},this.prep=function(){var b=this.paint.type;switch(b){case"linearGradient":case"radialGradient":var e=new a.jGraduate.Paint({copy:this.paint});d.setPaint(c,e)}}};W.fill=new id("#fill_color","fill"),W.stroke=new id("#stroke_color","stroke"),a("#stroke_width").val(k.initStroke.width),a("#group_opacity").val(100*k.initOpacity);var jd=W.fill.rect.cloneNode(!1);jd.setAttribute("style","vector-effect:non-scaling-stroke"),E="non-scaling-stroke"===jd.style.vectorEffect,jd.removeAttribute("style");var kd=W.fill.rect.ownerDocument,ld=kd.createElementNS(svgedit.NS.SVG,"feGaussianBlur");void 0===ld.stdDeviationX&&a("#tool_blur").hide(),a(ld).remove(),function(){var a="-"+Jb.toLowerCase()+"-zoom-",b=a+"in";P.css("cursor",b),P.css("cursor")===b&&(S=b,T=a+"out"),P.css("cursor","auto")}(),setTimeout(function(){d.embedImage("images/logo.png",function(b){b||(a("#image_save_opts [value=embed]").attr("disabled","disabled"),a("#image_save_opts input").val(["ref"]),a.pref("img_save","ref"),a("#image_opt_embed").css("color","#666").attr("title",n.notification.featNotSupported))})},1e3),a("#fill_color, #tool_fill .icon_label").click(function(){hd(a("#fill_color")),sb()}),a("#stroke_color, #tool_stroke .icon_label").click(function(){hd(a("#stroke_color")),sb()}),a("#group_opacityLabel").click(function(){a("#opacity_dropdown button").mousedown(),a(window).mouseup()}),a("#zoomLabel").click(function(){a("#zoom_dropdown button").mousedown(),a(window).mouseup()}),a("#tool_move_top").mousedown(function(b){a("#tools_stacking").show(),b.preventDefault()}),a(".layer_button").mousedown(function(){a(this).addClass("layer_buttonpressed")}).mouseout(function(){a(this).removeClass("layer_buttonpressed")}).mouseup(function(){a(this).removeClass("layer_buttonpressed")}),a(".push_button").mousedown(function(){a(this).hasClass("disabled")||a(this).addClass("push_button_pressed").removeClass("push_button")}).mouseout(function(){a(this).removeClass("push_button_pressed").addClass("push_button")}).mouseup(function(){a(this).removeClass("push_button_pressed").addClass("push_button")}),a("#layer_new").click(function(){var b,c=d.getCurrentDrawing().getNumLayers();do b=n.layers.layer+" "+ ++c;while(d.getCurrentDrawing().hasLayer(b));a.prompt(n.notification.enterUniqueLayerName,b,function(b){if(b){if(d.getCurrentDrawing().hasLayer(b))return void a.alert(n.notification.dupeLayerName);d.createLayer(b),ub(),hb()}})}),a("#layer_delete").click(s),a("#layer_up").click(function(){v(-1)}),a("#layer_down").click(function(){v(1)}),a("#layer_rename").click(function(){var b=a("#layerlist tr.layersel td.layername").text();a.prompt(n.notification.enterNewLayerName,"",function(c){if(c){if(b==c||d.getCurrentDrawing().hasLayer(c))return void a.alert(n.notification.layerHasThatName);d.renameCurrentLayer(c),hb()}})});var md=300,nd=150,od=-1,pd=!1,qd=!1,rd=function(b){var c=a("#ruler_x");a("#sidepanels").width("+="+b),a("#layerpanel").width("+="+b),c.css("right",parseInt(c.css("right"),10)+b),P.css("right",parseInt(P.css("right"),10)+b),d.runExtensions("workareaResized")},sd=function(b){if(qd&&-1!=od){pd=!0;var c=od-b.pageX,d=a("#sidepanels").width();d+c>md?(c=md-d,d=md):2>d+c&&(c=2-d,d=2),0!=c&&(od-=c,rd(c))}},td=function(b){var c=a("#sidepanels").width(),d=(c>2||b?2:nd)-c;rd(d)};a("#sidepanel_handle").mousedown(function(b){od=b.pageX,a(window).mousemove(sd),qd=!1,setTimeout(function(){qd=!0},20)}).mouseup(function(){pd||td(),od=-1,pd=!1}),a(window).mouseup(function(){od=-1,pd=!1,a("#svg_editor").unbind("mousemove",sd)}),hb();var ud=function(){P.css("line-height",P.height()+"px")};a(window).bind("load resize",ud),a("#resolution").change(function(){var b=a("#canvas_width,#canvas_height");if(this.selectedIndex)if("content"==this.value)b.val("fit").attr("disabled","disabled");else{var c=this.value.split("x");a("#canvas_width").val(c[0]),a("#canvas_height").val(c[1]),b.removeAttr("disabled")}else"fit"==a("#canvas_width").val()&&b.removeAttr("disabled").val(100)}),a("input,select").attr("autocomplete","off"),H=function(){var b=[{sel:"#tool_select",fn:ob,evt:"click",key:["V",!0]},{sel:"#tool_fhpath",fn:ac,evt:"click",key:["Q",!0]},{sel:"#tool_line",fn:bc,evt:"click",key:["L",!0]},{sel:"#tool_rect",fn:dc,evt:"mouseup",key:["R",!0],parent:"#tools_rect",icon:"rect"},{sel:"#tool_square",fn:cc,evt:"mouseup",parent:"#tools_rect",icon:"square"},{sel:"#tool_fhrect",fn:ec,evt:"mouseup",parent:"#tools_rect",icon:"fh_rect"},{sel:"#tool_ellipse",fn:gc,evt:"mouseup",key:["E",!0],parent:"#tools_ellipse",icon:"ellipse"},{sel:"#tool_circle",fn:fc,evt:"mouseup",parent:"#tools_ellipse",icon:"circle"},{sel:"#tool_fhellipse",fn:hc,evt:"mouseup",parent:"#tools_ellipse",icon:"fh_ellipse"},{sel:"#tool_path",fn:nc,evt:"click",key:["P",!0]},{sel:"#tool_text",fn:mc,evt:"click",key:["T",!0]},{sel:"#tool_image",fn:ic,evt:"mouseup"},{sel:"#tool_zoom",fn:jc,evt:"mouseup",key:["Z",!0]},{sel:"#tool_clear",fn:Hc,evt:"mouseup",key:["N",!0]},{sel:"#tool_save",fn:function(){ab?Xc():Kc()},evt:"mouseup",key:["S",!0]},{sel:"#tool_export",fn:Lc,evt:"mouseup"},{sel:"#tool_open",fn:Mc,evt:"mouseup",key:["O",!0]},{sel:"#tool_import",fn:Nc,evt:"mouseup"},{sel:"#tool_source",fn:ib,evt:"click",key:["U",!0]},{sel:"#tool_wireframe",fn:Tc,evt:"click",key:["F",!0]},{sel:"#tool_source_cancel,.overlay,#tool_docprops_cancel,#tool_prefs_cancel",fn:bd,evt:"click",key:["esc",!1,!1],hidekey:!0},{sel:"#tool_source_save",fn:Xc,evt:"click"},{sel:"#tool_docprops_save",fn:$c,evt:"click"},{sel:"#tool_docprops",fn:Uc,evt:"mouseup"},{sel:"#tool_prefs_save",fn:_c,evt:"click"},{sel:"#tool_prefs_option",fn:function(){return Vc(),!1},evt:"mouseup"},{sel:"#tool_delete,#tool_delete_multi",fn:oc,evt:"click",key:["del/backspace",!0]},{sel:"#tool_reorient",fn:wc,evt:"click"},{sel:"#tool_node_link",fn:zc,evt:"click"},{sel:"#tool_node_clone",fn:Ac,evt:"click"},{sel:"#tool_node_delete",fn:Bc,evt:"click"},{sel:"#tool_openclose_path",fn:Dc,evt:"click"},{sel:"#tool_add_subpath",fn:Cc,evt:"click"},{sel:"#tool_move_top",fn:sc,evt:"click",key:"ctrl+shift+]"},{sel:"#tool_move_bottom",fn:tc,evt:"click",key:"ctrl+shift+["},{sel:"#tool_topath",fn:vc,evt:"click"},{sel:"#tool_make_link,#tool_make_link_multi",fn:xc,evt:"click"},{sel:"#tool_undo",fn:Oc,evt:"click",key:["Z",!0]},{sel:"#tool_redo",fn:Pc,evt:"click",key:["Y",!0]},{sel:"#tool_clone,#tool_clone_multi",fn:Rc,evt:"click",key:["D",!0]},{sel:"#tool_group_elements",fn:Qc,evt:"click",key:["G",!0]},{sel:"#tool_ungroup",fn:Qc,evt:"click"},{sel:"#tool_unlink_use",fn:Qc,evt:"click"},{sel:"[id^=tool_align]",fn:Sc,evt:"click"},{sel:"#tool_bold",fn:Ic,evt:"mousedown"},{sel:"#tool_italic",fn:Jc,evt:"mousedown"},{sel:"#sidepanel_handle",fn:td,key:["X"]},{sel:"#copy_save_done",fn:bd,evt:"click"},{key:"ctrl+left",fn:function(){Gc(0,1)}},{key:"ctrl+right",fn:function(){Gc(1,1)}},{key:"ctrl+shift+left",fn:function(){Gc(0,5)}},{key:"ctrl+shift+right",fn:function(){Gc(1,5)}},{key:"shift+O",fn:Fc},{key:"shift+P",fn:Ec},{key:[K+"up",!0],fn:function(){kc(2)}},{key:[K+"down",!0],fn:function(){kc(.5)}},{key:[K+"]",!0],fn:function(){uc("Up")}},{key:[K+"[",!0],fn:function(){uc("Down")}},{key:["up",!0],fn:function(){yc(0,-1)}},{key:["down",!0],fn:function(){yc(0,1)}},{key:["left",!0],fn:function(){yc(-1,0)}},{key:["right",!0],fn:function(){yc(1,0)}},{key:"shift+up",fn:function(){yc(0,-10)}},{key:"shift+down",fn:function(){yc(0,10)}},{key:"shift+left",fn:function(){yc(-10,0)}},{key:"shift+right",fn:function(){yc(10,0)}},{key:["alt+up",!0],fn:function(){d.cloneSelectedElements(0,-1)}},{key:["alt+down",!0],fn:function(){d.cloneSelectedElements(0,1)}},{key:["alt+left",!0],fn:function(){d.cloneSelectedElements(-1,0)}},{key:["alt+right",!0],fn:function(){d.cloneSelectedElements(1,0)}},{key:["alt+shift+up",!0],fn:function(){d.cloneSelectedElements(0,-10)}},{key:["alt+shift+down",!0],fn:function(){d.cloneSelectedElements(0,10)}},{key:["alt+shift+left",!0],fn:function(){d.cloneSelectedElements(-10,0)}},{key:["alt+shift+right",!0],fn:function(){d.cloneSelectedElements(10,0)}},{key:"A",fn:function(){d.selectAllInCurrentLayer()}},{key:K+"z",fn:Oc},{key:K+"shift+z",fn:Pc},{key:K+"y",fn:Pc},{key:K+"x",fn:pc},{key:K+"c",fn:qc},{key:K+"v",fn:rc}],c={"4/Shift+4":"#tools_rect_show","5/Shift+5":"#tools_ellipse_show"};return{setAll:function(){var d={};a.each(b,function(b,e){var f;if(e.sel){if(f=a(e.sel),0==f.length)return!0;if(e.evt&&(svgedit.browser.isTouch()&&"click"===e.evt&&(e.evt="mousedown"),f[e.evt](e.fn)),e.parent&&0!=a(e.parent+"_show").length){var g=a(e.parent);g.length||(g=Ib(e.parent.substr(1))),g.append(f),a.isArray(d[e.parent])||(d[e.parent]=[]),d[e.parent].push(e)}}if(e.key){var h,i=!0,j=e.fn,k=!1;if(a.isArray(e.key)?(h=e.key[0],e.key.length>1&&(k=e.key[1]),e.key.length>2&&(i=e.key[2])):h=e.key,h+="",a.each(h.split("/"),function(b,c){a(document).bind("keydown",c,function(a){return j(),k&&a.preventDefault(),!1})}),e.sel&&!e.hidekey&&f.attr("title")){var l=f.attr("title").split("[")[0]+" ("+h+")";c[h]=e.sel,f.parents("#main_menu").length||f.attr("title",l)
}}}),Hb(d),a(".attr_changer, #image_url").bind("keydown","return",function(b){a(this).change(),b.preventDefault()}),a(window).bind("keydown","tab",function(a){"canvas"===U&&(a.preventDefault(),Ec())}).bind("keydown","shift+tab",function(a){"canvas"===U&&(a.preventDefault(),Fc())}),a("#tool_zoom").dblclick(lc)},setTitles:function(){a.each(c,function(b,c){var d=a(c).parents("#main_menu").length;a(c).each(function(){var c;c=d?a(this).text().split(" [")[0]:this.title.split(" [")[0];var e="";a.each(b.split("/"),function(a,b){var c=b.split("+"),d="";c.length>1&&(d=c[0]+"+",b=c[1]),e+=(a?"/":"")+d+(n["key_"+b]||b)}),d?this.lastChild.textContent=c+" ["+e+"]":this.title=c+" ["+e+"]"})})},getButtonData:function(c){var d;return a.each(b,function(a,b){b.sel===c&&(d=b)}),d}}}(),H.setAll(),c.ready(function(){var b,c=k.initTool,d=a("#tools_left, #svg_editor .tools_flyout"),e=d.find("#tool_"+c),f=d.find("#"+c);b=e.length?e:f.length?f:a("#tool_select"),b.click().mouseup(),k.wireframe&&a("#tool_wireframe").click(),k.showlayers&&td(),a("#rulers").toggle(!!k.showRulers),k.showRulers&&(a("#show_rulers")[0].checked=!0),k.baseUnit&&a("#base_unit").val(k.baseUnit),k.gridSnapping&&(a("#grid_snapping_on")[0].checked=!0),k.snappingStep&&a("#grid_snapping_step").val(k.snappingStep),k.gridColor&&a("#grid_color").val(k.gridColor)}),a("#rect_rx").SpinButton({min:0,max:1e3,callback:Ub}),a("#stroke_width").SpinButton({min:0,max:99,smallStep:.1,callback:Wb}),a("#angle").SpinButton({min:-180,max:180,step:5,callback:Xb}),a("#font_size").SpinButton({min:.001,stepfunc:w,callback:Vb}),a("#group_opacity").SpinButton({min:0,max:100,step:5,callback:Yb}),a("#blur").SpinButton({min:0,max:10,step:.1,callback:Zb}),a("#zoom").SpinButton({min:.001,max:1e4,step:50,stepfunc:x,callback:G}).val(100*d.getZoom()),a("#workarea").contextMenu({menu:"cmenu_canvas",inSpeed:0},function(a){switch(a){case"delete":oc();break;case"cut":pc();break;case"copy":qc();break;case"paste":d.pasteElements();break;case"paste_in_place":d.pasteElements("in_place");break;case"group_elements":d.groupSelectedElements();break;case"ungroup":d.ungroupSelectedElement();break;case"move_front":sc();break;case"move_up":uc("Up");break;case"move_down":uc("Down");break;case"move_back":tc();break;default:svgedit.contextmenu&&svgedit.contextmenu.hasCustomHandler(a)&&svgedit.contextmenu.getCustomHandler(a).call()}d.clipBoard.length&&Q.enableContextMenuItems("#paste,#paste_in_place")});var vd=function(a){switch(a){case"dupe":t();break;case"delete":s();break;case"merge_down":u();break;case"merge_all":d.mergeAllLayers(),ub(),hb()}};if(a("#layerlist").contextMenu({menu:"cmenu_layers",inSpeed:0},vd),a("#layer_moreopts").contextMenu({menu:"cmenu_layers",inSpeed:0,allowLeft:!0},vd),a(".contextMenu li").mousedown(function(a){a.preventDefault()}),a("#cmenu_canvas li").disableContextMenu(),Q.enableContextMenuItems("#delete,#cut,#copy"),window.addEventListener("beforeunload",function(a){return 0===M.getUndoStackSize()&&(c.showSaveWarning=!1),!k.no_save_warning&&c.showSaveWarning?(a.returnValue=n.notification.unsavedChanges,n.notification.unsavedChanges):void 0},!1),c.openPrep=function(b){a("#main_menu").hide(),0===M.getUndoStackSize()?b(!0):a.confirm(n.notification.QwantToOpen,b)},window.FileReader){var wd=function(b){a.process_cancel(n.notification.loadingImage),b.stopPropagation(),b.preventDefault(),a("#workarea").removeAttr("style"),a("#main_menu").hide();var c="drop"==b.type?b.dataTransfer.files[0]:this.files[0];if(c&&-1!=c.type.indexOf("image")){var e;-1!=c.type.indexOf("svg")?(e=new FileReader,e.onloadend=function(a){d.importSvgString(a.target.result,!0),d.ungroupSelectedElement(),d.ungroupSelectedElement(),d.groupSelectedElements(),d.alignSelectedElements("m","page"),d.alignSelectedElements("c","page")},e.readAsText(c)):(e=new FileReader,e.onloadend=function(a){var b=function(b,c){var e=d.addSvgElementFromJson({element:"image",attr:{x:0,y:0,width:b,height:c,id:d.getNextId(),style:"pointer-events:inherit"}});d.setHref(e,a.target.result),d.selectOnly([e]),d.alignSelectedElements("m","page"),d.alignSelectedElements("c","page"),ub()},c=100,e=100,f=new Image;f.src=a.target.result,f.style.opacity=0,f.onload=function(){c=f.offsetWidth,e=f.offsetHeight,b(c,e)}},e.readAsDataURL(c))}};P[0].addEventListener("dragenter",y,!1),P[0].addEventListener("dragover",z,!1),P[0].addEventListener("dragleave",A,!1),P[0].addEventListener("drop",wd,!1);var xd=a('<input type="file">').change(function(){var e=this;c.openPrep(function(c){if(c&&(d.clear(),1==e.files.length)){a.process_cancel(n.notification.loadingImage);var f=new FileReader;f.onloadend=function(a){b(a.target.result),rb()},f.readAsText(e.files[0])}})});a("#tool_open").show().prepend(xd);var yd=a('<input type="file">').change(wd);a("#tool_import").show().prepend(yd)}rb(!0);try{window.addEventListener("message",function(a){if("string"==typeof a.data&&"|"!==a.data.charAt()){var b=JSON.parse(a.data);if(b&&"object"==typeof b&&"svgCanvas"===b.namespace){var c=b.id,e=b.name,f=b.args;try{a.source.postMessage(JSON.stringify({namespace:"svg-edit",id:c,result:d[e].apply(d,f)}),"*")}catch(g){a.source.postMessage(JSON.stringify({namespace:"svg-edit",id:c,error:g.message}),"*")}}}},!1)}catch(zd){window.embed_error=zd}a(function(){window.svgCanvas=d,d.ready=svgEditor.ready}),c.setLang=function(b,e){if(c.langChanged=!0,a.pref("lang",b),a("#lang_select").val(b),e){var f=a("#layerlist tr.layersel td.layername").text(),g=f==n.common.layer+" 1";if(a.extend(n,e),d.setUiStrings(e),H.setTitles(),g&&(d.renameCurrentLayer(n.common.layer+" 1"),hb()),Nb.length)for(;Nb.length;){var h=Nb.shift();h.langReady({lang:b,uiStrings:n})}else d.runExtensions("langReady",{lang:b,uiStrings:n});d.runExtensions("langChanged",b),Fb();var i={"#stroke_color":"#tool_stroke .icon_label, #tool_stroke .color_block","#fill_color":"#tool_fill label, #tool_fill .color_block","#linejoin_miter":"#cur_linejoin","#linecap_butt":"#cur_linecap"};a.each(i,function(b,c){a(c).attr("title",a(b)[0].title)}),a("#multiselected_panel div[id^=tool_align]").each(function(){a("#tool_pos"+this.id.substr(10))[0].title=this.title})}}},c.ready=function(a){f?a():g.push(a)},c.runCallbacks=function(){a.each(g,function(){this()}),f=!0},c.loadFromString=function(a){c.ready(function(){b(a)})},c.disableUI=function(){},c.loadFromURL=function(d,e){e||(e={});var f=e.cache,g=e.callback;c.ready(function(){a.ajax({url:d,dataType:"text",cache:!!f,beforeSend:function(){a.process_cancel(n.notification.loadingImage)},success:function(a){b(a,g)},error:function(c,d,e){404!=c.status&&c.responseText?b(c.responseText,g):a.alert(n.notification.URLloadFail+": \n"+e,g)},complete:function(){a("#dialog_box").hide()}})})},c.loadFromDataURI=function(a){c.ready(function(){var c="data:image/svg+xml;base64,",d=a.substring(c.length);b(svgedit.utilities.decode64(d))})},c.addExtension=function(){var b=arguments;a(function(){d&&d.addExtension.apply(this,b)})},c}(jQuery),$(svgEditor.init))}();
Biojs.AreaSelector=Biojs.extend({constructor:function(){var a=this;$("#"+a.opt.target).css("position","relative");var b="<div class='selector'>";a.opt.resize_left&&(b+="<div class='scaler left'></div>"),a.opt.resize_right&&(b+="<div class='scaler right'></div>"),a.opt.resize_top&&(b+="<div class='scaler top'></div>"),a.opt.resize_bottom&&(b+="<div class='scaler bottom'></div>"),b+="<div>",$("#"+a.opt.target).append(b),$("#"+a.opt.target+" .selector .right").draggable({axis:"x",start:function(){a.updateScalers(),$(this).parent().css("border-right-width","0px")},stop:function(){$("#"+a.opt.target+" .selector").width(a._removePx($(this).css("left"))+5),$(this).parent().css("border-right-width","1px"),a.updateScalers(),a.raiseEvent("onRegionChanged",{region:a.getCoveredArea()})}}),$("#"+a.opt.target+" .selector .left").draggable({axis:"x",start:function(){a.updateScalers(),$(this).parent().css("border-left-width","0px")},stop:function(){var b=$(this).position().left+5;$("#"+a.opt.target+" .selector").width($("#"+a.opt.target+" .selector").width()-b),$("#"+a.opt.target+" .selector").css("left",$(this).parent().position().left+b+"px"),$(this).parent().css("border-left-width","1px"),a.updateScalers(),a.raiseEvent("onRegionChanged",{region:a.getCoveredArea()})}}),$("#"+a.opt.target+" .selector .bottom").draggable({axis:"y",start:function(){a.updateScalers(),$(this).parent().css("border-bottom-width","0px")},stop:function(){$("#"+a.opt.target+" .selector").height(a._removePx($(this).css("top"))+5),$(this).parent().css("border-bottom-width","1px"),a.updateScalers(),a.raiseEvent("onRegionChanged",{region:a.getCoveredArea()})}}),$("#"+a.opt.target+" .selector .top").draggable({axis:"y",start:function(){a.updateScalers(),$(this).parent().css("border-top-width","0px")},stop:function(){var b=$(this).position().top+5;$("#"+a.opt.target+" .selector").height($("#"+a.opt.target+" .selector").height()-b),$("#"+a.opt.target+" .selector").css("top",$(this).parent().position().top+b+"px"),$(this).parent().css("border-top-width","1px"),a.updateScalers(),a.raiseEvent("onRegionChanged",{region:a.getCoveredArea()})}}),$("#"+a.opt.target).watch("left,top,width,height,display",function(){a.updateScalers()},100,"_containerMove"),a.updateScalers(),a.setCoveredArea(a.opt.area)},opt:{target:"YourOwnDivId",resize_left:!0,resize_right:!0,resize_top:!0,resize_bottom:!0,area:[0,0,50,50]},eventTypes:["onRegionChanged"],getCoveredArea:function(){var a=this;return[$("#"+a.opt.target+" .selector").position().left,$("#"+a.opt.target+" .selector").position().top,$("#"+a.opt.target+" .selector").position().left+$("#"+a.opt.target+" .selector").width(),$("#"+a.opt.target+" .selector").position().top+$("#"+a.opt.target+" .selector").height()]},setCoveredArea:function(a){var b=this;$("#"+b.opt.target+" .selector").css("left",a[0]+"px"),$("#"+b.opt.target+" .selector").css("top",a[1]+"px"),$("#"+b.opt.target+" .selector").width(a[2]-a[0]),$("#"+b.opt.target+" .selector").height(a[3]-a[1]),b.updateScalers(),b.raiseEvent("onRegionChanged",{region:b.getCoveredArea()})},updateScalers:function(){var a=this;$("#"+a.opt.target+" .selector .left").css("left","-5px"),$("#"+a.opt.target+" .selector .left").css("top",$("#"+a.opt.target+" .selector").height()/2-5),$("#"+a.opt.target+" .selector .right").css("left",$("#"+a.opt.target+" .selector").width()-5),$("#"+a.opt.target+" .selector .right").css("top",$("#"+a.opt.target+" .selector").height()/2-5),$("#"+a.opt.target+" .selector .top").css("left",$("#"+a.opt.target+" .selector").width()/2-5),$("#"+a.opt.target+" .selector .top").css("top","-5px"),$("#"+a.opt.target+" .selector .bottom").css("left",$("#"+a.opt.target+" .selector").width()/2-5),$("#"+a.opt.target+" .selector .bottom").css("top",$("#"+a.opt.target+" .selector").height()-5),$("#"+a.opt.target+" .selector .right").draggable("option","containment",[$("#"+a.opt.target+" .selector").offset().left-3,$("#"+a.opt.target).offset().top,$("#"+a.opt.target).offset().left+$("#"+a.opt.target).width()-4,$("#"+a.opt.target).offset().top+$("#"+a.opt.target).height()]),$("#"+a.opt.target+" .selector .left").draggable("option","containment",[$("#"+a.opt.target).offset().left-4,$("#"+a.opt.target).offset().top,$("#"+a.opt.target+" .selector").offset().left+$("#"+a.opt.target+" .selector").width()-5,$("#"+a.opt.target).offset().top+$("#"+a.opt.target).height()]),$("#"+a.opt.target+" .selector .bottom").draggable("option","containment",[$("#"+a.opt.target).offset().left,$("#"+a.opt.target+" .selector").offset().top-3,$("#"+a.opt.target).offset().left+$("#"+a.opt.target).width(),$("#"+a.opt.target).offset().top+$("#"+a.opt.target).height()-4]),$("#"+a.opt.target+" .selector .top").draggable("option","containment",[$("#"+a.opt.target).offset().left,$("#"+a.opt.target).offset().top-4,$("#"+a.opt.target).offset().left+$("#"+a.opt.target).width()-4,$("#"+a.opt.target+" .selector").offset().top+$("#"+a.opt.target+" .selector").height()-5])},_removePx:function(a){return 1*a.substr(0,a.length-2)}}),Biojs.AutocompleteOLS=Biojs.extend({constructor:function(){var a=this;if(this._container=jQuery("#"+a.opt.target),this._container.append(jQuery("<input style='width: 300px;' type='text' name='query' id='local-searchbox' class='ac_input'>")),void 0==$)throw"jQuery not loaded";$(function(){var b=function(){$(this).attr("autocomplete","off")},c=function(){$(this).removeAttr("autocomplete")};$("#local-searchbox").autocomplete("http://www.ebi.ac.uk/ontology-lookup/term.view",{matchContains:!1,selectFirst:!1,scroll:!0,max:50,requestTreeUrl:"http://www.ebi.ac.uk/ontology-lookup/json/termchildren",ontologyId:a.opt.ontology}).focus(b).blur(c).removeAttr("autocomplete")})},opt:{target:"",ontology:"EFO"},eventTypes:[]}),Biojs.ChEBICompound=Biojs.extend({constructor:function(){var a,b,c=this,d=this.opt.width,e=this.opt.height;"string"==typeof this.opt.target?this._container=jQuery("#"+this.opt.target):(this.opt.target="biojs_ChEBICompound_"+this.getId(),this._container=jQuery('<div id="'+c.opt.target+'"></div>')),this._container.html("").addClass("ChEBICompound"),void 0==d?d=this._container.css("width"):this._container.width(d),void 0==e?e=this._container.css("height"):this._container.height(e),this._container.html(""),this._imageContainer=jQuery('<div class="ChEBICompound_image"></div>').appendTo(this._container),this._tabContainer=jQuery('<div class="ChEBICompound_tab"></div>').appendTo(this._container),this._summaryContainer=this._buildTabPanel(this._tabContainer,function(){}),a=this._imageContainer.width(),b=this._imageContainer.height(),this.opt.imageDimension=b>a?a:b,void 0!==this.opt.id&&this.setId(this.opt.id)},opt:{target:"YourOwnDivId",id:void 0,imageUrl:"http://www.ebi.ac.uk/chebi/displayImage.do",chebiDetailsUrl:"http://www.ebi.ac.uk/webservices/chebi/2.0/test/getCompleteEntity?chebiId=",proxyUrl:"../biojs/dependencies/proxy/proxy.php",height:void 0,width:void 0,scale:!1,imageIndex:0},eventTypes:["onRequestError","onImageLoaded"],setId:function(a){var b,c,d=this;this._imageContainer.html(""),this.opt.id=a.replace("CHEBI:",""),this._requestDetails(this.opt);var e={defaultImage:!0,imageIndex:this.opt.imageIndex,chebiId:a,dimensions:this.opt.imageDimension,scaleMolecule:this.opt.scale};b=this.opt.imageUrl+"?"+jQuery.param(e),c=jQuery('<img id="image_'+a+'"/>').load(function(){d._imageContainer.removeClass("noImage"),d._imageContainer.append(c).css({width:d.opt.imageDimension,height:d.opt.imageDimension,margin:"auto"}),d.raiseEvent(Biojs.ChEBICompound.EVT_ON_IMAGE_LOADED,{id:a,url:b})}).error(function(){d._imageContainer.addClass("noImage"),d.raiseEvent(Biojs.ChEBICompound.EVT_ON_REQUEST_ERROR,{id:a,url:b,message:"No image available"})}).attr("src",b)},_requestDetails:function(a){var b=this,c=a.chebiDetailsUrl+a.id;Biojs.console.log("Requesting summary from: "+c);var d={url:c,method:"GET",success:function(a){b._dataReceived(a)},error:function(a,c){Biojs.console.log("ERROR requesting summary. Response: "+c),b.raiseEvent(Biojs.ChEBICompound.EVT_ON_REQUEST_ERROR,{message:c})}};void 0!=a.proxyUrl&&(d.url=a.proxyUrl,d.data=[{name:"url",value:c}]),d.dataType="text",jQuery.ajax(d)},_dataReceived:function(a){var b={};return Biojs.console.log("Data received"),a.length>0&&(xmlDoc=jQuery.parseXML(a),xmlResult=jQuery(xmlDoc).find("return"),b.chebiAsciiName={name:"Name",value:xmlResult.find(" > chebiAsciiName").text()},b.chebiId={name:"Identifier",value:xmlResult.find("> chebiId").text()},b.definition={name:"Definition",value:xmlResult.find("> definition").text()},b.SecondaryChEBIIds={name:"Other Identifiers",value:xmlResult.find(" > SecondaryChEBIIds").text()},b.entityStar={name:"Stars",value:xmlResult.find(" > entityStar").text()}),this._setSummary(b),b},_setSummary:function(a){Biojs.console.log("_setSummary()");var b=this._summaryContainer;if(b.children().remove(),Biojs.Utils.isEmpty(a))b.append("Not information available");else{for(key in a)a[key].value.length>0&&("entityStar"==key?(jQuery("<h2>"+a[key].name+"</h2>").appendTo(b),jQuery('<div class="star"/>').appendTo(b).css({width:16*parseInt(a[key].value),padding:0})):b.append("<h2>"+a[key].name+"</h2><p>"+a[key].value+"</p>"));this.raiseEvent(Biojs.ChEBICompound.EVT_ON_SUMMARY_LOADED,{id:a.Identifier})}Biojs.console.log("_setSummary done")},_buildTabPanel:function(a,b){a.html("");var c=jQuery('<div class="content"></div>').appendTo(a),d=(jQuery('<div style="display: none;" class="toggle expand"></div>').appendTo(a),jQuery('<div class="toggle collapse"/>').appendTo(a)),e=parseInt(jQuery(".toggle").css("width"),10),f=a.width()-e;return a.css("left",0).find(".toggle").click(function(){a.animate({left:(0==parseInt(a.css("left"),10)?e-a.outerWidth():0)+"px"},function(){var c=0==parseInt(a.css("left"),10)?a.width():e;a.find(".toggle").toggle(),"function"==typeof b&&b.call(this,d.is(":visible"),c)})}).css({"float":"right",position:"relative"}),Biojs.console.log("content width "+f),c.css({width:f+"px",height:a.height()+"px","word-wrap":"break-word"}),c},getHTML:function(){return this._container}},{EVT_ON_IMAGE_LOADED:"onImageLoaded",EVT_ON_SUMMARY_LOADED:"onSummaryLoaded",EVT_ON_REQUEST_ERROR:"onRequestError"}),Biojs.ChEMBLCompound=Biojs.extend({constructor:function(){Biojs.console.enable(),jQuery("#"+this.opt.target).css("padding","0px").css("width",this.opt.width).css("height",this.opt.height).css("overflow","hidden"),void 0!==this.opt.id&&this.setId(this.opt.id)},opt:{target:"YourOwnDivId",id:void 0,imageUrl:"https://www.ebi.ac.uk/chembldb/index.php/compound/displayimage/",detailsUrl:"https://www.ebi.ac.uk/chemblws/compounds/",proxyUrl:"../biojs/dependencies/proxy/proxy.php",height:400,width:597,scale:!1,imageIndex:0},eventTypes:["onRequestError","onLoadedImage"],setId:function(a){self=this,self.opt.id=a;var b=Math.round(.7*self.opt.width),c=self.opt.imageUrl+a,d='<img id="image_'+a+'" src="'+c+'"   />';jQuery("div#"+this.opt.target).html('<div id="div'+a+'" style="position:relative; float:right;">'+d+'</div><div id="controlSection'+a+'" style="position:relative; float:right;"/>'),jQuery("#image_"+a).load(function(){self.raiseEvent("onLoadedImage",{id:a})}).css("height",self.opt.height).css("width",b),this._requestDetails(a)},_requestDetails:function(a){var b=this;Biojs.console.log("url="+b.opt.detailsUrl+a+".json"),jQuery.ajax({url:b.opt.proxyUrl,dataType:"json",data:"url="+b.opt.detailsUrl+a+".json",success:function(a){Biojs.console.log("SUCCESS: data received from "+this.data),b._buildPanel(a.compounds)},async:!1,error:function(a,c){Biojs.console.log(c),b.raiseEvent("onRequestError",{message:c})}})},_buildPanel:function(a){this._controlsVisible=!1,Biojs.console.log(a);var b=this,c=Math.round(.3*b.opt.width),d=b.opt.height,e=jQuery("#"+b.opt.target+" > div#controlSection"+b.opt.id);e.append('<div id="controls" /><div id="controlTab"><span id="hideButton" title="Hide this control panel">&lt;&lt;</span><span id="showButton" title="Show the control panel">&gt;&gt;</span><br/><br/></div>').css("border",0).css("margin",0).css("width","auto").css("height","auto").css("float","left").css("font-family",'"Heveltica Neue", Arial, "sans serif"').css("font-size","12px");var f=5,g=20,h=d,i=c-(2*f+g),j=d-2*f,k=e.find("div#controls"),l="";for(key in a)a[key].length>0&&(l+="<b>"+key+":</b><br/>"+a[key]+"<br/><br/>");k.css("position","relative").css("border",0).css("margin",0).css("background-color","#000").css("color","#fff").css("float","left").css("width",i).css("height",j).css("padding",f).append(l);var m=e.find("#controlTab");m.css("border",0).css("margin",0).css("padding",0).css("float","left").css("width",g).css("height",h).css("background-color","#000");var n=function(){m.find("span").toggle(),b._controlsVisible?(k.hide(),b._controlsVisible=!1):(k.show(),b._controlsVisible=!0)};b._toggleControls=n,m.find("#hideButton").click(b._toggleControls).mouseover(function(){jQuery(this).css("color","#27C0FF")}).mouseout(function(){jQuery(this).css("color","#fff")}).css("color","#fff").css("display","none").css("cursor","pointer"),m.find("#showButton").click(b._toggleControls).mouseover(function(){jQuery(this).css("color","#27C0FF")}).mouseout(function(){jQuery(this).css("color","#000")}).css("color","#000").css("cursor","pointer"),this._controlsReady=!0,Biojs.console.log("_buildPanel done")}}),Biojs.Chromosome=Biojs.extend({constructor:function(){var a=this;if($("#"+a.opt.target).html('<div id="'+a.opt.target+'_chr"></div>'),$("#"+a.opt.target+"_chr").css("position","relative"),null!=a.opt.dasSource){var b=JSDAS.Simple.getClient(a.opt.dasSource);b.features({segment:a.opt.dasSegment},function(b){a._modelFromDAS(b,a)},a._error_response)}else null!=a.opt.model&&this._process_model(a.opt.model,a)},opt:{target:"chromosome",model:null,dasSource:null,dasSegment:null,includeSelector:!0},eventTypes:["onBandSelection","onSelectorChanged","onModelLoaded","onDASLoadFail"],_error_response:function(){var a=this;$("#"+a.opt.target).append("ERROR querying the DAS source."),a.raiseEvent("onDASLoadFail",{dasSource:a.opt.dasSource,dasSegment:a.opt.dasSegment})},_modelFromDAS:function(a,b){if("undefined"!=typeof b)var c=b;var d=a.GFF.SEGMENT[0].FEATURE,e=(a.GFF.SEGMENT[0].start,a.GFF.SEGMENT[0].stop,{id:a.GFF.SEGMENT[0].id,start:1*a.GFF.SEGMENT[0].start,stop:a.GFF.SEGMENT[0].stop,bands:null}),f=[];for(var g in d){var h=d[g],i=h.TYPE.id.substr(5);"acen"==i&&("p"==h.id[0]?i="p_acen":"q"==h.id[0]&&(i="q_acen")),f.push({start:1*h.START.textContent,stop:1*h.END.textContent,label:h.id,type:i})}e.bands=f,c.opt.model=e,c._process_model(e,c)},_process_model:function(a,b){a.bands.sort(function(a,b){return a.start-b.start});var c="first",d="",e=null,f=null;for(var g in a.bands){var h=a.bands[g];1*g+1==a.bands.length&&(d="last");var i=94*(h.stop-h.start)/a.stop,j=a.id+"_"+h.label;$("#"+b.opt.target+"_chr").append("<div id='"+j+"' title='"+h.label+"' class='band "+h.type+" "+c+d+"' style='width: "+i.toFixed(3)+"%;'></div>"),j=j.replace(/\./gi,"\\."),$("#"+j).click(function(){var c={};for(var d in a.bands)$(this).attr("title")==a.bands[d].label&&(c=a.bands[d]);b.raiseEvent("onBandSelection",{chromosome_id:a.id,band_id:c.label,band_start:c.start,band_stop:c.stop,band_type:c.type}),b.opt.includeSelector&&(b.opt.selector.from=c.start,b.opt.selector.to=c.stop,b.raiseEvent("onSelectorChanged",{chromosome_id:a.id,selector_start:c.stop,selector_stop:c.type}),b._moveSelectorToDivCoordinates($(this).position().left,$(this).position().left+$(this).width()))}),""!=c&&(e=j,f=h.stop),c=""}b.opt.includeSelector&&(b.opt.selector=new Biojs.AreaSelector({target:b.opt.target+"_chr",resize_top:!1,resize_bottom:!1,area:[0,-5,$("#"+e).width(),20]}),b.opt.selector.from=0,b.opt.selector.to=f,b.opt.selector.fromWatcher=!1,b.opt.selector.onRegionChanged(function(a){b.opt.selector.fromWatcher||(b.opt.selector.from=b._getCoordinateFromLeft(a.region[0]),b.opt.selector.to=b._getCoordinateFromLeft(a.region[2]),b.raiseEvent("onSelectorChanged",{chromosome_id:b.opt.model.id,selector_start:b.opt.selector.from,selector_stop:b.opt.selector.to}))}),$("#"+b.opt.target).watch("left,top,width,height,display",function(){b.opt.selector.fromWatcher=!0,null!=b.opt.selector.from&&null!=b.opt.selector.to&&b.moveSelectorToCoordinates(b.opt.selector.from,b.opt.selector.to),b.opt.selector.fromWatcher=!1},100,"_containerMove")),b.raiseEvent("onModelLoaded",{model:a})},selector:null,moveSelectorToCoordinates:function(a,b){var c=this;return null==c.opt.selector?!1:(c.opt.selector.from=a,c.opt.selector.to=b,c._moveSelectorToDivCoordinates(c._getLeftFromCoordinate(a),c._getLeftFromCoordinate(b)),void 0)},_getLeftFromCoordinate:function(a){var b=this,c=null;for(var d in b.opt.model.bands){var e=b.opt.model.bands[d];if(a>=e.start&&a<=e.stop){c=e;break}}if(null!=c){var f=b.opt.model.id+"_"+c.label;f=f.replace(/\./gi,"\\.");var g=$("#"+f).position().left,h=$("#"+f).width(),i=c.start,j=c.stop-c.start;return g+(a-i)*h/j}return!1},_getCoordinateFromLeft:function(a){var b=this;for(var c in b.opt.model.bands){var d=b.opt.model.bands[c],e=b.opt.model.id+"_"+d.label;if(e=e.replace(/\./gi,"\\."),a>=$("#"+e).position().left&&a<=$("#"+e).position().left+$("#"+e).width()){var f=$("#"+e).position().left,g=$("#"+e).width(),h=d.start,i=d.stop-d.start;return h+(a-f)*i/g}}return!1},_moveSelectorToDivCoordinates:function(a,b){var c=this;c.opt.includeSelector&&null!=c.opt.selector&&c.opt.selector.setCoveredArea([a,-5,b,20])}}),Biojs.Cytoscape=Biojs.extend({constructor:function(a){cytoscape(a)},opt:{container:void 0},eventTypes:[]}),Biojs.DNAContentViewer=Biojs.extend({zoomSlider:"",slider_stop:0,slider_start:0,track:[],track_bins:[],width:1,height:1,data_last_start:1,data_first_start:1,max:0,data:[],main_data:[],constructor:function(){var a=this;a.vis=null,a.color=null,a.foci=[],this.track,this.track_bins,this._container=$("#DNAContentFeaturePainter-holder"),$(this._container).addClass("graph"),this._container.css({"font-family":a.opt.fontFamily,"background-color":a.opt.backgroundColor,color:a.opt.fontColor,"font-size":"36px","text-align":"center","vertical-align":"middle",width:"600px",height:"100px",bottom:"0px"}),this._container.css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none"}),this.paintDNAContentContent(a.opt.dataSet)},opt:{target:"YourOwnDivId",dataSet:"",fontFamily:'"Andale mono", courier, monospace',fontColor:"white",backgroundColor:"#7BBFE9",selectionFontColor:"black",selectionBackgroundColor:"yellow",width:"100%",height:"130",radius:10},eventTypes:[],_updateDraw:function(a,b,c){b&&c?(this.slider_start+=b,this.slider_stop+=c,this._calculateContent(this.slider_start,this.slider_stop)):this._calculateContent(),this.slider_start<this.data_first_start&&(b==c&&(this.slider_stop+=this.data_first_start-this.slider_start),this.slider_start=this.data_first_start),this.slider_stop>this.data_last_start&&(b==c&&(this.slider_start+=this.data_last_start-this.slider_stop),this.slider_stop=this.data_last_start),this._paintDNAContentGraph(void 0,this.slider_start,this.slider_stop)},paintDNAContentContent:function(a){if(void 0==a)throw this.$errorMsg=jQuery('<div id="DNAContentFeaturePainter-errorInit"></div>').html("There was an unexpected failure, the image cannot be displayed. data is undefined.").dialog({autoOpen:!0,title:"Error",modal:!0}),"Error";this._setDataSource(a),this._init()},_init:function(){Biojs.DNAContentViewer.myself=this;var a=jQuery("#"+this.opt.target);a.text(""),a.append(this._withSliderOnly(100)),a.append('<div id="DNAContentPainter-holder" style="overflow: visible; left: 10px; position: relative"></div>');var b=document.getElementById("DNAContentPainter-holder");if(!b)throw this.$errorMsg=jQuery('<div id="DNAContentPainter-errorInit"></div>').html("There was an unexpected failure, the image cannot be displayed.").dialog({autoOpen:!0,title:"Error",modal:!0}),"Error";b.innerHTML="",b.style.height="200px",b.style.width="700px";var c=this;this.width=$("#DNAContentPainter-holder").width(),this.height=$("#DNAContentPainter-holder").height(),this.r=c.opt.radius,c.opt.width=c.opt.width.toString(),this.width=-1!=c.opt.width.indexOf("%")?1*this.width*c.opt.width.substring(0,c.opt.width.length-1)/100:1*c.opt.width,c.opt.width=parseInt(this.width),c.opt.height=c.opt.height.toString(),this.height=-1!=c.opt.height.indexOf("%")?1*this.height*c.opt.height.substring(0,c.opt.height.length-1)/100:1*c.opt.height,c.opt.height=parseInt(this.height),c.color=function(){return d3.scale.ordinal().range(c.colors)}(),d3.text(c.opt.dataSet,function(a){c.track=a;var b=a.length-1;c._paintLegend(),c._updateLegend(c._Statsforchunk(c.track)),c.slider_start=0,c.slider_stop=b,c.data_last_start=b,c.data_first_start=0,c._paintSlider(),c._paintMarkersGraph(),c._updateDraw()})},_withSliderOnly:function(a){var b='<table width="'+a+'px"><tr><td width="33%" id="DNAContentPainter-slider" style="margin-left: 10px;"></td><td width="33%" id="Marker-Legend"></td><td width="33%" id="DNAContentPainter-Legend" style="margin-right: 10px;"></td></tr></table><br/>';return b},_calculateContent:function(a,b){var c=this.track;a&&b?(0>a&&(a=0),b>this.slider_stop&&(b=this.slider_stop),c=c.substring(a,b)):a=0;var d=[],e=c.length,f=0;if(e>100){for(;e>=f;){var g=c.substr(f,Math.floor(e/100));d.push({start:parseInt(a)+parseInt(f),gc_value:this._GCforchunk(g),at_value:this._ATforchunk(g)}),f+=Math.floor(e/100)}if(e>f){var g=c.substr(f);d.push({start:parseInt(a)+parseInt(f),gc_value:this._GCforchunk(g),at_value:this._ATforchunk(g)})}}else for(;e>=f;){var g=c.substr(f,10);d.push({start:parseInt(a)+parseInt(f),gc_value:this._GCforchunk(g),at_value:this._ATforchunk(g)}),f+=1}this.max=100,this.track_bins=d},_Statsforchunk:function(a){for(var b=a.split(""),c=0,d=0,e=0,f=0,g=0;g<b.length;g++)"g"==b[g].toLocaleLowerCase()||"c"==b[g].toLocaleLowerCase()?c++:"a"==b[g].toLocaleLowerCase()||"t"==b[g].toLocaleLowerCase()?d++:e++,f++;return{total:f,gc:c,at:d,ot:e}},_GCforchunk:function(a){for(var b=a.split(""),c=0,d=0,e=0;e<b.length;e++)("g"==b[e].toLocaleLowerCase()||"c"==b[e].toLocaleLowerCase())&&c++,d++;return 100*c/d},_ATforchunk:function(a){for(var b=a.split(""),c=0,d=0,e=0;e<b.length;e++)("a"==b[e].toLocaleLowerCase()||"t"==b[e].toLocaleLowerCase())&&c++,d++;return 100*c/d},_paintSlider:function(){if(document.getElementById("DNAContentPainter-slider")){var a=jQuery("#DNAContentPainter-slider");a.text(""),a.append('<label for="DNAContentPainter-slider-values"></label>'),a.append('<div type="text" id="DNAContentPainter-slider-values" style="margin-bottom:5px" />');var b=this,c=parseInt(b.track.length/100);this.zoomSlider=jQuery('<div id="DNAContentPainter-slider-bar" style="width:300px"></div>').appendTo(a),a.html('<b>Controls:</b><br><div class="ui-button ui-widget ui-corner-all ui-button-text-only" onclick=Biojs.DNAContentViewer.myself._updateDraw(undefined,'+1*c+","+-1*c+');><span title="Zoom In" class="ui-button ui-icon ui-icon-zoomin"></span></div><div class="ui-button ui-widget ui-corner-all ui-button-text-only"  onclick=Biojs.DNAContentViewer.myself._updateDraw(undefined,'+-1*c+","+1*c+'); ><span title="Zoom Out" class="ui-button ui-icon ui-icon-zoomout"></span></div><div class="ui-button ui-widget ui-corner-all ui-button-text-only"  onclick=Biojs.DNAContentViewer.myself._updateDraw(undefined,'+-1*c+","+-1*c+');><span title="Left" class="ui-button ui-icon ui-icon-arrowthick-1-w"></span></div><div class="ui-button ui-widget ui-corner-all ui-button-text-only"  onclick=Biojs.DNAContentViewer.myself._updateDraw(undefined,'+1*c+","+1*c+');><span title="Right" class="ui-button ui-icon ui-icon-arrowthick-1-e"></span></div>')}},_paintLegend:function(){var a=this;if(document.getElementById("DNAContentPainter-slider")){var b=jQuery("#DNAContentPainter-Legend");b.html('<div class=""> <font color="blue">  <input id=gc_checkbox type=checkbox checked> GC Content <span id=gc_perc> </span> </font></div><div class="">  <font color="red"> <input id=at_checkbox type=checkbox checked> AT Content <span id=at_perc> </span></font></div>'),$("#at_checkbox").change(function(){a._toggleAT()}),$("#gc_checkbox").change(function(){a._toggleGC()});var c=jQuery("#Marker-Legend");c.html('<div class=""> Marker Position: <br> <input type="radio" name="marker-pos" class="marker-pos" value="left" checked> Left <input type="radio" class="marker-pos" name="marker-pos" value="centre"> Centre <input type="radio" class="marker-pos" name="marker-pos" value="right"> Right </div>'),$(".marker-pos").change(function(){a._toggleMarker(this)})}},_updateLegend:function(a){if(document.getElementById("DNAContentPainter-slider")){var b=parseFloat(100*a.at/a.total).toFixed(2),c=parseFloat(100*a.gc/a.total).toFixed(2),d=jQuery("#gc_perc"),e=jQuery("#at_perc");d.html(c+"%"),e.html(b+"%")}},_paintDNAContentGraph:function(a,b,c){var d=this,e="50px",f="0px",g=this.track_bins;b&&c&&(g=jQuery.grep(d.track_bins,function(a){return a.start>=b&&a.start<=c}));var h=this.height,i=this.width,j=100*Math.ceil(this.max/100),k=g.length-1,l=parseInt(i)/(g[k].start-g[0].start);if(k>0){this._clear();var m=d3.select("#DNAContentPainter-holder").select("svg").append("g").attr("width",this.width).attr("height",this.height+30).attr("class","redrawn-path").attr("transform","translate("+e+","+f+")");this._container=jQuery("#DNAContentPainter-holder");for(var n=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear"),o=[],p=[],q=0,r=(parseInt(g[1].start-g[0].start),0);r<g.length-1;){var s,t;b?(s=(g[r].start-b)*l,t=(g[r].start-b)*l):(s=g[r].start*l,t=g[r].start*l);var u=h-g[r].gc_value*h/j,v=h-g[r].at_value*h/j;o.push({x:s,y:u}),p.push({x:t,y:v}),r++,q=g[r].start}b&&(s=(g[g.length-1].start-b)*l,t=(g[g.length-1].start-b)*l);var u=h-g[g.length-1].gc_value*h/j,v=h-g[g.length-1].at_value*h/j;o.push({x:s,y:u}),p.push({x:t,y:v});var w=m.selectAll("path").data([1]),x=[];for(r=0;r<g.length;)x.push(g[r]),r+=parseInt(k/10);var y=m.selectAll("text.day").data(x);y.enter().append("svg:text").attr("x",function(a){return b?(a.start-b)*l:a.start*l}).attr("y",160).attr("text-anchor","middle").style("font-size","10px").text(function(a){return a.start>1e6?parseInt(a.start/1e6)+"M":a.start>1e3?parseInt(a.start/1e3)+"K":a.start});var z=[];for(r=1;10>=r;r++)z.push(j/10*r);var A=m.selectAll("line.bottom").data(g);A.enter().insert("svg:line").attr("class","line").attr("x1",function(a){return b?(a.start-b)*l:a.start*l}).attr("y1",130).attr("x2",function(a){return b?(a.start-b)*l:a.start*l}).attr("y2",function(){return 140}).attr("stroke",function(){return"black"});var A=m.selectAll("line.bottom").data(x);A.enter().insert("svg:line").attr("class","line").attr("x1",function(a){return b?(a.start-b)*l:a.start*l}).attr("y1",130).attr("x2",function(a){return b?(a.start-b)*l:a.start*l}).attr("y2",function(){return 150}).attr("stroke",function(){return"black"});var B=m.selectAll("line.bottom").data([1]);B.enter().insert("svg:line").attr("class","line base").attr("x1",function(){return 0}).attr("y1",function(){return h}).attr("x2",function(){return i}).attr("y2",function(){return h}).attr("stroke",function(){return"black"}),w.enter().append("svg:path").attr("width",200).attr("height",200).attr("class","path gc-path").attr("stroke",function(){return"blue"}).attr("stroke-width",function(){return"2px"}).attr("fill",function(){return"transparent"}).attr("d",n(o)),w.enter().append("svg:path").attr("width",200).attr("height",200).attr("class","path at-path").attr("stroke",function(){return"red"}).attr("stroke-width",function(){return"2px"}).attr("fill",function(){return"transparent"}).attr("d",n(p))}},_paintMarkersGraph:function(){var a="50px",b="0px",c=this.height,d=(this.width,100);this._clear();var e=d3.select("#DNAContentPainter-holder").append("svg").style("overflow","visible").append("g").attr("class","marker-base").attr("width",this.width).attr("height",this.height+30).attr("transform","translate("+a+","+b+")");this._container=jQuery("#DNAContentPainter-holder");for(var f=[],g=1;10>=g;g++)f.push(d/10*g);var h=e.selectAll("text.marker").data(f);h.enter().append("svg:text").attr("class","text marker").attr("x",function(){return 10}).attr("y",function(a){return c-a*c/d+parseInt(5)}).attr("text-anchor","begin").style("font-size","10px").text(function(a,b){return 10*(b+1)+"%"});var i=e.selectAll("tick.marker").data(f);i.enter().insert("svg:line").attr("class","tick tickmarker").attr("x1",function(){return 0}).attr("y1",function(a){return c-a*c/d}).attr("x2",function(){return 5}).attr("y2",function(a){return c-a*c/d}).attr("stroke",function(){return"black"});var j=e.selectAll("line.bottom").data([1]);j.enter().insert("svg:line").attr("class","line marker base").attr("x1",function(){return 1}).attr("y1",function(){return 0}).attr("x2",function(){return 1}).attr("y2",function(){return c}).attr("stroke",function(){return"black"})},_toggleAT:function(){"none"==jQuery(".at-path").css("display")?jQuery(".at-path").show():jQuery(".at-path").hide()},_toggleGC:function(){"none"==jQuery(".gc-path").css("display")?jQuery(".gc-path").show():jQuery(".gc-path").hide()},_toggleMarker:function(a){console.log(a);var b=d3.select("#DNAContentPainter-holder"),c=this.width,d=b.selectAll("line.marker"),e=b.selectAll("text.marker"),f=b.selectAll("line.tick");"left"==a.value?(d.transition().duration(500).attr("x1",function(){return 1}).attr("x2",function(){return 1}),e.transition().duration(500).attr("text-anchor","begin").attr("x",function(){return 10}),f.transition().duration(500).attr("x1",function(){return 0}).attr("x2",function(){return 5})):"centre"==a.value?(d.transition().duration(500).attr("x1",function(){return c/2}).attr("x2",function(){return c/2}),e.transition().duration(500).attr("text-anchor","begin").attr("x",function(){return parseInt(c/2)+parseInt(10)}),f.transition().duration(500).attr("x1",function(){return c/2}).attr("x2",function(){return parseInt(c/2)+parseInt(5)})):(d.transition().duration(500).attr("x1",function(){return c}).attr("x2",function(){return c}),e.transition().duration(500).attr("text-anchor","end").attr("x",function(){return parseInt(c)-parseInt(10)}),f.transition().duration(500).attr("x1",function(){return c-5}).attr("x2",function(){return c}))},_clear:function(){d3.select("#DNAContentPainter-holder").select("svg").select("g.redrawn-path").remove()},_setDataSource:function(a){this.opt.dataSet=a},_addSimpleClickTrigger:function(){var a=this;this._container.find("span").click(function(b){var c=jQuery(b.target).text(),d={selected:c};a.raiseEvent("onClick",d)})}},{myself:void 0}),Biojs.DasProteinFeatureViewer=Biojs.FeatureViewer.extend({_webservice:"http://wwwdev.ebi.ac.uk/uniprot/featureViewer/image",_dasReference:"http://www.ebi.ac.uk/das-srv/uniprot/das/uniprot/",constructor:function(a){this.base(a);var b=this,c="?";if(c+="&option=raphael",Biojs.Utils.isEmpty(a.segment))throw"A UniProt accession or identifier is mandatory";c=c+"&segment="+a.segment,Biojs.Utils.isEmpty(a.dasSources)||(c=c+"&dasSources="+a.dasSources),Biojs.Utils.isEmpty(a.featureTypes)||(c=c+"&"+a.featureTypes),Biojs.Utils.isEmpty(a.featureNames)||(c=c+"&"+a.featureNames),void 0==a.imageWidth||isNaN(a.imageWidth)||(c=c+"&width="+a.imageWidth),Biojs.Utils.isEmpty(a.imageStyle)||(c=c+"&style="+a.imageStyle),void 0!=a.hgrid&&1==a.hgrid&&(c+="&hgrid"),void 0!=a.vgrid&&1==a.vgrid&&(c+="&vgrid"),void 0!=a.allFeatures&&1==a.allFeatures&&(c+="&allFeatures"),void 0!=a.allRectangles&&1==a.allRectangles&&(c+="&allRectangles"),void 0!=a.allSameSize&&1==a.allSameSize&&(c+="&allSameSize"),this.opt.json="",jQuery.ajax({url:b.opt.proxyUrl,data:"url="+this._webservice+c,success:function(a){json=jQuery.parseJSON(a);try{b.opt.json=json,Biojs.Utils.isEmpty(b.opt.json)||b.paintFeatures(b.opt.json)}catch(c){Biojs.console.log(c),document.getElementById(b.opt.target).innerHTML="",document.getElementById(b.opt.target).innerHTML="No image available. Did you provide a valid UniProt accession or identifier, and valid limits?"}},error:function(){Biojs.console.log(error),document.getElementById(b.opt.target).innerHTML="",document.getElementById(b.opt.target).innerHTML="No image available. Did you provide a valid UniProt accession or identifier, and valid limits?"
}})},opt:{dasSources:"http://www.ebi.ac.uk/das-srv/uniprot/das/uniprot",featureTypes:"",featureNames:"",imageWidth:700,imageStyle:"nonOverlapping",optionResponse:"raphael",hgrid:!1,vgrid:!1,allFeatures:!0,allRectangles:!1,allSameSize:!1,proxyUrl:"../biojs/dependencies/proxy/proxy.php"},eventTypes:[],showGeneralLegend:function(){var a=(this.opt.json.configuration,this._webservice+"?");window.open(a)},exportFeaturesToImage:function(){var a=this.opt.json.configuration,b="";if(jQuery.browser.msie){var c="segment="+this.opt.json.segment;0!=a.requestedStart&&0!=a.requestedStop&&(c=c+":"+a.requestedStart+","+a.requestedStop),c=c+"&dasReference="+a.dasReference+"&dasSources="+a.dasSources+"&width="+a.sizeX+"&option=image&hgrid="+a.horizontalGrid+"&vgrid="+a.verticalGrid+"&style="+a.style,b=this._webservice+"?"+c,window.open(b)}else{svg=document.getElementById("uniprotFeaturePainter-holder").innerHTML;var d=document.createElement("canvas");canvg(d,svg),b=d.toDataURL(),this.$imageExported=jQuery('<div id="uniprotFeaturePainter-imageExportedDiv"></div>').html('<img id="uniprotFeaturePainter-imageExported" alt="exported image" src="'+b+'"/>').dialog({autoOpen:!0,title:"Exported image",modal:!0,width:a.sizeX+20})}},applyStyle:function(a){if(void 0!=a&&("centered"==a||"nonOverlapping"==a||(a="rows"))){var b=this.opt.json.configuration;this.customize(a,b.horizontalGrid,b.verticalGrid)}},showHideHorizontalGrid:function(a){if(void 0!=a&&(1==a||0==a)){var b=this.opt.json.configuration;this.customize(b.style,a,b.verticalGrid)}},showHideVerticalGrid:function(a){if(void 0!=a&&(1==a||0==a)){var b=this.opt.json.configuration;this.customize(b.style,b.horizontalGrid,a)}}}),Biojs.DetailsFrame=Biojs.extend({constructor:function(){var a=this,b=a.opt.target,c="";a.opt.minizable&&(c+='		<div class="minimize to_minimize" " ></div>'),a.opt.draggable&&(c+='		<div class="dragger" src="../../main/resources/css/images/draggable.png" ></div>'),c+='		<header class="protein-label" />',c+="		<ul />",$("#"+b).addClass("protein"),$("#"+b).append(c),a.updateFeatures(),a.opt.minizable&&$("#"+b+" .minimize").click(function(){"none"==$("#"+b+" ul").css("display")?($("#"+b+" ul").show(),$(this).removeClass("minimized"),$(this).addClass("to_minimize")):($("#"+b+" ul").hide(),$(this).removeClass("to_minimize"),$(this).addClass("minimized"))}),a.opt.draggable&&$("#"+b).draggable({cursor:"move",cancel:"ul"})},opt:{target:"YourOwnDivId",features:{id:"Not loaded"},minizable:!0,draggable:!0},eventTypes:["onFeaturesUpdated"],updateFeatures:function(a,b){var c=this;"undefined"!=typeof a&&(c.opt.features=a),$("#"+c.opt.target+" header").html(c.opt.features.id);var d="";if("undefined"!=typeof c.opt.features.description&&(d+='			<li class="protein-description"><h2>'+c.opt.features.description+"</h2></li>"),"undefined"==typeof b)for(var e in c.opt.features)"description"!=e&&"id"!=e&&(d+="			<li><b>"+e+":</b>"+c.opt.features[e]+"</li>");else for(var e=0;e<b.length;e++)d+="			<li><b>"+b[e]+":</b>"+c.opt.features[b[e]]+"</li>";$("#"+c.opt.target+" ul").html(d),c.raiseEvent("onFeaturesUpdated",{})}}),Biojs.EbiGlobalSearch=Biojs.extend({constructor:function(){this.setQuery(this.opt.query)},opt:{target:"YourOwnDivId",query:void 0,searchBaseURL:"http://www.ebi.ac.uk/ebisearch/",style:"collapsible",proxyUrl:""},setQuery:function(a,b){if(this._completedRequest=!1,"undefined"!=typeof b&&(this.opt.style=b),"undefined"!=typeof a)this.opt.query=a,this._drawTemplate(),this.opt.style!=Biojs.EbiGlobalSearch.VIEW_COLLAPSIBLE&&this._updateSummary();else{var c="ERROR: Query error: "+Biojs.EbiGlobalSearch.QUERY_ERROR_UNDEFINED;Biojs.console.log(c),this.raiseEvent(Biojs.EbiGlobalSearch.EVT_ON_ERROR,{message:c})}},setStyle:function(a){this.setQuery(this.opt.query,a)},_updateSummary:function(){var a=this,b=this.opt.searchBaseURL+"globalsearchsummary.ebi?query="+this.opt.query;""!=a.opt.proxyUrl&&(b=a.opt.proxyUrl+"?url="+b),jQuery.ajax({url:b,context:this,dataType:"json"}).done(function(b){Biojs.console.log("SUCCESS: data received"),a._completedRequest=!0,a._drawResults(b)}).fail(function(b,c){var d="ERROR: Request failed: "+c;""==this.opt.query&&(d+=": Empty query"),Biojs.console.log(d),a.raiseEvent(Biojs.EbiGlobalSearch.EVT_ON_ERROR,{message:d}),a._drawResults(d)})},_renderItem:function(a,b){jQuery("<li>").append(jQuery("<a>").attr("href",this.opt.searchBaseURL+b.url).text(b.name+" ("+b.numberOfResults+")")).appendTo(a)},_renderItems:function(a,b){var c=this,d=0,e=0,f=0;if(jQuery.each(a,function(a,g){e++,0!=g.numberOfResults&&(c._renderItem(b,g),d+=parseInt(g.numberOfResults),f++)}),0==d){var g='No results for "'+this.opt.query+'"',h=jQuery("#"+Biojs.EbiGlobalSearch.SEARCH_EXTRAS);h.find("ul").css("display","none"),h.find("p").text(g)}this.raiseEvent(Biojs.EbiGlobalSearch.EVT_ON_RESULTS,{resutls:d,services:e,servicesWithResults:f,items:a})},_drawTemplate:function(){if(this.opt.style.toLowerCase()==Biojs.EbiGlobalSearch.VIEW_BASIC){var a=jQuery("#"+this.opt.target);a.html("");var b=jQuery("<aside id='"+Biojs.EbiGlobalSearch.SEARCH_EXTRAS+"'></aside>");b.appendTo(a),b.removeClass("shortcuts"),b.text("Loading other results"),b.addClass("loading")}else if(this.opt.style.toLowerCase()==Biojs.EbiGlobalSearch.VIEW_COLLAPSIBLE){var c=this,a=jQuery("#"+this.opt.target);a.html("");var b=jQuery("<aside id='"+Biojs.EbiGlobalSearch.SEARCH_EXTRAS+"'></aside>");b.appendTo(a),b.addClass("shortcuts expander");var d=jQuery("<div id='"+Biojs.EbiGlobalSearch.EBI_SEARCH_RESULTS+"'></div>");d.appendTo(b);var e=jQuery("<h3 data-icon='u'>Show more data from EMBL-EBI</h3>");e.addClass("slideToggle icon icon-functional"),e.appendTo(d),jQuery('#ebi_search_results .slideToggle[data-icon="u"]').next().hide(),jQuery("#ebi_search_results .slideToggle").click(function(){"u"===jQuery(this).attr("data-icon")?jQuery(this).attr("data-icon","w"):jQuery(this).attr("data-icon","u"),"w"===jQuery(this).attr("data-icon")&&1!=c._completedRequest&&(e.addClass("loading"),c._updateSummary()),jQuery(this).parent().find("p").slideToggle(300),jQuery(this).parent().find("ul").slideToggle(300)})}else{var a=jQuery("#"+this.opt.target);a.html("");var b=jQuery("<aside id='"+Biojs.EbiGlobalSearch.SEARCH_EXTRAS+"'></aside>");b.appendTo(a),b.addClass("shortcuts");var d=jQuery("<div id='"+Biojs.EbiGlobalSearch.EBI_SEARCH_RESULTS+"'></div>");d.appendTo(b);var e=jQuery("<h3>More data from EMBL-EBI</h3>");e.addClass("loading"),e.appendTo(d)}},_drawResults:function(a){var b=this;if(this.opt.style.toLowerCase()==Biojs.EbiGlobalSearch.VIEW_BASIC){var c=jQuery("#"+Biojs.EbiGlobalSearch.SEARCH_EXTRAS);if(c.html(""),c.removeClass("loading"),c.append("<p>EBI global search results</p>"),"string"!=typeof a){var d=jQuery("<ul>").appendTo(c);b._renderItems(a,d)}else jQuery("<p>"+a+"</p>").appendTo(c)}else if(this.opt.style.toLowerCase()==Biojs.EbiGlobalSearch.VIEW_COLLAPSIBLE){var b=this,e=jQuery("#"+Biojs.EbiGlobalSearch.EBI_SEARCH_RESULTS);if(jQuery(e).find("h3").removeClass("loading"),jQuery(e).find("ul").remove(),jQuery(e).find("p").remove(),"string"!=typeof a){var f=jQuery('<p>Other results for "'+this.opt.query+'"</p>');f.appendTo(e);var d=jQuery("<ul>");d.attr("id","global-search-results"),d.appendTo(e),b._renderItems(a,d)}else jQuery("<p>"+a+"</p>").appendTo(e)}else{var e=jQuery("#"+Biojs.EbiGlobalSearch.EBI_SEARCH_RESULTS);if(jQuery(e).find("h3").removeClass("loading"),"string"!=typeof a){var f=jQuery('<p>Other results for "'+this.opt.query+'"</p>');f.appendTo(e);var d=jQuery("<ul>");d.attr("id","global-search-results"),d.appendTo(e),b._renderItems(a,d)}else jQuery("<p>"+a+"</p>").appendTo(e)}},eventTypes:["onError","onResults"]},{QUERY_ERROR_UNDEFINED:"Query undefined",QUERY_ERROR_USER_MESSAGE:"Sorry, we could not process your request",EVT_ON_ERROR:"onError",EVT_ON_RESULTS:"onResults",EBI_SEARCH_RESULTS:"ebi_search_results",SEARCH_EXTRAS:"search-extras",VIEW_BASIC:"basic",VIEW_COLLAPSIBLE:"collapsible",VIEW_EXPANDED:"expanded"}),Biojs.ExpressionAtlasBaselineSummary=Biojs.extend({constructor:function(){this._containerDiv=jQuery("#"+this.opt.target),this.setQuery(this.opt.geneQuery,this.opt.propertyType,this.opt.geneSetMatch)},setQuery:function(a,b,c){this.opt.geneQuery=a,this.opt.propertyType=b,this.opt.geneSetMatch=c,this._containerDiv.empty();var d=a.split("+");this._identifierDb=this._checkIdentifier(d[0]),this._identifierDb==Biojs.ExpressionAtlasBaselineSummary.ID_UNIPROT?this.opt.propertyType="":this._identifierDb==Biojs.ExpressionAtlasBaselineSummary.ID_ENSEMBL&&(this.opt.propertyType="bioentity_identifier");var e=this.opt.featuresUrl+"?geneQuery="+this.opt.geneQuery;""!=this.opt.propertyType&&(e=e+"&propertyType="+this.opt.propertyType),1==this.opt.geneSetMatch&&(e+="&geneSetMatch=true"),""!=this.opt.proxyUrl&&(e=this.opt.proxyUrl+"?url="+e);var f=this,g={url:e,data:{rootContext:this.opt.rootContext},method:"GET",beforeSend:function(){f._containerDiv.html("<img src='http://www.ebi.ac.uk/gxa/resources/images/loading.gif' />")},success:function(a){Biojs.console.log("SUCCESS: data received"),Biojs.console.log(a),f._containerDiv.html(a)},error:function(a,b,c){Biojs.console.log("ERROR: "+a.status),f._containerDiv.html("An error occurred while retrieving the data: "+a.status+" - "+a.statusText),f.raiseEvent("onError",{message:"AJAX request failed",jqXHR:a,textStatus:b,errorThrown:c})}};jQuery.ajax(g)},_checkIdentifier:function(a){var b=this;return b._re=/^([A-N,R-Z][0-9][A-Z][A-Z, 0-9][A-Z, 0-9][0-9])|([O,P,Q][0-9][A-Z, 0-9][A-Z, 0-9][A-Z, 0-9][0-9])$/,-1!=a.search(b._re)?Biojs.ExpressionAtlasBaselineSummary.ID_UNIPROT:"ENSG"==a.substring(0,4)?Biojs.ExpressionAtlasBaselineSummary.ID_ENSEMBL:void 0},opt:{featuresUrl:"http://www.ebi.ac.uk/gxa/widgets/heatmap/protein",geneQuery:"",propertyType:"",geneSetMatch:"",target:"YourOwnDivId",rootContext:"../biojs/dependencies/proxy/proxy.php?url=http://www.ebi.ac.uk/gxa",proxyUrl:"../biojs/dependencies/proxy/proxy.php"},eventTypes:["onError"]},{ID_UNIPROT:"uniprot",ID_ENSEMBL:"ensembl"}),Biojs.ExpressionLoader=Biojs.extend({expressions:null,min:99999,max:-99999,column:-1,colorData:null,constructor:function(){var a=this;window.File&&window.FileReader&&window.FileList&&window.Blob?($("#"+a.opt.target).html('<input type="file" name="files[]" class="button-link" /><div class="fake-file">'+a.opt.label+"</div><br/><output></output>"),$("#"+a.opt.target+" .fake-file").click(function(){$("#"+a.opt.target+" .button-link").click()}),$("#"+a.opt.target+" .button-link").change(function(b){a._handleFileSelect(b)})):a.raiseEvent("onError",{error:"Expression data can't be loaded in your browser."})},opt:{target:"YourOwnDivId",label:"Color by Expression File..."},eventTypes:["onFileLoaded","onFileRemoved","onError"],_handleFileSelect:function(a){for(var b,c=this,d=a.target.files,e=0;b=d[e];e++)if(b.type.match("text.*")){var f=new FileReader;f.onload=function(){return function(a){var b=c.parseTabDelimitedString(a.target.result);null!=b&&c.startWizzard()}}(b),f.readAsText(b)}else $("#"+c.opt.target+" output").html("The selected file is not text, its type is "+b.type),c.raiseEvent("onError",{error:"The selected file is not text, its type is "+b.type})},parseTabDelimitedString:function(a){var b=this;b.expressions={},b.min=99999,b.max=-99999,b.column=-1,b.colorData=null;for(var c=a.split("\n"),d=-1,e=0;e<c.length;e++)if(0!=c[e].indexOf("#")){var f=c[e].split("	");if(-1==d){if(d=f.length,2>d){b.raiseEvent("onError",{error:"The file at requires at least 2 columns (Id and Expression)"}),$("#"+b.opt.target+" output").html("The file at requires at least 2 columns (Id and Expression)"),b.expressions=null;break}}else if(d!=f.length){b.raiseEvent("onError",{error:"The number of columns is different between lines "+e+" and "+(e+1)}),$("#"+b.opt.target+" output").html("The number of columns is different between lines "+e+" and "+(e+1)),b.expressions=null,d=-1;break}var g=f.splice(1);b.expressions[f[0]]=g;for(var h=0;h<g.length;h++)b.min>1*g[h]&&(b.min=1*g[h]),b.max<1*g[h]&&(b.max=1*g[h])}return b.expressions},getFormatedTable:function(a){var b=this,c=0,d="<table>",e=0;for(var f in b.expressions){if(a==c++)break;d+="<tr><th>"+f+"</th><td>"+b.expressions[f].join("</td><td>")+"</td></tr>",e=b.expressions[f].length}d+="<tr><th>Column to Use:</th>";for(var g=-1!=b.column?b.column:0,c=0;e>c;c++){var h=c==g?"checked":"";d+='<td><input type="radio" name="column" value="'+c+'" '+h+" /></td>",h=""}return d+="</tr></table>"},startWizzard:function(){var a=this;$("#"+a.opt.target+" output").html('<div class="dialog-modal" title="Select Column"><p>'+a.getFormatedTable(5)+"</p></div>"),$("#"+a.opt.target+" .dialog-modal").dialog({height:400,width:600,modal:!0,buttons:{Next:function(){a.column=1*$('.dialog-modal input[name="column"]:checked').val(),$(this).dialog("destroy"),a.wizzardStep2()}}})},wizzardStep2:function(){var a=this,b=null!=a.colorData?a.colorData.min:a.min,c=null!=a.colorData?a.colorData.max:a.max,d=null!=a.colorData?a.colorData.center:0,e=null!=a.colorData?a.colorData.colorMin:"#FF0000",f=null!=a.colorData?a.colorData.colorMax:"#00FF00",g=null!=a.colorData?a.colorData.colorCenter:"#000000",h="<table><tr><th>Min:</th><td><input type='text' id='min' value='"+b+"'/></td><td>";h+='<input type="hidden" id="colorMin" name="colorMin" class="color-picker" size="6" />',h+="</td></tr><tr><th>Center:</th><td><input type='text' id='center' value='"+d+"'/></td><td>",h+='<input type="hidden" id="colorCenter" name="colorCenter" class="color-picker" size="6" />',h+="</td></tr><tr><th>Max:</th><td><input type='text' id='max' value='"+c+"'/></td><td>",h+='<input type="hidden" id="colorMax" name="colorMax" class="color-picker" size="6" />',h+="</td></tr></table>",$("#"+a.opt.target+" output").html('<div class="dialog-modal" title="Select Range and Colors"><p>'+h+"</p></div>"),$("#colorMax").miniColors({letterCase:"uppercase"}).miniColors("value",f),$("#colorCenter").miniColors({letterCase:"uppercase"}).miniColors("value",g),$("#colorMin").miniColors({letterCase:"uppercase"}).miniColors("value",e),$("#"+a.opt.target+" .dialog-modal").dialog({height:400,width:600,modal:!0,buttons:{Apply:function(){a.colorData={min:$("#min").val(),center:$("#center").val(),max:$("#max").val(),colorMin:$("#colorMin").val(),colorCenter:$("#colorCenter").val(),colorMax:$("#colorMax").val()},a.calculateExtrapolingData(a.colorData),$("#colorCenter").miniColors("destroy"),$("#colorMin").miniColors("destroy"),$("#colorMax").miniColors("destroy"),$(this).dialog("destroy"),$(" .dialog-modal").remove(),$("#"+a.opt.target+" .fake-file").html("Change File..."),$("#"+a.opt.target+" .exp-edit").remove(),$("#"+a.opt.target+" .exp-remove").remove(),$("#"+a.opt.target+" .fake-file").after("<div class='exp-remove'></div>"),$("#"+a.opt.target+" .exp-remove").click(function(){a.expressions=null,a.min=99999,a.max=-99999,a.column=-1,a.colorData=null,$("#"+a.opt.target+" .exp-edit").remove(),$("#"+a.opt.target+" .exp-remove").remove(),$("#"+a.opt.target+" .fake-file").html(a.opt.label),$("#"+a.opt.target+" .button-link").val(""),a.raiseEvent("onFileRemoved",{})}),$("#"+a.opt.target+" .fake-file").after("<div class='exp-edit'></div>"),$("#"+a.opt.target+" .exp-edit").click(function(){a.startWizzard()}),a.raiseEvent("onFileLoaded",{expressions:a.expressions,column:a.column,colorData:a.colorData})}}})},_hexToR:function(a){var b=this;return parseInt(b._cutHex(a).substring(0,2),16)},_hexToG:function(a){var b=this;return parseInt(b._cutHex(a).substring(2,4),16)},_hexToB:function(a){var b=this;return parseInt(b._cutHex(a).substring(4,6),16)},_cutHex:function(a){return"#"==a.charAt(0)?a.substring(1,7):a},_getM:function(a,b,c,d){return(b-d)/(a-c)},_getB:function(a,b,c){return c-a*b},_getY:function(a,b,c){return parseInt(a*c+b)},calculateExtrapolingData:function(a){var b=this,c=b._hexToR(a.colorMin),d=b._hexToR(a.colorCenter),e=b._hexToR(a.colorMax),f=b._hexToG(a.colorMin),g=b._hexToG(a.colorCenter),h=b._hexToG(a.colorMax),i=b._hexToB(a.colorMin),j=b._hexToB(a.colorCenter),k=b._hexToB(a.colorMax),l=b._getM(a.min,c,a.center,d),m=b._getM(a.min,f,a.center,g),n=b._getM(a.min,i,a.center,j),o=b._getM(a.center,d,a.max,e),p=b._getM(a.center,g,a.max,h),q=b._getM(a.center,j,a.max,k),r=b._getB(l,a.min,c),s=b._getB(m,a.min,f),t=b._getB(n,a.min,i),u=b._getB(o,a.max,e),v=b._getB(p,a.max,h),w=b._getB(q,a.max,k);return a.mRedN=l,a.mGreenN=m,a.mBlueN=n,a.mRedP=o,a.mGreenP=p,a.mBlueP=q,a.bRedN=r,a.bGreenN=s,a.bBlueN=t,a.bRedP=u,a.bGreenP=v,a.bBlueP=w,a},getRGBString:function(a){var b=this;return a>b.colorData.center?"rgb("+b._getY(b.colorData.mRedP,b.colorData.bRedP,a)+","+b._getY(b.colorData.mGreenP,b.colorData.bGreenP,a)+","+b._getY(b.colorData.mBlueP,b.colorData.bBlueP,a)+")":"rgb("+b._getY(b.colorData.mRedN,b.colorData.bRedN,a)+","+b._getY(b.colorData.mGreenN,b.colorData.bGreenN,a)+","+b._getY(b.colorData.mBlueN,b.colorData.bBlueN,a)+")"}}),Biojs.FeatureViewer=Biojs.extend({raphael:"",connections:[],zoomSlider:"",slider_stop:0,slider_start:0,context:"",instance:void 0,_UP:"up",_DOWN:"down",_MIDDLE:"middle",_CENTERED:"centered",_ROWS:"rows",_NON_OVERLAPPING:"nonOverlapping",_GRID_OPACITY:.3,_LIME:"#00ff00",_DARK_ORANGE:"#ff8c00",_originalColor:"",_previousClickedColor:"",_previousClickedFillColor:"",_previousClickedShape:"",_previousClickedFeature:"",_clickCounter:0,constructor:function(){Biojs_FeatureViewer_array.push(this),this.instance=Biojs_FeatureViewer_array.length-1,Biojs_FeatureViewer_array[this.instance].opt.json=jQuery.extend(!0,{},this.opt.json),Biojs_FeatureViewer_array[this.instance].initRaphael(),Biojs.Utils.isEmpty(Biojs_FeatureViewer_array[this.instance].opt.json)||Biojs_FeatureViewer_array[this.instance].paintFeatures(Biojs_FeatureViewer_array[this.instance].opt.json)},opt:{target:"YourOwnDivId",json:{},showSlider:!0,showPrintButton:!0,showFeatureTooltipOnMouseOver:!0,highlightFeatureOnMouseOver:!0,selectFeatureOnMouseClick:!0,dragSites:!0,selectionColor:"#ff8c00"},eventTypes:["onFeatureClick","onFeatureOn","onFeatureOff","onFeatureSelected","onFeatureUnselected"],_getElementWithinTarget:function(a){return jQuery("#"+this.opt.target).find("#"+a)},_getHolder:function(){return jQuery("#"+this.opt.target).children("#uniprotFeaturePainter-holder")[0]},setSelectionColor:function(a){this.opt.selectionColor=a},customize:function(a,b,c){var d=this.opt.json.configuration;if(""==a||""!=a&&a==d.style)c!=d.verticalGrid?(d.verticalGrid=c,b!=d.horizontalGrid?(d.horizontalGrid=b,c&&b?(this._paintVerticalGridLines(d.verticalGridLineLength,d.requestedStop,d.requestedStart,d.rulerLength,d.rulerY,d.pixelsDivision,d.leftMargin,this.raphael),this._paintHorizontalGridLines(d.horizontalGrid,d.horizontalGridNumLines,d.gridLineHeight,d.nonOverlapping,d.leftMargin,d.rightMargin,d.sequenceLineY,d.rulerY,d.sizeX,this.raphael)):this._repaint("withoutZoom")):c?this._paintVerticalGridLines(d.verticalGridLineLength,d.requestedStop,d.requestedStart,d.rulerLength,d.rulerY,d.pixelsDivision,d.leftMargin,this.raphael):this._repaint("withoutZoom")):b!=d.horizontalGrid&&(d.horizontalGrid=b,b?this._paintHorizontalGridLines(d.horizontalGrid,d.horizontalGridNumLines,d.gridLineHeight,d.nonOverlapping,d.leftMargin,d.rightMargin,d.sequenceLineY,d.rulerY,d.sizeX,this.raphael):this._repaint("withoutZoom"));else{d.style=a,d.horizontalGrid=b,d.verticalGrid=c,this._updateFeaturesToStyle(a);var e=this._getHolder();e.innerHTML="",e.style.height=d.sizeY+d.sizeYKey+"px",e.style.width=d.sizeX+"px",this.raphael=Raphael(e,d.sizeX,d.sizeY+d.sizeYKey),this._repaint("withoutZoom")}},paintFeatures:function(a){a&&(this.opt.json=a),this._init(),this._paintSlider(),this._repaint()},exportFeaturesToImage:function(){var a=this.opt.json.configuration,b="";if(jQuery.browser.msie)this.$imageExported=jQuery('<div id="uniprotFeaturePainter-imageExportedDiv"></div>').html("Image export is not supported for IE").dialog({autoOpen:!0,title:"Exported image",modal:!0,width:a.sizeX+20});else{svg=this._getHolder().innerHTML;var c=document.createElement("canvas");canvg(c,svg),b=c.toDataURL(),this.$imageExported=jQuery('<div id="uniprotFeaturePainter-imageExportedDiv"></div>').html('<img id="uniprotFeaturePainter-imageExported" alt="exported image" src="'+b+'"/>').dialog({autoOpen:!0,title:"Exported image",modal:!0,width:a.sizeX+20})}},zoom:function(a,b){var c=this.opt.json.configuration,d=c.sequenceLength;a>=1&&d>=b&&this._repaint(void 0,a,b)},_init:function(){var a=this.opt.json.configuration,b=jQuery("#"+this.opt.target);b.text(""),this.opt.showSlider&&this.opt.showPrintButton?b.append(this._withSliderAndButton(a.sizeX,a.sizeY,a.sizeYKey)):this.opt.showPrintButton?b.append(this._withButtonOnly(a.sizeX,a.sizeY,a.sizeYKey)):this.opt.showSlider&&b.append(this._withSliderOnly(a.sizeX)),b.append("<br/>"),b.append('<div id="uniprotFeaturePainter-holder"></div>');var c=this._getHolder();if(!c)throw this.$errorMsg=jQuery('<div id="uniprotFeaturePainter-errorInit"></div>').html("There was an unexpected failure, the image cannot be displayed.").dialog({autoOpen:!0,title:"Error",modal:!0}),"Error";c.innerHTML="",c.style.height=a.sizeY+a.sizeYKey+"px",c.style.width=a.sizeX+"px",this.raphael=Raphael(c,a.sizeX,a.sizeY+a.sizeYKey)},_clear:function(a){if(this.raphael.clear(),this.connections=[],!a){var b=this.opt.json.legend.key;if(b)for(var c=0;c<b.length;c++)b[c].label.total=0}},_paintJson:function(a){for(var b=this.opt.json.configuration,c=0;c<this.opt.json.featuresArray.length;c++){var d=this.opt.json.featuresArray[c];d.featureEnd<b.requestedStart||d.featureStart>b.requestedStop||(this._paint(d,b.sequenceLineY),a||this._increaseKeyTotal(d.typeLabel))}},_paintKey:function(){var a=this.opt.json.legend,b=a.segment,c={"text-anchor":"start"},d=this.raphael.text(b.xPos,b.yPos,b.text).attr(c);d.attr({stroke:"black","stroke-width":.1});for(var e=a.key,f=0;f<e.length;f++){this._paint(e[f].shape);var g=e[f].label,c={"text-anchor":"start"},d=this.raphael.text(g.xPos,g.yPos,g.text+" ("+g.total+")").attr(c);d.attr({stroke:"black","stroke-width":.1})}},_paintRuler:function(){var a=this.opt.json.configuration,b=this.raphael.path("M"+a.leftMargin+" "+a.rulerY+"L"+(a.sizeX-a.rightMargin)+" "+a.rulerY);b.attr({fill:"black",stroke:"black",fill:1,"stroke-width":1});var c=1*a.rulerLength/a.pixelsDivision,d=1*(a.requestedStop-a.requestedStart+1)/c,e=a.rulerLength/(10*c);c=Math.round(c),d=Math.round(d);for(var f=1;10*c>f;f++){var g=Math.round(f*e+a.leftMargin);if(d*f/10<a.requestedStop)if(f%10==0){var h=this.raphael.path("M"+g+" "+(a.rulerY-6)+"L"+g+" "+(a.rulerY+6));h.attr({fill:"black",stroke:"black",fill:1,"stroke-width":1});var i=this.raphael.text(g,a.aboveRuler,""+(d*f/10+a.requestedStart-1));if(i.attr({fill:"black"}),"true"==a.verticalGrid||1==a.verticalGrid){var h=this.raphael.path("M"+g+" "+(a.rulerY+6)+"L"+g+" "+a.verticalGridLineLength);h.attr({stroke:"black","stroke-width":.7,"stroke-opacity":this._GRID_OPACITY})}}else if(f%5==0){var h=this.raphael.path("M"+g+" "+(a.rulerY-4)+"L"+g+" "+(a.rulerY+4));h.attr({fill:"grey",stroke:"grey",fill:1,"stroke-width":1})}}var i=this.raphael.text(a.leftMargin,a.belowRuler,""+a.requestedStart);i.attr({fill:"blue"});var i=this.raphael.text(a.rulerLength+a.leftMargin,a.belowRuler,""+a.requestedStop);if(i.attr({fill:"blue"}),"true"==a.verticalGrid||1==a.verticalGrid){var h=this.raphael.path("M"+a.leftMargin+" "+(a.rulerY+6)+"L"+a.leftMargin+" "+a.verticalGridLineLength);h.attr({stroke:"black","stroke-width":.7,"stroke-opacity":this._GRID_OPACITY});var h=this.raphael.path("M"+(a.rulerLength+a.leftMargin)+" "+(a.rulerY+6)+"L"+(a.rulerLength+a.leftMargin)+" "+a.verticalGridLineLength);h.attr({stroke:"black","stroke-width":.7,"stroke-opacity":this._GRID_OPACITY})}var j=this.raphael.path("M"+a.leftMargin+" "+a.sequenceLineY+"L"+(a.sizeX-a.rightMargin)+" "+a.sequenceLineY);j.attr({fill:"blue",stroke:"blue",fill:1,"stroke-width":1}),this._paintHorizontalGridLines(a.horizontalGrid,a.horizontalGridNumLines,a.gridLineHeight,a.nonOverlapping,a.leftMargin,a.rightMargin,a.sequenceLineY,a.rulerY,a.sizeX,this.raphael)},_paintSlider:function(){if(1==this.opt.showSlider){var a=this.opt.json.configuration,b=a.requestedStart,c=a.requestedStop,d=a.sequenceLength,e=this._getElementWithinTarget("uniprotFeaturePainter-slider");if(!e)return;this.slider_start=b,this.slider_stop=c,e.text(""),e.append('<label for="uniprotFeaturePainter-slider-values"></label>'),e.append('<div type="text" id="uniprotFeaturePainter-slider-values" style="margin-bottom:5px" />');var f=this;this.zoomSlider=jQuery('<div id="uniprotFeaturePainter-slider-bar" style="width:300px"></div>').appendTo(e),this._getElementWithinTarget("uniprotFeaturePainter-slider-bar").slider({range:!0,min:1,max:d,values:[b,c],slide:function(a,b){f._getElementWithinTarget("uniprotFeaturePainter-slider-values").html("Zoom - Start: "+b.values[0]+", End: "+b.values[1]),slider_start=b.values[0],slider_stop=b.values[1]},change:function(a,b){f._repaint(void 0,b.values[0],b.values[1])}}),this._getElementWithinTarget("uniprotFeaturePainter-slider-values").html("Zoom - Start:"+b+", End:"+c)}},_repaint:function(a,b,c){var d=this.opt.json.configuration;if(b&&c&&(this.slider_start=b,this.slider_stop=c),0!=this.slider_start&&0!=this.slider_stop&&(d.requestedStart=this.slider_start,d.requestedStop=this.slider_stop),d.unitSize=d.rulerLength/(d.requestedStop-d.requestedStart+1),this._clear(a),this._paintRuler(),!a)for(var e=0;e<this.opt.json.featuresArray.length;e++){var f=this.opt.json.featuresArray[e];f.featureEnd<d.requestedStart||f.featureStart>d.requestedStop||this._applyZoomToFeature(f)}this._paintJson(a),this._paintKey()},_withSliderAndButton:function(a,b,c){var d='<table width="'+a+'px"><tr><td width="75%"><div  id="uniprotFeaturePainter-slider" style="margin-left: 10px;"></div></td><td valign="bottom" align="right"><div id="uniprotFeaturePainter-printButton"><input type="button" value="Export to image" onclick="Biojs_FeatureViewer_array['+this.instance+'].exportFeaturesToImage();"/></div> </td></tr></table><br/><div id="uniprotFeaturePainter-divimage" style="display: none;"><img id="uniprotFeaturePainter-image" alt="Features image"></div><div id="uniprotFeaturePainter-divcanvas" style="display: none;"><canvas id="uniprotFeaturePainter-canvas" height="'+(b+c)+'" width="'+a+'" style="width: '+a+"px; height: "+a+'px;"></canvas></div>';return d},_withSliderOnly:function(a){var b='<table width="'+a+'px"><tr><td width="75%"><div  id="uniprotFeaturePainter-slider" style="margin-left: 10px;"></div></td></tr></table><br/>';return b},_withButtonOnly:function(a,b,c){var d='<table width="'+a+'px"><tr><td valign="bottom" align="right"><div id="uniprotFeaturePainter-printButton"><input type="button" value="Export to image" onclick="Biojs_FeatureViewer_array['+this.instance+'].exportFeaturesToImage();"/></div> </td></tr></table><br/><div id="uniprotFeaturePainter-divimage" style="display: none;"><img id="uniprotFeaturePainter-image" alt="Features image"></div><div id="uniprotFeaturePainter-divcanvas" style="display: none;"><canvas id="uniprotFeaturePainter-canvas" height="'+(b+c)+'" width="'+a+'" style="width: '+a+"px; height: "+a+'px;"></canvas></div>';return d},_raiseEvent:function(a,b,c,d){if(connection=a.connections[b.connectionIndex-1])try{b=connection.from}catch(e){}a.raiseEvent(d,{featureId:c.featureId,featureLabel:c.featureLabel,featureStart:c.featureStart,featureEnd:c.featureEnd,featureTypeLabel:c.featureTypeLabel,typeCode:c.typeCode,typeCategory:c.typeCategory,evidenceText:c.evidenceText,evidenceCode:c.evidenceCode,shape:b})},_featureClick:function(a,b,c,d){if(b._clickCounter=b._clickCounter+1,a?(b._originalColor=c.attrs.stroke,b._originalFillColor=c.attrs.fill):b._clickCounter>1&&(b._originalColor=c.attrs.stroke,b._originalFillColor=c.attrs.fill),c.animate({"fill-opacity":1},500),c==b._previousClickedShape)b._originalColor==b.opt.selectionColor?(b._originalColor=b._previousClickedColor,b._originalFillColor=b._previousClickedFillColor,c.attr({stroke:b._previousClickedColor,fill:b._previousClickedFillColor}),d.isSelected=!1,b._raiseEvent(b,c,d,"onFeatureUnselected")):((a||b._clickCounter%2!=0)&&(c.attr({stroke:b.opt.selectionColor,fill:b.opt.selectionColor}),c.animate({"fill-opacity":1},500)),d.isSelected=!0,b._raiseEvent(b,c,d,"onFeatureSelected"));else{if(b._previousClickedShape&&""!=b._previousClickedShape)try{b._previousClickedShape.attr({stroke:b._previousClickedColor,fill:b._previousClickedFillColor}),b._previousClickedShape.animate({"fill-opacity":.5},500),b._previousClickedFeature.isSelected=!1,b._raiseEvent(b,b._previousClickedShape,d,"onFeatureUnselected")}catch(e){Biojs.console.log(e)}b._previousClickedColor=b._originalColor,b._previousClickedFillColor=b._originalFillColor,b._previousClickedShape=c,b._previousClickedFeature=d,a&&(c.attr({stroke:b.opt.selectionColor,fill:b.opt.selectionColor}),c.animate({"fill-opacity":1},500)),d.isSelected=!0,b._raiseEvent(b,c,d,"onFeatureSelected")}b._raiseEvent(b,c,d,"onFeatureClick")},_paint:function(a,b){var c,d=1;if("path"==a.type)if(a.featureId||!b)c=this.raphael.path(a.path),c.attr({fill:a.fill,stroke:a.stroke,"fill-opacity":a.fillOpacity});else{var e=this.raphael.path(a.path);e.attr({fill:a.fill,stroke:a.stroke,"stroke-width":a.strokeWidth})}else if("text"==a.type)if(a.featureId||!b)c=this.raphael.text(a.x,a.y,a.text),c.attr({stroke:a.stroke,"fill-opacity":a.fillOpacity,"stroke-width":2});else{var f=this.raphael.text(a.x,a.y,a.text);f.attr({fill:a.fill})}else if("circle"==a.type)c=this.raphael.circle(a.cx,a.cy,a.r),c.attr({fill:a.fill,stroke:a.stroke,"fill-opacity":a.fillOpacity});else if("rect"==a.type)0==a.width&&(a.width=1),c=this.raphael.rect(a.x,a.y,a.width,a.height),c.attr({fill:a.fill,stroke:a.stroke,"fill-opacity":a.fillOpacity});else if("diamond"==a.type)c=this.raphael.uniprotFeaturePainter_diamond(a.cx,a.cy,a.r),c.attr({fill:a.fill,stroke:a.stroke,"fill-opacity":a.fillOpacity});else if("bridge"==a.type)c=this.raphael.uniprotFeaturePainter_bridge(a.cx,a.cy,a.width,a.height),a.fill="none",c.attr({fill:a.fill,stroke:a.stroke,"fill-opacity":0});else if("triangle"==a.type)c=this.raphael.uniprotFeaturePainter_triangle(a.cx,a.cy,a.r),c.attr({fill:a.fill,stroke:a.stroke,"fill-opacity":a.fillOpacity});else if("conPath"==a.type){var g=4,h=8;if("N"==a.text)c=this.raphael.uniprotFeaturePainter_NPath(a.x,a.y,g,h);else if("O"==a.text)c=this.raphael.uniprotFeaturePainter_OPath(a.x,a.y,g,h);else if("C"==a.text)c=this.raphael.uniprotFeaturePainter_CPath(a.x,a.y,g,h);else{g=2,h=6;var i=4;c=this.raphael.uniprotFeaturePainter_CONPath(a.x,a.y,g,h,i)}c.attr({stroke:a.stroke,"fill-opacity":a.fillOpacity,"stroke-width":2})}else"wave"==a.type?(c=this.raphael.uniprotFeaturePainter_wave(a.cx,a.cy,a.r),c.attr({fill:a.fill,stroke:a.stroke,"fill-opacity":a.fillOpacity})):"hexagon"==a.type&&(c=this.raphael.uniprotFeaturePainter_hexagon(a.cx,a.cy,a.r),c.attr({fill:a.fill,stroke:a.stroke,"fill-opacity":a.fillOpacity}));if(a.isSelected&&(this._previousClickedShape=c,this._previousClickedColor=c.attrs.stroke,this._previousClickedFeature=a,c.attr({fill:this.opt.selectionColor,stroke:this.opt.selectionColor,"fill-opacity":this.opt.selectionColor})),b){var j=this;if(this.opt.selectFeatureOnMouseClick?this.opt.highlightFeatureOnMouseOver?(_clickedShape=!1,c.click(function(){_clickedShape=!0,j._featureClick(!1,j,this,a)}),c.hover(function(){j._originalColor=c.attrs.stroke,j._originalFillColor=c.attrs.fill,this.attr({stroke:j.opt.selectionColor,fill:j.opt.selectionColor}),this.animate({"fill-opacity":1},500),j._raiseEvent(j,this,a,"onFeatureOn")},function(){_clickedShape||this.attr({stroke:j._originalColor,fill:j._originalFillColor}),_clickedShape=!1,j._clickCounter=0,this.animate({"fill-opacity":.5},500),j._raiseEvent(j,this,a,"onFeatureOff")})):(c.click(function(){j._featureClick(!0,j,this,a)}),c.hover(function(){j._raiseEvent(j,this,a,"onFeatureOn")},function(){this.animate({"fill-opacity":.5},500),j._raiseEvent(j,this,a,"onFeatureOff")})):this.opt.highlightFeatureOnMouseOver?(c.click(function(){j._raiseEvent(j,this,a,"onFeatureClick")
}),c.hover(function(){j._originalColor=this.attrs.stroke,j._originalFillColor=c.attrs.fill,this.attr({stroke:j.opt.selectionColor,fill:j.opt.selectionColor}),this.animate({"fill-opacity":1},500),j._raiseEvent(j,this,a,"onFeatureOn")},function(){this.attr({stroke:j._originalColor,fill:j._originalFillColor}),this.animate({"fill-opacity":.5},500),j._raiseEvent(j,this,a,"onFeatureOff")})):(c.click(function(){j._raiseEvent(j,this,a,"onFeatureClick")}),c.hover(function(){j._raiseEvent(j,this,a,"onFeatureOn")},function(){j._raiseEvent(j,this,a,"onFeatureOff")})),"rect"!=a.type&&"bridge"!=a.type){this.opt.dragSites&&c.drag(function(a,b){if(this.attr("cx")||this.attr("x")){var c="rect"==this.type||"text"==this.type?{x:this.ox+a,y:this.oy+b}:{cx:this.ox+a,cy:this.oy+b};this.attr(c)}else{var d=a-this.ox,e=b-this.oy;this.translate(d,e),this.ox=a,this.oy=b}j.raphael.uniprotFeaturePainter_connection(j.connections[this.connectionIndex-1]),j.raphael.safari()},function(){this.attr("cx")||this.attr("x")?(this.ox=this.attr("rect"==this.type||"text"==this.type?"x":"cx"),this.oy=this.attr("rect"==this.type||"text"==this.type?"y":"cy")):(this.ox=0,this.oy=0),this.animate({"fill-opacity":1},500)},function(){this.animate({"fill-opacity":.5},500)});var k=this.raphael.circle(a.x,b,d);k.attr({fill:1,stroke:a.stroke,"stroke-width":1});try{var l=this.raphael.uniprotFeaturePainter_connection(k,c,"#000");this.connections.push(l),c.connectionIndex=this.connections.length}catch(m){Biojs.console.log(m)}}}if(1==this.opt.showFeatureTooltipOnMouseOver&&a.featureId){a.featureId=a.featureId.replace(/:|\./g,"_"),c.node.id="uniprotFeaturePainter_"+a.featureId;var n=a.featureLabel+" ("+a.featureStart+", "+a.featureEnd+"; length "+(a.featureEnd-a.featureStart+1)+")<br/>Type: "+a.featureTypeLabel+" - "+a.typeCode+" - "+a.typeCategory+"<br/>Evidence: "+a.evidenceText+" - "+a.evidenceCode,o=j._getElementWithinTarget("uniprotFeaturePainter_"+a.featureId);o.tooltip({track:!0,delay:0,showURL:!1,bodyHandler:function(){return n}})}this.raphael.safari()},_increaseKeyTotal:function(a){for(var b=this.opt.json.legend.key,c=0;c<b.length;c++)if(b[c].label.text==a)return void(b[c].label.total=b[c].label.total+1)},_applyZoomToFeature:function(a){config=this.opt.json.configuration,1!=config.requestedStart?(fstart=a.featureStart-config.requestedStart,fstop=a.featureEnd-config.requestedStart):(fstart=a.featureStart,fstop=a.featureEnd),xInit=Math.round(fstart*config.unitSize+config.leftMargin),xEnd=Math.round(fstop*config.unitSize+config.leftMargin),width=xEnd-xInit,"hexagon"==a.type&&(xInit-=a.r/2),a.cx=xInit,a.x=xInit,a.width=width},_paintHorizontalGridLines:function(a,b,c,d,e,f,g,h,j,k){if("true"==a||1==a){for(i=1;b>=i;i++)if(d){var l=k.path("M"+e+" "+(h+(i+1)*c)+"L"+(j-f)+" "+(h+(i+1)*c));l.attr({stroke:"black","stroke-width":.7,"stroke-opacity":this._GRID_OPACITY})}else{var m=k.path("M"+e+" "+(g+i*c)+"L"+(j-f)+" "+(g+i*c));m.attr({stroke:"black","stroke-width":.7,"stroke-opacity":this._GRID_OPACITY});var l=k.path("M"+e+" "+(g-i*c)+"L"+(j-f)+" "+(g-i*c));l.attr({stroke:"black","stroke-width":.7,"stroke-opacity":this._GRID_OPACITY})}if(!d&&0!=b){var m=k.path("M"+e+" "+(g+(b+1)*c)+"L"+(j-f)+" "+(g+(b+1)*c));m.attr({stroke:"black","stroke-width":.7,"stroke-opacity":this._GRID_OPACITY})}if(d&&0!=b){var m=k.path("M"+e+" "+(h+(b+2)*c)+"L"+(j-f)+" "+(h+(b+2)*c));m.attr({stroke:"black","stroke-width":.7,"stroke-opacity":this._GRID_OPACITY})}}},_paintVerticalGridLines:function(a,b,c,d,e,f,g,h){var i=1*d/f,j=1*(b-c+1)/i,k=d/(10*i);i=Math.round(i),j=Math.round(j);for(var l=1;10*i>l;l++){var m=Math.round(l*k+g);if(b>j*l/10&&l%10==0){var n=h.path("M"+m+" "+(e+6)+"L"+m+" "+a);n.attr({stroke:"black","stroke-width":.7,"stroke-opacity":this._GRID_OPACITY})}}},_updateFeaturesToStyle:function(a){a==this._ROWS?(this.opt.json.configuration.sequenceLineY=this.opt.json.configuration.sequenceLineYRows,this.opt.json.configuration.sizeY=this.opt.json.configuration.sizeYRows,this.opt.json.configuration.verticalGridLineLength=this.opt.json.configuration.verticalGridLineLengthRows,this.opt.json.configuration.horizontalGridNumLines=this.opt.json.configuration.horizontalGridNumLinesRows,this.opt.json.legend.segment.yPos=this.opt.json.legend.segment.yPosRows,this.opt.json.configuration.nonOverlapping=!1):a==this._NON_OVERLAPPING?(this.opt.json.configuration.sequenceLineY=this.opt.json.configuration.sequenceLineYNonOverlapping,this.opt.json.configuration.sizeY=this.opt.json.configuration.sizeYNonOverlapping,this.opt.json.configuration.verticalGridLineLength=this.opt.json.configuration.verticalGridLineLengthNonOverlapping,this.opt.json.configuration.horizontalGridNumLines=this.opt.json.configuration.horizontalGridNumLinesNonOverlapping,this.opt.json.legend.segment.yPos=this.opt.json.legend.segment.yPosNonOverlapping,this.opt.json.configuration.nonOverlapping=!0):(this.opt.json.configuration.sequenceLineY=this.opt.json.configuration.sequenceLineYCentered,this.opt.json.configuration.sizeY=this.opt.json.configuration.sizeYCentered,this.opt.json.configuration.verticalGridLineLength=this.opt.json.configuration.verticalGridLineLengthCentered,this.opt.json.configuration.horizontalGridNumLines=this.opt.json.configuration.horizontalGridNumLinesCentered,this.opt.json.legend.segment.yPos=this.opt.json.legend.segment.yPosCentered,this.opt.json.configuration.nonOverlapping=!1);for(var b=0;b<this.opt.json.featuresArray.length;b++){var c=this.opt.json.featuresArray[b];a==this._ROWS?(c.cy=c.rowsStyle.y,c.y=c.rowsStyle.y,c.height=c.rowsStyle.heightOrRadius,c.r=c.rowsStyle.heightOrRadius):a==this._NON_OVERLAPPING?(c.cy=c.nonOverlappingStyle.y,c.y=c.nonOverlappingStyle.y,c.height=c.nonOverlappingStyle.heightOrRadius,c.r=c.nonOverlappingStyle.heightOrRadius):(c.cy=c.centeredStyle.y,c.y=c.centeredStyle.y,c.height=c.centeredStyle.heightOrRadius,c.r=c.centeredStyle.heightOrRadius)}for(var b=0;b<this.opt.json.legend.key.length;b++){var c=this.opt.json.legend.key[b].shape;a==this._ROWS?(this.opt.json.legend.key[b].label.yPos=this.opt.json.legend.key[b].label.yPosRows,c.cy=c.rowsStyle.y,c.y=c.rowsStyle.y,c.height=c.rowsStyle.heightOrRadius,c.r=c.rowsStyle.heightOrRadius):a==this._NON_OVERLAPPING?(this.opt.json.legend.key[b].label.yPos=this.opt.json.legend.key[b].label.yPosNonOverlapping,c.cy=c.nonOverlappingStyle.y,c.y=c.nonOverlappingStyle.y,c.height=c.nonOverlappingStyle.heightOrRadius,c.r=c.nonOverlappingStyle.heightOrRadius):(this.opt.json.legend.key[b].label.yPos=this.opt.json.legend.key[b].label.yPosCentered,c.cy=c.centeredStyle.y,c.y=c.centeredStyle.y,c.height=c.centeredStyle.heightOrRadius,c.r=c.centeredStyle.heightOrRadius)}},initRaphael:function(){Raphael.fn.uniprotFeaturePainter_hexagon=function(a,b,c){a-=c/2;var d=["M",a,b];return d=d.concat(["L",a-c,b+c/2]),d=d.concat(["L",a,b+c]),d=d.concat(["L",a+c,b+c]),d=d.concat(["L",a+c+c,b+c/2]),d=d.concat(["L",a+c,b]),this.path(d.concat(["Z"]).join(" "))},Raphael.fn.uniprotFeaturePainter_triangle=function(a,b,c){var d=["M",a,b];return d=d.concat(["L",a+c/2,b+c]),d=d.concat(["L",a-c/2,b+c]),this.path(d.concat(["Z"]).join(" "))},Raphael.fn.uniprotFeaturePainter_wave=function(a,b,c){var d=["M",a,b];return d=d.concat(["L",a-c/2,b-c]),d=d.concat(["L",a-c,b]),d=d.concat(["L",a-c,b+c]),d=d.concat(["L",a-c/2,b+c/2]),d=d.concat(["L",a,b+c]),d=d.concat(["L",a+c/2,b+c/2]),d=d.concat(["L",a+c,b+c]),d=d.concat(["L",a+c,b]),d=d.concat(["L",a+c/2,b-c]),this.path(d.concat(["Z"]).join(" "))},Raphael.fn.uniprotFeaturePainter_diamond=function(a,b,c){var d=["M",a,b];return d=d.concat(["L",a-c,b+c]),d=d.concat(["L",a,b+2*c]),d=d.concat(["L",a+c,b+c]),this.path(d.concat(["Z"].join(" ")))},Raphael.fn.uniprotFeaturePainter_bridge=function(a,b,c,d){var e=["M",a,b-1];return e=e.concat(["L",a,b-1-d]),e=e.concat(["L",a+c,b-1-d]),e=e.concat(["L",a+c,b-1]),this.path(e)},Raphael.fn.uniprotFeaturePainter_NPath=function(a,b,c,d){var e=["M",a-c,b+d];return e=e.concat(["L",a-c,b]),e=e.concat(["L",a+c,b+d-1]),e=e.concat(["L",a+c,b-1]),this.path(e)},Raphael.fn.uniprotFeaturePainter_OPath=function(a,b,c,d){var e=["M",a,b];return e=e.concat(["C",a-c,b,a-c,b+d,a,b+d]),e=e.concat(["M",a,b]),e=e.concat(["C",a+c,b,a+c,b+d,a,b+d]),this.path(e)},Raphael.fn.uniprotFeaturePainter_CPath=function(a,b,c,d){var e=["M",a+c,b];return e=e.concat(["C",a-c,b,a-c,b+d,a+c,b+d]),this.path(e)},Raphael.fn.uniprotFeaturePainter_CONPath=function(a,b,c,d,e){var f=["M",a-c-e,b];return f=f.concat(["C",a-c-e-2*c,b,a-c-e-2*c,b+d,a-c-e,b+d]),f=f.concat(["M",a-c-e+1,b+d/2]),f=f.concat(["L",a-c-1,b+d/2]),f=f.concat(["M",a,b]),f=f.concat(["C",a-c,b,a-c,b+d,a,b+d]),f=f.concat(["M",a,b]),f=f.concat(["C",a+c,b,a+c,b+d,a,b+d]),f=f.concat(["M",a+c+1,b+d/2]),f=f.concat(["L",a+c+e-1,b+d/2]),f=f.concat(["M",a+c+e,b+d]),f=f.concat(["L",a+c+e,b-2]),f=f.concat(["L",a+3*c+e,b+d]),f=f.concat(["L",a+3*c+e,b-2]),this.path(f)},Raphael.fn.uniprotFeaturePainter_connection=function(a,b,c,d){a.line&&a.from&&a.to&&(c=a,a=c.from,b=c.to);var e=a.getBBox();e.x||"circle"!=a.type||(e={height:2*a.attrs.r,width:2*a.attrs.r,x:a.attrs.cx-a.attrs.r,y:a.attrs.cy-a.attrs.r});var f=b.getBBox();f.x||"circle"!=b.type||(f={height:2*b.attrs.r,width:2*b.attrs.r,x:b.attrs.cx-b.attrs.r,y:b.attrs.cy-b.attrs.r});for(var g=[{x:e.x+e.width/2,y:e.y-1},{x:e.x+e.width/2,y:e.y+e.height+1},{x:e.x-1,y:e.y+e.height/2},{x:e.x+e.width+1,y:e.y+e.height/2},{x:f.x+f.width/2,y:f.y-1},{x:f.x+f.width/2,y:f.y+f.height+1},{x:f.x-1,y:f.y+f.height/2},{x:f.x+f.width+1,y:f.y+f.height/2}],h={},i=[],j=0;4>j;j++)for(var k=4;8>k;k++){var l=Math.abs(g[j].x-g[k].x),m=Math.abs(g[j].y-g[k].y);(j==k-4||(3!=j&&6!=k||g[j].x<g[k].x)&&(2!=j&&7!=k||g[j].x>g[k].x)&&(0!=j&&5!=k||g[j].y>g[k].y)&&(1!=j&&4!=k||g[j].y<g[k].y))&&(i.push(l+m),h[i[i.length-1]]=[j,k])}if(0==i.length)var n=[0,4];else n=h[Math.min.apply(Math,i)];var o=g[n[0]].x,p=g[n[0]].y,q=g[n[1]].x,r=g[n[1]].y;l=Math.max(Math.abs(o-q)/2,10),m=Math.max(Math.abs(p-r)/2,10);var s=[o,o,o-l,o+l][n[0]].toFixed(3),t=[p-m,p+m,p,p][n[0]].toFixed(3),u=[0,0,0,0,q,q,q-l,q+l][n[1]].toFixed(3),v=[0,0,0,0,p+m,p-m,r,r][n[1]].toFixed(3),w=["M",o.toFixed(3),p.toFixed(3),"C",s,t,u,v,q.toFixed(3),r.toFixed(3)].join(",");if(!c||!c.line){var x="string"==typeof c?c:"#000";return{bg:d&&d.split&&this.path(w).attr({stroke:d.split("|")[0],fill:"none","stroke-width":d.split("|")[1]||3}),line:this.path(w).attr({stroke:x,fill:"none"}),from:a,to:b}}c.bg&&c.bg.attr({path:w}),c.line.attr({path:w})}}});var Biojs_FeatureViewer_array=new Array;Biojs.GeneExpressionSummary=Biojs.extend({constructor:function(){this.setIdentifier(this.opt.identifier)},opt:{target:"YourOwnDivId",identifier:void 0,featuresUrl:"http://www-test.ebi.ac.uk/gxa/das/s4/features",legend:!0,proxyUrl:"../biojs/dependencies/proxy/proxy.php"},eventTypes:["onRequestError","onDbError"],setIdentifier:function(a){this._drawTemplate(),this._identifierDb=this._checkIdentifier(a),this._identifierDb==Biojs.GeneExpressionSummary.ID_UNIPROT?this._requestFeaturesFromUniprotAcc(a):this._identifierDb==Biojs.GeneExpressionSummary.ID_ENSEMBL?this._requestFeatures(a):this._processDbError(a)},_drawTemplate:function(){this._selector="#"+this.opt.target,this._container=jQuery(this._selector),this._container.html(""),this._container.addClass("GeneExpressionSummary"),this._title=jQuery('<div class="GeneExpressionSummary_title"></div>').appendTo(this._container),this._table=jQuery('<table class="GeneExpressionSummary_title"></table>').appendTo(this._container),this._row=jQuery("<tr></tr>").appendTo(this._table),this._leftColumn=jQuery("<td></td>").appendTo(this._row),this._rightColumn=jQuery("<td></td>").appendTo(this._row),this._imageContainer=jQuery('<div class="GeneExpressionSummary_image"></div>').appendTo(this._rightColumn),this._summaryContainer=jQuery('<div class="GeneExpressionSummary_summary"></div>').appendTo(this._leftColumn),this._footerContainer=jQuery('<div class="GeneExpressionSummary_footer"></div>').appendTo(this._container)},_checkIdentifier:function(a){var b=this;return b._re=/^([A-N,R-Z][0-9][A-Z][A-Z, 0-9][A-Z, 0-9][0-9])|([O,P,Q][0-9][A-Z, 0-9][A-Z, 0-9][A-Z, 0-9][0-9])$/,-1!=a.search(b._re)?Biojs.GeneExpressionSummary.ID_UNIPROT:"ENSG"==a.substring(0,4)?Biojs.GeneExpressionSummary.ID_ENSEMBL:void 0},_requestFeatures:function(a){void 0!==a?a.length>0?(this.opt.identifier=a,this._requestFeaturesXML(this.opt)):(Biojs.console.log("no identifier value available"),this._displayNoDataMessage()):(Biojs.console.log("identifier value is not valid"),this._displayNoDataMessage())},_requestFeaturesXML:function(a){var b=this,c={url:a.featuresUrl,data:"segment="+a.identifier,methid:"GET",success:function(a){Biojs.console.log("SUCCESS: data received"),b._responseReceived(a)},error:this._processErrorRequest};void 0!=a.proxyUrl&&(c.url=a.proxyUrl,c.data=[{name:"url",value:a.featuresUrl+"?segment="+a.identifier}],c.dataType="text"),jQuery.ajax(c)},_responseReceived:function(a){var b=this,c="",d=[];Biojs.console.log("Decoding "+a);try{c=jQuery.parseXML(a)}catch(e){Biojs.console.log("ERROR decoding "),Biojs.console.log(e)}jQuery(c).find("FEATURE").each(function(){d.push(b._decodeFeature(this))}),d.length>0?(Biojs.console.log("Features decoded:"),Biojs.console.log(d),this._setFeatures(d)):this._displayNoDataMessage()},_displayNoDataMessage:function(){jQuery("#"+this.opt.target).html(Biojs.GeneExpressionSummary.MESSAGE_NODATA)},_decodeFeature:function(a){Biojs.console.log("Decoding feature"+a);var b=this._decodeNode(a),c=jQuery(a).children();for(i=0;i<c.length;i++){var d=this._decodeNode(c[i]);"NOTE"==c[i].nodeName?(void 0==b[c[i].nodeName]&&(b[c[i].nodeName]=[]),b[c[i].nodeName].push(d)):b[c[i].nodeName]=d}return b},_decodeNode:function(a){var b={};return jQuery.each(a.attributes,function(a,c){b[c.nodeName]=c.nodeValue}),b.text=jQuery(a).text(),b},_setFeatures:function(a){this._title.text(""),this._imageContainer.text(""),this._summaryContainer.text(""),this._footerContainer.text("");var b=this;for(i=0;i<a.length;i++){var c=a[i];if(Biojs.GeneExpressionSummary.TYPE_DESCRIPTION==c.TYPE.id)this._title.text(c.NOTE[0].text);else if(Biojs.GeneExpressionSummary.TYPE_IMAGE==c.TYPE.id){var d=jQuery('<img src="'+c.LINK.href+'" />').appendTo(this._imageContainer);d.css("width","100%"),d.css("height","auto");var e="<p>"+c.LINK.text;this._imageContainer.append(e)}else if(Biojs.GeneExpressionSummary.TYPE_PROVENANCE==c.TYPE.id&&1==b.opt.legend){var f="";for(n in c.NOTE)f+=c.NOTE[n].text+" ";f+='<a href="'+c.LINK.href+'">'+c.LINK.href+"</a>",this._footerContainer.append(f)}else{var g='<div class="GeneExpressionSummary_subtitle">'+c.label+"</div>";g+='<div class="GeneExpressionSummary_feature">'+c.NOTE[0].text,"undefined"!=typeof c.LINK&&(g+=' <a href="'+c.LINK.href+'">view all</a></div>'),this._summaryContainer.append(g)}}},_requestFeaturesFromUniprotAcc:function(a){var b=this;b._serviceUrl="http://www.ebi.ac.uk/uniprot/biomart/martservice?query=%3C?xml%20version=%221.0%22%20encoding=%22UTF-8%22?%3E%3C!DOCTYPE%20Query%3E%3CQuery%20%20virtualSchemaName%20=%20%22default%22%20formatter%20=%20%22TSV%22%20header%20=%20%220%22%20uniqueRows%20=%20%221%22%20count%20=%20%22%22%20datasetConfigVersion%20=%20%220.6%22%20%3E%3CDataset%20name%20=%20%22uniprot%22%20interface%20=%20%22default%22%20%3E%3CFilter%20name%20=%20%22accession%22%20value%20=%20%22",b._serviceUrl+=a,b._serviceUrl+="%22/%3E%3CAttribute%20name%20=%20%22ensembl_id%22%20/%3E%3C/Dataset%3E%3C/Query%3E",b._url="",b._url=""!=b.opt.proxyUrl?b.opt.proxyUrl+"?url="+b._serviceUrl:b._serviceUrl,jQuery.ajax({type:"GET",url:b._url,dataType:"text",success:function(a){b._requestFeatures(a)},error:function(a){b._processErrorRequest(a)}})},_processErrorRequest:function(a){Biojs.console.log("ERROR: "+a),self.raiseEvent(Biojs.GeneExpressionSummary.EVT_ON_REQUEST_ERROR,{message:a})},_processDbError:function(a){var b=this;b._message="Not recognize identifier: "+a,Biojs.console.log("ERROR: "+b._message),b.raiseEvent(Biojs.GeneExpressionSummary.EVT_ON_DB_ERROR,{message:b._message})}},{EVT_ON_REQUEST_ERROR:"onRequestError",EVT_ON_DB_ERROR:"onDbError",ID_UNIPROT:"uniprot",ID_ENSEMBL:"ensembl",MESSAGE_NODATA:"Sorry, we could not find summary data for your request",TYPE_IMAGE:"image",TYPE_SUMMARY:"summary",TYPE_DESCRIPTION:"description",TYPE_PROVENANCE:"atlas-provenance"}),Biojs.HeatmapViewer=Biojs.extend({target:void 0,_MAIN_HEAT_MAP_DIV:"main_heatmap_div",_ZOOM_HEAT_MAP_DIV:"zoom_heatmap_div",_SLIDER_DIV:"slider_heatmap_div",_SCALE_DIV:"scale_div",_origData:void 0,_zoomedData:void 0,viewer_config:{dimensions:{},displayDiv:"",colorLow:"green",colorMed:"white",colorHigh:"red",scoreLow:-100,scoreMed:0,scoreHigh:100,offset:0,x_axis:[],y_axis:[],canvas_margin:{top:30,right:30,bottom:30,left:30},labels:{max_font_size:20,min_font_size:11},main_heatmap:{min_cell_width:2,max_cell_width:100,orig_cell_width:0},zoom_area:{cell_width:20},slider:{start_value:0,increments:50}},constructor:function(){this._origData=this.opt.jsonData,this.target=this.opt.target,this._init(),this._draw()},opt:{target:"YourOwnDivId",jsonData:{},showScale:!0,showExportToImageButton:!1,show_zoom_panel:!0},eventTypes:[],SCALE:function(){var a=[],b={},c=d3.behavior.drag().on("drag",function(a){a.x+=d3.event.dx,d3.select(this).attr("transform",function(a){return"translate("+[a.x]+",20)"})});return b.init=function(b){for(var d=b.scoreLow,e=b.scoreMid,f=b.scoreHigh,g=b.colorLow,h=b.colorMid,i=b.colorHigh,j=b.target,k=d;f>=k;k++)a.push(k);var l=d3.scale.linear().domain([d,e,f]).range([g,h,i]),m=50,n=20,o=d3.select("#"+j).append("svg").attr("id",j+"_svg").attr("width","100%").attr("height","40"),p=o.append("g").data([{x:m,y:n}]).attr("transform","translate("+m+",20)").call(c);p.selectAll("lines").data(a).enter().append("svg:line").attr("x1",function(a,b){return b}).attr("y1",0).attr("x2",function(a,b){return b}).attr("y1",20).style("stroke",function(a){return l(a)}).style("stroke-width",5),p.append("text").attr("y",-5).attr("x",-15).text(-100).attr("transform","translate(0, 0 )");var q=a.length/2;p.append("text").attr("class","caption").attr("y",-5).attr("x",q-2).text(0);var r=a.length;p.append("text").attr("class","caption").attr("y",-5).attr("x",r-2).text(100)},b}(jQuery),HEATMAP:function(a){var b,c={},d=20,e=11,f=void 0,g=void 0,h={axis_line_stroke:"2",axis_line_stroke_color:"#000",dimensions:{canvas_width:0,canvas_height:0,cell_width:0,cell_height:0,cell_count:0,row_count:0},x_axis:[],y_axis:[],jsonData:{},offset:0,show_frame:!0};c.settarget=function(a){return g=a,c},c.gettarget=function(){return this.target},c.init=function(b,d,e){return h=a.extend(h,b),this.settarget(e),f=d,c},getData=function(){return f};var i=function(){{var a=Math.min(h.dimensions.cell_width-10,d);b.append("svg:line").attr("x1",0).attr("y1",-3).attr("x2",h.dimensions.cell_width*(h.dimensions.cell_count+1)).attr("y2",-3).style("stroke",h.axis_line_stroke_color).style("stroke-width",h.axis_line_stroke),b.append("svg:line").attr("x1",-5).attr("y1",0).attr("x2",-5).attr("y2",h.dimensions.canvas_height).style("stroke",h.axis_line_stroke_color).style("stroke-width",h.axis_line_stroke)}b.selectAll("x_axis").data(h.x_axis).enter().append("text").style("font-size",a).text(function(a){return a}).attr("x",function(a,b){return b*h.dimensions.cell_width}).attr("y",function(){return-5}),b.selectAll("y_axis").data(h.y_axis).enter().append("text").style("font-size",a).text(function(a){return a}).attr("x",function(){return-1*(h.canvas_margin.right-5)}).attr("y",function(a,b){return b*h.dimensions.cell_width+h.dimensions.cell_width})};c.draw=function(){j(),h.dimensions.cell_width>e&&i()};var j=function(){b=d3.select("#"+g).append("svg").attr("id",g+"_svg").attr("width",h.dimensions.canvas_width+h.canvas_margin.right+h.canvas_margin.left).attr("height",h.dimensions.canvas_height+h.canvas_margin.top+h.canvas_margin.bottom).append("g").attr("transform","translate("+h.canvas_margin.right+","+h.canvas_margin.top+")");var a=d3.scale.linear().domain([h.scoreLow,h.scoreMed,h.scoreHigh]).range([h.colorLow,h.colorMed,h.colorHigh]);b.selectAll(".heatmapDiv").data(getData(),function(a){return a.col+": "+a.row}).enter().append("svg:rect").attr("x",function(a){return(a.col-h.offset)*h.dimensions.cell_width}).attr("y",function(a){return a.row*h.dimensions.cell_height}).attr("width",function(){return h.dimensions.cell_width}).attr("height",function(){return h.dimensions.cell_height}).style("fill",function(b){return b.label==b.row_label?"black ":a(b.score)}).append("svg:title").text(function(a){return a.label+a.col+a.row_label+" Score: "+a.score})};return c}(jQuery),_show_sliding_window:function(a){var b,c=this,d=a.dimensions,e=a.svg,f=d.cell_width*d.cell_count-d.frame_width,g=y=0,h=d3.behavior.drag().on("dragend",function(a){a.x<0&&(a.x=0),a.x>f&&(a.x=f),b=a.x,c._drawZoomDiv(a),d3.select(this).style("cursor","-webkit-grab"),d3.select(this).style("cursor","-moz-grab")}).on("drag",function(a){a.x+=d3.event.dx,a.y+=d3.event.dy,d3.select(this).attr("transform",function(a){return a.x<0?"translate(0)":a.x>f?"translate("+(f+10)+")":(d3.select(this).style("cursor","-webkit-grabbing"),d3.select(this).style("cursor","-moz-grabbing"),"translate("+[a.x]+")")})});e.append("svg:rect").attr("x",0).attr("y",-5).attr("width",d.frame_width).attr("height",d.height+15).style("fill-opacity",0).style("stroke","blue").style("stroke-width",4).style("cursor","-webkit-grab").style("cursor","-moz-grab").data([{x:g}]).attr("transform","translate("+g+","+y+")").call(h)},_draw:function(){var a=jQuery("#"+this.opt.target);[this._MAIN_HEAT_MAP_DIV,this._SCALE_DIV,this._ZOOM_HEAT_MAP_DIV].forEach(function(b){a.append(jQuery("<div>").attr("id",b).css("width","75%").css("margin","25px"))}),this.HEATMAP.init(this.viewer_config,this._origData,this._MAIN_HEAT_MAP_DIV).draw(),this.opt.showScale&&this.SCALE.init({colorLow:this.viewer_config.colorLow,colorMid:this.viewer_config.colorMed,colorHigh:this.viewer_config.colorHigh,scoreLow:this.viewer_config.scoreLow,scoreMid:this.viewer_config.scoreMed,scoreHigh:this.viewer_config.scoreHigh,target:this._SCALE_DIV}),this.viewer_config.dimensions.cell_width<this.viewer_config.labels.min_font_size&&(this.viewer_config.main_heatmap.orig_cell_width=this.viewer_config.dimensions.cell_width,this.opt.show_zoom_panel&&(this._show_sliding_window({dimensions:{cell_width:this.viewer_config.dimensions.cell_width,cell_count:this.viewer_config.dimensions.cell_count,frame_width:60*this.viewer_config.dimensions.cell_width,height:this.viewer_config.dimensions.row_count*this.viewer_config.dimensions.cell_width},svg:d3.select("#"+this._MAIN_HEAT_MAP_DIV+"_svg > g")}),this._drawZoomDiv()))},_init:function(){var a=this._origData,b=this.viewer_config;if("undefined"!=this.opt.user_defined_config){var c=this.opt.user_defined_config;["colorLow","colorHigh","colorMed"].forEach(function(a){b[a]&&(b[a]=c[a])})}this._calcHeatMap({start:0,end:a.length/20})},_drawZoomDiv:function(a){var b=0;"undefined"!=typeof a&&(b=Math.floor(a.x/this.viewer_config.main_heatmap.orig_cell_width));var c=b+this.viewer_config.slider.increments;this.viewer_config.offset=b,this._calcHeatMap({start:b,end:c});var d=jQuery("#"+this._ZOOM_HEAT_MAP_DIV);d&&(d.empty(),this.HEATMAP.init(this.viewer_config,this._zoomedData,this._ZOOM_HEAT_MAP_DIV).draw())},_calcHeatMap:function(a){var b,c,d={},e=[],f=[];c=0;var g=jQuery("#"+this.target);if(d.canvas_width=g.width(),this._origData){"undefined"!=typeof this.opt.jsonData&&(b=this._origData.slice(20*a.start,20*a.end),c=a.start);var h=0,i=0;jQuery.each(b,function(a,b){0==b.row&&(e.push(b.label),b.col>h&&(h=b.col)),b.col-c==0&&f.push(b.row_label),b.row>i&&(i=b.row)}),d.cell_count=h-this.viewer_config.offset,d.row_count=i;var j=Math.max(Math.min((d.canvas_width-this.viewer_config.canvas_margin.right-this.viewer_config.canvas_margin.left)/(d.cell_count+1),this.viewer_config.main_heatmap.max_cell_width),this.viewer_config.main_heatmap.min_cell_width);d.cell_height=d.cell_width=j,d.canvas_height=(d.row_count+1)*d.cell_height,this._zoomedData=b}this.viewer_config.dimensions=jQuery.extend(!0,{},d),this.viewer_config.x_axis=e,this.viewer_config.y_axis=f,this.viewer_config.slider.increments=Math.floor(d.canvas_width/this.viewer_config.zoom_area.cell_width-1)}}),Biojs.HelloWorld=Biojs.extend({constructor:function(){var a=this;for(this._container=jQuery("#"+a.opt.target),this._container.css({"font-family":a.opt.fontFamily,"background-color":a.opt.backgroundColor,color:a.opt.fontColor,"font-size":"36px","text-align":"center","vertical-align":"middle",display:"table-cell",width:"597px",height:"300px"}),this._container.css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none"}),text="Hello World!",i=0;i<text.length;i++)this._container.append("<span>"+text[i]+"</span>");this._addSelectionTrigger(),this._addSimpleClickTrigger()},opt:{target:"YourOwnDivId",fontFamily:'"Andale mono", courier, monospace',fontColor:"white",backgroundColor:"#7BBFE9",selectionFontColor:"black",selectionBackgroundColor:"yellow"},eventTypes:["onClick","onHelloSelected"],setSize:function(a){void 0!=a&&jQuery("#"+this.opt.target).css("font-size",a)},_addSelectionTrigger:function(){var a=this,b=!1;jQuery("<style> .selected { background-color:"+a.opt.selectionBackgroundColor+";color:"+a.opt.selectionFontColor+"; }</style>").appendTo("head"),this._container.find("span").mousedown(function(){b=!0,a._container.children("span").removeClass("selected"),jQuery(this).addClass("selected")}).mouseover(function(){b&&jQuery(this).addClass("selected")}).mouseup(function(){b=!1;var c="";a._container.children("span.selected").each(function(){c+=jQuery(this).text()}),"Hello"==c&&a.raiseEvent("onHelloSelected",{textSelected:c})})},_addSimpleClickTrigger:function(){var a=this;this._container.find("span").click(function(b){var c=jQuery(b.target).text(),d={selected:c};a.raiseEvent("onClick",d)})}}),Biojs.HelloWorldYUI=Biojs.extend({constructor:function(){var a=this;for($("#"+a.opt.target).css({"font-family":a.opt.fontFamily,"background-color":a.opt.backgroundColor,color:a.opt.fontColor,"font-size":"36px","text-align":"center","vertical-align":"middle",display:"table-cell",width:"597px",height:"300px"}),$("#"+a.opt.target).css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none"}),text="Hello World with YUI+jQuery!",contentHTML="",i=0;i<text.length;i++)contentHTML+="<span>"+text[i]+"</span>";$(contentHTML).appendTo("#"+a.opt.target),a._addSelectionTrigger()},opt:{target:"YourOwnDivId",fontFamily:'"Andale mono", courier, monospace',fontColor:"white",backgroundColor:"#7BBFE9",selectionFontColor:"black",selectionBackgroundColor:"yellow"},eventTypes:["onHelloSelected"],setSize:function(a){void 0!=a&&$("#"+this.opt.target).css("font-size",a)},sayHello:function(){var a=this;for(text="Hi there! who are you?",contentHTML="",i=0;i<text.length;i++)contentHTML+="<span>"+text[i]+"</span>";$("#"+a.opt.target).html(contentHTML)},_addSelectionTrigger:function(){var a=this,b=!1,c=function(b){b.hasClass("selected")?(b.removeClass("selected"),b.setStyle("color",a.opt.fontColor),b.setStyle("background-color",a.opt.backgroundColor)):(b.addClass("selected"),b.setStyle("color",a.opt.selectionFontColor),b.setStyle("background-color",a.opt.selectionBackgroundColor))};YUI().use("node",function(d){d.all("#"+a.opt.target+" span").on("mousedown",function(e){b=!0;var f=d.all("#"+a.opt.target+" span");f.removeClass("selected"),f.setStyle("color",a.opt.fontColor),f.setStyle("background-color",a.opt.backgroundColor),c(e.currentTarget)}),d.all("#"+a.opt.target+" span").on("mouseover",function(a){b&&c(a.currentTarget)}),d.all("#"+a.opt.target+" span").on("mouseup",function(){b=!1;var c="";$("#"+a.opt.target+" span.selected").each(function(){c+=$(this).text()}),"Hello"==c&&a.raiseEvent("onHelloSelected",{textSelected:c})})})}}),Biojs.HpaSummaryFeature=Biojs.extend({constructor:function(){this._draw()},_draw:function(){var a=this;a._componentPrefix="hpaSummaryFeature_",a._componentDiv=jQuery("<div></div>"),a._componentDiv.css("width",a.opt.width),a._leftColumn=jQuery('<td class="'+a._componentPrefix+'leftColumn"></td>'),a._leftColumn.css({width:a.opt.imageWidth,"vertical-align":"top"}),a._rightColumn=jQuery('<td class="'+a._componentPrefix+'rightColumn"></td>'),a._rightColumn.css({"vertical-align":"top"}),a._mainRow=jQuery("<tr></tr>"),a._mainRow.append(a._leftColumn),a._mainRow.append(a._rightColumn),a._table=jQuery('<table class="'+a._componentPrefix+'table"></table>'),a._table.append(a._mainRow),a._table.css("width","100%"),a._leftContainer=jQuery('<div class="'+a._componentPrefix+'leftContainer"></div>'),""!=a.opt.imageTitle&&(a._imageTitle=jQuery('<div class="'+a._componentPrefix+'imageTitle">'+a.opt.imageTitle+"</div>")),""!=a.opt.imageUrl&&(a._image=jQuery('<img src="'+a.opt.imageUrl+'" class="'+a._componentPrefix+'image" />'),a._image.css({width:"100%"}),""!=a.opt.imageTitle&&a._image.attr({alt:"HPA image",title:a.opt.imageTitle})),a._linkImage=jQuery('<div class="'+a._componentPrefix+'linkImage" ></div>'),""!=a.opt.linkUrl?(a._link=jQuery('<a target="_blank" href="'+a.opt.linkUrl+'"></a>'),""!=a.opt.linkTitle&&a._link.attr({title:a.opt.linkTitle}),""!=a.opt.imageUrl&&a._link.append(a._image),a._link.append(a._linkImage),a._leftContainer.append(a._link),""!=a.opt.imageTitle&&""!=a.opt.imageUrl&&a._leftContainer.append(a._imageTitle)):(a._leftContainer.append(a._image),""!=a.opt.imageTitle&&""!=a.opt.imageUrl&&a._leftContainer.appenf(a._imageTitle)),a._contentTitle=jQuery('<div class="'+a._componentPrefix+'contentTitle">'+a.opt.title+"</div>"),a._contentNotes=jQuery('<ul class="'+a._componentPrefix+'contentNotes"></ul>'),jQuery.each(a.opt.notes,function(b,c){a._contentNotes.append(jQuery("<li>"+c+"</li>"))}),jQuery("#"+a.opt.target).append(a._componentDiv),a._componentDiv.append(a._table),a._leftColumn.append(a._leftContainer),a._rightColumn.append(a._contentTitle),a._rightColumn.append(a._contentNotes)},opt:{target:"",title:"",imageUrl:"",imageTitle:"",notes:[],linkUrl:"",linkTitle:"",width:"900px",imageWidth:"200px"},eventTypes:["onTextSelected"]}),Biojs.HpaSummaryFeatures=Biojs.HpaSummaryFeature.extend({constructor:function(){var a=this;this.setHpaDasUrl(a.opt.hpaDasUrl)},setHpaDasUrl:function(a){var b=this;b._url,b._url=""!=b.opt.proxyUrl?b.opt.proxyUrl+"?url="+a:a,jQuery.ajax({type:"GET",url:b._url,dataType:"xml",success:function(a){b._processDasHpaXml(a)},error:function(a){b._processErrorRequest(a)}})},_processDasHpaXml:function(a){var b=this;Biojs.console.log("SUCCESS: data received");var c=this._getAntibodiesAccessions(a);if(c.length>0){var d=this._createHtmlContainer(c);jQuery("#"+b.opt.target).html(d),this._displayHpaSummaries(a,c)}else jQuery("#"+b.opt.target).html(Biojs.HpaSummaryFeatures.MESSAGE_NODATA)},_processErrorRequest:function(a){var b=this;Biojs.console.log("ERROR: "+a),b.raiseEvent(Biojs.HpaSummaryFeatures.EVT_ON_REQUEST_ERROR,{message:a})},_getAntibodiesAccessions:function(a){var b=new Object;jQuery(a).find("PARENT").each(function(){var a=jQuery(this).attr("id").split("_");2==a.length&&(b[a[0]]=!0)});var c=new Array;for(var d in b)c.push(d);return c},_createHtmlContainer:function(a){var b=this,c="";return jQuery.each(a,function(a,d){c+='<div style="width:'+b.opt.width+';" class="'+Biojs.HpaSummaryFeatures.COMPONENT_PREFIX+'antibodyTitle">Antibody '+d+"</div>",c+='<div class="'+Biojs.HpaSummaryFeatures.COMPONENT_PREFIX+'summary" id="'+d+'_cell_line_immunofluorescence_summary"></div>',c+='<div class="'+Biojs.HpaSummaryFeatures.COMPONENT_PREFIX+'summary" id="'+d+'_cell_line_immunohistochemistry_summary"></div>',c+='<div class="'+Biojs.HpaSummaryFeatures.COMPONENT_PREFIX+'summary" id="'+d+'_cell_line_immunohistochemistry_summary"></div>',c+='<div class="'+Biojs.HpaSummaryFeatures.COMPONENT_PREFIX+'summary" id="'+d+'_cancer_tissue_immunohistochemistry_summary"></div>',c+='<div class="'+Biojs.HpaSummaryFeatures.COMPONENT_PREFIX+'summary" id="'+d+'_normal_tissue_immunohistochemistry_summary"></div>'}),c},_displayHpaSummaries:function(a){var b=this;
jQuery(a).find("FEATURE").each(function(){if(-1!=jQuery(this).attr("id").indexOf("_summary")){var a=new Array,c=jQuery(this).find("NOTE");c.each(function(){a.push(jQuery(this).text())});var d="",e="",f="",g="",h=jQuery(this).find("LINK");h.each(function(){-1!=jQuery(this).attr("href").indexOf(".jpg")||-1!=jQuery(this).attr("href").indexOf(".png")?(d=jQuery(this).attr("href"),e=jQuery(this).text()):-1!=jQuery(this).text().indexOf("original source")&&(f=jQuery(this).attr("href"),g=jQuery(this).text())}),new Biojs.HpaSummaryFeature({target:jQuery(this).attr("id"),title:jQuery(this).attr("label"),imageUrl:d,imageTitle:e,notes:a,linkUrl:f,linkTitle:g,width:b.opt.width,imageWidth:b.opt.imageWidth})}})},opt:{target:"hpaSummaryFeatues",hpaDasUrl:"",proxyUrl:"../biojs/dependencies/proxy/proxy.php",width:"900px",imageWidth:"200px"},eventTypes:["onRequestError"]},{COMPONENT_PREFIX:"hpaSummaryFeatures_",MESSAGE_NODATA:"Sorry, we could not find summary data for your request",EVT_ON_REQUEST_ERROR:"onRequestError"}),Biojs.InteractionsBundleD3=Biojs.extend({cluster:null,bundle:null,vis:null,splines:[],model:{},organisms:{},proteins:[],interactions:[],interactionsA:{},svg:null,tTranslate:null,tScale:null,constructor:function(){function a(a,c,d){var e=null,f=null;"undefined"!=typeof a&&"undefined"!=typeof c?(e=[a,c],f=d):(e=d3.event.translate,f=d3.event.scale),b.tTranslate=e,b.tScale=f;var g=b.rect[0][0].width.animVal.value,h=b.rect[0][0].height.animVal.value,i=g*f,j=h*f;i/2<g/2+e[0]&&(e[0]=(i-g)/2),j/2<h/2+e[1]&&(e[1]=(j-h)/2),i/2<g/2-e[0]&&(e[0]=(g-i)/2),j/2<h/2-e[1]&&(e[1]=(h-j)/2),b.svg.attr("transform","translate("+e+") scale("+f+")")}var b=this;b.cluster=null,b.bundle=null,b.vis=null,b.splines=[],b.model={name:"",children:[]},b.organisms={},b.proteins=[],b.interactions=[],b.svg=null,b.interactionsA={},this._container=$("#"+b.opt.target),this._container.empty(),$(this._container).addClass("graphCircle");var c=$(this._container).width(),d=$(this._container).height();c=-1!=b.opt.width.indexOf("%")?1*c*b.opt.width.substring(0,b.opt.width.length-1)/100:1*b.opt.width,b.opt.width=c,d=-1!=b.opt.height.indexOf("%")?1*d*b.opt.height.substring(0,b.opt.height.length-1)/100:1*b.opt.height,b.opt.height=d;var e=c/2,f=d/2,g=f>e?e:f;b.cluster=d3.layout.cluster().size([360,g-b.opt.textLength]).sort(function(a,b){return d3.ascending(a.key,b.key)}),b.bundle=d3.layout.bundle(),b.line=d3.svg.line.radial().interpolate("bundle").tension(.45).radius(function(a){return a.y}).angle(function(a){return a.x/180*Math.PI}),this._container.width(c),this._container.height(d),b.color=function(){return d3.scale.ordinal().range(b.colors)}(),b.vis=d3.select("#"+b.opt.target).insert("div","h2").style("width",c+"px").style("height",d+"px"),b.zoom=d3.behavior.zoom().scaleExtent([1,10]).on("zoom",a),b.svg=b.vis.append("svg:svg").attr("width",c).attr("height",d).append("svg:g").attr("id","innergroup").attr("transform","translate("+e+","+f+")").attr("pointer-events","all").call(b.zoom).append("svg:g"),b.rect=b.svg.append("svg:rect").attr("class","frame").attr("width",c).attr("height",d).attr("fill","white").attr("stroke","grey").attr("transform","translate(-"+e+", -"+f+")").attr("stroke-dasharray","5,5"),b.svg.append("svg:path").attr("class","arc").attr("d",d3.svg.arc().outerRadius(f-120).innerRadius(0).startAngle(0).endAngle(2*Math.PI)),b.redraw=a,b.restart()},opt:{target:"YourOwnDivId",width:"100%",height:"500",radius:4,textLength:120},eventTypes:["proteinClick","proteinMouseOver","proteinMouseOut","interactionClick","interactionMouseOver","interactionMouseOut","sizeChanged"],setSize:function(a,b){var c=this;c.opt.width=a,c.opt.height=b,d3.select("#"+c.opt.target+" svg").attr("width",a).attr("height",b),d3.select("#"+c.opt.target+" .frame").attr("width",a).attr("height",b).attr("transform","translate(-"+c.opt.width/2+",-"+c.opt.height/2+")"),c._container.width(a),c._container.height(b);var d=c.opt.height;d<c.opt.width&&(d=c.opt.width),c.cluster.size([360,d/2-c.opt.textLength]),d3.select("#innergroup").attr("transform","translate("+c.opt.width/2+","+c.opt.height/2+")"),c.svg.selectAll("path.link").remove(),c.svg.selectAll("g.node").remove(),c.svg.selectAll("circle.figure").remove(),c.restart(),c.raiseEvent("sizeChanged",{width:a,height:b})},addInteraction:function(a,b,c){var d=this,e=d.getProtein(a);if("undefined"==typeof e)return!1;var f=d.getProtein(b);if("undefined"==typeof f)return!1;-1==d.proteins[e.id].imports.indexOf(f.id)&&d.proteins[e.id].imports.push(f.id),-1==d.proteins[f.id].imports.indexOf(e.id)&&d.proteins[f.id].imports.push(e.id);var g={source:e,target:f,id:e.id+"-"+f.id};if("undefined"!=typeof c)for(var h in c)g[h]=c[h];var i=d.interactions.push(g);return"undefined"==typeof d.interactionsA[g.source.id]?d.interactionsA[g.source.id]=[g.target]:d.interactionsA[g.source.id].push(g.target),"undefined"==typeof d.interactionsA[g.target.id]?d.interactionsA[g.target.id]=[g.source]:d.interactionsA[g.target.id].push(g.source),i},addOrganism:function(a){var b=this;b.organisms.hasOwnProperty(a)||(b.organisms[a]={key:a,name:a,parent:b.model,children:[]},b.model.children.push(b.organisms[a]))},addProtein:function(a){var b=this;"undefined"==typeof a.size&&(a.size=1),b.addOrganism(a.organism),b.proteins.hasOwnProperty(a.id)||(b.proteins[a.id]=a,b.proteins[a.id].key=a.id,b.proteins[a.id].name=a.id,b.proteins[a.id].parent=b.organisms[a.organism],b.proteins[a.id].imports=[],b.organisms[a.organism].children.push(b.proteins[a.id]),"undefined"==typeof b.interactionsA[a.id]&&(b.interactionsA[a.id]=[]))},getProtein:function(a){var b=this;return b.proteins[a]},getInteractionIndex:function(a,b){for(var c=this,d=0;d<c.interactions.length;d++){var e=c.interactions[d].source.id,f=c.interactions[d].target.id;if(e==a&&f==b||e==b&&f==a)return d}return null},getInteraction:function(a,b){var c=this,d=c.getInteractionIndex(a,b);return null==d?d:c.interactions[d]},removeInteraction:function(a,b){var c=this,d=c.getInteractionIndex(a,b);c.interactions.splice(d--,1);var e=c.proteins[b].imports.indexOf(a);-1!=e&&c.proteins[b].imports.splice(e,1),e=c.proteins[a].imports.indexOf(b),-1!=e&&c.proteins[a].imports.splice(e,1);var f=c.getProtein(a),g=c.getProtein(b);d=c.interactionsA[a].indexOf(g),-1!=d&&c.interactionsA[a].splice(d--,1),d=c.interactionsA[b].indexOf(f),-1!=d&&c.interactionsA[b].splice(d--,1)},removeProtein:function(a,b){var c=this;if(b="undefined"==typeof b?[]:b,"undefined"!=typeof c.interactionsA[a]){for(var d=0;d<c.interactionsA[a].length;d++){var e=c.interactionsA[a][d].id;-1==b.indexOf(e)&&(c.removeInteraction(a,e),d--,0==c.interactionsA[e].length&&c.removeProtein(e))}if(0==c.interactionsA[a].length){delete c.interactionsA[a];for(var d in c.proteins)if(c.proteins[d].id==a){c.proteins.splice(d,1);break}for(var d in c.organisms){var f=c.organisms[d].children;for(var g in f)f[g].id==a&&c.organisms[d].children.splice(g,1)}delete c.proteins[a]}}},resetGraphic:function(){var a=this;a.proteins=[],a.interactions=[],a.interactionsA={},a.restart()},clearAndRestartGraphic:function(){var a=this;a.svg.selectAll("path.link").remove(),a.svg.selectAll("g.node").remove(),a.restart()},imports:function(a){var b=this,c={},d=[];return a.forEach(function(a){c[a.name]=a}),a.forEach(function(a){a.imports&&a.imports.forEach(function(e){var f=b.getInteraction(c[a.name].id,c[e].id);null!=f&&-1==d.indexOf(f)&&d.push(f)})}),d},restart:function(){var a=this,b=a.cluster.nodes(a.model),c=a.imports(b);a.splines=a.bundle(c);var d=a.svg.selectAll("path.link").data(c);d.enter().append("svg:path").attr("id",function(a){return"link-"+a.source.key+"-"+a.target.key}).attr("class",function(a){return"link source-"+a.source.key+" target-"+a.target.key}).attr("d",function(b,c){return a.line(a.splines[c])}).style("pointer-events","visibleStroke").on("mouseover",function(b){a.raiseEvent("interactionMouseOver",{interaction:b})}).on("mouseout",function(b){a.raiseEvent("interactionMouseOut",{interaction:b})}).on("click",function(b){a.raiseEvent("interactionClick",{interaction:b})}),d.exit().remove();var e=a.svg.selectAll("g.node").data(b.filter(function(a){return!a.children})),f=e.enter().append("svg:g").attr("class","node").attr("id",function(a){return"node-"+a.key}).attr("transform",function(a){return"rotate("+(a.x-90)+")translate("+a.y+")"});f.append("svg:text").attr("class","legend").attr("dx",function(a){return a.x<180?8:-8}).attr("dy",".31em").attr("text-anchor",function(a){return a.x<180?"start":"end"}).attr("transform",function(a){return a.x<180?null:"rotate(180)"}).attr("visibility",function(a){return a.showLegend?"visible":"hidden"}).text(function(a){return a.key}),f.append("circle").attr("class","figure").attr("id",function(a){return"figure_"+a.id}).attr("r",function(b){return a.opt.radius*Math.sqrt(b.size)}).attr("stroke-width",.3*a.opt.radius).on("mouseover",function(b){a.raiseEvent("proteinMouseOver",{protein:b})}).on("mouseout",function(b){a.raiseEvent("proteinMouseOut",{protein:b})}).on("click",function(b){a.raiseEvent("proteinClick",{protein:b})}),e.exit().remove(),a.svg.selectAll(".legendBlock").remove(),"undefined"!=typeof a.legends&&null!=a.legends&&a._paintLegends()},_sortLegends:function(){var a=this;a.legends.sort(function(a,b){return a[1]!=b[1]?a[1]>b[1]?-1:1:"label"==a[0]?-1:"label"==b[0]?1:0})},_paintLegend:function(a,b){var c=this;a.filter(function(a){return"label"==a[0]&&a[1]==b}).append("text").attr("x",c.opt.width/2-6).attr("y",7-c.opt.height/2).attr("dy",".35em").style("text-anchor","end").style("font-size","1.2em").text(b+":"),0==b.indexOf("Resize By")?(a.filter(function(a){return"label"!=a[0]&&a[1]==b}).append("path").attr("class","figure").attr("d",function(a){var b=2*c.opt.radius*Math.sqrt(a[0][2]);return"M0,0L0,10M0,5L"+b+",5M"+b+",0L"+b+",10 "}).attr("transform",function(a){return"translate("+(c.opt.width/2-18-2*c.opt.radius*Math.sqrt(a[0][2]))+", -"+c.opt.height/2+")"}).style("fill","transparent").style("stroke","black"),a.filter(function(a){return"label"!=a[0]&&a[1]==b}).append("text").attr("x",function(){return c.opt.width/2-22-5*c.opt.radius}).attr("y",7-c.opt.height/2).attr("dy",".35em").style("text-anchor","end").text(function(a){return(1*a[0][1]).toFixed(2)})):(a.filter(function(a){return"label"!=a[0]&&a[1]==b}).append("rect").attr("x",c.opt.width/2-18).attr("y",-c.opt.height/2).attr("width",13).attr("height",13).style("fill",function(a,b){return"undefined"==typeof a[2]?c.color(b):a[2]}),a.filter(function(a){return"label"!=a[0]&&a[1]==b}).append("text").attr("x",c.opt.width/2-24).attr("y",7-c.opt.height/2).attr("dy",".35em").style("text-anchor","end").text(function(a){return a[0]}))},_paintLegends:function(){var a=this,b=18+7*a.longestLegend+10,c=a.svg.insert("g",".link").attr("class","legendBlock");a._sortLegends(),c.append("rect").attr("x",a.opt.width/2-b).attr("y",-a.opt.height/2).attr("height",6+16*a.legends.length).attr("width",b).style("fill","#ddd").style("fill-opacity","0.4");for(var d=c.selectAll(".mainLegend").data(a.legends).enter().insert("g").attr("class","mainLegend").attr("transform",function(a,b){return"translate(0,"+(3+16*b)+")"}),e=0;e<a.legendTypes.length;e++)a._paintLegend(d,a.legendTypes[e])},longestLegend:4,legendTypes:[],addLegends:function(a,b,c){var d=this;if(null==d.legends&&(d.legends=[],d.legendTypes=[]),null==a)return d.legends=null,d.legendTypes=[],void(d.longestLegend=4);if("Resize By"==b&&(b=b+" "+a[0]),-1==d.legendTypes.indexOf(b)&&(d.legends.push(["label",b]),d.legendTypes.push(b),b.length>d.longestLegend&&(d.longestLegend=b.length)),0==b.indexOf("Resize By"))d.legends.push([a,b]);else for(var e=0;e<a.length;e++)d.legends.push("undefined"==typeof c?[a[e],b]:[a[e],b,c]),a[e].length>d.longestLegend&&(d.longestLegend=a[e].length)},hide:function(a){var b=this;b.vis.selectAll(a).attr("visibility","hidden"),b.vis.selectAll(a).selectAll(" .legend").attr("visibility","hidden")},show:function(a){var b=this;b.vis.selectAll(a).attr("visibility","visible"),b.vis.selectAll(a).selectAll(" .legend").attr("visibility",function(a){return a.showLegend?"visible":"hidden"})},highlight:function(a){var b=this;b.vis.selectAll(a).style("stroke","#0f0")},setFillColor:function(a,b){var c=this;c.vis.selectAll(a).style("fill",b)},setColor:function(a,b){var c=this;c.vis.selectAll(a).style("stroke",b)},showLegend:function(a,b){var c=this;c.vis.selectAll(a).selectAll(".legend").attr("visibility","visible").text(function(a){return a.typeLegend=b,"id"==a.typeLegend?a.id:a.features[a.typeLegend]})},setSizeScale:function(a,b){var c=this;c.vis.selectAll(a).attr("r",function(a){return a.size=b,c.opt.radius*Math.sqrt(a.size)})},refreshSizeScale:function(a){var b=this;b.vis.selectAll(a).attr("r",function(a){return b.opt.radius*Math.sqrt(a.size)})},hideLegend:function(a){var b=this;b.vis.selectAll(a).selectAll(".legend").attr("visibility","hidden")},swapShowLegend:function(a){var b=this;b.vis.selectAll(a).attr("visibility",function(a){return a.showLegend=!a.showLegend,a.showLegend?"visible":"hidden"})},_resize:function(a){var b=window.innerWidth,c=window.innerHeight;a.vis.attr("width",b).attr("height",c),a.force.size([b,c]).resume()},colors:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5","#0077b4","#11c7e8","#227f0e","#33bb78","#44a02c","#55df8a","#662728","#779896","#8867bd","#99b0d5","#AA564b","#BB9c94","#CC77c2","#DDb6d2","#EE7f7f","#FFc7c7","#00bd22","#11db8d","#22becf","#33dae5","#1f00b4","#ae11e8","#ff220e","#ff3378","#2c442c","#98558a","#d66628","#ff7796","#9488bd","#c599d5","#8cAA4b","#c4BB94","#e3CCc2","#f7DDd2","#7fEE7f","#c7FFc7","#bc0022","#db118d","#1722cf","#9e33e5","#1f7700","#aec711","#ff7f22","#ffbb33","#2ca044","#98df55","#d62766","#ff9877","#946788","#c5b099","#8c56AA","#c49cBB","#e377FC","#f7b6FD","#7f7fEE","#c7c7FF","#bcbd00","#dbdb11","#17be22","#9eda33"]}),Biojs.InteractionsD3=Biojs.extend({force:null,vis:null,interactions:[],interactionsA:{},proteins:[],proteinsA:{},node_drag:null,color:null,foci:[],organisms:{},tTranslate:null,tScale:null,constructor:function(){function a(a,b,c){var d=null,e=null;if("undefined"!=typeof a&&"undefined"!=typeof b?(d=[a,b],e=c):(d=d3.event.translate,e=d3.event.scale),f.tTranslate=d,f.tScale=e,f.opt.enableEdges){1>e&&(e=1),d3.behavior.zoom().scaleExtent([1,1/0]),d[0]>0&&(d[0]=0),d[1]>0&&(d[1]=0);var g=f.rect[0][0].width.animVal.value,h=f.rect[0][0].height.animVal.value,i=g*e,j=h*e;i<g-d[0]&&(d[0]=g-i),j<h-d[1]&&(d[1]=h-j)}f.vis.attr("transform","translate("+d+") scale("+e+")")}function b(){f.force.stop()}function c(a){a.px+=d3.event.dx,a.py+=d3.event.dy,a.x+=d3.event.dx,a.y+=d3.event.dy,e(d3.event)}function d(a){a.fixed=!0,e(d3.event),f.force.resume()}function e(a){if("tick"==a.type){var b=.1*a.alpha;f.proteins.forEach(function(a){a.y+=(f.foci[f.organisms[a.organism]].y-a.y)*b,a.x+=(f.foci[f.organisms[a.organism]].x-a.x)*b})}f.vis.selectAll("path.figure").attr("transform",function(a){return f.opt.enableEdges?"translate("+Math.max(r,Math.min(f.opt.width,a.x+r))+","+Math.max(r,Math.min(f.opt.height,a.y+r))+")":"translate("+a.x+","+a.y+")"}),f.opt.enableEdges?f.vis.selectAll(".legend").attr("x",function(a){return a.x=Math.max(r,Math.min(f.opt.width-r,a.x))}).attr("y",function(a){return a.y=Math.max(r,Math.min(f.opt.height-r,a.y))}):f.vis.selectAll(".legend").attr("x",function(a){return a.x}).attr("y",function(a){return a.y}),f.opt.enableEdges?f.vis.selectAll("line.link").attr("x1",function(a){return a.source.x+r}).attr("y1",function(a){return a.source.y+r}).attr("x2",function(a){return a.target.x+r}).attr("y2",function(a){return a.target.y+r}):f.vis.selectAll("line.link").attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y})}var f=this;f.force=null,f.vis=null,f.interactions=[],f.interactionsA={},f.proteins=[],f.proteinsA={},f.node_drag=null,f.color=null,f.foci=[],f.organisms={},this._container=$("#"+f.opt.target),this._container.empty(),$(this._container).addClass("graphNetwork");var g=$(this._container).width(),h=$(this._container).height();g=-1!=f.opt.width.indexOf("%")?1*g*f.opt.width.substring(0,f.opt.width.length-1)/100:1*f.opt.width,f.opt.width=g,h=-1!=f.opt.height.indexOf("%")?1*h*f.opt.height.substring(0,f.opt.height.length-1)/100:1*f.opt.height,f.opt.height=h,this._container.width(g),this._container.height(h),f.color=function(){return d3.scale.ordinal().range(f.colors)}(),f.zoom=d3.behavior.zoom().scaleExtent([f.opt.enableEdges?1:.1,10]).on("zoom",a),f.vis=d3.select("#"+f.opt.target).append("svg").attr("width",g).attr("height",h).attr("pointer-events","all").call(f.zoom).append("svg:g"),f.vis.append("svg:rect").attr("width",20*g).attr("height",20*h).attr("x",10*-g).attr("y",10*-h).attr("fill","white").attr("stroke","white"),f.rect=f.vis.append("svg:rect").attr("class","frame").attr("width",g).attr("height",h).attr("fill","white").attr("stroke","white").attr("stroke-dasharray","5,5"),f.perspective=d3.select("#"+f.opt.target+" svg").append("svg:g"),f.redraw=a,f.force=d3.layout.force().nodes(f.proteins).links(f.interactions).size([g,h]),f.node_drag=d3.behavior.drag().on("dragstart",b).on("drag",c).on("dragend",d),f.force.on("tick",e),f.tick=e,f.restart()},opt:{target:"YourOwnDivId",width:"100%",height:"500",radius:10,enableEdges:!1},eventTypes:["proteinClick","proteinMouseOver","proteinMouseOut","interactionClick","interactionMouseOver","interactionMouseOut","sizeChanged"],setSize:function(a,b){var c=this;c.opt.width=a,c.opt.height=b,d3.select("#"+c.opt.target+" svg").attr("width",a).attr("height",b),d3.select("#"+c.opt.target+" .frame").attr("width",a).attr("height",b),c._container.width(a),c._container.height(b);var d=Object.keys(c.organisms).length;c.foci=[];for(var e=0;d>e;e++)c.foci.push({x:c.opt.width/(d+1)*(e+1),y:c.opt.height/2});null!=c.tTranslate&&c.redraw(c.tTranslate[0],c.tTranslate[1],c.tScale),c.restart(),c.raiseEvent("sizeChanged",{width:a,height:b})},addInteraction:function(a,b,c){var d=this,e=d.getProtein(a);if("undefined"==typeof e)return!1;var f=d.getProtein(b);if("undefined"==typeof f)return!1;if("undefined"!=typeof d.interactionsA[a]&&-1!=d.interactionsA[a].indexOf(f))return d.interactionsA[a].indexOf(f);var g={source:e,target:f};if("undefined"!=typeof c)for(var h in c)g[h]=c[h];var i=d.interactions.push(g);return"undefined"==typeof d.interactionsA[g.source.id]?d.interactionsA[g.source.id]=[g.target]:d.interactionsA[g.source.id].push(g.target),"undefined"==typeof d.interactionsA[g.target.id]?d.interactionsA[g.target.id]=[g.source]:d.interactionsA[g.target.id].push(g.source),i},addProtein:function(a){var b=this,c=b.proteins.indexOf(b.proteinsA[a.id]);if(-1!=c)return c;if("undefined"==typeof b.fixedProteins[a.id]?(a.x=Math.floor(Math.random()*b.opt.width),a.y=Math.floor(Math.random()*b.opt.width)):(a.x=b.fixedProteins[a.id][0],a.y=b.fixedProteins[a.id][1],a.fixed=!0),"undefined"==typeof a.size&&(a.size=1),c=b.proteins.push(a),b.proteinsA[a.id]=a,"undefined"==typeof b.interactionsA[a.id]&&(b.interactionsA[a.id]=[]),"undefined"==typeof b.organisms[a.organism]){var d=Object.keys(b.organisms).length;b.organisms[a.organism]=d++,b.foci=[];for(var e=0;d>e;e++)b.foci.push({x:b.opt.width/(d+1)*(e+1),y:b.opt.height/2})}return c},getProtein:function(a){var b=this;return b.proteinsA[a]},getInteractionIndex:function(a,b){for(var c=this,d=0;d<c.interactions.length;d++){var e=c.interactions[d].source.id,f=c.interactions[d].target.id;if(e==a&&f==b||e==b&&f==a)return d}return null},getInteraction:function(a,b){var c=this;return c.getInteractionIndex(a,b)},removeInteraction:function(a,b){var c=this,d=c.getInteractionIndex(a,b);c.interactions.splice(d--,1);var e=c.getProtein(a),f=c.getProtein(b);d=c.interactionsA[a].indexOf(f),-1!=d&&c.interactionsA[a].splice(d--,1),d=c.interactionsA[b].indexOf(e),-1!=d&&c.interactionsA[b].splice(d--,1)},removeProtein:function(a,b){var c=this;if(b="undefined"==typeof b?[]:b,"undefined"!=typeof c.interactionsA[a]){for(var d=0;d<c.interactionsA[a].length;d++){var e=c.interactionsA[a][d].id;-1==b.indexOf(e)&&(c.removeInteraction(a,e),d--,0==c.interactionsA[e].length&&c.removeProtein(e))}if(0==c.interactionsA[a].length){delete c.interactionsA[a];for(var d=0;d<c.proteins.length;d++)if(c.proteins[d].id==a){c.proteins.splice(d,1);break}delete c.proteinsA[a]}else c.proteinsA[a].fixed=!1}},resetGraphic:function(){var a=this;a.proteins=[],a.proteinsA={},a.interactions=[],a.restart()},_figuresOrder:[0,3,2,5,4,1],restart:function(){var a=this;a.force.nodes(a.proteins).links(a.interactions).charge(-a.opt.radius*(3+a.proteins.length)).linkDistance(a.opt.radius*(3+.05*a.proteins.length)).start();var b=a.vis.selectAll(".graphNetwork line.link").data(a.interactions,function(a){return a.source.id+"-"+a.target.id});b.enter().insert("line",".node").attr("class","link").attr("id",function(a){return"link_"+a.source.id+"_"+a.target.id}).on("mouseover",function(b){a.raiseEvent("interactionMouseOver",{interaction:b})}).on("mouseout",function(b){a.raiseEvent("interactionMouseOut",{interaction:b})}).on("click",function(b){a.raiseEvent("interactionClick",{interaction:b})}).attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),b.exit().remove();var c=a.vis.selectAll(".graphNetwork .node").data(a.proteins,function(a){return a.id}),d=c.enter().append("g").attr("class","node").attr("id",function(a){return"node_"+a.id}).attr("organism",function(a){return a.organism}).call(a.node_drag);d.append("path").attr("class","figure").attr("d",d3.svg.symbol().size(function(b){return 2*a.opt.radius*2*a.opt.radius*b.size*b.size}).type(function(b){return d3.svg.symbolTypes[a._figuresOrder[a.organisms[b.organism]]]})).attr("id",function(a){return"figure_"+a.id}).on("click",function(b){a.raiseEvent("proteinClick",{protein:b})}).on("mouseover",function(b){a.raiseEvent("proteinMouseOver",{protein:b})}).on("mouseout",function(b){a.raiseEvent("proteinMouseOut",{protein:b})}).attr("stroke-width",.3*a.opt.radius),d.append("svg:text").attr("class","legend").attr("id",function(a){return"legend_"+a.id}).text(function(a){return"id"==a.typeLegend?a.id:0==a.typeLegend.indexOf("features.")?a.features[a.typeLegend.substr(9)]:a[a.typeLegend]}).attr("visibility",function(a){return a.showLegend?"visible":"hidden"}).attr("transform",function(b){return 0==a.organisms[b.organism]?"translate(-"+1.9*a.opt.radius+","+.4*a.opt.radius+")":"translate(-"+.9*a.opt.radius+","+1.3*a.opt.radius+")"}),c.exit().remove(),a.perspective.selectAll(".legendBlock").remove(),"undefined"!=typeof a.legends&&null!=a.legends&&a._paintLegends()},_sortLegends:function(){var a=this;a.legends.sort(function(a,b){return a[1]!=b[1]?a[1]>b[1]?-1:1:"label"==a[0]?-1:"label"==b[0]?1:0})},_paintLegend:function(a,b){var c=this;a.filter(function(a){return"label"==a[0]&&a[1]==b}).append("text").attr("x",c.opt.width-6).attr("y",7).attr("dy",".35em").style("text-anchor","end").style("font-size","1.2em").text(b+":"),0==b.indexOf("Resize By")?(a.filter(function(a){return"label"!=a[0]&&a[1]==b}).append("path").attr("class","figure").attr("d",function(a){var b=2*c.opt.radius*Math.sqrt(a[0][2]);return"M0,0L0,10M0,5L"+b+",5M"+b+",0L"+b+",10 "}).attr("transform",function(a){return"translate("+(c.opt.width-18-2*c.opt.radius*Math.sqrt(a[0][2]))+",0)"}).style("fill","transparent").style("stroke","black"),a.filter(function(a){return"label"!=a[0]&&a[1]==b}).append("text").attr("x",function(){return c.opt.width-22-5*c.opt.radius}).attr("y",7).attr("dy",".35em").style("text-anchor","end").text(function(a){return(1*a[0][1]).toFixed(2)})):(a.filter(function(a){return"label"!=a[0]&&a[1]==b}).append("rect").attr("x",c.opt.width-18).attr("width",13).attr("height",13).style("fill",function(a,b){return"undefined"==typeof a[2]?c.color(b):a[2]}),a.filter(function(a){return"label"!=a[0]&&a[1]==b}).append("text").attr("x",c.opt.width-24).attr("y",7).attr("dy",".35em").style("text-anchor","end").text(function(a){return a[0]}))},_paintLegends:function(){var a=this,b=18+7*a.longestLegend+10,c=a.perspective.insert("g",".link").attr("class","legendBlock");a._sortLegends(),c.append("rect").attr("x",a.opt.width-b).attr("height",6+16*a.legends.length).attr("width",b).style("fill","#ddd").style("fill-opacity","0.4");for(var d=c.selectAll(".mainLegend").data(a.legends).enter().insert("g").attr("class","mainLegend").attr("transform",function(a,b){return"translate(0,"+(3+16*b)+")"}),e=0;e<a.legendTypes.length;e++)a._paintLegend(d,a.legendTypes[e])},longestLegend:4,legendTypes:[],addLegends:function(a,b,c){var d=this;if(null==d.legends&&(d.legends=[],d.legendTypes=[]),null==a)return d.legends=null,d.legendTypes=[],void(d.longestLegend=4);if("Resize By"==b&&(b=b+" "+a[0]),-1==d.legendTypes.indexOf(b)&&(d.legends.push(["label",b]),d.legendTypes.push(b),b.length>d.longestLegend&&(d.longestLegend=b.length)),0==b.indexOf("Resize By"))d.legends.push([a,b]);else for(var e=0;e<a.length;e++)d.legends.push("undefined"==typeof c?[a[e],b]:[a[e],b,c]),a[e].length>d.longestLegend&&(d.longestLegend=a[e].length)},hide:function(a){var b=this;b.vis.selectAll(a).attr("visibility","hidden"),b.vis.selectAll(a).selectAll(" .legend").attr("visibility","hidden")},show:function(a){var b=this;b.vis.selectAll(a).attr("visibility","visible"),b.vis.selectAll(a).selectAll(" .legend").attr("visibility",function(a){return a.showLegend?"visible":"hidden"})},highlight:function(a){var b=this;b.vis.selectAll(a).style("stroke","#3d6")},setFillColor:function(a,b){var c=this;c.vis.selectAll(a).style("fill",b)},setColor:function(a,b){var c=this;c.vis.selectAll(a).style("stroke",b)},swapFixed:function(a){var b=this,c=b.force.nodes();c.forEach(function(b){b.id==a&&(b.fixed=!b.fixed)})},showLegend:function(a,b){var c=this;c.vis.selectAll(a).selectAll(".legend").attr("visibility","visible").text(function(a){return a.typeLegend=b,"id"==a.typeLegend?a.id:a.features[a.typeLegend]})},setSizeScale:function(a,b){var c=this;c.vis.selectAll(a).attr("d",d3.svg.symbol().size(function(a){return a.size=b,2*c.opt.radius*2*c.opt.radius*b}).type(function(a){return d3.svg.symbolTypes[c._figuresOrder[c.organisms[a.organism]]]}))},refreshSizeScale:function(a){var b=this;b.vis.selectAll(a).attr("d",d3.svg.symbol().size(function(a){return 2*b.opt.radius*2*b.opt.radius*a.size}).type(function(a){return d3.svg.symbolTypes[b._figuresOrder[b.organisms[a.organism]]]}))},hideLegend:function(a){var b=this;b.vis.selectAll(a).selectAll(".legend").attr("visibility","hidden")},swapShowLegend:function(a){var b=this;b.vis.selectAll(a).attr("visibility",function(a){return a.showLegend=!a.showLegend,a.showLegend?"visible":"hidden"})},getFixedProteins:function(){var a=this,b=[];for(var c in a.proteinsA)a.proteinsA[c].fixed&&b.push({protein:c,x:a.proteinsA[c].x,y:a.proteinsA[c].y});return b},fixedProteins:{},fixProteinAt:function(a,b,c){var d=this;return"undefined"==typeof d.proteinsA[a]?void(d.fixedProteins[a]=[b,c]):(d.proteinsA[a].x=b,d.proteinsA[a].y=c,d.proteinsA[a].px=b,d.proteinsA[a].py=c,void(d.proteinsA[a].fixed=!0))},colors:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5","#3399FF","#99FF66","#66FF99","#CCFF00","#6699CC","#99CC00","#99FFCC","#993399","#33FFFF","#33CC33","#66CCFF","#009999","#00FFFF","#CC66CC","#FF9966","#CC3300","#009966","#660000","#99FF33","#330066","#FFFF00","#0099FF","#FF6699","#33FF00","#FFFFCC","#990000","#99CC33","#0033CC","#006699","#6699FF","#FFCC00","#330099","#999999","#666633","#FFCC99","#00CCCC","#006633","#CCCC99","#3300FF","#33CC66","#339999","#6666FF","#33FF66","#990033","#33CC99","#993300","#00FF00","#666699","#00CC00","#FF66CC","#00FFCC","#FF9999","#66FF00","#003366","#CCFF33","#660066","#6633CC","#FF3366","#99FF00","#FF33CC","#CCFFCC","#99CCCC","#3300CC","#0066FF","#66CC33","#3366CC","#CCCCCC","#FF0000","#6666CC","#336699","#999966","#FFFF99","#66CC99","#FF0033","#999933","#CC99FF","#FF0099","#6600CC","#CC9966","#00CC66","#33CC00","#666666","#33CCCC","#FF0066","#00CC33","#FFCC66","#FF6600","#9999FF","#CC66FF","#9933FF","#FF00CC","#CC3399","#CC6633","#33FFCC","#FF33FF","#009900","#660099","#669999","#CC3366","#0099CC","#9900FF","#669933","#FFFFFF","#CCCCFF","#66CCCC","#669966","#0066CC","#CC9900","#663300","#33FF99","#996666","#3399CC","#99FF99","#66CC66","#CC0066","#CCFF66","#663366","#99CC66","#000033","#003333","#FF6666","#009933","#FFFF66","#996699","#FFCCCC","#00CCFF","#339966","#3366FF","#00CC99","#336633","#FF99FF","#663333","#CCFF99","#CC99CC","#339933","#33CCFF","#333366","#006666","#CC6600","#333300","#FFCC33","#9966CC","#003300","#9966FF","#996600","#CC9933","#9999CC","#FF9933","#006600","#6633FF","#CC6699","#FF3399","#993333","#CCFFFF","#330033","#FFCCFF","#FFFF33","#990066","#CCCC66","#CC0099","#CCCC00","#339900","#660033","#FF00FF","#333333","#99CC99","#66FFCC","#003399","#999900","#99FFFF","#990099","#3333FF","#CC33CC","#CC6666","#3333CC","#9900CC","#9933CC","#CC0033","#CC00FF","#FF99CC","#FF66FF","#66FFFF","#6600FF","#66FF66","#996633","#669900","#00FF99","#CC9999","#993366","#CC33FF","#336666","#0033FF","#336600","#CC0000","#FF9900","#33FF33","#000000","#99CCFF","#000066","#0000CC","#000099","#00FF33","#666600","#66FF33","#CCCC33","#66CC00","#FF3333","#CC3333","#663399","#333399","#FF3300","#0000FF","#CC00CC","#00FF66","#330000","#FF6633"]}),Biojs.InteractionsFilterGraph=Biojs.extend({constructor:function(){this._getObjectSize(this.opt.interactions)&&(this._setHtmlTemplate(),this._createFilterOptions(),this._setCytoscapeHeight(),this._startCytoscape())},opt:{target:"YourOwnDivId",instanceName:"instance",graphHeight:500,graphWidth:500,interactions:{},filters:{}},eventTypes:[],_setExample:function(){this.opt.interactions={i1:["P1","P2"],i2:["P3","P4"],i3:["P5","P6"],i4:["P2","P6"],i5:["P2","P4"],i6:["P6","P1"],i7:["P2","P6"]},this.opt.filters={timeSeries:{title:"Time after Sendai viral infection (hours)",presentation:"radio",active:!0,dataType:"edges",data:{2:["i2","i3","i4"],6:["i2","i5","i6","i7"],12:["i1","i2","i3","i4","i6","i7"]}},interactionTypes:{title:"Interaction types",presentation:"radio",active:!0,dataType:"edges",data:{association:["i3","i4"],"physical association":["i2","i5","i6","i7"],colocalization:["i1","i2"]}},publications:{title:"Publications",presentation:"checkbox",active:!1,dataType:"edges",data:{pumned01:["i1","i2","i3","i4","i5","i6","i7"],pumned02:["i1","i2","i3","i4","i5","i6"],pumned03:["i1","i2","i3","i6"],pumned04:["i1","i3"],pumned05:["i3"]}}}},_getObjectSize:function(a){var b=0;for(i in a)a.hasOwnProperty(i)&&b++;return b},_setCytoscapeHeight:function(){this.opt.graphHeight=this.opt.graphHeight.toString();var a=this.opt.graphHeight;-1!=this.opt.graphHeight.indexOf("px")&&(a=this.opt.graphHeight.substring(0,this.opt.graphHeight.length-2));var b=jQuery("#"+this._filtersTarget).height(),c=parseInt(this.opt.graphHeight)-parseInt(b)-5,d=jQuery("#"+this._cytoscapeTarget);d.height(c)},_getCytoscapeElements:function(){var a=this,b=[],c=[],d=new Object,e={},f=function(c){e[c]||(b.push({data:{id:c,weight:a.opt.nodeWeight},classes:"allnodes"}),e[c]=!0)};for(interactionId in a.opt.interactions){var g=a.opt.interactions[interactionId];c.push({data:{id:interactionId,source:g[0],target:g[1]},classes:"alledges"}),f(g[0]),f(g[1])}return d={nodes:b,edges:c}},_startCytoscape:function(){var a=this._getCytoscapeElements();jQuery("#"+this._cytoscapeTarget).cytoscape({elements:a,layout:{name:"arbor"},style:[{selector:"node",css:{shape:"ellipse",backgroundColor:"#888",height:"mapData(weight, 0, 100, 15, 30)",width:"mapData(weight, 0, 100, 15, 30)",content:"data(id)"}},{selector:".unselect",css:{backgroundColor:"#888",borderColor:"#ccc"}},{selector:"edge",css:{lineColor:"#ccc",targetArrowColor:"#ccc",width:"mapData(weight, 0, 100, 2, 5)"}},{selector:"node:selected",css:{backgroundColor:"#cc0000"}},{selector:"edge:selected",css:{lineColor:"#ff9999"}}],ready:function(){window.cy=this
}})},_onCytoscapeReady:function(){alert("asdasdaa")},_printInteractionDetails:function(a,b){var c=jQuery('<span class="inInformation"><span class="miGreyText">Interactions: </span><span>'+b+"</span></span>"),d=jQuery('<span class="inInformation"><span class="miGreyText">Interactors: </span><span>'+a+"</span></span>");jQuery("#"+this._informationTarget).append(c),jQuery("#"+this._informationTarget).append(d)},highlightFilterOption:function(a,b){if(jQuery(".miRadioBtn").not("."+b+"RadioBtn").prop("checked",!1),void 0!=typeof b)if(void 0!=typeof a)if("none"==a)this.unselect();else if(void 0!=typeof this.opt.filters[b].data[a]){var c="",d="";for(key in this.opt.filters[b].data[a])if(this.opt.filters[b].data[a].hasOwnProperty(key)){var e=this.opt.filters[b].data[a][key];if("function"!=typeof e)if(c+="#"+e+", ",void 0!=this.opt.interactions[e])for(i=0;i<this.opt.interactions[e].length;i++)d+="#"+this.opt.interactions[e][i]+", ";else console.log("interaction"+e+" undefined in interactions object")}c=c.substring(0,c.length-2),d=d.substring(0,d.length-2),this.unselect(),cy.edges(c).select(),this._printInteractionDetails(d.replace(/#/g,""),c.replace(/#/g,""))}else console.log("dataElement undefined");else console.log("dataElement undefined");else console.log("filterName undefined")},unselect:function(){cy.elements().unselect(),jQuery("#"+this._informationTarget).empty()},_createFilterOptions:function(){for(key in this.opt.filters)if(this.opt.filters.hasOwnProperty(key)&&1==this.opt.filters[key].active){var a=jQuery('<div class="miFilter" id="'+key+'Filter"></div>'),b=jQuery('<div class="miFilterTitle" id="'+key+'Title">'+this.opt.filters[key].title+"</div>"),c=jQuery('<div class="miFilterOptions" id="'+key+'Options"></div>');a.append(b),a.append(c),jQuery("#"+this._filtersTarget).append(a),"radio"==this.opt.filters[key].presentation?this._createRadioButtons(this.opt.filters[key].data,key,"#"+key+"Options"):"checkbox"==this.opt.filters[key].presentation||Biojs.console.log("ERROR: filter presentation value unknown for filter "+key)}},_createCheckBox:function(){},_createRadioButtons:function(a,b,c){for(key in a)if(a.hasOwnProperty(key)){var d=(jQuery("<br/>"),jQuery("<span></span>")),e=jQuery('<input class="miRadioBtn '+b+'RadioBtn" type="radio" name="'+b+'" value="'+key+'" onclick="'+this.opt.instanceName+".highlightFilterOption('"+key+"','"+b+"');\" />"),f=jQuery('<span class="miRadioBtnName">'+key+"</span>");d.append(e),d.append(f),d.appendTo(c)}var g=jQuery('<input class="miRadioBtn '+b+'RadioBtn" type="radio" name="'+b+'" value="'+key+'" onclick="'+this.opt.instanceName+".highlightFilterOption('none','"+b+"');\" />"),h=jQuery('<span class="miRadioBtnName miGreyText">None</span>');g.appendTo(c),h.appendTo(c)},_setHtmlTemplate:function(){this.opt.graphWidth=this.opt.graphWidth.toString();var a=this.opt.graphWidth+"px";(-1!=this.opt.graphWidth.indexOf("%")||-1!=this.opt.graphWidth.indexOf("px"))&&(a=this.opt.graphWidth);var b=jQuery('<div id="'+this._filtersTarget+'" style="width:'+a+';"></div>'),c=jQuery('<div class="miDisplay" id="'+this._cytoscapeTarget+'" style="width:'+a+';"></div>'),d=jQuery('<div id="'+this._informationTarget+'" style="width:'+a+';"></div>');jQuery("#"+this.opt.target).append(b),jQuery("#"+this.opt.target).append(c),jQuery("#"+this.opt.target).append(d)},_cytoscapeTarget:"miCy",_filtersTarget:"miInteractionFilters",_informationTarget:"miInformation"}),Biojs.InteractionsTable=Biojs.Table.extend({constructor:function(a){a.dataSet.version=void 0!=a.dataSet.version?a.dataSet.version:Biojs.InteractionsTable.MITAB_VERSION_2_5,this._useVersion(a.dataSet.version),this.base(a)},opt:{target:"YourOwnDivId",rowSelection:!1,version:"MITAB_VERSION_2_5",psiquicUrl:"http://www.ebi.ac.uk/Tools/webservices/psicquic/intact/webservices/current/search/query",proxyUrl:"../biojs/dependencies/proxy/proxy.php"},eventTypes:[],setQuery:function(a){delete this.opt.dataSet.url,delete this.opt.totalRecords,this.opt.dataSet.query=a,this.setDataSource(this.opt.dataSet)},getQuery:function(){return unescape(this.opt.dataSet.query)},_requestQueryCount:function(a,b){var c=this;a.url=a.psicquicUrl+"/"+a.query,a.paramsMap={iDisplayStart:"firstResult",iDisplayLength:"maxResults"},jQuery.ajax({url:a.proxyUrl,dataType:"text",data:[{name:"url",value:a.url+"?format=count"}],success:function(d){a.totalRecords=0|parseInt(d),b.call(c,a)}})},setDataSource:function(a){a instanceof Array?this.base(a):a.hasOwnProperty("totalRecords")&&a.hasOwnProperty("url")?this.base(a):(this.opt.dataSet={},this.opt.dataSet.psicquicUrl=a.psicquicUrl,this.opt.dataSet.proxyUrl=a.proxyUrl,this.opt.dataSet.version=a.version,this.opt.dataSet.filter=a.filter,this.opt.dataSet.query=escape(a.query),this.opt.dataSet.url=a.psicquicUrl+"/"+a.query,this.opt.dataSet.paramsMap={iDisplayStart:"firstResult",iDisplayLength:"maxResults"},this._requestQueryCount(this.opt.dataSet,this.base))},_decodeToJSON:function(a){Biojs.console.log("DATA DECODING FROM MITAB to JSON");var b={},c=new Biojs.InteractionsTable.MITabTxtDecoder(a);return b.aaData=c.decodeData(),b.iTotalRecords=this.getTotalRecords(),b.iTotalDisplayRecords=this.getTotalRecords(),delete c,b},_useVersion:function(a){var b="string"==typeof a?Biojs.InteractionsTable[a]:a,c=[];switch(b){case Biojs.InteractionsTable.MITAB_VERSION_2_7:for(var d=36;42>d;d++)this.opt.columns[d]=Biojs.InteractionsTable.MITAB_COLUMNS[d];c=[36,37,38,39,40,41];case Biojs.InteractionsTable.MITAB_VERSION_2_6:for(var d=31;36>d;d++)this.opt.columns[d]=Biojs.InteractionsTable.MITAB_COLUMNS[d];c=c.concat([31,32,33,34,35]);case Biojs.InteractionsTable.MITAB_VERSION_2_5_EXT:for(var d=15;31>d;d++)this.opt.columns[d]=Biojs.InteractionsTable.MITAB_COLUMNS[d];c=c.concat([15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]),this.opt.columns[15].render=this._columnRender.showDescXRef,this.opt.columns[16].render=this._columnRender.showDescXRef,this.opt.columns[17].render=this._columnRender.showDescXRef,this.opt.columns[18].render=this._columnRender.showRowDescXRef,this.opt.columns[19].render=this._columnRender.showRowDescXRef,this.opt.columns[20].render=this._columnRender.showDescXRef,this.opt.columns[21].render=this._columnRender.showDescXRef,this.opt.columns[22].render=this._columnRender.showDescXRef,this.opt.columns[23].render=this._columnRender.showDescXRef,this.opt.columns[24].render=this._columnRender.showDescXRef,this.opt.columns[25].render=this._columnRender.showRowDescXRef,this.opt.columns[26].render=this._columnRender.showRowDescXRef,this.opt.columns[27].render=this._columnRender.showRowDescXRef,this.opt.columns[28].render=this._columnRender.showDescXRef,this.opt.columns[29].render=this._columnRender.showRowDescXRef,this.opt.columns[30].render=this._columnRender.showRowDescXRef;case Biojs.InteractionsTable.MITAB_VERSION_2_5:for(var d=0;15>d;d++)this.opt.columns[d]=Biojs.InteractionsTable.MITAB_COLUMNS[d];c=c.concat([2,3,7,8,11,12,13]),this.opt.columns[0].render=this._columnRender.showProteinXRef,this.opt.columns[1].render=this._columnRender.showProteinXRef,this.opt.columns[2].render=this._columnRender.showValueXRef,this.opt.columns[3].render=this._columnRender.showValueXRef,this.opt.columns[4].render=this._columnRender.showValueXRef,this.opt.columns[5].render=this._columnRender.showValueXRef,this.opt.columns[6].render=this._columnRender.showDescXRef,this.opt.columns[9].render=this._columnRender.showDescXRef,this.opt.columns[10].render=this._columnRender.showDescXRef,this.opt.columns[11].render=this._columnRender.showDescXRef,this.opt.columns[12].render=this._columnRender.showDescXRef,this.opt.columns[13].render=this._columnRender.showInteractionXRef,this.opt.columns[14].render=this._columnRender.showRawValueXRef;break;default:Biojs.console.log("Wrong version <"+b+"> ")}this.opt.hideColumns=c},_columnRender:{showProteinXRef:function(a,b,c){for(var d=new Biojs.InteractionsTable.MITabTxtDecoder(c),e="",f={};d.hasNext();)f=d.decodeXRef(),url=Biojs.InteractionsTable.DATABASE_URL[f.key],e+='<a href="'+url+f.value+'" title="'+f.desc+'" >'+f.value+"</a><br/>";return delete d,e},showInteractionXRef:function(a,b,c){for(var d=new Biojs.InteractionsTable.MITabTxtDecoder(c),e="",f={};d.hasNext();)f=d.decodeXRef(),url=Biojs.InteractionsTable.DATABASE_URL[f.key],e+='<a href="'+url+"interaction/"+f.value+'" title="'+f.desc+'" >'+f.value+"</a><br/>";return delete d,e},showValueXRef:function(a,b,c){for(var d,e=new Biojs.InteractionsTable.MITabTxtDecoder(c),f="",g="";e.hasNext();)d=e.decodeXRef(),f+=g+'<span title="'+d.desc+'">'+d.value+"</span>",g=", ";return delete e,f},showDescXRef:function(a,b,c){for(var d=new Biojs.InteractionsTable.MITabTxtDecoder(c),e="";d.hasNext();)xref=d.decodeXRef(),url=Biojs.InteractionsTable.DATABASE_URL[xref.key.replace(/-/gi,"")],e+='<a href="'+url+xref.value+'" >'+xref.desc+"</a><br/>";return delete d,e},showRawValueXRef:function(a,b,c){var d=new Biojs.InteractionsTable.MITabTxtDecoder(c),e="";return d.hasNext()&&(xref=d.decodeXRef(),e=xref.value),delete d,e},showRowDescXRef:function(a,b,c){for(var d=new Biojs.InteractionsTable.MITabTxtDecoder(c),e="",f="";d.hasNext();)xref=d.decodeXRef(),e+=f+xref.desc,f=", ";return delete d,e}}},{MITabTxtDecoder:function(a){this.buffer=void 0!=a?a:"",this.offset=0,this.nextToken=function(a){var b,c="";return this.offset<this.buffer.length&&(start=this.offset,b=this.buffer.indexOf(a,start),-1!=b?(this.offset=b,c=this.buffer.substring(start,b),this.offset+=a.length):(this.offset=this.buffer.length,c=this.buffer.substring(start))),c},this.hasNext=function(){return this.offset<this.buffer.length},this.decodeXRef=function(){var a="",b={key:"",value:"",desc:""};return a=this.nextToken(":"),a.length>1&&(b.key=a,b.value=this.nextToken("|").replace(/\"/gi,""),descIdx=b.value.indexOf("("),-1!=descIdx&&(b.desc=b.value.substring(descIdx+1,b.value.length-1),b.value=b.value.substring(0,descIdx)),Biojs.console.log("XREF<"+b.key+">, VALUE<"+b.value+">, DESC<"+b.desc+">")),b},this.decodeRow=function(){var a=[];return this.hasNext()&&(a=this.nextToken("\n").split("	")),a},this.decodeData=function(){for(var a=[];this.hasNext();)a.push(this.decodeRow());return a}},MITAB_VERSION_2_5:15,MITAB_VERSION_2_5_EXT:31,MITAB_VERSION_2_6:36,MITAB_VERSION_2_7:42,MITAB_COLUMNS:[{name:"Identifier A"},{name:"Identifier B"},{name:"Alternative id A"},{name:"Alternative id B"},{name:"Aliases for A"},{name:"Aliases for B"},{name:"Detection Method"},{name:"first author"},{name:"Id of publication"},{name:"NCBI taxon A"},{name:"NCBI taxon B"},{name:"Interaction type"},{name:"Source"},{name:"Interaction identifier(s)"},{name:"Confidence score"},{name:"Complex expansion"},{name:"Biological role A"},{name:"Biological role B"},{name:"Experimental role A"},{name:"Experimental role B"},{name:"Interactor type A"},{name:"Interactor type B"},{name:"Xref for interactor A"},{name:"Xref for interactor B"},{name:"Xref for the interaction"},{name:"Annotations for interactor A"},{name:"Annotations for Interactor B"},{name:"Annotations for the interaction"},{name:"NCBI Taxonomy identifier for the host organism"},{name:"Parameters of the interaction"},{name:"Creation date"},{name:"Update date"},{name:"Checksum for interactor A"},{name:"Checksum for interactor B"},{name:"Checksum for interaction"},{name:"negative"},{name:"Binding domain for interactor A"},{name:"Binding domain for interactor B"},{name:"Stoichiometry for interactor A"},{name:"Stoichiometry for interactor B"},{name:"Participant identification method for interactor A"},{name:"Participant identification method for interactor B"}],DATABASE_URL:{uniprotkb:"http://www.uniprot.org/uniprot/",intact:"http://www.ebi.ac.uk/intact/",taxid:"http://www.uniprot.org/taxonomy/",psimi:"http://www.ebi.ac.uk/ontology-lookup/browse.do?ontName=MI&termId="}}),Biojs.InteractiveInteractionTable=Biojs.extend({constructor:function(){var a=this;this._container=jQuery("#"+this.opt.target),this._container.ready(function(){a._initialize()})},opt:{target:"",interactionSetObject:{},dasRegistryUrl:"http://www.dasregistry.org/das/sources",converterUrl:"http://matrixdb.ibcp.fr/matrixdbSpecifics.json",proteinAnnotationUrl:{uniprot:"www.uniprot.org/"},geneAnnotationUrl:{unigene:"http://www.ncbi.nlm.nih.gov/unigene/"},interactionProviderUrl:{DIP:"http://dip.doe-mbi.ucla.edu/dip/"},provider:"matrixdb"},eventYpes:["onCellClick"],_headers:null,_headersDef:null,_converter:null,_initialize:function(){var a=this;this._setConverter(this.opt.converterUrl),this.headers=[{sTitle:"Interactor A"},{sTitle:"Common name A"},{sTitle:"Gene name A"},{sTitle:"A Biological Role"},{sTitle:"A Tax ID"},{sTitle:"Interactor B"},{sTitle:"Common name B"},{sTitle:"Gene name B"},{sTitle:"B Biological Role"},{sTitle:"B TaxID"},{sTitle:"Source database"}],this.headersDef=[{sWidth:"5%",aTargets:[0]},{sWidth:"15%",aTargets:[1]},{sWidth:"5%",aTargets:[2]},{sWidth:"15%",aTargets:[3]},{sWidth:"2.5%",aTargets:[4]},{sWidth:"10%",aTargets:[5]},{sWidth:"15%",aTargets:[6]},{sWidth:"5%",aTargets:[7]},{sWidth:"15%",aTargets:[8]},{sWidth:"2.5%",aTargets:[9]},{sWidth:"5%",aTargets:[10]}],this._contentTable=jQuery('<table cellpadding="0" cellspacing="0" border="0" class="display" id="example" width="100%"></table>').appendTo(this._container),this._contentTable.dataTable({sScrollX:"100%",bAutoWidth:!0,bJQueryUI:!0,bRetrieve:!0,oTableTools:{sRowSelect:"multi",aButtons:["select_all","select_none"]},aaData:this.opt.interactionSetObject.aaData,aoColumns:this.headers,fnInitComplete:function(){a._formatCells()}});var b=$(this._contentTable).dataTable();this._contentTable.show(b)},_formatCells:function(){var a=this,b=a._contentTable.dataTable();b.$("td").each(function(){var c=b.fnGetPosition(this),d=(c[0],c[1]),e=this.innerHTML;this.innerHTML=0,this.innerHTML='<div class = "dataTables_cellWrapper">'+e+"</div>";var f=this;a._generateContextualMenuDataTable(b,f),(0==d||5==d)&&jQuery(this).draggable({cursor:"crosshair",appendTo:"body",helper:"clone"}).css("cursor","pointer")}),b.find("[class=dataTables_cellWrapper]").each(function(){var a=jQuery(this).html();jQuery(this).qtip({content:a,events:{show:function(){$(".qtip").each(function(){$(this).qtip("hide")})}}})}),b.bind("draw",a.refreshQtip)},_setConverter:function(){$.getJSON(this.opt.converterUrl,function(a){self.converter=a}).complete(function(){}).error(function(){self.converter={GAG_1:{type:"Glycosaminoglycan",name:"Heparin",comments:"Defined by the disaccharide unit (GlcNAc[alpha]1-4GlcA[beta]1-4IdoA[alpha] 1-4)n, containing N- and O-sulfate esters at various positions that has the highest amount of iduronic acid and of N- and O-sulfate residues. Made by mast cells.",chebiRef:"CHEBI:28304"},GAG_2:{type:"Glycosaminoglycan",name:"Heparan_Sulfate",comments:"Defined by the disaccharide unit (GlcNAc[alpha]1-4GlcA[beta]1-4IdoA[alpha] 1-4)n, containing N- and O-sulfate esters at various positions, and typically found covalently linked to a proteoglycan core protein.",chebiRef:"CHEBI:28815"},GAG_3:{type:"Glycosaminoglycan",name:"Dermatan_Sulfate",comments:"A modified form of chondroitin sulfate  (defined by the disaccharide unit (GalNAc[beta]1-4GlcA[beta] 1-3)n, modified with ester-linked sulfate at certain positions) in which a portion of the D-glucuronate residues are epimerized to L-iduronates. Typically found covalently linked to a core protein to form a proteoglycan.",chebiRef:"CHEBI:18376"},GAG_4:{type:"Glycosaminoglycan",name:"Chondroitin_Sulfate_A",comments:"Defined by the disaccharide unit (GalNAc[beta]1-4GlcA[beta] 1-3)n, modified with ester-linked sulfate at certain positions and typically found covalently linked to a core protein to form a proteoglycan.",chebiRef:"CHEBI:18250"},GAG_5:{type:"Glycosaminoglycan",name:"Chondroitin_Sulfate_C",comments:"Defined by the disaccharide unit (GalNAc[beta]1-4GlcA[beta] 1-3)n, modified with ester-linked sulfate at certain positions and typically found covalently linked to a core protein to form a proteoglycan.",chebiRef:"CHEBI:18296"},GAG_6:{type:"Glycosaminoglycan",name:"Chondroitin_Sulfate_D",comments:"Defined by the disaccharide unit (GalNAc[beta]1-4GlcA[beta] 1-3)n, modified with ester-linked sulfate at certain positions and typically found covalently linked to a core protein to form a proteoglycan.",chebiRef:"CHEBI:37397"},GAG_7:{type:"Glycosaminoglycan",name:"Chondroitin_Sulfate_E",comments:"Defined by the disaccharide unit (GalNAc[beta]1-4GlcA[beta] 1-3)n, modified with ester-linked sulfate at certain positions and typically found covalently linked to a core protein to form a proteoglycan.",chebiRef:"CHEBI:52562"},GAG_8:{type:"Glycosaminoglycan",name:"Keratan_Sulfate",comments:"A poly-N-acetyllactosamine (Gal[beta]1-4GlcNAc[beta] 1-3)n with sulfate esters at C-6 of N-acetylglucosamine and galactose residues, typically found covalently linked to a core protein to form a proteoglycan.",chebiRef:"CHEBI:18331"},GAG_9:{type:"Glycosaminoglycan",name:"Hyaluronan",comments:"Defined by the disaccharide unit (GlcNAc[beta]1-4GlcA[beta] 1-3)n that is neither sulfated nor covalently linked to protein.",chebiRef:"CHEBI:16336"},MULT_1_human:{type:"Multimer",name:"Laminin-111",components:["P25391","P07942","P11047"],ebiRef:"EBI-2529702",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_1_human&class=Multimer#bottom",Stoichiometry:"1 P25391 + 1 P07942 + 1 P11047"},MULT_2_human:{type:"Multimer",name:"Laminin -1_Nidogen-1",components:["MULT_1_human","P14543"],getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_2_human&class=Multimer#bottom"},MULT_3_human:{type:"Multimer",name:"Collagen-I",components:["P02452","P08123"],ebiRef:"EBI-2325312",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_3_human&class=Multimer#bottom",Stoichiometry:"2 P02452 + 1 P08123"},MULT_4_VAR1_human:{type:"Multimer",name:"Collagen-IV v1",components:["P02462","P08572"],ebiRef:"EBI-2461395",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_4_VAR1_human&class=Multimer#bottom",Stoichiometry:"2 P02462 + 1 P08572"},MULT_4_VAR2_human:{type:"Multimer",name:"Collagen-IV v2",components:["P29400","Q14031"],ebiRef:"EBI-2461418",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_4_VAR2_human&class=Multimer#bottom",Stoichiometry:"2 P29400 + 1 Q14031"},MULT_4_VAR3_human:{type:"Multimer",name:"Collagen-IV v3",components:["Q01955","P53420","P29400"],ebiRef:"EBI-2461456",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_4_VAR3_human&class=Multimer#bottom",Stoichiometry:"1 Q01955 + 1 P53420 + 1 P29400"},MULT_5_VAR1_human:{type:"Multimer",name:"Collagen-V heterotrimer 2 different chains",components:["P20908","P05997"],ebiRef:"EBI-2464572",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_5_VAR1_human&class=Multimer#bottom",Stoichiometry:"2 P20908 + 1 P05997"},MULT_5_VAR2_human:{type:"Multimer",name:"Collagen-V heterotrimer 3 different chains",components:["P20908","P05997","P25940"],ebiRef:"EBI-2464603",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_5_VAR2_human&class=Multimer#bottom",Stoichiometry:"1 P20908 + 1 P05997 + 1 P25940"},MULT_5_VAR3_human:{type:"Multimer",name:"Collagen-V homotrimer",components:["P20908"],ebiRef:"EBI-2464615",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_5_VAR3_human&class=Multimer#bottom",Stoichiometry:"3 P20908"},MULT_6_human:{type:"Multimer",name:"Collagen-IX",components:["P20849","Q14055","Q14050"],ebiRef:"EBI-2528296",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_6_human&class=Multimer#bottom",Stoichiometry:"1 P20849 + 1 Q14055 + 1 Q14050"},MULT_7_VAR1_human:{type:"Multimer",name:"Collagen-XI v1",components:["P12107","P13942","P02458"],ebiRef:"EBI-2528381",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_7_VAR1_human&class=Multimer#bottom",Stoichiometry:"1 P12107 + 1 P13942 + 1 P02458"},MULT_7_VAR2_human:{type:"Multimer",name:"Collagen-XI v2",components:["P12107","P05997"],ebiRef:"EBI-2528394",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_7_VAR2_human&class=Multimer#bottom",Stoichiometry:"2 P12107 + 1 P05997"},MULT_7_VAR3_human:{type:"Multimer",name:"Collagen-XI v3",components:["P20908","P12107","P05997"],ebiRef:"EBI-2528403",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_7_VAR3_human&class=Multimer#bottom",Stoichiometry:"1 P20908 + 1 P12107 + 1 P05997"},MULT_8_human:{type:"Multimer",name:"Collagen-VI",components:["P12109","P12110","P12111"],ebiRef:"EBI-2465980",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_8_human&class=Multimer#bottom",Stoichiometry:"1 P12109 + 1 P12110 + 1 P12111"},MULT_9_human:{type:"Multimer",name:"Collagen-II",components:["P02458"],ebiRef:"EBI-2431477",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_9_human&class=Multimer#bottom",Stoichiometry:"3 P02458"},MULT_10_human:{type:"Multimer",name:"Collagen-III",components:["P02461"],ebiRef:"EBI-2431547",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_10_human&class=Multimer#bottom",Stoichiometry:"3 P02461"},MULT_11_human:{type:"Multimer",name:"Collagen-XII",components:["Q99715"],ebiRef:"EBI-2528413",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_11_human&class=Multimer#bottom",Stoichiometry:"3 Q99715"},MULT_12_human:{type:"Multimer",name:"Collagen-XIII",components:["Q5TAT6"],ebiRef:"EBI-2528478",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_12_human&class=Multimer#bottom",Stoichiometry:"3 Q5TAT6"},MULT_13_human:{type:"Multimer",name:"Collagen-XIV",components:["Q05707"],ebiRef:"EBI-2528588",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_13_human&class=Multimer#bottom",Stoichiometry:"3 Q05707"},MULT_15_human:{type:"Multimer",name:"Integrin-alpha5beta1",components:["P05556","P08648"],ebiRef:"EBI-2550721",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_15_human&class=Multimer#bottom",Stoichiometry:"1 P08648 + 1 P05556"},MULT_16_human:{type:"Multimer",name:"Integrin-alphavbeta3",components:["P05106","P06756"],ebiRef:"EBI-2550735",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_16_human&class=Multimer#bottom",Stoichiometry:"1 P06756 + 1 P05106"},MULT_17_human:{type:"Multimer",name:"Integrin-alphavbeta5",components:["P18084","P06756"],ebiRef:"EBI-2550754",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_17_human&class=Multimer#bottom",Stoichiometry:"1 P06756 + 1 P18084"},MULT_18_human:{type:"Multimer",name:"Integrin-alpha3beta1",components:["P05556","P26006"],ebiRef:"EBI-2550808",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_18_human&class=Multimer#bottom",Stoichiometry:"1 P26006 + 1 P05556"},MULT_19_human:{type:"Multimer",name:"Integrin-alpha1beta1",components:["P05556","P56199"],ebiRef:"EBI-2554495",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_19_human&class=Multimer#bottom",Stoichiometry:"1 P56199 + 1 P05556"},MULT_22_human:{type:"Multimer",name:"Collagen-X",components:["Q03692"],ebiRef:"EBI-2528323",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_22_human&class=Multimer#bottom",Stoichiometry:"3 Q03692"},MULT_23_human:{type:"Multimer",name:"Fibrinogen",components:["P02671","P02675","P02679"],getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_23_human&class=Multimer#bottom",Stoichiometry:"2 P02671+ 2 P02675 + 2 P02679"},MULT_24_human:{type:"Multimer",name:"Integrin-alphaIIbbeta3",components:["P05106","P08514"],ebiRef:"EBI-2554508",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_24_human&class=Multimer#bottom",Stoichiometry:"1 P08514 + 1 P05106"},MULT_25_human:{type:"Multimer",name:"Integrin-alpha2beta1",components:["P05556","P17301"],ebiRef:"EBI-2565102",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_25_human&class=Multimer#bottom",Stoichiometry:"1 P17301 + 1 P05556"},MULT_26_human:{type:"Multimer",name:"Integrin-alpha4beta1",components:["P05556","P13612"],ebiRef:"EBI-2565117",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_26_human&class=Multimer#bottom",Stoichiometry:"1 P13612 + 1 P05556"},MULT_27_human:{type:"Multimer",name:"Laminin-211",components:["P24043","P07942","P11047"],ebiRef:"EBI-2529716",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_27_human&class=Multimer#bottom",Stoichiometry:"1 P24043 + 1 P07942 + 1 P11047"},MULT_28_human:{type:"Multimer",name:"Laminin-121",components:["P25391","P55268","P11047"],ebiRef:"EBI-2529791",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_28_human&class=Multimer#bottom",Stoichiometry:"1 P25391 + 1 P55268 + 1 P11047"},MULt_29_human:{type:"Multimer",name:"Laminin-221",components:["P24043","P55268","P11047"],ebiRef:"EBI-2529805",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULt_29_human&class=Multimer#bottom",Stoichiometry:"1 P24043 + 1 P55268 + 1 P11047"},MULT_30_human:{type:"Multimer",name:"Laminin-332",components:["Q16787","Q13751","Q13753"],ebiRef:"EBI-2529819",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_30_human&class=Multimer#bottom",Stoichiometry:"1 Q16787 + 1 Q13751 + 1 Q13753"},MULT_31_human:{type:"Multimer",name:"Laminin-311",components:["Q16787","P07942","P11047"],ebiRef:"EBI-2529903",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_31_human&class=Multimer#bottom",Stoichiometry:"1 Q16787 + 1 P07942 + 1 P11047"},MULT_32_human:{type:"Multimer",name:"Laminin-321",components:["Q16787","P55268","P11047"],ebiRef:"EBI-2529917",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_32_human&class=Multimer#bottom",Stoichiometry:"1 Q16787 + 1 P55268 + 1 P11047"},MULT_33_human:{type:"Multimer",name:"Laminin-411",components:["Q16363","P07942","P11047"],ebiRef:"EBI-2529931",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_33_human&class=Multimer#bottom",Stoichiometry:"1 Q16363 + 1 P07942 + 1 P11047"},MULt_34_human:{type:"Multimer",name:"Laminin-421",components:["Q16363","P55268","P11047"],ebiRef:"EBI-2529945",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULt_34_human&class=Multimer#bottom",Stoichiometry:"1 Q16363 + 1 P55268 + 1 P11047"},MULT_35_human:{type:"Multimer",name:"Laminin-511",components:["O15230","P07942","P11047"],ebiRef:"EBI-2529959",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_35_human&class=Multimer#bottom",Stoichiometry:"1 O15230 + 1 P07942 + 1 P11047"},Mult_36_human:{type:"Multimer",name:"Laminin-521",components:["O15230","P55268","P11047"],ebiRef:"EBI-2529973",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=Mult_36_human&class=Multimer#bottom",Stoichiometry:"1 O15230 + 1 P55268 + 1 P11047"},MULT_37_human:{type:"Multimer",name:"Laminin-213",components:["P24043","P07942","Q9Y6N6"],ebiRef:"EBI-2520006",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_37_human&class=Multimer#bottom",Stoichiometry:"1 P24043 + 1 P07942 + 1 Q9Y6N6"},MULT_38_human:{type:"Multimer",name:"Laminin-423",components:["Q16363","P55268","Q9Y6N6"],ebiRef:"EBI-2520020",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_38_human&class=Multimer#bottom",Stoichiometry:"1 Q16363+ 1 P55268 + 1 Q9Y6N6"},MULT_39_human:{type:"Multimer",name:"Laminin-522",components:["O15230","P55268","Q13753"],ebiRef:"EBI-2520034",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_39_human&class=Multimer#bottom",Stoichiometry:"1 O15230 + 1  P55268 + 1 Q13753"},MULT_40_human:{type:"Multimer",name:"Laminin-523",components:["O15230","P55268","Q9Y6N6"],ebiRef:"EBI-2520049",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_40_human&class=Multimer#bottom",Stoichiometry:"1 O15230 + 1  P55268 + 1 Q9Y6N6"},MULT_41_human:{type:"Multimer",name:"Collagen-VII",components:["Q02388"],ebiRef:"EBI-2466039",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_41_human&class=Multimer#bottom",Stoichiometry:"3 Q02388"},MULT_42_VAR1_human:{type:"Multimer",name:"Collagen-VIII v1",components:["P27658","P25067"],ebiRef:"EBI-2528208",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_42_VAR1_human&class=Multimer#bottom",Stoichiometry:"2 P27658 + 1 P25067"},MULT_42_VAR2_human:{type:"Multimer",name:"Collagen-VIII v2",components:["P27658"],ebiRef:"EBI-2528219",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_42_VAR2_human&class=Multimer#bottom",Stoichiometry:"3 P27658"},MULT_42_VAR3_human:{type:"Multimer",name:"Collagen-VIII v3",components:["P25067"],ebiRef:"EBI-2528228",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_42_VAR3_human&class=Multimer#bottom",Stoichiometry:"3 P25067"},MULT_43_human:{type:"Multimer",name:"Collagen-XV",components:["P39059"],ebiRef:"EBI-2528649",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_43_human&class=Multimer#bottom",Stoichiometry:"3 P39059"},MULT_44_human:{type:"Multimer",name:"Collagen-XVI",components:["Q07092"],ebiRef:"EBI-2528687",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_44_human&class=Multimer#bottom",Stoichiometry:"3 Q07092"},MULT_45_human:{type:"Multimer",name:"Collagen-XVII",components:["Q9UMD9"],ebiRef:"EBI-2528731",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_45_human&class=Multimer#bottom",Stoichiometry:"3 Q9UMD9"},MULT_46_human:{type:"Multimer",name:"Collagen-XVIII",components:["P39060"],ebiRef:"EBI-2528782",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_46_human&class=Multimer#bottom",Stoichiometry:"3 P39060"},MULT_47_human:{type:"Multimer",name:"Collagen-XIX",components:["Q14993"],ebiRef:"EBI-2529092",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_47_human&class=Multimer#bottom",Stoichiometry:"3 Q14993"},MULT_48_human:{type:"Multimer",name:"Collagen-XX",components:["Q9P218"],ebiRef:"EBI-2529132",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_48_human&class=Multimer#bottom",Stoichiometry:"3 Q9P218"},MULT_49_human:{type:"Multimer",name:"Collagen-XXI",components:["Q96P44"],ebiRef:"EBI-2529143",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_49_human&class=Multimer#bottom",Stoichiometry:"3 Q96P44"},MULT_50_human:{type:"Multimer",name:"Collagen-XXII",components:["Q8NFW1"],ebiRef:"EBI-2529189",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_50_human&class=Multimer#bottom",Stoichiometry:"3 Q8NFW1"},MULT_51_human:{type:"Multimer",name:"Collagen-XXIII",components:["Q86Y22"],ebiRef:"EBI-2529234",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_51_human&class=Multimer#bottom",Stoichiometry:"3 Q86Y22"},MULT_52_human:{type:"Multimer",name:"Collagen-XXIV",components:["Q17RW2"],ebiRef:"EBI-2529258",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_52_human&class=Multimer#bottom",Stoichiometry:"3 Q17RW2"},MULT_53_human:{type:"Multimer",name:"Collagen_XXV",components:["Q9BXS0"],ebiRef:"EBI-2529312",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_53_human&class=Multimer#bottom",Stoichiometry:"3 Q9BXS0"},MULT_54_human:{type:"Multimer",name:"Collagen-XXVI",components:["Q96A83"],ebiRef:"EBI-2529362",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_54_human&class=Multimer#bottom",Stoichiometry:"3 Q96A83"},MULT_55_human:{type:"Multimer",name:"Collagen-XXVII",components:["Q8IZC6"],ebiRef:"EBI-2529377",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_55_human&class=Multimer#bottom",Stoichiometry:"3 Q8IZC6"},MULT_56_human:{type:"Multimer",name:"Collagen-XXVIII",components:["Q2UY09"],ebiRef:"EBI-2529426",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_56_human&class=Multimer#bottom",Stoichiometry:"3 Q2UY09"},MULT_57_human:{type:"Multimer",name:"Thrombospondin-1",components:["P07996"],ebiRef:"EBI-2530370",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_57_human&class=Multimer#bottom",Stoichiometry:"3 P07996"},MULT_58_human:{type:"Multimer",name:"Thrombospondin-2",components:["P35442"],ebiRef:"EBI-2530917",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_58_human&class=Multimer#bottom",Stoichiometry:"3 P35442"},MULT_59_human:{type:"Multimer",name:"Thrombospondin-3",components:["P49746"],ebiRef:"EBI-2530961",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_59_human&class=Multimer#bottom",Stoichiometry:"5 P49746"},MULT_60_human:{type:"Multimer",name:"Thrombospondin-4",components:["P35443"],ebiRef:"EBI-2530975",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_60_human&class=Multimer#bottom",Stoichiometry:"5 P35443"},MULT_61_human:{type:"Multimer",name:"Thrombospondin_5",components:["P49747"],ebiRef:"EBI-2531058",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_61_human&class=Multimer#bottom",Stoichiometry:"5 P49747"},MULT_62_human:{type:"Multimer",name:"Integrin-alpha6beta1",components:["P23229","P05556"],ebiRef:"EBI-2565268",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_62_human&class=Multimer#bottom",Stoichiometry:"1 P23229 + 1 P05556"},MULT_63_human:{type:"Multimer",name:"Integrin-alpha7beta1",components:["Q13683","P05556"],ebiRef:"EBI-2565379",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_63_human&class=Multimer#bottom",Stoichiometry:"1 Q13683 + 1 P05556"},MULT_64_human:{type:"Multimer",name:"Integrin-alpha8beta1",components:["P53708","P05556"],ebiRef:"EBI-2567920",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_64_human&class=Multimer#bottom",Stoichiometry:"1 P53708 + 1 P05556"},MULT_65_human:{type:"Multimer",name:"Integrin-alpha9beta1",components:["Q13797","P05556"],ebiRef:"EBI-2567957",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_65_human&class=Multimer#bottom",Stoichiometry:"1 Q13797 + 1 P05556"},MULT_66_human:{type:"Multimer",name:"Integrin-alpha10beta1",components:["O75578","P05556"],ebiRef:"EBI-2568006",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_66_human&class=Multimer#bottom",Stoichiometry:"1 O75578 + 1 P05556"},MULT_67_human:{type:"Multimer",name:"Integrin-alpha11beta1",components:["Q9UKX5","P05556"],ebiRef:"EBI-2568044",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_67_human&class=Multimer#bottom",Stoichiometry:"1 Q9UKX5 + 1 P05556"},MULT_68_human:{type:"Multimer",name:"Integrin-alphavbeta1",components:["P06756","P05556"],ebiRef:"EBI-2568057",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_68_human&class=Multimer#bottom",Stoichiometry:"1 P06756 + 1 P05556"},MULT_69_human:{type:"Multimer",name:"Integrin-alphavbeta6",components:["P06756","P18564"],ebiRef:"EBI-2568099",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_69_human&class=Multimer#bottom",Stoichiometry:"1 P06756 + 1 P18564"},MULT_70_human:{type:"Multimer",name:"Integrin-alphavbeta8",components:["P06756","P26012"],ebiRef:"EBI-2568170",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_70_human&class=Multimer#bottom",Stoichiometry:"1 P06756 + 1 P26012"},MULT_71_human:{type:"Multimer",name:"Integrin-alpha6beta4",components:["P23229","P16144"],ebiRef:"EBI-2568184",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_71_human&class=Multimer#bottom",Stoichiometry:"1 P23229 + 1 P16144"},MULT_72_human:{type:"Multimer",name:"Integrin-alpha4beta7",components:["P13612","P26010"],ebiRef:"EBI-2568198",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_72_human&class=Multimer#bottom",Stoichiometry:"1 P13612 + 1 P26010"},MULT_73_human:{type:"Multimer",name:"Integrin-alphaEbeta7",components:["P38570","P26010"],ebiRef:"EBI-2568216",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_73_human&class=Multimer#bottom",Stoichiometry:"1 P38570 + 1 P26010"},MULT_74_human:{type:"Multimer",name:"Integrin-alphaLbeta2",components:["P20701","P05107"],ebiRef:"EBI-2568233",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_74_human&class=Multimer#bottom",Stoichiometry:"1 P20701 + 1 P05107"},MULT_75_human:{type:"Multimer",name:"Integrin-alphaMbeta2",components:["P11215","P05107"],ebiRef:"EBI-2568294",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_75_human&class=Multimer#bottom",Stoichiometry:"1 P11215 + 1 P05107"},MULT_76_human:{type:"Multimer",name:"Integrin-alphaXbeta2",components:["P20702","P05107"],ebiRef:"EBI-2568341",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_76_human&class=Multimer#bottom",Stoichiometry:"1 P20702 + 1 P05107"},MULT_77_human:{type:"Multimer",name:"Integrin-alphaDbeta2",components:["Q13349","P05107"],ebiRef:"EBI-2568341",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_77_human&class=Multimer#bottom",Stoichiometry:"1 Q13349 + 1 P05107"},MULT_78_human:{type:"Multimer",name:"PDGF-BB",components:["P01127"],ebiRef:"EBI-2881451",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_78_human&class=Multimer#bottom",Stoichiometry:"2 P01127"},MULT_79_human:{type:"Multimer",name:"PDGF-AB",components:["P04085","P01127"],ebiRef:"EBI-2881436",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_79_human&class=Multimer#bottom",Stoichiometry:"1 P04085 + 1 P01127"},MULT_80_human:{type:"Multimer",name:"PDGF-AA",components:["P04085"],ebiRef:"EBI-2881443",getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_80_human&class=Multimer#bottom",Stoichiometry:"2 P04085"},MULT_81_VAR1_human:{type:"Multimer",name:"VEGF-A165",components:["P15692"],getUrl:"http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name=MULT_81_VAR1_human&class=Multimer#bottom",Stoichiometry:"2 P15692"}}
})},_generateContextualMenuDataTable:function(a,b){var c=this;jQuery(b).qtip({content:{text:function(d){var e=c._qtipGenerateContent(d,a,b);return $(this).attr("qtip-content",e.text),$(this).attr("qtip-content")},title:function(d){var e=c._qtipGenerateContent(d,a,b);return $(this).attr("qtip-content",e.title),$(this).attr("qtip-content")}},position:{target:"mouse",adjust:{mouse:!1}},show:"mousedown",events:{show:function(a){if($(".qtip").each(function(){$(this).qtip("hide")}),2!==a.originalEvent.button)try{a.preventDefault()}catch(b){}}}}).bind("contextmenu",function(){return!1})},_qtipGenerateContent:function(a,b,c){var d,e=b.fnGetPosition(c),f=(e[0],e[1]),g=c.innerHTML,h=void 0;if(0==f||5==f){h="BioMolecule";var i,j,k=jQuery(g).text();if(k in self.converter){if(h=self.converter[k].type,i=$("<div></div>"),$(i).append(jQuery("<p id = qtipContextContent></p>")),$(i).find("#qtipContextContent").append("<h4 id=qtTitle>"+self.converter[k].name+"</h4>"),"chebiRef"in self.converter[k]){var l="http://www.ebi.ac.uk/chebi/searchId.do?chebiId="+self.converter[k].chebiRef;$(i).find("#qtTitle").append('<a class="alink" href = "'+l+'" target="_blank"><img src = "../images/chebiLogo.png" alt="chebiLogo" class="qtipLogo2"/></a>')}if("comments"in converter[k]&&$(i).find("#qtipContextContent").append(self.converter[k].comments),"Stoichiometry"in converter[k]&&$(i).find("#qtipContextContent").append("Stoichiometry: "+self.converter[k].Stoichiometry),"ebiRef"in self.converter[k],"components"in self.converter[k]){jQuery(i).append(jQuery('<h4><img src = "../images/icon_uniprotkb.png" alt="uniprotkb" class="qtipLogo"/>Component subunits<h4><p id="compounds"></p>'));for(var m=jQuery("<ul></ul>"),n=0;n<self.converter[k].components.length;n++){var o=self.converter[k].components[n],p="http://www.uniprot.org/uniprot/"+o;jQuery(m).append(jQuery('<li><a class="alink" href = "'+p+'" target="_blank">'+o+"</a></li>"))}jQuery(i).find("#compounds").append(jQuery(m))}}else{var q="http://www.uniprot.org/uniprot/"+k;j="http://matrixdb.ibcp.fr/cgi-bin/model/report/default?name="+k+"&class="+h+"#bottom",i=jQuery('<div><p><a class="alink" href = "'+q+'" target="_blank"><img src = "../images/icon_uniprotkb.png" alt="uniprotkb" class="qtipLogo"/></a></p><p><a class="alink" href = "'+j+'" target="_blank">"visit matrixdb"</a></p></div>')}return d={text:i.html(),title:h}}return d},redraw:function(a){var b=this._contentTable.dataTable();b.fnClearTable(),b.fnAddData(a.interactionSetObject.aaData),this._formatCells()},displayQtip:function(){},refreshQtip:function(){}}),Biojs.KEGGViewer=Biojs.extend({constructor:function(a){var b=this;a.expression&&a.expression.conditions.length>0&&b._initInfo(this.opt),b._query(this.opt)},opt:{target:"YourOwnDivId",pathId:"hsa04910",proxyUrl:"../biojs/dependencies/proxy/proxy.php",expression:{upColor:"red",downColor:"blue",genes:["hsa:7248","hsa:51763","hsa:2002","hsa:2194"],conditions:[{name:"condition 1",values:[-1,.5,.7,-.3]},{name:"condition 2",values:[.5,-.1,-.2,1]},{name:"condition 3",values:[0,.4,-.2,.5]}]}},eventTypes:[],_initInfo:function(a){var b=this,c='<option value="nocondition">No Condition</option>';a.expression.conditions.forEach(function(a){c+='<option value="'+a.name+'">'+a.name+"</option>"}),jQuery('<div id="toolbar" style="position:relative;z-index:999999;top:20px;float:right;font-size:0.8em"><select id="condition">'+c+'</select><button id="play">play</button><button id="refresh">refresh</button><p><label for="amount">Expression range:</label><label id="amount" style=" color: #f6931f; font-weight: bold;margin-left:10px;"></label></p><div id="slider-range"></div></div>').appendTo("#"+a.target),$("#play").button({text:!1,icons:{primary:"ui-icon-play"}}).click(function(){var a;"play"===$(this).text()?(a={label:"stop",icons:{primary:"ui-icon-stop"}},$("#refresh").button("disable"),b._conditions=$("#condition > option"),b._interval=setInterval(function(){for(var a,c=b._conditions,d=$("#condition").val(),e=0;e<c.length;e++)if($(c[e]).val()==d){a=e;break}$("#condition").val(a===c.length?$(c[0]).val():$(c[a+1]).val()),b._paintExpression(b)},2e3)):(a={label:"play",icons:{primary:"ui-icon-play"}},$("#refresh").button("enable"),window.clearInterval(b._interval)),$(this).button("option",a)}),$("#refresh").button({text:!1,icons:{primary:"ui-icon-refresh"}}).click(function(){b._paintExpression(b)});for(var d,e,f=0;f<a.expression.conditions.length;f++)for(var g=a.expression.conditions[f],h=0;h<g.values.length;h++){var i=g.values[h];void 0==d&&void 0==e?(d=i,e=i):d>i?d=i:i>e&&(e=i)}a.expression.min=d,a.expression.max=e,$("#slider-range").slider({range:!0,min:d,max:e,step:.01,slide:function(a,b){$("#amount").text(b.values[0]+" , "+b.values[1])}}),$("#amount").text($("#slider-range").slider("values",0)+" , "+$("#slider-range").slider("values",1)),$("#condition").change(function(){b._paintExpression(b)})},_query:function(a){var b=this;$.ajax({dataType:"xml",url:a.proxyUrl,data:{url:"http://rest.kegg.jp/get/"+a.pathId+"/kgml"},success:function(a){b._renderPathway(a,b)}})},_clearExpression:function(a){for(var b=a._cy.nodes(),c=0;c<b.length;c++)for(var d=0;d<a.opt.expression.genes.length;d++)b[c].data().keggId==a.opt.expression.genes[d]&&b[c].css("background-color",b[c].data().bkg_color)},_paintExpression:function(a){"nocondition"==$("#condition").val()&&a._clearExpression(a);for(var b=$("#slider-range").slider("values",0),c=$("#slider-range").slider("values",1),d={},e=0;e<a.opt.expression.conditions.length;e++)if(a.opt.expression.conditions[e].name==$("#condition").val()){d=a.opt.expression.conditions[e];for(var f=a._cy.nodes(),g=0;g<f.length;g++)for(var h=0;h<a.opt.expression.genes.length;h++){var i=jQuery.inArray(a.opt.expression.genes[h],f[g].data().keggId);if(-1!=i){var j=d.values[h],k=f[g].data().bkg_color;b>j?k=a.opt.expression.downColor:j>c&&(k=a.opt.expression.upColor),f[g].css("background-color",k)}}break}},_renderPathway:function(a,b){var c={},d={},e=[],f=[],g=[];$(a).find("entry").each(function(){var a=$(this),b=a.attr("type"),f=a.find("graphics"),h="center",i="rectangle",j="#99ff99",k=.9,l=0,m=$(f).attr("width"),n=$(f).attr("height");"gene"==b?l=2:"ortholog"==b?l=2:"compound"==b?(i="ellipse",j="#aaaaee",h="bottom",k=1):"map"==b?(i="roundrectangle",j="#00bfff"):"group"==b&&(m=void 0,n=void 0,a.find("component").each(function(){d[$(this).attr("id")].data.parent=a.attr("id")}));var o=[];void 0!==f.attr("name")&&(o=f.attr("name").split(","));var p={};p.data={id:a.attr("id"),keggId:a.attr("name").split(" "),name:o[0],names:o,type:b,link:a.attr("link"),width:m,height:n,shape:i,bkg_color:j,text_valign:h,"border-width":l},g.push(a.attr("name")),d[a.attr("id")]=p,e.push(p),c[a.attr("id")]={x:+f.attr("x"),y:+f.attr("y")}}),$(a).find("relation").each(function(){var a=$(this),b=a.attr("type");a.find("subtype").each(function(){var c=$(this),d=c.attr("name"),e="solid",g="none",h="";"maplink"==d?g="diamond":"indirect effect"==d?(e="dotted",g="diamond"):"state change"==d?e="dotted":"missing interaction"==d?(e="dotted",g="triangle"):"phosphorylation"==d?(g="triangle",h="p+"):"dephosphorylation"==d?(g="triangle",h="p-"):"glycosylation"==d?(e="dashed",g="circle"):"ubiquitination"==d?(e="dashed",g="circle"):"methylation"==d?(e="dashed",g="circle"):"activation"==d?g="triangle":"inhibition"==d?g="tee":"expression"==d?g="triangle":"repression"==d&&(g="tee"),f.push({data:{source:a.attr("entry1"),target:a.attr("entry2"),name:d,reaction:b,line_style:e,target_arrow_shape:g,text:h}})})}),jQuery('<div style="z-index:9;position:relative;height:500px;width:100%;"></div>').appendTo("#"+b.opt.target).cytoscape({elements:{nodes:e,edges:f},style:cytoscape.stylesheet().selector("node").css({content:"data(name)","text-valign":"center",width:"data(width)",height:"data(height)",shape:"data(shape)","background-color":"data(bkg_color)","text-valign":"data(text_valign)",opacity:"data(opacity)","border-color":"#000000","border-width":"data(border-width)","font-size":11}).selector("edge").css({content:"data(text)","target-arrow-shape":"data(target_arrow_shape)","line-style":"data(line_style)","line-color":"#000000","target-arrow-color":"#000000","text-valign":"bottom"}),layout:{name:"preset",fit:!1,positions:c},ready:function(){var a=this;b._cy=a}})}}),Biojs.MmcifViewer=Biojs.extend({opt:{divid:"YourOwnDivId",pdbid:"1cbs"},constructor:function(a){var b=this;jQuery("#"+a.divid).html('<table cellpadding="0" cellspacing="0" border="0" class="display" id="catlistTable"></table><br><br><hr><br><br> <table cellpadding="0" cellspacing="0" border="0" class="display" id="categoryTable"></table><br>'),b.pdbid=a.pdbid,b.catable=null,jQuery.ajax({url:"http://puck.ebi.ac.uk:4000/mmcif/"+b.pdbid+"/categories",data:{varname:"catlist"},dataType:"script",crossDomain:"true",type:"GET",success:function(){b.showCategoriesList(catlist)}})},showCategoriesList:function(a){for(var b=this,c=0;c<a.length;c++)a[c]=[a[c]];var d=jQuery("#catlistTable").dataTable({aaData:a,aoColumns:[{sTitle:"Categories"}]});d.$("td").click(function(){var a=d.fnGetData(this);b.showAcategory(a)})},standardizeVals:function(a){return a instanceof Array?a:[a]},showAcategory:function(a){var b=this;console.log("Start showing category "+a),jQuery.ajax({url:"http://puck.ebi.ac.uk:4000/mmcif/"+b.pdbid+"/"+a,data:{varname:"catinfo"},dataType:"script",crossDomain:"true",type:"GET",success:function(){b.showCategoryTable(catinfo)}})},showCategoryTable:function(a){var b=this,c=[],d=[];for(var e in a){c.push({sTitle:e});var f=b.standardizeVals(a[e]);if(0==d.length)for(ri=0;ri<f.length;ri++)d.push([]);for(ri=0;ri<f.length;ri++)d[ri].push(f[ri])}null!=b.catable&&(b.catable.fnDestroy(),jQuery("#categoryTable").html("")),b.catable=jQuery("#categoryTable").dataTable({aaData:d,aoColumns:c,bDestroy:!0})},eventTypes:["onClick","onHelloSelected"]}),Biojs.PDBLogos=Biojs.extend({opt:{target:"YourOwnDivId",raphael:null,identifier:"",startX:10,startY:10,interval:10,size:40,orient:"h",logosURL:"http://www.ebi.ac.uk/pdbe-apps/widgets/pdbprints",logos:[],color:"#588FE5",pdb3DIcon:"biojs/css/images/3d.png"},eventTypes:["onClick"],constructor:function(){this._initCanvas(),Biojs.Utils.isEmpty(this.opt.identifier)||this._doRequest(this.opt.identifier)},_initCanvas:function(){var a=this.opt;Biojs.Utils.isEmpty(a.raphael)||(a.raphael.remove(),a.raphael=null);var b=a.startX+a.size*Biojs.PDBLogos.CATEGORY.lenght,c=a.startY+(a.interval+a.size);a.orient==Biojs.PDBLogos.VERTICAL&&(c=a.startY+a.size*Biojs.PDBLogos.CATEGORY.lenght,b=a.startX+(a.interval+a.size)),a.raphael=Raphael(a.target,b,c)},setIdentifier:function(a){this.opt.identifier=a,this._initCanvas(),this._doRequest(a)},_doRequest:function(a){var b=this;jQuery.ajax({url:"http://www.ebi.ac.uk/pdbe-apps/widgets/pdbprints",data:{varname:"printsdata",pdbid:a,color:"transparent"},dataType:"script",crossDomain:"true",type:"GET",success:function(){b._printsLayout(printsdata)}})},_printsLayout:function(a){var b=this,c=this.opt,d=c.startX,e=c.startY,f=0;c.logos=[],a[c.identifier].PDBStructure=[c.pdb3DIcon,"structure"];for(category in Biojs.PDBLogos.CATEGORY){var g=c.size,h=c.size,i=a[c.identifier][category][0],j="http://www.pdbe.org";d=c.startX,e=c.startY,c.orient==Biojs.PDBLogos.VERTICAL?e+=c.size*f++:d+=c.size*f++,"PDBeLogo"==category?(c.logos.push(c.raphael.text(d,e+b.opt.size/4,c.identifier).attr({"font-family":"Mono","text-anchor":"start","font-size":b.opt.size/3,cursor:"pointer",title:"View all about PDB "+c.identifier}).data("identifier",c.identifier).mouseup(function(){window.open("http://www.pdbe.org/"+this.data("identifier"))})),i="http://www.ebi.ac.uk/pdbe-apps/widgets/html/PDBeWatermark_horizontal_128.png",h=.9*c.size,g=c.size/2,e+=c.size/2):(j+="/"+c.identifier+"/"+Biojs.PDBLogos.CATEGORY[category],"PDBStructure"==category&&(j="http://www.ebi.ac.uk/pdbe-srv/view/entry/"+c.identifier+"/openastex"),c.raphael.rect(d,e,h,g,7).attr({fill:b.opt.color})),c.logos.push(c.raphael.image(i,d,e,h,g).attr({cursor:"pointer",title:"View "+category}).data({printsURL:j,category:category}).mouseup(function(){b.raiseEvent(Biojs.PDBLogos.EVT_ON_CLICK,{printsURL:this.data("printsURL"),identifier:c.identifier,category:this.data("category")})}).mouseover(function(){}))}}},{HORIZONTAL:"h",VERTICAL:"v",CATEGORY:{PDBeLogo:"",PrimaryCitation:"citation",Taxonomy:"taxonomy",Expressed:"taxonomy",Experimental:"experimental",Protein:"primary",NucleicAcid:"primary",Ligands:"ligands",PDBStructure:"PDBStructure"},EVT_ON_CLICK:"onClick"}),Biojs.PDBprints=Biojs.extend({opt:{target:"YourOwnDivId",rapha:null,pdbids:["2x9t"]},constructor:function(){for(var a=this,b={size:40,orient:"h",interval:10,startX:10,startY:10},c=0;c<a.opt.targets.length;c++){var d=a.opt.targets[c];for(var e in b)d[e]||(d[e]=b[e]);if(!d.rapha){var f=d.startX+8*d.size,g=d.startY+(d.interval+d.size)*d.pdbids.length;"v"==d.orient&&(g=d.startY+8*d.size,f=d.startX+(d.interval+d.size)*d.pdbids.length),d.rapha=Raphael(d.divid,f,g)}}var h="";for(var i in a.opt.targets)for(var j=0;j<a.opt.targets[i].pdbids.length;j++)h+=a.opt.targets[i].pdbids[j]+",";h=h.replace(/,$/,""),jQuery.ajax({url:"http://www.ebi.ac.uk/pdbe-apps/widgets/pdbprints",data:{varname:"printsdata",pdbid:h},dataType:"script",crossDomain:"true",type:"GET",success:function(){a.printsLayout(printsdata)}})},printsLayout:function(a){for(var b=this,c=0;c<b.opt.targets.length;c++){var d=b.opt.targets[c];b.printsLayout1(d,a)}},printsLayout1:function(a,b){var c=50,d="h",e=10,f=10,g=5;c=a.size,d=a.orient,g=a.interval,e=a.startX,f=a.startY;for(var h=["PDBeLogo","PrimaryCitation","Taxonomy","Expressed","Experimental","Protein","NucleicAcid","Ligands"],i={PDBeLogo:[""],PrimaryCitation:["citation"],Taxonomy:["taxonomy"],Expressed:["taxonomy"],Experimental:["experimental"],Protein:["primary"],NucleicAcid:["primary"],Ligands:["ligands"]},j=0;j<a.pdbids.length;j++){for(var k=a.pdbids[j],l=0;l<h.length;l++){var m=h[l],n=e+c*l,o=f;"v"==d&&(n=e,o=f+c*l);var p=b[k][m][0],q=c,r=c,s="http://pdbe.org";if("PDBeLogo"==m){var t=a.rapha.text(n,o+c/4,k).attr({"font-family":"Mono","text-anchor":"start","font-size":c/3}).attr({cursor:"pointer",title:"a tooltip "+k}).data("pdbid",k);t.mouseup(function(){window.open("http://pdbe.org/"+this.data("pdbid"))}),p="http://www.ebi.ac.uk/pdbe-apps/widgets/html/PDBeWatermark_horizontal_128.png",r=.9*c,q=c/2,o+=c/2}else s+="/"+k+"/"+i[m][0];var u=a.rapha.image(p,n,o,r,q).attr({cursor:"pointer",title:"a tooltip "+m});u.data("printsURL",s),u.mouseup(function(){window.open(this.data("printsURL"))}),u.mouseover(function(){})}"v"==d&&(e+=c+g),"h"==d&&(f+=c+g)}},eventTypes:["onClick","onHelloSelected"]}),Biojs.Protein3D=Biojs.extend({constructor:function(){var a=this,b=this.opt.width,c=this.opt.height;this._appletId="jmolApplet"+a.getId(),this._container=jQuery("#"+this.opt.target).addClass("Protein3D"),void 0==b?b=this._container.css("width"):this._container.width(b),void 0==c?c=this._container.css("height"):this._container.height(c),this.opt.backgroundColor=void 0!==this.opt.backgroundColor?this.opt.backgroundColor:this._container.css("background-color"),this._container.html(""),this._controlsContainer=jQuery('<div id="controlSection" class="Protein3D_tab"></div>').appendTo(this._container),this._appletContainer=jQuery('<div id="div'+a._appletId+'" class="Protein3D_applet"></div>').appendTo(this._container),this._loadingImage=jQuery('<div class="Protein3D_loadingImage" />').appendTo(this._container).hide(),void 0!==this.opt.loadingStatusImage&&this._loadingImage.css("background-image","url("+this.opt.loadingStatusImage+")"),this._initializeJmolApplet(),Biojs.console.log("ending Biojs.Protein3D constructor")},opt:{target:"component",width:597,height:400,jmolFolder:"../biojs/dependencies/jmol-12.0.48",unpolarColor:"salmon",negativeColor:"red",positiveColor:"blue",polarColor:"yellow",backgroundColor:"white",enableControls:!0,loadingStatusImage:void 0,surface:"None",style:"Cartoon",colorScheme:"By Chain",antialias:!1,rotate:!1},eventTypes:["onPdbLoaded","onSelection"],_appletId:void 0,_controlsReady:!1,_jmoljarfile:"JmolApplet.jar",_jmolAppletInitialized:!1,_selection:void 0,_selectionType:void 0,_display:{property:{polar:!1,unpolar:!1,positive:!1,negative:!1},surface:!1,halos:!0},_initializeJmolApplet:function(){var a=this;jmolInitialize(a.opt.jmolFolder),jmolSetAppletColor(a.opt.backgroundColor),jmolSetDocument(0);var b=a._appletId+"_pdbLoadCb";Biojs.console.log("registring callback function loadStructCallback "+b),Biojs.registerGlobal(b,a._loadStructCallback),jmolSetCallback("loadStructCallback",b)},showControls:function(){this.changeControlsVisiblility(!0)},hideControls:function(){this.changeControlsVisiblility(!1)},changeControlsVisiblility:function(a){this.opt.enableControls&&(this._controlsReady||this._buildControls(),a!=this._controlsAreVisible()&&this._toggleControls())},getSelection:function(){return Biojs.Utils.clone(this._selection)},reset:function(){jmolScriptWait(this._getDisplayColor(this.opt.colorScheme)+this._getDisplayStyle(this.opt.style),this.getId());var a=jQuery("#"+this.opt.target);a.find("div#controlSection > div#controls > input[type='checkbox']").attr("checked",!1),a.find("#styleSelect").val(this.opt.style),a.find("#colorSelect").val(this.opt.colorScheme),a.find("#surfaceSelect").val(this.opt.style);for(var b in this._display.property)this._display.property[b]=!1;this.setHalosVisible(!0)},showLoadingImage:function(a){var b=void 0===a?!0:a;this._loadingImage.is(":visible")!=b&&(this._controlsContainer.toggle(),this._appletContainer.toggle(),this._loadingImage.toggle())},setPdb:function(a){Biojs.console.log("LOADING pdb content");var b=this,c=this._getDisplaySurface(this.opt.surface),d=this._getDisplayStyle(this.opt.style),e=this._getDisplayColor(this.opt.colorScheme),f=e+d+c+this._getSelectionScript(this._selection);this.showLoadingImage(!1),this._jmolAppletInitialized&&this.reset(),htmlContent=jmolAppletInline([b._appletContainer.width(),b._appletContainer.height()],a,f,b.getId()),this._appletContainer.html(htmlContent),this._jmolAppletInitialized=!0,Biojs.console.log("setPdb() ending")},removeSelection:function(){this._selection=void 0;var a="select all; ";a+=this._display.halos?"selectionHalos off; ":"color translucent 1; ",a+="select none;",jmolScriptWait(a,this.getId())},setSelection:function(a){a instanceof Array?(this._selection=Biojs.Utils.clone(a),this._drawSelection(),this.raiseEvent(Biojs.Protein3D.EVT_ON_SELECTION,{selectionType:this._selectionType,selection:Biojs.Utils.clone(a)})):a instanceof Object&&a.start<=a.end?(this._selection=Biojs.Utils.clone(a),this._drawSelection(),this.raiseEvent(Biojs.Protein3D.EVT_ON_SELECTION,{selectionType:"region",selection:Biojs.Utils.clone(a)})):Biojs.console.log("selection not valid")},_getSelectionScript:function(a){var b="",c="",d=!1,e=!1,f=!1;if(a){if(b="select all; color translucent 1;",a instanceof Array)for(i=0;i<a.length;i++)a[i]instanceof Object?(c=c+a[i].start+"-"+a[i].end,e=!0):(c+=a[i],f=!0),i!=a.length-1&&(c+=",");else c=a.start+"-"+a.end,d=!0;b+=this._display.halos?"select "+c+"; selectionHalos on;":"select not "+c+"; color translucent 0.8; selectionHalos off;"}else b="select none";return Biojs.console.log("Selection script: "+b),this._selectionType=1==d?"region":1==e&&1==f?"mixed":1==e&&0==f?"multipleRegion":0==e&&1==f?"positions":"region",Biojs.console.log("Selection type: "+this._selectionType),b},_drawSelection:function(){void 0!==this._selection&&(result=jmolScriptWait(this._getSelectionScript(this._selection),this.getId()),Biojs.console.log("Selection done, result: "+result))},displayAntialias:function(a){this._getControl("antialiasCheck").attr("checked",a),this.applyJmolCommand("set antialiasDisplay "+a)},rotate:function(a){this._getControl("rotationCheck").attr("checked",a),this.applyJmolCommand("spin "+a)},displaySurface:function(a){var b=this._getDisplaySurface(a);return void 0===b?void Biojs.console.log("Unknown surface name "+a):(this._getControl("surfaceSelect").val(a),void this.applyJmolCommand(b+this._getSelectionScript(this._selection)))},hideSurface:function(){this.displaySurface(Biojs.Protein3D.SURFACE_NONE)},displayNegative:function(a,b){a=void 0!==a?a:this.opt.positiveColor,b=void 0!==b?b:!0,this._getControl("negativeCheck").attr("checked",b),b?this.display("acidic",a):this.undisplay("acidic"),this._display.property.negative=b},hideNegative:function(){this.displayNegative(void 0,!1)},displayPositive:function(a,b){a=void 0!==a?a:this.opt.positiveColor,b=void 0!==b?b:!0,this._getControl("positiveCheck").attr("checked",b),b?this.display("basic",a):this.undisplay("basic"),this._display.property.positive=b},hidePositive:function(){this.displayPositive(void 0,!1)},displayPolar:function(a,b){polarColor=void 0!==a?a:this.opt.polarColor,b=void 0!==b?b:!0,this._getControl("polarCheck").attr("checked",b),b?this.display("polar",polarColor):this.undisplay("polar"),this._display.property.polar=b},_getControl:function(a){return jQuery(jQuery("#"+this.opt.target).find("#"+a)[0])},hidePolar:function(){this.displayPolar(void 0,!1)},displayUnPolar:function(a,b){a=void 0!==a?a:this.opt.unpolarColor,b=void 0!==b?b:!0,this._getControl("unpolarCheck").attr("checked",b),b?this.display("hydrophobic",a):this.undisplay("hydrophobic"),this._display.property.unpolar=b},displayColorScheme:function(a){return colorCmd=this._getDisplayColor(a),void 0===colorCmd?void Biojs.console.log("Unknown color scheme "+a):(this._getControl("colorSelect").val(a),void this.applyJmolCommand(colorCmd+this._getSelectionScript(this._selection)))},displayStyle:function(a){var b=this._getDisplayStyle(a);return void 0===b?void Biojs.console.log("Unknown style name "+a):(this._getControl("styleSelect").val(a),void this.applyJmolCommand(b+this._getSelectionScript(this._selection)))},hideUnPolar:function(){this.displayUnPolar(void 0,!1)},setHalosVisible:function(a){this._display.halos=a,a?jQuery("#"+this.opt.target).find("#halosRadio:checked").val()||(jQuery("#"+this.opt.target).find("#halosRadio").attr("checked","halosRadio"),jQuery("#"+this.opt.target).find("#translucentRadio").removeAttr("checked")):jQuery("#"+this.opt.target).find("#halosRadio:checked").val()&&(jQuery("#"+this.opt.target).find("#halosRadio").removeAttr("checked"),jQuery("#"+this.opt.target).find("#translucentRadio").attr("checked","translucentRadio")),this._drawSelection()},applyJmolCommand:function(a){jmolScriptWait(a,this.getId())},display:function(a,b){scr=this._isAnyDisplayed()?"":"select all; color lightgrey;",scr+="select "+a+";color "+b+"; select none",jmolScriptWait(scr,this.getId()),Biojs.console.log("applied: "+scr),this._drawSelection()},changeBackgroundColor:function(a){this.applyJmolCommand("background "+(void 0!==a?a:this.opt.backgroundColor))},undisplay:function(a){scr="select "+a+";color lightgrey; select none;",scr+=this._isAnyDisplayed()?"":"select all; color chain; select none;",jmolScriptWait(scr,this.getId()),Biojs.console.log("applied: "+scr),this._drawSelection()},_isAnyDisplayed:function(){for(var a in this._display.property)if(this._display.property[a])return!0;return!1},_buildTabPanel:function(a,b){a.html("");var c=jQuery('<div class="content"></div>').appendTo(a);c.expand=jQuery('<div style="display: none;" class="toggle expand"></div>').appendTo(a),c.collapse=jQuery('<div class="toggle collapse"/>').appendTo(a);var d=a.width()-c.expand.outerWidth();return a.css("left",0).find(".toggle.collapse").click(function(){a.animate({left:c.expand.width()-a.outerWidth()+"px"},function(){a.find(".toggle").toggle(),"function"==typeof b&&b.call(c,!1,c.expand.outerWidth()),c.hide(),a.css({left:"0px",width:"auto"})})}).css({"float":"right",position:"relative"}),a.find(".toggle.expand").click(function(){a.css({left:-d+"px"}),c.show(),a.animate({left:"0px"},function(){a.find(".toggle").toggle(),"function"==typeof b&&b.call(c,!0,a.outerWidth())})}),Biojs.console.log("content width "+d),c.css({width:d+"px",height:a.height()+"px","word-wrap":"break-word"}),c},_buildControls:function(){if(Biojs.console.log("_buildControls()"),this._controlsReady)return void Biojs.console.log("exiting _buildControls(): controls has been built already.");var a=this;jmolResizeApplet([a._container.width()-a._controlsContainer.outerWidth(),a._container.height()],a.getId()),this._controlsDiv=this._buildTabPanel(this._controlsContainer,function(b,c){jmolResizeApplet([a._container.width()-c,a._container.height()],a.getId()),a._appletContainer.css("width",a._container.width()-c)});this._controlsDiv.append('<h1> Display: </h1><input id="polarCheck" type="checkbox" name="polarCheck" value="polarCheck"/> Hydrophylic residues<br/><input id="unpolarCheck" type="checkbox" name="unpolarCheck" value="unpolarCheck"/> Hydrophobic residues<br/><input id="positiveCheck" type="checkbox" name="positiveCheck" value="positiveCheck"/> Basic(+) residues<br/><input id="negativeCheck" type="checkbox" name="negativeCheck" value="negativeCheck"/> Acidic(-) residues<br/><input id="antialiasCheck" type="checkbox" name="antialiasCheck" value="antialiasCheck"/> Antialias<br/><input id="backgroundCheck" type="checkbox" name="backgroundCheck" value="backgroundCheck"/> Black background<br/><input id="rotationCheck" type="checkbox" name="rotationCheck" value="rotationCheck"/> Rotation<h1>Style:</h1><select id="styleSelect"><option selected="selected">'+Biojs.Protein3D.STYLE_CARTOON+"</option><option >"+Biojs.Protein3D.STYLE_BACKBONE+"</option><option >"+Biojs.Protein3D.STYLE_CPK+"</option><option >"+Biojs.Protein3D.STYLE_BALL_STICK+"</option><option >"+Biojs.Protein3D.STYLE_LIGANDS+"</option><option >"+Biojs.Protein3D.STYLE_LIGANDS_POCKET+'</option></select><h1>Color:</h1><select id="colorSelect"><option selected="selected">'+Biojs.Protein3D.COLOR_BY_CHAIN+"</option><option >"+Biojs.Protein3D.COLOR_SECONDARY_STRUCTURE+"</option><option >"+Biojs.Protein3D.COLOR_RAINBOW+"</option><option >"+Biojs.Protein3D.COLOR_BY_ELEMENT+"</option><option >"+Biojs.Protein3D.COLOR_BY_AMINO_ACID+"</option><option >"+Biojs.Protein3D.COLOR_BY_TEMPERATURE+"</option><option >"+Biojs.Protein3D.COLOR_HIDROPHOBICITY+'</option></select><h1>Surface:</h1><select  id="surfaceSelect"><option selected="selected">'+Biojs.Protein3D.SURFACE_NONE+"</option><option >"+Biojs.Protein3D.SURFACE_ACCESSIBLE+"</option><option >"+Biojs.Protein3D.SURFACE_EXCLUDED+"</option><option >"+Biojs.Protein3D.SURFACE_CAVITIES+'</option></select><h1> Show selection using:</h1><input id="translucentRadio" type="radio" name="selection" value="translucentRadio"/> Translucent <input id="halosRadio" type="radio" name="selection" value="halosRadio" checked="halosRadio"/> Halos').change(function(b){var c=jQuery(b.target).attr("id");switch(c){case"polarCheck":a.displayPolar(void 0,b.target.checked);break;case"unpolarCheck":a.displayUnPolar(void 0,b.target.checked);break;case"positiveCheck":a.displayPositive(void 0,b.target.checked);break;case"negativeCheck":a.displayNegative(void 0,b.target.checked);break;case"antialiasCheck":a.displayAntialias(event.target.checked);break;case"rotationCheck":a.rotate(event.target.checked);break;case"backgroundCheck":a.changeBackgroundColor("black",b.target);break;case"styleSelect":a.displayStyle(b.target.value);break;case"colorSelect":a.displayColorScheme(b.target.value);break;case"surfaceSelect":a.displaySurface(b.target.value);break;case"translucentRadio":a.setHalosVisible(!1);break;case"halosRadio":a.setHalosVisible(!0)}});this._controlsReady=!0,Biojs.console.log("_buildControls done")},_controlsAreVisible:function(){return this._controlsContainer.find(".toggle.collapse").is(":visible")},_toggleControls:function(){this._controlsAreVisible()?this._controlsContainer.find(".toggle.collapse").click():this._controlsContainer.find(".toggle.expand").click()},_addControl:function(a){this._controlsDiv.append(a)},_getDisplayStyle:function(a){return a==Biojs.Protein3D.STYLE_CARTOON?"hide null; select all;  spacefill off; wireframe off; backbone off; cartoon on;  select ligand; wireframe 0.16;spacefill 0.5; color cpk;  select *.FE; spacefill 0.7; color cpk ;  select *.CU; spacefill 0.7; color cpk ;  select *.ZN; spacefill 0.7; color cpk ;  select all; ":a==Biojs.Protein3D.STYLE_BACKBONE?"hide null; select all; spacefill off; wireframe off; backbone 0.4; cartoon off;  select ligand; wireframe 0.16;spacefill 0.5; color cpk;  select *.FE; spacefill 0.7; color cpk ;  select *.CU; spacefill 0.7; color cpk ;  select *.ZN; spacefill 0.7; color cpk ;  select all; ":a==Biojs.Protein3D.STYLE_CPK?"hide null; select all; spacefill off; wireframe off; backbone off; cartoon off; cpk on; select ligand; wireframe 0.16;spacefill 0.5; color cpk;  select *.FE; spacefill 0.7; color cpk ;  select *.CU; spacefill 0.7; color cpk ;  select *.ZN; spacefill 0.7; color cpk ;  select all; ":a==Biojs.Protein3D.STYLE_LIGANDS?"restrict ligand; cartoon off; wireframe on;  display selected; select *.FE; spacefill 0.7; color cpk ;  select *.CU; spacefill 0.7; color cpk ;  select *.ZN; spacefill 0.7; color cpk ;  select all; ":a==Biojs.Protein3D.STYLE_LIGANDS_POCKET?" select within (6.0, true, ligand); cartoon off; wireframe on; backbone off; display selected;  select *.FE; spacefill 0.7; color cpk ;  select *.CU; spacefill 0.7; color cpk ;  select *.ZN; spacefill 0.7; color cpk ;  select all; ":a==Biojs.Protein3D.STYLE_BALL_STICK?"hide null; restrict not water;  wireframe 0.2; spacefill 25%; cartoon off; backbone off;  select ligand; wireframe 0.16; spacefill 0.5; color cpk;  select *.FE; spacefill 0.7; color cpk ;  select *.CU; spacefill 0.7; color cpk ;  select *.ZN; spacefill 0.7; color cpk ;  select all; ":void 0},_getDisplayColor:function(a){return a==Biojs.Protein3D.COLOR_BY_CHAIN?"hide null; select all; cartoon on; wireframe off; spacefill off; color chain; select ligand; wireframe 0.16; spacefill 0.5; color chain ; select all; ":a==Biojs.Protein3D.COLOR_BY_TEMPERATURE?"hide null; select all;spacefill off; wireframe off; backbone 0.4; cartoon off; set defaultColors Jmol; color relativeTemperature; color cartoon relateiveTemperature select ligand;wireframe 0.16;spacefill 0.5; color cpk ;; select all; ":a==Biojs.Protein3D.COLOR_RAINBOW?"hide null; select all; set defaultColors Jmol; color group; color cartoon group; select ligand;wireframe 0.16;spacefill 0.5; color cpk ; select all; ":a==Biojs.Protein3D.COLOR_SECONDARY_STRUCTURE?"hide null; select all; set defaultColors Jmol; color structure; color cartoon structure;select ligand;wireframe 0.16;spacefill 0.5; color cpk ;; select all; ":a==Biojs.Protein3D.COLOR_BY_ELEMENT?"hide null; select all; set defaultColors Jmol; color cpk; color cartoon cpk; select ligand;wireframe 0.16; spacefill 0.5; color cpk ; select all; ":a==Biojs.Protein3D.COLOR_BY_AMINO_ACID?"hide null; select all; set defaultColors Jmol; color amino; color cartoon amino; select ligand;wireframe 0.16;spacefill 0.5; color cpk ;; select all; ":a==Biojs.Protein3D.COLOR_HIDROPHOBICITY?"hide null; set defaultColors Jmol; select hydrophobic; color red; color cartoon red; select not hydrophobic ; color blue ; color cartoon blue; select ligand;wireframe 0.16;spacefill 0.5; color cpk ;; select all; ":void 0},_getDisplaySurface:function(a){return a==Biojs.Protein3D.SURFACE_NONE?"select all; isosurface off; select none;":a==Biojs.Protein3D.SURFACE_ACCESSIBLE?"select all; isosurface sasurface 1.2; color isoSurface translucent 0.8; select none;":a==Biojs.Protein3D.SURFACE_EXCLUDED?"select all; isosurface solvent 1.2; color isoSurface translucent 0.8; select none;":a==Biojs.Protein3D.SURFACE_CAVITIES?"select all; isosurface cavity 1.2 10; color isoSurface translucent 0.8; select none;":void 0},toString:function(){return"Biojs.Protein3D"},_loadStructCallback:function(a,b,c,d,e,f){switch(Biojs.console.log("executing _loadStructCallback for "+a),f){case 3:result="success";break;case 0:result="zapped";break;case-1:result="failure";break;default:result="undefined"}if("zapped"!=result){var g=parseInt(a.replace("jmolApplet","")),h=Biojs.getInstance(g);"success"==result&&(h.showControls(),h.displayAntialias(h.opt.antialias),h.rotate(h.opt.rotate)),h.raiseEvent(Biojs.Protein3D.EVT_ON_PDB_LOADED,{file:d,result:result,message:e})
}}},{COLOR_BY_CHAIN:"By Chain",COLOR_SECONDARY_STRUCTURE:"Secondary Structure",COLOR_RAINBOW:"Rainbow",COLOR_BY_ELEMENT:"By Element",COLOR_BY_AMINO_ACID:"By Amino Acid",COLOR_BY_TEMPERATURE:"By Temperature",COLOR_HIDROPHOBICITY:"Hidrophobicity",SURFACE_NONE:"None",SURFACE_ACCESSIBLE:"Solvent Accessible",SURFACE_EXCLUDED:"Solvent Excluded",SURFACE_CAVITIES:"Cavities",STYLE_CARTOON:"Cartoon",STYLE_BACKBONE:"Backbone",STYLE_CPK:"CPK",STYLE_BALL_STICK:"Ball and Stick",STYLE_LIGANDS:"Ligands",STYLE_LIGANDS_POCKET:"Ligands and Pocket",EVT_ON_PDB_LOADED:"onPdbLoaded",EVT_ON_SELECTION:"onSelection"}),Biojs.Protein3DCanvas=Biojs.Protein3D.extend({constructor:function(a){this.opt.jmolFolder=this.opt.jsmolFolder,Biojs.Protein3D.call(this,a),Jmol.Info.use=void 0==this.opt.use?"HTML5 JAVA":this.opt.use,void 0!=this.opt.proxyUrl&&(Jmol.Info.serverURL=this.opt.proxyUrl),Jmol.Info.jarPath=this.opt.jsmolFolder+"/java",Jmol.Info.jarFile=this.opt.jsmolFolder+"/java/JmolApplet0.jar",Jmol.Info.j2sPath=this.opt.jsmolFolder+"/j2s",Jmol.Info.addSelectionOptions=!1,Jmol.Info.color="#ffffff",Jmol.Info.debug=!1,Jmol.Info.memoryLimit=512,Jmol.Info.readyFunction=null,Jmol.Info.src=null,Jmol.Info.disableInitialConsole=!0,Jmol.Info.disableJ2SLoadMonitor=!0,Jmol.Info.deferUncover=!0,Jmol.Info.deferApplet=!1},opt:{use:"HTML5 JAVA",jsmolFolder:"../biojs/dependencies/jsmol-14.0.2/jsmol",viewControls:!0},eventTypes:[],setPdb:function(pdb){Biojs.console.log("LOADING pdb content");var self=this,surfaceCmd=this._getDisplaySurface(this.opt.surface),styleCmd=this._getDisplayStyle(this.opt.style),colorSchemeCmd=this._getDisplayColor(this.opt.colorScheme),scr=colorSchemeCmd+styleCmd+surfaceCmd+this._getSelectionScript(this._selection);this.showLoadingImage(!0),this._jmolAppletInitialized&&this.reset(),Jmol.setDocument(0),htmlContent=jmolApplet([self._appletContainer.width(),self._appletContainer.height()]," load 'http://www.rcsb.org/pdb/files/"+pdb+".pdb.gz';"+scr,self.getId()),this._appletContainer.html(Jmol.getAppletHtml(eval(htmlContent._id))),this._jmolAppletInitialized=!0,Biojs.console.log("setPdb() ending")},toString:function(){return"Biojs.Protein3DCanvas"},_loadStructCallback:function(a,b,c,d,e,f){switch(Biojs.console.log("executing _loadStructCallback for "+a),f){case 3:result="success";break;case 0:result="zapped";break;case-1:result="failure";break;default:result="undefined"}if("zapped"!=result){var g=parseInt(a.replace("jmolApplet","")),h=Biojs.getInstance(g);"success"==result&&(h.displayAntialias(h.opt.antialias),h.rotate(h.opt.rotate)),h.showLoadingImage(!1),h.opt.viewControls?(h.showControls(),h._controlsContainer.css("display","block"),jmolResizeApplet([h._container.width()-h._controlsContainer.outerWidth(),h._container.height()],h.getId()),h._appletContainer.css("float","right")):(h.hideControls(),h._controlsContainer.css("display","none"),jmolResizeApplet([h._container.width(),h._container.height()],h.getId()),h._appletContainer.css("float","left")),h.raiseEvent(Biojs.Protein3D.EVT_ON_PDB_LOADED,{file:d,result:result,message:e}),h._appletContainer.css("display","block")}}}),Biojs.Protein3DUniprot=Biojs.Protein3DWS.extend({constructor:function(a){this.base(a);var b=this;if(this.onPdbLoaded(function(a){if(Biojs.console.log(a.result+" loading the pdb file "+a.file),Biojs.console.log("self._aligmentsJustArrived= "+b._alignmentsJustArrived),b._alignmentsJustArrived){Biojs.console.log("Initialising the alignments selection list"),b.reset();var c=b._filterAligmentsBySelection(b._selection),d=b._createOptions(c);0==jQuery("#"+b.opt.target).find("div#pdbStructures").length&&b._addControl('<div id="pdbStructures"></div>'),jQuery("#"+b.opt.target).find("div#pdbStructures").html("<h1>Structures for <b>"+b.opt.proteinId+'</b></h1><br/><select id="pdbFile_select">'+d+"</select>"),jQuery("#"+b.opt.target+" #pdbFile_select").val(pdb),jQuery("#"+b.opt.target+" #pdbFile_select").change(function(){b._onAlignmentSelectionChange()}),jQuery("#"+b.opt.target).find("#pdbStructures").show();var e=pdb,f=e.substring(0,pdb.indexOf(".")).toLowerCase(),g=b.getAlignmentsByPdb(e);if(g.hasOwnProperty(e)){var h=g[e][1].start,i=g[e][1].end;b.raiseEvent("onPdbSelected",{pdbId:f,alignmentId:e,start:h,end:i})}b._alignmentsJustArrived=!1}}),void 0!=this.opt.proteinId){var c=this.opt.proteinId;this.opt.proteinId="",this.setProtein(c)}},opt:{proteinId:void 0,mapping:"http://www.ebi.ac.uk/pdbe-apps/widgets/unipdb?uniprot=",proxyUrl:"../biojs/dependencies/proxy/proxy.php"},eventTypes:["onPdbSelected"],_aligments:void 0,setProtein:function(a){if(a!=this.opt.proteinId)if(this.opt.proteinId=a,this._selection=void 0,this._minStart=Number.MAX_VALUE,this._maxEnd=0,this._alignments=void 0,this.opt.mapping==Biojs.Protein3DUniprot.ALIGNMENTS_UNIPROT_MAPPING)this._requestAligmentsFromUniprot();else{if(this.opt.mapping!=Biojs.Protein3DUniprot.ALIGNMENTS_PDBe_MAPPING)throw"Error in mapping function. this.opt.mapping="+this.opt.mapping;this._requestAligmentsFromPdbe()}},_requestAligmentsFromUniprot:function(){var a=this;jQuery.ajax({url:a.opt.mapping+a.opt.proteinId,data:{biojsmapping:"1",varname:"pdbmappings"},dataType:"script",crossDomain:!0,success:function(){Biojs.console.log("SUCCESS: data received"),a._alignments=pdbmappings;for(obj in pdbmappings){pdbmappings[obj][1].intObjectId!=a.opt.proteinId&&(a.opt.proteinId=pdbmappings[obj][1].intObjectId);break}a._aligmentsArrived()},async:!1,error:function(b,c){Biojs.console.log("ERROR: requesting "+this.data),a.raiseEvent("onRequestError",{message:c})}})},_requestAligmentsFromPdbe:function(){var a=this;jQuery.ajax({url:a.opt.proxyUrl,dataType:"text",data:{url:a.opt.mapping+a.opt.proteinId+"/"},success:function(b){Biojs.console.log("SUCCESS: data received"),a._parseResponse(b)},async:!1,error:function(b,c){Biojs.console.log("ERROR: requesting "+this.data),a.raiseEvent("onRequestError",{message:c})}})},_parseResponse:function(a){this._alignments={};var b,c=0,d=this;if(Biojs.console.log("Decoding "+a),!Biojs.Utils.isEmpty(a)){try{b=jQuery.parseJSON(a)}catch(e){Biojs.console.log("Error decoding response: "+e.message)}for(var c in b)try{var f=[];f.push({start:b[c].pdb_range[0],end:b[c].pdb_range[1],intObjectId:b[c].pdbid+"."+b[c].chain}),f.push({start:b[c].uniprot_range[0],end:b[c].uniprot_range[1],intObjectId:b[c].uniprot_acc}),d._alignments[f[0].intObjectId]=f,d._minStart>segment[1].start&&(d._minStart=segment[1].start),d._maxEnd<segment[1].end&&(d._maxEnd=segment[1].end)}catch(e){Biojs.console.log("Error decoding alignment: "+e.message)}}Biojs.console.log("Alignments decoded:"),Biojs.console.log(d._alignments),this._aligmentsArrived()},_aligmentsArrived:function(){this._alignmentsJustArrived=!0;var a=this._filterAligmentsBySelection(this._selection);if(Biojs.Utils.isEmpty(a))this._container.html("No structural information for "+this.opt.proteinId),this.raiseEvent("onRequestError",{message:"No structural information available for "+this.opt.proteinId});else{var b=void 0;for(b in a)break;Biojs.console.log("Requesting pdb "+b),this.requestPdb(b.substring(0,b.indexOf(".")).toLowerCase())}},_onAlignmentSelectionChange:function(){var a=jQuery("#pdbFile_select").val();if(void 0!=a){var b=a.substring(0,a.indexOf(" ")),c=b.substring(0,a.indexOf(".")).toLowerCase(),d=this.getAlignmentsByPdb(b);if(d.hasOwnProperty(b)){var e=d[b][1].start,f=d[b][1].end;this.raiseEvent("onPdbSelected",{pdbId:c,alignmentId:b,start:e,end:f})}this.requestPdb(c)}else Biojs.console.log("No structural information available for "+this.opt.proteinId)},requestPdb:function(a){var b=this;b.showLoadingImage(),b.opt.id=a,jQuery.ajax({url:b.opt.proxyUrl,data:"url="+b.opt.pdbUrl+"/pdb"+a+".ent",dataType:"text",success:function(a){Biojs.console.log("DATA ARRIVED"),void 0!=b._uniprotSelection&&(b._selection=b._translateSelection(b._uniprotSelection)),b.setPdb(a)},error:function(a,c){b.raiseEvent("onRequestError",{message:c})}})},getAlignmentsBySelection:function(a){var b=this._alignments;return void 0!=a&&this._filterAligmentsBySelection(a),b},getAlignmentsByPdb:function(a){var b={};for(al in this._alignments)-1!=this._alignments[al][0].intObjectId.indexOf(a)&&(b[this._alignments[al][0].intObjectId]=this._alignments[al]);return Biojs.console.log("Alignments for pdb "+a),Biojs.console.log(b),b},filterAlignments:function(b){var c=this._filterAligmentsBySelection(b),d=jQuery("#pdbFile_select").val();if(jQuery("#pdbFile_select").html(this._createOptions(c)),c.hasOwnProperty(d.slice(0,d.indexOf(" "))))jQuery("#pdbFile_select").val(d);else{for(a in c){jQuery("#pdbFile_select").val(a);break}this._onAlignmentSelectionChange()}this.base(b)},_createOptions:function(a){var b="";for(pdb in a)text=pdb+" ("+a[pdb][1].start+".."+a[pdb][1].end+")",b+='<option value="'+text+'">'+text+"</option>";return Biojs.console.log("_createOptions: "+b),b},_filterAligmentsBySelection:function(a){var b=void 0;if(a instanceof Array){b={};for(al in this._alignments){var c=this._alignments[al][1];for(d in a)if(a[d]>=c.start&&a[d]<=c.end){b[this._alignments[al][0].intObjectId]=this._alignments[al];break}}}else if(a instanceof Object){b={};var d=0;for(al in this._alignments){var c=this._alignments[al][1];(a.start>=c.start&&a.start<=c.end||a.end>=c.start&&a.end<=c.end||a.start<c.start&&a.end>c.end)&&(b[this._alignments[al][0].intObjectId]=this._alignments[al],d++)}}else b=this._alignments;return Biojs.console.log("Filtered alignments:"),Biojs.console.log(b),b},setSelection:function(a){this._uniprotSelection=Biojs.Utils.clone(a);var b=this._translateSelection(a);this.base(b)},_translateSelection:function(a){var b=Biojs.Utils.clone(a),c=this.getCurrentAlignmentId(),d=this.getCurrentProteinId(),e=this.getAlignmentsByPdb(c)[c],f=0;for(i in e)e[i].intObjectId==c?pdbSegment=e[i]:e[i].intObjectId==d&&(uniprotSegment=e[i]);if(f=uniprotSegment.start-pdbSegment.start,b instanceof Array){var g=new Array(b.length);for(i in b)b[i]instanceof Object?b[i].start>uniprotSegment.end||b[i].end<uniprotSegment.start?(b[i].start=0,b[i].end=0,g[i]=!0):b[i].start>=uniprotSegment.start&&b[i].end<=uniprotSegment.end?(b.start-=f,b.end-=f,g[i]=!1):b[i].start<uniprotSegment.start&&b[i].end<=uniprotSegment.end?(b[i].start=pdbSegment.start-0,b[i].end-=f,g[i]=!1):b[i].start>=uniprotSegment.start&&b[i].end>uniprotSegment.end?(b[i].start-=f,b[i].end=pdbSegment.end-0,g[i]=!1):b[i].start<uniprotSegment.start&&b[i].end>uniprotSegment.end&&(b[i].start=pdbSegment.start-0,b[i].end=pdbSegment.end-0,g[i]=!1):uniprotSegment.start<=b[i]&&b[i]<=uniprotSegment.end?(b[i]-=f,g[i]=!1):g[i]=!0;var h=0;for(j in g)1==g[j]&&(b.splice(j-h,j-h),h+=1)}else b instanceof Object&&b.start<=b.end&&(b.start>uniprotSegment.end||b.end<uniprotSegment.start?(b.start=0,b.end=0,this.removeSelection()):b.start>=uniprotSegment.start&&b.end<=uniprotSegment.end?(b.start-=f,b.end-=f):b.start<uniprotSegment.start&&b.end<=uniprotSegment.end?(b.start=pdbSegment.start-0,b.end-=f):b.start>=uniprotSegment.start&&b.end>uniprotSegment.end?(b.start-=f,b.end=pdbSegment.end-0):b.start<uniprotSegment.start&&b.end>uniprotSegment.end&&(b.start=pdbSegment.start-0,b.end=pdbSegment.end-0));return b},getCurrentAlignmentId:function(){var a=jQuery("#pdbFile_select").val(),b=a.substring(0,a.indexOf(" "));return b},getCurrentProteinId:function(){return this.opt.proteinId},removeSelection:function(){this.base()}},{ALIGNMENTS_UNIPROT_MAPPING:"http://www.ebi.ac.uk/pdbe-apps/widgets/unipdb?uniprot=",ALIGNMENTS_PDBe_MAPPING:"http://wwwdev.ebi.ac.uk/pdbe-apps/jsonizer/mappings/best/all/"}),Biojs.Protein3DWS=Biojs.Protein3D.extend({constructor:function(a){this.base(a),void 0!==this.opt.id&&this.requestPdb(this.opt.id)},opt:{id:void 0,pdbUrl:"http://www.ebi.ac.uk/pdbe/entry-files",proxyUrl:"../biojs/dependencies/proxy/proxy.php"},eventTypes:["onRequestError"],requestPdb:function(a){var b=this;b.showLoadingImage(),b.opt.id=a,jQuery.ajax({url:b.opt.proxyUrl,data:"url="+b.opt.pdbUrl+"/pdb"+a+".ent",dataType:"text",success:function(a){Biojs.console.log("DATA ARRIVED"),b.setPdb(a)},error:function(a,c){b.raiseEvent("onRequestError",{message:c})}})},getPdbId:function(){return opt.id}}),Biojs.ProteinPortafolio=Biojs.extend({constructor:function(a){var b=this;Biojs.console.enable(),this._container=jQuery("#"+b.opt.target),this._initialize(),Biojs.Utils.isEmpty(a.accession)||this.setProtein(a.accession)},opt:{target:"YourOwnDivId",accession:"",mappingUrl:"http://www.ebi.ac.uk/pdbe-apps/widgets/unipdb?uniprot=",featuresUrl:"http://www.ebi.ac.uk/das-srv/uniprot/das/uniprot-summary/features",proxyUrl:"../biojs/dependencies/proxy/proxy.php",jmolFolder:"../biojs/dependencies/jmol-12.0.48",pdb3DIcon:"../biojs/css/images/3d.png",pdbIconSize:40},eventTypes:["onClick","onPdbSelected"],setSize:function(){},_initialize:function(){this._alpha=jQuery('<div class="alpha"></div>').appendTo(this._container),this._beta=jQuery('<div class="beta"></div>').appendTo(this._container),this._header=jQuery('<div class="header"></div>').appendTo(this._alpha),this._toolbar=jQuery('<div class="toolbar"></div>').appendTo(this._alpha),this._content=jQuery('<div class="content"></div>').appendTo(this._alpha),this._content.attr("id","ProteinPortafolio_content_"+this.getId()),this._container.addClass("ProteinPortafolio")},_clearAll:function(){this._header.children().remove(),this._toolbar.children().remove(),this._content.children().remove()},setProtein:function(a){this.opt.accession=a,this._requestAligments(a,function(a){this._alignments=a,this._container.removeClass("loading"),Biojs.Utils.isEmpty(a)?this._setHeader(this.opt.accession):this._setHeader(this.opt.accession,this._createPDBSelect(a))}),this._showFeatures(a)},_requestAligments:function(a,b){var c=this;this._clearAll(),this._container.addClass("loading");jQuery.ajax({url:c.opt.mappingUrl+a,data:{biojsmapping:"1",varname:"pdbmappings"},dataType:"script",crossDomain:!0,timeout:5e3,success:function(){Biojs.console.log("SUCCESS: data received"),c._alignments=pdbmappings,b.call(c,pdbmappings)},async:!0,error:function(a,d){Biojs.console.log("ERROR: "+d),c.raiseEvent("onRequestError",{message:d}),b.call(c,{})}})},_createPDBSelect:function(a){var b="";for(pdb in a)text=pdb+" ("+a[pdb][1].start+".."+a[pdb][1].end+")",b+='<option value="'+text+'">'+text+"</option>";return Biojs.console.log("_createOptions: "+b),b},_setHeader:function(a,b){var c=this;void 0!==b?(this._header.html("Accession: "+a+", PDB Alignments: <select>"+b+"</select>"),this._onAlignmentSelectionChange(),this._header.children("select").change(function(){c._onAlignmentSelectionChange()})):this._header.html("Accession: "+a+", No PDB alignments found."),this._adjustContentSize()},_onAlignmentSelectionChange:function(){var a=this.getCurrentAlignment();Biojs.Utils.isEmpty(a)?Biojs.console.log("No structural information available for "+this.opt.accession):(this.raiseEvent("onPdbSelected",{pdbId:a.pdbId,alignmentId:a.alignmentId,start:a.start,end:a.end}),this._showPDBPrints(a.pdbId),this._showImage(a.pdbId),this._showFeatures(this.opt.accession))},_showPDBPrints:function(a){var b=this;this._toolbar.children().remove(),this._toolbar.attr("id","PDBLogos_toolbar_"+this.getId());var c=new Biojs.PDBLogos({target:this._toolbar.attr("id"),identifier:a,size:b.opt.pdbIconSize,pdb3DIcon:b.opt.pdb3DIcon});c.onClick(function(a){"PDBStructure"==a.category?b._showProtein3D():window.open(a.printsURL)}),this._adjustContentSize()},getAlignmentsByPdb:function(a){var b={};for(al in this._alignments)-1!=this._alignments[al][0].intObjectId.indexOf(a)&&(b[this._alignments[al][0].intObjectId]=this._alignments[al]);return Biojs.console.log("Alignments for pdb "+a),Biojs.console.log(b),b},getCurrentAlignment:function(){var a={},b=this._header.find("select").val();if(void 0!=b){a.accession=this.opt.accession,a.alignmentId=b.substring(0,b.indexOf(" ")),a.pdbId=b.substring(0,b.indexOf(".")).toLowerCase();var c=this.getAlignmentsByPdb(a.alignmentId);a.start=c[a.alignmentId][1].start,a.end=c[a.alignmentId][1].end,a.offset=0,c.hasOwnProperty(a.alignmentId)&&(a.offset=a.start-c[a.alignmentId][0].start),a.alignment=c}return Biojs.console.log("Current alignment"),Biojs.console.log(a),a},_showProtein3D:function(){{var a=this,b=this.getCurrentAlignment();this._container.height()-this._header.height()-this._toolbar.height()}a._content.children().remove(),a._beta.children().remove(),a._beta.attr("id","biojs_protein3D_"+a._content.attr("id"));var c=jQuery("<span>X</span>").appendTo(a._content),d=Math.round(a._content.width()*(1/c.width()));c.remove();var e=new Biojs.Sequence({target:a._content.attr("id"),format:"FASTA",id:b.accession,formatSelectorVisible:!1,columns:{size:d,spacedEach:10}}),f=new Biojs.Protein3DWS({id:b.pdbId,target:a._beta.attr("id"),width:Math.round(a._beta.width()),height:a._container.height(),proxyUrl:a.opt.proxyUrl,jmolFolder:a.opt.jmolFolder});e.onSelectionChange(function(a){var c={start:a.start,end:a.end};c.start-=b.offset,c.end-=b.offset,f.setSelection(c)})},_showSequence:function(a){var b=this;this._content.children().remove();new Biojs.Sequence({target:this._content.attr("id"),format:"FASTA",id:a,formatSelectorVisible:!1,columns:{size:Math.round(b._content.width()/20),spacedEach:10}})},_showImage:function(a){this._beta.children().remove();jQuery('<img src="http://www.ebi.ac.uk/pdbe-srv/view/images/entry/'+a+'_cbc600.png"/>').appendTo(this._beta).addClass("crop")},_showFeatures:function(a){var b=this;this._content.children().remove(),this._adjustContentSize(),this._requestFeatures(a,function(a){Biojs.console.log("Features received "+a);var c="";try{c=jQuery.parseXML(a)}catch(d){Biojs.console.log("XML parser error"+d)}var e=jQuery('<ul class="features"></ul>').appendTo(b._content),f="",g="";jQuery(c).find("FEATURE").each(function(){f='<span class="label">'+jQuery(this).attr("label")+"</span>",g='<span class="value">'+jQuery(this).children("NOTE:first").text()+"</span>",e.append("<li>"+f+g+"</li>")})})},_requestFeatures:function(a,b){var c=this;Biojs.console.log("Requesting features for '"+a+"'");var d={url:c.opt.proxyUrl,data:[{name:"url",value:c.opt.featuresUrl+"?segment="+a}],method:"GET",dataType:"text",success:b,error:function(){Biojs.console.log("Error requesting features for "+a)}};jQuery.ajax(d)},_adjustContentSize:function(){this._beta.children().length>0?(this._alpha.addClass("alpha"),this._beta.addClass("beta"),this._content.height(this._container.height()-this._header.height()-this._toolbar.height())):(this._alpha.removeClass("alpha"),this._beta.removeClass("beta"),this._content.height("auto"))}}),Biojs.PsicquicGraph=Biojs.extend({constructor:function(){this._query(this.opt)},opt:{target:"YourOwnDivId",psicquicUrl:"http://www.ebi.ac.uk/Tools/webservices/psicquic/intact/webservices/current/search/query",proxyUrl:"../biojs/dependencies/proxy/proxy.php",query:"species:human?firstResult=0&maxResults=100",cyoptions:{style:cytoscape.stylesheet().selector("node").css({content:"data(id)","font-family":"helvetica","font-size":14,"text-outline-width":3,"text-outline-color":"#888","text-valign":"center",color:"#fff",width:"mapData(weight, 30, 80, 20, 50)",height:"mapData(height, 0, 200, 10, 45)","border-color":"#fff"}).selector(":selected").css({"background-color":"#000","line-color":"#000","target-arrow-color":"#000","text-outline-color":"#000"}).selector("edge").css({width:2}),layout:{name:"circle",fit:!0,ready:void 0,stop:void 0,rStepSize:10,padding:30,startAngle:1.5*Math.PI,counterclockwise:!1},ready:function(){var a=this;a.nodes().click(function(a){console.log(a.cyTarget.id())})}}},eventTypes:[],_query:function(a){a.url=a.psicquicUrl+"/"+a.query;var b=this;jQuery.ajax({url:a.proxyUrl,dataType:"text",data:[{name:"url",value:a.url}],success:function(a){b._decodeToJSON(a,b)}})},_decodeToJSON:function(a,b){for(var c=[],d=[],e={},f=a.split("\n"),g=0;g<f.length;g++){var h=f[g].split("	");if(h.length>13){var i=h[0].split("|")[0].split(":")[1];void 0===e[i]&&(e[i]={data:{id:i,organism:h[9].split("|")}},c.push(e[i]));var j=h[1].split("|")[0].split(":")[1];void 0===e[j]&&(e[j]={data:{id:j,organism:h[10].split("|")}},c.push(e[j])),d.push({data:{source:i,target:j,type:h[11].split("|"),score:h[14].split("|")}})}}b.opt.cyoptions.elements={nodes:c,edges:d},jQuery('<div style="height:500px;width:100%;"></div>').appendTo("#"+b.opt.target).cytoscape(b.opt.cyoptions)}}),Biojs.RaphaelCanvas=Biojs.extend({opt:{divid:"YourOwnDivId",dimension:500},constructor:function(a){var b=this;b.dim=a.dimension,b.divid=a.divid,b.jq=jQuery("#"+b.divid),b.mousedownEvent=null,b.init()},init:function(){var a=this;a.rapha=Raphael(a.divid,a.dim,a.dim),a.fullbox=a.rapha.rect(0,0,a.dim,a.dim).attr({fill:"green",stroke:"black",opacity:.01}),a.jq.mousedown(function(b){a.recordMousedown(b)}),a.makeZoomPannable(),a.setVbox(0,0,a.dim)},testSetup:function(){for(var a=this,b=0;b<a.dim;b+=a.dim/10)for(var c=0;c<a.dim;c+=a.dim/10)a.rapha.text(b,c,b+","+c).attr({"text-anchor":"start"}),a.rapha.circle(b,c,a.dim/50)},makeZoomPannable:function(){var a=this;a.jq.mouseup(function(b){a.zoompan(b),a.zoompanstarted=null}),a.jq.mousemove(function(b){a.zoompan(b)})},setVbox:function(a,b,c){var d=this;d.rapha.setViewBox(a,b,c,c,!0),d.curVbox=[a,b,c]},zoompan:function(a){var b=this;if(a.preventDefault(),b.zoompanMouseactivity(a)&&1==b.zoompanstarted){console.log("zoompan event",a.button,a.buttons,a.which);{var c=b.event2paperxy(a),d=b.event2paperxy(b.mousedownEvent),e=a.clientX-b.mousedownEvent.clientX,f=c[0]-d[0],g=a.clientY-b.mousedownEvent.clientY;c[1]-d[1]}console.log("zoompan",f.toFixed(1),e.toFixed(1),b.zoom),Math.abs(e)<5&&Math.abs(g)<5||(a.shiftKey?(dd=b.curVbox[2]-f,decr=(dd-b.curVbox[2])/2,console.log("viewbox",d,dd),b.setVbox(b.curVbox[0]-decr,b.curVbox[1]-decr,dd)):a.ctrlKey&&(console.log("viewbox",d,b.curVbox[2]),e=d[0]-c[0],g=d[1]-c[1],b.setVbox(b.curVbox[0]+e,b.curVbox[1]+g,b.curVbox[2])),b.mousedownEvent=a)}},zoompanMouseactivity:function(a){return a.shiftKey||a.ctrlKey?1!=a.which?!1:!0:!1},recordMousedown:function(a){var b=this;b.zoompanMouseactivity(a)&&(a.preventDefault(),b.mousedownEvent=a,b.zoompanstarted=1)},event2paperxy:function(a){var b=this,c=b.fullbox,d=b.jq[0].getBoundingClientRect(),e=a.clientX-d.left,f=a.clientY-d.top,g=e/d.width*c.attrs.width,h=f/d.height*c.attrs.height;return console.log("event2paper",e.toFixed(1),f.toFixed(1),g.toFixed(1),h.toFixed(1)),[g,h]},eventTypes:["onClick","onHelloSelected"]}),Biojs.Rheaction=Biojs.extend({constructor:function(){this.setId(this.opt.id)},setId:function(a){this._clearContent();var b=a.replace("RHEA:","");this._rheaIdLabel="RHEA_"+b,"string"==typeof this.opt.target?this._container=jQuery("#"+this.opt.target):(this.opt.target="biojs_Rheaction_"+b,this._container=jQuery('<div id="'+this.opt.target+'"></div>')),this._container.addClass("scrollpane"),this._reactionRow=jQuery("<div/>",{"class":"reactionRow"}),this._container.append(this._reactionRow),this._getCml(b)},opt:{target:void 0,id:void 0,dimensions:"200",proxyUrl:"../biojs/dependencies/proxy/proxy.php",rheaWsUrl:"http://www.ebi.ac.uk/rhea/rest/1.0/ws/reaction/cmlreact/",chebiUrl:"http://www.ebi.ac.uk/chebi/searchId.do?chebiId=",chebiImgUrl:"http://www.ebi.ac.uk/chebi/displayImage.do?defaultImage=true&scaleMolecule=true&chebiId="},_clearContent:function(){jQuery("#"+this.opt.target).html("")},_displayNoDataMessage:function(){jQuery("#"+this.opt.target).html(Biojs.Rheaction.MESSAGE_NODATA)},_getCml:function(a){var b=this,c=this.opt.rheaWsUrl+a,d={url:c,method:"GET",success:function(a){b._dataReceived(a)},error:function(a,b){Biojs.console.log("ERROR requesting reaction. Response: "+b)}};void 0!=this.opt.proxyUrl&&(d.url=this.opt.proxyUrl,d.data=[{name:"url",value:c}],d.dataType="text"),jQuery.ajax(d)},_dataReceived:function(a){var b=this,c="";if(a.length>0)try{c=jQuery.parseXML(a),xmlResult=jQuery(c).find("reaction");for(var d=xmlResult.find("reactant"),e=0;e<d.length;e++)e>0&&b._addPlus(),b._addParticipant(d[e]);b._addDirection(xmlResult.attr("convention"));for(var f=xmlResult.find("product"),e=0;e<f.length;e++)e>0&&b._addPlus(),b._addParticipant(f[e])}catch(g){Biojs.console.log("ERROR decoding "),Biojs.console.log(g),this._displayNoDataMessage()}},_addPlus:function(){jQuery("<div/>",{"class":"direction",html:"+"}).appendTo(this._reactionRow)},_addDirection:function(a){var b=a.replace("rhea:direction.",""),c=void 0;switch(b){case"UN":c="&lt;?&gt;";break;case"BI":c="&lt;=&gt;";break;default:c="=&gt;"}jQuery("<div/>",{"class":"direction",html:c}).appendTo(this._reactionRow)},_addParticipant:function(a){var b=parseInt(a.attributes.count.value),c=jQuery(a).find("molecule")[0],d=c.attributes.title.value,e=c.attributes.id.value.replace("CHEBI:",""),f=this._rheaIdLabel+"_CHEBI_"+e;jQuery("<div/>",{id:f,"class":"compound",css:{width:this.opt.dimensions}}).appendTo(this._reactionRow),b>1&&$("#"+f).append(jQuery("<span/>",{"class":"stoichCoef",html:b})),$("#"+f).append(jQuery("<a/>",{"class":"compoundName",html:d,href:this.opt.chebiUrl+e,title:"CHEBI:"+e})),$("#"+f).append(jQuery("<br/>"));var g=this.opt.chebiImgUrl+e+"&dimensions="+this.opt.dimensions;$("#"+f).append(jQuery("<img/>",{src:g,"class":"compoundStructure",title:"CHEBI:"+e}))}},{MESSAGE_NODATA:"Sorry, no results for your request"}),Biojs.Ruler=Biojs.extend({_number:1,constructor:function(){var a=this,b=a.opt.target,c='		<section class="ruler">';c+='			<section class="active_rules">',c+="				<header>Created Rules</header>",c+='					<ul id="'+b+'_list" class="sortable"> ',c+="					</ul>",c+="			</section>",c+='			<section class="rules_editor">',c+="				<header>New Rule</header>",c+='				<div id="'+b+'_add_rule" class="add_rule"><a>+ Add Rule</a></div>',c+='				<ul id="'+b+'_list_to_add">',c+="				</ul>",c+="			</section>",c+="		</section>",$("#"+b).append(c),1==a.opt.allowOrdering?($(".sortable").sortable({stop:function(){a.raiseEvent("onOrderChanged",{rules:a.getActiveRules()})}}),$(".sortable").disableSelection()):$(".sortable").removeClass("sortable"),$("#"+b+"_add_rule a").click(function(){a.addRule()})},opt:{target:"YourOwnDivId",rules:null,allowOrdering:!0},eventTypes:["onRuleCreated","onRuleRemoved","onOrderChanged","onRuleEditing"],getActiveRules:function(){var a=this,b=new Array;return $("#"+a.opt.target+"_list > li").each(function(){b.push($(this).data("rule"))}),b},setAffectedByRule:function(a,b){$("#"+a+" .affected").html(b)},changeRules:function(a){var b=this;b.opt.rules=a},addRule:function(a){var b=this,c=b.opt.target,d=b._number,e='	<li id="rule_'+d+'"  class="rule_item"><table><tr><td class="rule">',f=!("undefined"==typeof a),g=0;if("undefined"!=typeof b.opt.rules.location&&b.opt.rules.location.length>0&&(e+="In",e+=b._getSelect("location_"+d,b.opt.rules.location,"",f?a.location:a)),f)for(var h in b.opt.rules.target)b.opt.rules.target[h].name==a.target&&(g=h);e+='		<span id="action_span_'+d+'" >'+b._getActionSpan(d,g,a)+"</span>",e+="		the ",e+=b._getSelect("target_"+d,b.opt.rules.target,"name",f?a.target:a),e+="		with ";var i=f?"none":"inline";for(var h in b.opt.rules.target)i=f?b.opt.rules.target[h].name==a.target?"inline":"none":i,e+=b._getConditionsSpan(d,b.opt.rules.target[h],i,a),i="none";e+="	</td> ",e+='		<td><span class="action" id="'+c+"_apply_rule_"+d+'">APPLY</span></td> ',e+="</tr></table></li>",$("#"+c+"_list_to_add").append(e),$("#"+c+"_apply_rule_"+d).click(function(){b._applyRule($(this))}),$("#target_"+d).change(function(){var a=$(this)[0].id.substr($(this)[0].id.lastIndexOf("_")+1);for(var c in b.opt.rules.target){var d=b.opt.rules.target[c].name,e=d.replace(/ /g,"");$("#conditions_"+a+"_"+e).css("display","none")}$("#target_"+a+" option:selected").each(function(){$("#conditions_"+a+"_"+$(this).text()).css("display","inline"),$("#condition_params_"+a+"_"+$(this).text()+"_"+$("#condition_"+a+"_"+$(this).text()).val().replace(/ /g,"")).css("display","inline"),$("#action_span_"+a).html(b._getActionSpan(a,$(this).parent()[0].selectedIndex)),b._enableAction(a)})}),b._enableAction(d,a);for(var h in b.opt.rules.target){var j=b.opt.rules.target[h].name,k=j.replace(/ /g,"");$("#condition_"+d+"_"+k).change(function(){var a=$(this)[0].id.split("_");$("#condition_"+a[1]+"_"+a[2]+" option").each(function(){$("#condition_params_"+a[1]+"_"+a[2]+"_"+$(this).text().replace(/ /g,"")).css("display","none")}),$("#condition_"+a[1]+"_"+a[2]+" option:selected").each(function(){$("#condition_params_"+a[1]+"_"+a[2]+"_"+$(this).text().replace(/ /g,"")).css("display","inline")})})}b._number++},addActiveRule:function(a,b){var c=this,d=c.opt.target;"undefined"==typeof b&&(b=c._number++,a.id=d+"_rule_"+b);var e="";switch(a.action.type){case"color":e='<span style="color: '+a.actionParameters[0]+"; background-color: "+a.actionParameters[0]+';">_</span>';break;case"colorRange":e='<span style="color: '+a.actionParameters[0]+"; background-color: "+a.actionParameters[0]+';">_</span>',e+='<span style="color: '+a.actionParameters[1]+"; background-color: "+a.actionParameters[1]+';">_</span>';break;case"select":e="<i>"+a.actionParameters[0]+"</i>"}var f="undefined"==typeof a.location?"":"In <i>"+a.location+"</i> ";$("#"+d+"_list").append('<li id="'+d+"_rule_"+b+'" class="rule_item"><table><tr><td class="rule"'+f+"<i>"+a.action.name+"</i> "+e+" the <i>"+a.target+"</i> with <i>"+a.condition+" "+a.parameters.join(" ")+' </i>  </td> <td><span class="action remove">remove</span> <span class="action edit">edit</span></td> <td class="rights"><span class="affected">0</span></td></tr></table></li>'),$("#"+d+"_rule_"+b).data("rule",a),$("#"+d+"_rule_"+b+" span.remove").click(function(){var a=$(this).parent().parent().parent().parent().parent().data("rule");$(this).parent().parent().parent().parent().parent().remove(),c.raiseEvent("onRuleRemoved",{rules:c.getActiveRules(),removed:a})}),$("#"+d+"_rule_"+b+" span.edit").click(function(){var a=$(this).parent().parent().parent().parent().parent().data("rule");$(this).parent().parent().parent().parent().parent().remove(),c.addRule(a),c.raiseEvent("onRuleEditing",{rules:c.getActiveRules(),editing:a})}),c.raiseEvent("onRuleCreated",{rules:c.getActiveRules(),new_rule:$("#"+d+"_rule_"+b).data("rule")})},_applyRule:function(a){for(var b=this,c=b.opt.target,d=a[0].id.substr(a[0].id.lastIndexOf("_")+1),e=$("#location_"+d).val(),f=$("#action_"+d).val(),g=$("#target_"+d).val(),h=b._getAction(g,f),i=$("#condition_"+d+"_"+g.replace(/ /g,"")).val(),j=new Array,k=0;"undefined"!=typeof $("#condition_params_"+d+"_"+g+"_"+i.replace(/ /g,"")+"_"+k).val();)j.push($("#condition_params_"+d+"_"+g+"_"+i.replace(/ /g,"")+"_"+k).val()),k++;var l=[];switch(h.type){case"color":l.push($("#action_parameters_0_"+d).val());break;case"colorRange":l.push($("#action_parameters_0_"+d).val()),l.push($("#action_parameters_1_"+d).val());break;case"select":l.push($("#action_parameters_0_"+d).val())}var m={location:e,action:h,actionParameters:l,target:g,condition:i,parameters:j,id:c+"_rule_"+d};b.addActiveRule(m,d),a.parent().parent().parent().parent().parent().remove()},_getConditionsSpan:function(a,b,c,d){var e=this,f=b.name,g=f.replace(/ /g,""),h='		<span id="conditions_'+a+"_"+g+'" style="display:'+c+'"> ',i=!("undefined"==typeof d);h+=e._getSelect("condition_"+a+"_"+g,b.conditions,"name",i?d.condition:d);var j=i?"none":"inline";for(var k in b.conditions)j=i?b.conditions[k].name==d.condition?"inline":"none":j,h+=e._getConditionSpan(a,g,b.conditions[k],j,d),j="none";return h+="		</span> "},_getConditionSpan:function(a,b,c,d,e){var f=this,g=c.name,h=g.replace(/ /g,""),i=!("undefined"==typeof e),j=' 	<span id="condition_params_'+a+"_"+b+"_"+h+'" style="display:'+d+'"> ';switch(c.type){case"selects":for(var k=0;k<1*c.amount;k++)j+=f._getSelect("condition_params_"+a+"_"+b+"_"+h+"_"+k,c.values,"",i?e.parameters[k]:e);break;case"numeric_comparison":j+=f._getSelect("condition_params_"+a+"_"+b+"_"+h+"_0",["==",">","<",">=","<="],"",i?e.parameters[0]:e);var l=i?e.parameters[1]:"";j+='		<input type="number" id="condition_params_'+a+"_"+b+"_"+h+'_1" value="'+l+'">';break;case"text_comparison":j+=f._getSelect("condition_params_"+a+"_"+b+"_"+h+"_0",["equals","contains","different","not contains"],"",i?e.parameters[0]:e);
var l=i?e.parameters[1]:"";j+='		<input type="text" id="condition_params_'+a+"_"+b+"_"+h+'_1"  value="'+l+'">';break;case"feature_comparison":j+=f._getSelect("condition_params_"+a+"_"+b+"_"+h+"_0",c.values,"",i?e.parameters[0]:e),j+=f._getSelect("condition_params_"+a+"_"+b+"_"+h+"_1",["equals","contains","different","not contains"],"",i?e.parameters[1]:e);var l=i?e.parameters[2]:"";j+='		<input type="text" id="condition_params_'+a+"_"+b+"_"+h+'_2"  value="'+l+'">';break;case"all":}return j+=" 	</span>"},_getSelect:function(a,b,c,d){var e='		<select  id="'+a+'" class="styled-select">';for(var f in b){var g=b[f];"undefined"!=typeof c&&""!=c&&(g=b[f][c]);var h=g==d?"selected='selected'":"";e+="			<option "+h+">"+g+"</option>"}return e+="		</select> "},_getActionSpan:function(a,b,c){var d=this,e=!("undefined"==typeof c),f=d._getSelect("action_"+a,d.opt.rules.target[b].action,"name",e?c.action.name:c);return f+='		<span id="action_parameters_'+a+'" > </span>'},_enableAction:function(a,b){var c=this;$("#action_"+a).change(function(){var a=$(this)[0].id.substr($(this)[0].id.lastIndexOf("_")+1);c._enableActionParameters(a)}),c._enableActionParameters(a,b)},_enableActionParameters:function(a,b){var c=this,d=!("undefined"==typeof b),e=d?c._getAction(b.target,b.action.name):c._getAction($("#target_"+a).val(),$("#action_"+a).val());switch($("#action_parameters_"+a).html(""),e.type){case"color":c._addColorSelector(a,0,d?b.actionParameters[0]:b);break;case"colorRange":c._addColorSelector(a,1,d?b.actionParameters[0]:"#F00"),c._addColorSelector(a,0,d?b.actionParameters[1]:"#0F0");break;case"select":$("#action_parameters_"+a).html(c._getSelect("action_parameters_0_"+a,e.options,"",d?b.actionParameters[0]:b));break;case"single":default:$("#action_parameters_"+a).html("")}},_addColorSelector:function(a,b,c){c="undefined"!=typeof c?c:"#56992F",$("#action_parameters_"+a).append('<input type="hidden" id="action_parameters_'+b+"_"+a+'" name="color4" class="color-picker" size="6" />'),$("#action_parameters_"+b+"_"+a).miniColors({letterCase:"uppercase"}).miniColors("value",c)},_getAction:function(a,b){for(var c=this,d=0;d<c.opt.rules.target.length;d++){var e=c.opt.rules.target[d];if(e.name==a)for(var f=0;f<e.action.length;f++){var g=e.action[f];if(g.name==b)return g}}}}),Biojs.Sequence=Biojs.extend({constructor:function(){var a=this;this._container=jQuery("#"+this.opt.target),this._container.ready(function(){a._initialize()})},opt:{sequence:"",id:"",target:"",format:"FASTA",selection:{start:0,end:0},columns:{size:35,spacedEach:10},highlights:[],annotations:[],sequenceUrl:"http://www.ebi.ac.uk/das-srv/uniprot/das/uniprot/sequence",selectionColor:"Yellow",selectionFontColor:"black",highlightFontColor:"red",highlightBackgroundColor:"white",fontFamily:'"Andale mono", courier, monospace',fontSize:"12px",fontColor:"inherit",backgroundColor:"inherit",width:void 0,height:void 0,formatSelectorVisible:!0},eventTypes:["onSelectionChanged","onSelectionChange","onAnnotationClicked"],_headerDiv:null,_contentDiv:null,_initialize:function(){void 0!==this.opt.width&&this._container.width(this.opt.width),void 0!==this.opt.height&&this._container.height(this.opt.height),this._container.css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none"}),this._buildFormatSelector(),this._contentDiv=jQuery("<div></div>").appendTo(this._container),this._contentDiv.css({"font-family":this.opt.fontFamily,"font-size":this.opt.fontSize,"text-align":"left"}),this._highlights=this.opt.highlights,this._annotations=this.opt.annotations,jQuery('<div id="sequenceTip'+this.getId()+'"></div>').css({position:"absolute","z-index":"999999",color:"#fff","font-size":"12px",width:"auto",display:"none"}).addClass("tooltip").appendTo("body").hide(),Biojs.Utils.isEmpty(this.opt.sequence)?Biojs.Utils.isEmpty(this.opt.id)?this.clearSequence("No sequence available","../biojs/css/images/warning_icon.png"):this._requestSequence(this.opt.id):this._redraw()},setSequence:function(a,b){a.match(/^([A-N,R-Z][0-9][A-Z][A-Z, 0-9][A-Z, 0-9][0-9])|([O,P,Q][0-9][A-Z, 0-9][A-Z, 0-9][A-Z, 0-9][0-9])(\.\d+)?$/i)?this._requestSequence(arguments[0]):(this.opt.sequence=a,this.opt.id=b,this._highlights=[],this._highlightsCount=0,this.opt.selection={start:0,end:0},this._annotations=[],this._contentDiv.children().remove(),this._redraw())},_requestSequence:function(a){var b=this;Biojs.console.log("Requesting sequence for: "+a),jQuery.ajax({url:b.opt.sequenceUrl,dataType:"xml",data:{segment:a},success:function(a){try{var c=jQuery(a).find("SEQUENCE:first");b.setSequence(c.text(),c.attr("id"),c.attr("label"))}catch(d){Biojs.console.log("Error decoding response data: "+d.message),b.clearSequence("No sequence available","../biojs/css/images/warning_icon.png")}},error:function(a,c){Biojs.console.log("Error decoding response data: "+c),b.clearSequence("Error requesting the sequence to the server "+this.url,"../biojs/css/images/warning_icon.png")}})},clearSequence:function(a,b){var c=void 0;this.opt.sequence="",this.opt.id="",this._highlights=[],this._highlightsCount=0,this.opt.selection={start:0,end:0},this._annotations=[],this._contentDiv.children().remove(),this._headerDiv.hide(),void 0!==a&&(c=jQuery("<div>"+a+"</div>").appendTo(this._contentDiv).addClass("message"),void 0!==b&&c.css({background:'transparent url("'+b+'") no-repeat center left',"padding-left":"20px"}))},setSelection:function(a,b){if(a>b){var c=b;b=a,a=c}(a!=this.opt.selection.start||b!=this.opt.selection.end)&&(this._setSelection(a,b),this.raiseEvent(Biojs.Sequence.EVT_ON_SELECTION_CHANGED,{start:a,end:b}))},_buildFormatSelector:function(){var a=this;this._headerDiv=jQuery("<div></div>").appendTo(this._container),this._headerDiv.css({"font-family":'"Heveltica Neue", Arial, "sans serif"',"font-size":"14px"}).append("Format: "),this._formatSelector=jQuery('<select> <option value="FASTA">FASTA</option><option value="CODATA">CODATA</option><option value="PRIDE">PRIDE</option><option value="RAW">RAW</option></select>').appendTo(a._headerDiv),this._formatSelector.change(function(){a.opt.format=jQuery(this).val(),a._redraw()}),this._formatSelector.val(a.opt.format),this.formatSelectorVisible(this.opt.formatSelectorVisible)},highlight:function(a,b,c,d,e){return this.addHighlight({start:a,end:b,color:c,background:d,id:e})},addHighlight:function(a){var b="-1",c="",d="",e={};return a instanceof Object&&a.start<=a.end&&(c="string"==typeof a.color?a.color:this.opt.highlightFontColor,d="string"==typeof a.background?a.background:this.opt.highlightBackgroundColor,b="string"==typeof a.id?a.id:new Number(this._highlightsCount++).toString(),e={start:a.start,end:a.end,color:c,background:d,id:b},this._highlights.push(e),this._applyHighlight(e),this._restoreSelection(a.start,a.end)),b},_applyHighlight:function(a){for(var b=this._contentDiv.find(".sequence"),c=a.start-1;c<a.end;c++)zindex=jQuery(b[c]).css("z-index"),"auto"==zindex?(z=1,o=1):(z=0,o=.5),jQuery(b[c]).css({color:a.color,"background-color":a.background,"z-index":z,opacity:o}).addClass("highlighted")},_applyHighlights:function(a){for(var b in a)this._applyHighlight(a[b])},_restoreHighlights:function(c,d){var e=this._highlights;this._applyHighlight({start:c,end:d,color:this.opt.fontColor,background:this.opt.backgroundColor});for(var f in e)e[f].start>d||e[f].end<c||(a=e[f].start<c?c:e[f].start,b=e[f].end>d?d:e[f].end,this._applyHighlight({start:a,end:b,color:e[f].color,background:e[f].background}))},_restoreSelection:function(c,d){var e=this.opt.selection;c>e.end||d<e.start||(a=c<e.start?e.start:c,b=d>e.end?e.end:d,this._applyHighlight({start:a,end:b,color:this.opt.selectionFontColor,background:this.opt.selectionColor}))},unHighlight:function(a){this.removeHighlight(a)},removeHighlight:function(a){var b=this._highlights;for(i in b)if(b[i].id==a){start=b[i].start,end=b[i].end,b.splice(i,1),this._restoreHighlights(start,end),this._restoreSelection(start,end);break}},unHighlightAll:function(){this.removeAllHighlights()},removeAllHighlights:function(){this._highlights=[],this._restoreHighlights(1,this.opt.sequence.length),this._restoreSelection(1,this.opt.sequence.length)},setFormat:function(a){this.opt.format!=a.toUpperCase()&&(this.opt.format=a.toUpperCase(),this._redraw());var b=this;this._headerDiv.find("option").each(function(){jQuery(this).val()==b.opt.format.toUpperCase()&&jQuery(this).attr("selected","selected")})},setNumCols:function(a){this.opt.columns.size=a,this._redraw()},formatSelectorVisible:function(a){a?this._headerDiv.show():this._headerDiv.hide()},showFormatSelector:function(){this._headerDiv.show()},hideFormatSelector:function(){this._headerDiv.hide()},hide:function(){this._headerDiv.hide(),this._contentDiv.hide()},show:function(){this._headerDiv.show(),this._contentDiv.show()},_setSelection:function(a,b){var c=this.opt.selection,d={};c.start==a?c.end<b?(d.start=c.end,d.end=b):this._restoreHighlights(b+1,c.end):c.end==b?c.start>a?(d.start=a,d.end=c.start):this._restoreHighlights(c.start,a-1):(this._restoreHighlights(c.start,c.end),d.start=a,d.end=b),c.start=a,c.end=b,void 0!=d.start&&this._applyHighlight({start:d.start,end:d.end,color:this.opt.selectionFontColor,background:this.opt.selectionColor})},_repaintSelection:function(){var a=Biojs.Utils.clone(this.opt.selection);this._setSelection(0,0),this._setSelection(a.start,a.end)},_redraw:function(){this._contentDiv.children().remove(),"RAW"==this.opt.format?this._drawRaw():"CODATA"==this.opt.format?this._drawCodata():"FASTA"==this.opt.format?this._drawFasta():(this.opt.format="PRIDE",this._drawPride()),this._applyHighlights(this._highlights),this._repaintSelection(),this._addSpanEvents()},_drawFasta:function(){var a=this.opt.sequence.toUpperCase().split(""),b=jQuery("<pre></pre>").appendTo(this._contentDiv),c=">"+this.opt.id+" "+a.length+" bp<br/>",d=this.opt.columns.size;this.opt.sequence.length<this.opt.columns.size&&(d=this.opt.sequence.length);var e={numCols:d,numColsForSpace:0};c+=this._drawSequence(a,e),b.html(c),this._drawAnnotations(e)},_drawCodata:function(){var a=this.opt.sequence.toUpperCase().split(""),b=jQuery('<pre style="white-space:pre"></pre>').appendTo(this._contentDiv),c="ENTRY           "+this.opt.id+"<br/>";c+="SEQUENCE<br/>",void 0!==this.opt.formatOptions&&void 0!==this.opt.formatOptions.title&&0==this.opt.formatOptions.title&&(c="");var d=this.opt.columns.size;this.opt.sequence.length<this.opt.columns.size&&(d=this.opt.sequence.length);var e={numLeft:!0,numLeftSize:7,numLeftPad:" ",numTop:!0,numTopEach:5,numCols:d,numColsForSpace:0,spaceBetweenChars:!0};c+=this._drawSequence(a,e);var f="<br/>///";void 0!==this.opt.formatOptions&&void 0!==this.opt.formatOptions.footer&&0==this.opt.formatOptions.footer&&(f=""),c+=f,b.html(c),this._drawAnnotations(e)},_drawAnnotations:function(a){var b=this,c=this.opt.sequence.toLowerCase().split(""),d=this._annotations,e="",f="",g="";a.numLeft&&(e+=this._formatIndex(" ",a.numLeftSize+2," "));for(var h=0;h<c.length;h+=a.numCols){f="";for(var i in d)d[i].id=this.getId()+"_"+i,g=this._getHTMLRowAnnot(h+1,d[i],a),g.length>0&&(f+="<br/>",f+=e,f+=g,f+="<br/>");var j=a.numCols,k=c.length-h;j>k&&(j=k),jQuery(f).insertAfter(a.numRight?"div#"+b.opt.target+" div pre span#numRight_"+this.getId()+"_"+(h+j):"div#"+b.opt.target+" div pre span#"+this.getId()+"_"+(h+j))}jQuery(this._contentDiv).find(".annotation").each(function(){b._addToolTip(this,function(){return b._getAnnotationString(jQuery(this).attr("id"))}),jQuery(this).mouseover(function(a){jQuery(".annotation."+jQuery(a.target).attr("id")).each(function(){jQuery(this).css("background-color",jQuery(this).attr("color"))})}).mouseout(function(){jQuery(".annotation").css("background-color","transparent")}).click(function(a){b.raiseEvent(Biojs.Sequence.EVT_ON_ANNOTATION_CLICKED,{name:b._annotations[jQuery(a.target).attr("id")].name,pos:parseInt(jQuery(a.target).attr("pos"))})})})},_getAnnotationString:function(a){var b=this._annotations[a.substr(a.indexOf("_")+1)];return b.name+"<br/>"+(b.html?b.html:"")},_getHTMLRowAnnot:function(a,b,c){for(var d="border-left:1px solid; border-bottom:1px solid; border-color:",e="border-bottom:1px solid; border-color:",f="border-bottom:1px solid; border-right:1px solid; border-color:",g="border-left:1px solid; border-right:1px solid; border-bottom:1px solid; border-color:",h=[],i=a+c.numCols,j=c.spaceBetweenChars?" ":"",k=b.color,l=b.id,m=a;i>m;m++)for(var n in b.regions)region=b.regions[n],spaceAfter="",spaceAfter+=m%c.numColsForSpace==0?" ":"",spaceAfter+=j,color=region.color?region.color:k,data='class="annotation '+l+'" id="'+l+'" color="'+color+'" pos="'+m+'"',m==region.start&&m==region.end?(h[m]='<span style="'+g+color+'" '+data+"> ",h[m]+=spaceAfter,h[m]+="</span>"):m==region.start?(h[m]='<span style="'+d+color+'" '+data+"> ",h[m]+=spaceAfter,h[m]+="</span>"):m==region.end?(h[m]='<span style="'+f+color+' " '+data+"> ",h[m]+="</span>"):m>region.start&&m<region.end?(h[m]='<span style="'+e+color+'" '+data+"> ",h[m]+=spaceAfter,h[m]+="</span>"):h[m]||(h[m]=" ",h[m]+=spaceAfter);var o=h.join("");return-1==o.indexOf("span")?"":o},_drawRaw:function(){var a=this.opt.sequence.toLowerCase().split(""),b=jQuery("<pre></pre>").appendTo(this._contentDiv),c=this.opt.columns.size;this.opt.sequence.length<this.opt.columns.size&&(c=this.opt.sequence.length);var d={numCols:c};b.html(this._drawSequence(a,d)),this._drawAnnotations(d)},_drawPride:function(){var a=this,b=this.opt.sequence.toUpperCase().split(""),c=jQuery("<pre></pre>").appendTo(this._contentDiv),d=this.opt.columns.size;this.opt.sequence.length<this.opt.columns.size&&(d=this.opt.sequence.length),opt={numLeft:!0,numLeftSize:5,numLeftPad:"0",numRight:!0,numRightSize:5,numRightPad:"0",numCols:d,numColsForSpace:a.opt.columns.spacedEach},c.html(this._drawSequence(b,opt)),this._drawAnnotations(opt)},_drawSequence:function(a,b){var c="",d="white-space: pre;";if(b.numTop){c+='<span style="'+d+'" class="numTop">';var e=b.spaceBetweenChars?2*b.numTopEach:b.numTopEach;b.numLeft&&(c+=this._formatIndex(" ",b.numLeftSize," ")),c+=this._formatIndex(" ",e," ");for(var f=b.numTopEach;f<b.numCols;f+=b.numTopEach)c+=this._formatIndex(f,e," ",!0);c+="</span><br/>"}b.numLeft&&(c+=this._formatIndex(1,b.numLeftSize,b.numLeftPad),c+="  ");for(var g=1,h=1;h<=a.length;h++)if(h%b.numCols==0){c+='<span class="sequence" id="'+this.getId()+"_"+h+'">'+a[h-1]+"</span>",b.numRight&&(c+='<span style="'+d+'" id="numRight_'+this.getId()+"_"+h+'">',c+="  ",c+=this._formatIndex(h,b.numRightSize,b.numRightPad),c+="</span>"),c+="<br/>";var i=a.length-h;b.numLeft&&i>0&&(c+='<span id="numLeft_'+this.getId()+"_"+h+'">',c+=this._formatIndex(h+1,b.numLeftSize,b.numLeftPad),c+="  ",c+="</span>"),g=1}else c+='<span class="sequence" style="'+d+'" id="'+this.getId()+"_"+h+'">'+a[h-1],c+=g%b.numColsForSpace==0?" ":"",c+=b.spaceBetweenChars?" ":"",c+="</span>",g++;return c+="<br/>",jQuery.browser.msie&&(c="<pre>"+c+"</pre>"),c},_formatIndex:function(a,b,c,d){var e=a.toString(),f="",g=b-e.length;if(g>0){for(;g-->0;)f+="<span>"+c+"</span>";e=d?a+f:f+a}return e},_addSpanEvents:function(){var a,b=this,c=!1;b._contentDiv.find(".sequence").each(function(){jQuery(this).mousedown(function(){var d=jQuery(this).attr("id");a=parseInt(d.substr(d.indexOf("_")+1)),clickPos=a,b._setSelection(clickPos,a),c=!0,b.raiseEvent(Biojs.Sequence.EVT_ON_SELECTION_CHANGE,{start:b.opt.selection.start,end:b.opt.selection.end})}).mouseover(function(){var d=jQuery(this).attr("id");a=parseInt(d.substr(d.indexOf("_")+1)),c&&(a>clickPos?b._setSelection(clickPos,a):b._setSelection(a,clickPos),b.raiseEvent(Biojs.Sequence.EVT_ON_SELECTION_CHANGE,{start:b.opt.selection.start,end:b.opt.selection.end}))}).mouseup(function(){c=!1,b.raiseEvent(Biojs.Sequence.EVT_ON_SELECTION_CHANGED,{start:b.opt.selection.start,end:b.opt.selection.end})}),b._addToolTip.call(b,this,function(){return c?"["+b.opt.selection.start+", "+b.opt.selection.end+"]":a})}).css("cursor","pointer")},_addToolTip:function(a,b){var c="#sequenceTip"+this.getId();jQuery(a).mouseover(function(d){var e=jQuery(d.target).offset();jQuery(c).is(":visible")||jQuery(c).css({"background-color":"#000",padding:"3px 10px 3px 10px",top:e.top+jQuery(d.target).height()+"px",left:e.left+jQuery(d.target).width()+"px"}).animate({opacity:"0.85"},10).html(b.call(a)).show()}).mouseout(function(){jQuery(c).hide()})},setAnnotation:function(a){this.addAnnotation(a)},addAnnotation:function(a){this._annotations.push(a),this._redraw()},removeAnnotation:function(a){for(var b=0;b<this._annotations.length;b++)if(a!=this._annotations[b].name){this._annotations.splice(b,1),this._redraw();break}},removeAllAnnotations:function(){this._annotations=[],this._redraw()}},{EVT_ON_SELECTION_CHANGE:"onSelectionChange",EVT_ON_SELECTION_CHANGED:"onSelectionChanged",EVT_ON_ANNOTATION_CLICKED:"onAnnotationClicked"}),Biojs.SimpleFeatureViewer=Biojs.FeatureViewer.extend({constructor:function(a){this.base(a),this._generatesJSON(),this.paintFeatures(this.opt.json)},opt:{dragSites:!1,imageWidth:700},eventTypes:[],exportFeaturesToImage:function(){var a=this.opt.json.configuration,b="";if(jQuery.browser.msie)alert("Operation not supported for IE, please try from a different browser");else{svg=document.getElementById("uniprotFeaturePainter-holder").innerHTML;var c=document.createElement("canvas");canvg(c,svg),b=c.toDataURL(),this.$imageExported=jQuery('<div id="uniprotFeaturePainter-imageExportedDiv"></div>').html('<img id="uniprotFeaturePainter-imageExported" alt="exported image" src="'+b+'"/>').dialog({autoOpen:!0,title:"Exported image",modal:!0,width:a.sizeX+20})}},_rectangleHeight:10,_tracks:0,_generatesJSON:function(){this.opt.json.segment=this.opt.sequenceId,this.opt.json={},this.opt.json.configuration={},this.opt.json.configuration.requestedStart=1,this.opt.json.configuration.requestedStop=this.opt.sequenceLength,this.opt.json.configuration.sequenceLength=this.opt.sequenceLength,this.opt.json.configuration.rightMargin=20,this.opt.json.configuration.leftMargin=20,this.opt.json.configuration.rulerLength=this.opt.imageWidth-this.opt.json.configuration.rightMargin-this.opt.json.configuration.leftMargin,this.opt.json.configuration.belowRuler=30,this.opt.json.configuration.aboveRuler=10,this.opt.json.configuration.rulerY=20,this.opt.json.configuration.unitSize=this.opt.json.configuration.rulerLength/this.opt.sequenceLength,this.opt.json.configuration.style="nonOverlapping",this.opt.json.configuration.nonOverlapping=!0,this.opt.json.configuration.verticalGrid=!1,this.opt.json.configuration.horizontalGrid=!1,this.opt.json.configuration.sizeX=this.opt.imageWidth,this.opt.json.configuration.sequenceLineY=4+this.opt.json.configuration.rulerY+this.opt.json.configuration.belowRuler,this.opt.json.configuration.pixelsDivision=50,this._organizeTracks(this.opt.features),0!=this._trackShapes?(this.opt.json.configuration.sizeY=this.opt.json.configuration.sequenceLineY+(this._tracks+1)*(this._rectangleHeight+2)+this._rectangleHeight,this.opt.json.configuration.sequenceLineY=this.opt.json.configuration.sequenceLineY+(this._trackShapes+1)*this._rectangleHeight):this.opt.json.configuration.sizeY=this.opt.json.configuration.sequenceLineY+this._tracks*(this._rectangleHeight+2)+this._rectangleHeight,this._renderFeatures(this.opt.features),this.opt.json.featuresArray=this.opt.features,console.log(this.opt.json.featuresArray),sizeKey=this._generateLegend(this.opt.features),this.opt.json.configuration.sizeYKey=sizeKey+this.opt.json.configuration.sizeY},_organizeTracks:function(a){tracks=new Array,trackShapes=new Array;for(var b=0;b<a.length;b++){var c=!1,d=!1;if(void 0!=a[b].type){if("rect"!=a[b].type&&"bridge"!=a[b].type&&"circle"!=a[b].type&&"diamond"!=a[b].type&&"hexagon"!=a[b].type&&"triangle"!=a[b].type&&"wave"!=a[b].type&&(a[b].type="rect"),a[b].featureStart==a[b].featureEnd&&"rect"!=a[b].type&&"bridge"!=a[b].type&&(c=!0),"bridge"==a[b].type){a[b].track=0;continue}}else a[b].type="rect";if(c){for(var e=0;e<trackShapes.length;e++){for(var f=!1,g=0;g<trackShapes[e].length;g++)if(a[b].featureStart==a[b].featureEnd)if(a[b].featureStart-3<trackShapes[e][g].featureStart&&a[b].featureEnd+3<trackShapes[e][g].featureStart)f=!1;else{if(!(a[b].featureStart-3>trackShapes[e][g].featureEnd)){f=!0;break}f=!1}if(!f){a[b].track=e,trackShapes[e][trackShapes[e].length]=a[b],d=!0;break}}d||(a[b].track=trackShapes.length,trackShapes[trackShapes.length]=new Array(a[b]))}else{for(var e=0;e<tracks.length;e++){for(var f=!1,g=0;g<tracks[e].length;g++)if(a[b].featureStart==a[b].featureEnd)if(a[b].featureStart<tracks[e][g].featureStart&&a[b].featureEnd<tracks[e][g].featureStart)f=!1;else{if(!(a[b].featureStart>tracks[e][g].featureEnd)){f=!0;break}f=!1}else if(a[b].featureStart<tracks[e][g].featureStart&&a[b].featureEnd<=tracks[e][g].featureStart)f=!1;else{if(!(a[b].featureStart>=tracks[e][g].featureEnd&&a[b].featureEnd>tracks[e][g].featureStart)){f=!0;break}f=!1}if(!f){a[b].track=e,tracks[e][tracks[e].length]=a[b],d=!0;break}}d||(a[b].track=tracks.length,tracks[tracks.length]=new Array(a[b]))}}this._tracks=tracks.length+trackShapes.length,this._trackRects=tracks.length,this._trackShapes=trackShapes.length},_renderFeatures:function(a){for(i=0;i<a.length;i++)void 0==a[i].type&&(a[i].type="rect"),void 0==a[i].color&&(a[i].color="black"),a[i].fillOpacity=.5,a[i].path="",a[i].text="",a[i].fill=a[i].color,a[i].stroke=a[i].color,a[i].strokeWidth=1,a[i].width=this.opt.json.configuration.unitSize*(a[i].featureEnd-a[i].featureStart+1),"rect"==a[i].type?(a[i].height=this._rectangleHeight,a[i].cy=this.opt.json.configuration.sequenceLineY+a[i].track*this._rectangleHeight+2*(a[i].track+1)):"bridge"==a[i].type?(a[i].height=this._rectangleHeight,a[i].cy=this.opt.json.configuration.sequenceLineY):(a[i].cy=this.opt.json.configuration.sequenceLineY-(a[i].track+2)*this._rectangleHeight,a[i].height="triangle"==a[i].type?10:"hexagon"==a[i].type?7:5),a[i].r=a[i].height,a[i].cx=this.opt.json.configuration.unitSize*(a[i].featureStart-1)+this.opt.json.configuration.leftMargin,a[i].x=a[i].cx,a[i].y=a[i].cy},_generateLegend:function(a){for(mykey=[],i=0;i<a.length;i++){for(found=!1,j=0;j<mykey.length;j++)if(a[i].typeLabel==mykey[j].label.text){mykey[j].label.total=mykey[j].label.total+1,mykey[j].label.text=mykey[j].label.text,found=!0;break}found||(mykey[mykey.length]={},mykey[mykey.length-1].label={},mykey[mykey.length-1].label.total=1,mykey[mykey.length-1].label.text=a[i].typeLabel,mykey[mykey.length-1].shape={},mykey[mykey.length-1].shape.text="",mykey[mykey.length-1].shape.width=30,mykey[mykey.length-1].shape.fill=a[i].fill,mykey[mykey.length-1].shape.type="rect",mykey[mykey.length-1].shape.fillOpacity=.5,mykey[mykey.length-1].shape.stroke=a[i].stroke,mykey[mykey.length-1].shape.height=5,mykey[mykey.length-1].shape.r=this._rectangleHeight,mykey[mykey.length-1].shape.path="",mykey[mykey.length-1].shape.typeLabel=a[i].typeLabel,mykey[mykey.length-1].shape.strokeWidth=1)}for(this.opt.json.legend={},yCell=this.opt.json.configuration.sizeY+this.opt.json.configuration.belowRuler,cellWidth=200,cellsByRow=this.opt.json.configuration.sizeX/cellWidth,cellHeight=20,this.opt.json.legend.segment={},this.opt.json.legend.segment.text=this.opt.sequenceId,this.opt.json.legend.segment.yPos=yCell,this.opt.json.legend.segment.xPos=this.opt.json.configuration.leftMargin,yCell+=cellHeight,cell=0,totalRows=1,i=0;i<mykey.length;i++)xPos=0,xPos=0==cell?this.opt.json.configuration.leftMargin:cell*cellWidth,mykey[i].label.yPos=yCell,mykey[i].label.xPos=xPos+cellHeight+15,mykey[i].shape.y=yCell,mykey[i].shape.cy=yCell,mykey[i].shape.x=xPos,mykey[i].shape.cx=xPos,cell=mykey[i].label.text.length>21?Math.min(cell+2,cellsByRow):Math.min(cell+1,cellsByRow),cell==cellsByRow&&(yCell+=cellHeight,cell=0,totalRows++);return this.opt.json.legend.key=mykey,(totalRows+1)*cellHeight}}),Biojs.Table=Biojs.extend({constructor:function(){var a=this;a._tableId="biojs_Table_"+a.getId(),a._tableSelector="#"+a._tableId,a._topControls=jQuery("<div></div>").appendTo("#"+a.opt.target),a._body=jQuery("<div></div>").appendTo("#"+a.opt.target),a._table=jQuery('<table id="'+a._tableId+'" cellpadding="0" cellspacing="0" border="0" class="display"></table>').appendTo(a._body),a._columnsOffset=this.opt.rowSelection?1:0,a._settings={},a._settings.opt=this.opt,a._initSettings(a._settings),a.setDataSource(a.opt.dataSet),a._addEvents(),Biojs.console.log("Biojs.Table constructor has finished")},opt:{target:"YourOwnDivId",hideColumns:[],columns:[""],dataSet:[],paginate:!0,pageLength:10,width:597,height:400,rowSelection:!0,orderBy:[]},eventTypes:["onCellClicked","onRowSelected","onHeaderClicked","onDataArrived"],setDataSource:function(a){this.opt.dataSet=a,a instanceof Array?this._initSettingsForLocalData(this._settings):this._initSettingsForRemoteData(this._settings),Biojs.console.log("Drawing.."),this._settings.bDestroy=!0,this._table.dataTable(this._settings),this._setColumnSelector(this._table.fnSettings())},toggleColumns:function(a,b){Biojs.console.log("Toggle columns to :"+b),Biojs.console.log(a);var c=jQuery('input[name="multiselect_'+this._tableId+'_columns"]');for(i=0;i<a.length;i++)toToggle=jQuery(c[a[i]]),toToggle.attr("checked")!=b&&toToggle.click(),this._table.fnSetColumnVis(a[i]+this._columnsOffset,b)},showColumns:function(a){Biojs.console.log("Showing columns:"),Biojs.console.log(a),this.toggleColumns(a,!0)},hideColumns:function(a){Biojs.console.log("Hiding columns:"),Biojs.console.log(a),this.toggleColumns(a,!1)},orderBy:function(a,b){this._table.fnSort([[a+this._columnsOffset,b]])},getSelectedRows:function(){var a=this,b=[];return jQuery(a._tableSelector+" tr.selected").each(function(c,d){b.push(a._table.fnGetData(d))}),Biojs.console.log(b),b},_initSettings:function(a){if(Biojs.console.log("initializing settings..."),a.aoColumnDefs=[],this._setColumns(this.opt.columns,a),this.opt.hideColumns.length>0&&a.aoColumnDefs.push({bVisible:!1,aTargets:this.opt.hideColumns}),this.opt.orderBy.length>0&&(a.aaSorting=this.opt.orderBy),this.opt.rowSelection){var b=a.aoColumnDefs[0].aTargets;for(i in b)b[i]+=1;for(i in a.aaSorting)a.aaSorting[i][0]+=1;a.aoColumnDefs.push({bSortable:!1,aTargets:[0]})}this.opt.paginate?(a.sPaginationType="full_numbers",a.iDisplayLength=this.opt.pageLength,a.oLanguage={oPaginate:{sPrevious:"<",sNext:">",sFirst:"|",sLast:"|"}}):(a.bScrollInfinite=!0,a.bScrollCollapse=!0),a.bProcessing=!0,a.bLengthChange=!1,a.sScrollX=this.opt.height,a.sScrollY="100%"},_initSettingsForLocalData:function(a){Biojs.console.log("Using local data"),this._setData(this.opt.dataSet,a),a.bServerSide=!1,a.sAjaxSource=null,a.fnServerData=null,a.bFilter=!0},_initSettingsForRemoteData:function(a){Biojs.console.log("Using data from remote URL: "+this.opt.dataSet.url),a.bServerSide=!0,a.sAjaxSource=this.opt.dataSet.url,a.fnServerData=this._fetchData,a.bFilter=this.opt.dataSet.filter},_fetchData:function(a,b,c,d){var e={url:a},f=b,g=d.sTableId.substr("biojs_Table_".length),h=Biojs.getInstance(g);h._mapUrlParams(b),e.dataType="json",void 0!=h.getProxy()&&(e.url=h.getProxy(),f=[{name:"url",value:a+"?"+jQuery.param(b)}],e.dataType=h.getProxyDataType()),e.success=function(a){jsonData=h._decodeToJSON(a),jsonData.sEcho=this.sEcho,h._setSelectionColumn(jsonData),c(jsonData),h.raiseEvent(Biojs.Table.EVT_ON_DATA_ARRIVED,{jsonData:jsonData})},e.type="GET",e.data=f,e.sEcho=b[0].value,jQuery.ajax(e)},getProxy:function(){return this.opt.dataSet.proxyUrl},getProxyDataType:function(){return"text"|this.opt.dataSet.dataType},getTotalRecords:function(){return this.opt.dataSet.totalRecords},_setSelectionColumn:function(a){if(this.opt.rowSelection&&a.aaData instanceof Array)for(i=0;i<a.aaData.length;i++)a.aaData[i].unshift('<input type="checkbox" id="'+i+'" />')},_decodeToJSON:function(a){var b=a;return Biojs.Utils.isEmpty(a)?Biojs.console.log("Empty data was received"):b instanceof Object&&b.aaData instanceof Array||(b={},b.aaData=[],b.iTotalRecords=0,b.iTotalDisplayRecords=0,Biojs.console.log("Error: data with unknown format was detected.")),Biojs.console.log(b),b},_mapUrlParams:function(a){var b=this.opt.dataSet.paramsMap;for(key in b)for(i=0;i<a.length;i++)a[i].name==key&&(Biojs.console.log("Renaming param <"+key+"> with <"+b[key]+">"),a[i].name=b[key])},_setColumnSelector:function(a){var b=this,c=a.aoColumns,d=jQuery('<select id="'+b._tableId+'_columns" name="columns" multiselect="multiselect" />');for(i=this._columnsOffset;i<c.length;i++)d.append('<option value="'+i+'">'+c[i].sTitle+"</option>");jQuery(b._tableSelector+"_wrapper > "+b._tableId+"_columns").remove(),d.prependTo(b._tableSelector+"_wrapper"),b._columnSelector=d.multiselect({header:!1,click:function(a,c){b._table.fnSetColumnVis(c.value,c.checked)}}),jQuery(b._tableSelector+"_wrapper > button").html('<span class="ui-icon ui-icon-carat-2-e-w"></span>').css("width","auto").addClass("dataTables_settings").attr("title","Show/hide columns"),b._columnSelector.multiselect("uncheckAll");var e=(a.aiDisplayMaster,jQuery('input[name="multiselect_'+this._tableId+'_columns"]'));for(i=0;i<e.length;i++)jQuery(e[i]).attr("checked",a.aoColumns[i+this._columnsOffset].bVisible)},addDataRow:function(a){this.opt.rowSelection&&a.unshift('<input type="checkbox" id="" />'),this._table.fnAddData(a)},removeDataRow:function(a){this._table.fnDeleteRow(a)},_setColumns:function(a,b){var c=[];this.opt.rowSelection&&a.splice(0,0,{name:'<input type="checkbox" />'});for(j in a)"string"==typeof a[j]?c[j]={sTitle:a[j]}:(c[j]={sTitle:a[j].name},a[j].render&&"function"==typeof a[j].render&&(c[j].fnRender=function(b,c){return a[b.iDataColumn].render(b.iDataColumn,b.aData,c)}),a[j].width&&"string"==typeof a[j].width&&(c[j].sWidth=a[j].width));b.aoColumns=c},_setData:function(a,b){if(this.opt.rowSelection)for(r in a)a[r].splice(0,0,'<input type="checkbox" id="'+r+'" />');b.aaData=a},_showEmptyMessage:function(){this._body.html("Empty")},_addEvents:function(){var a=this;jQuery(this._tableSelector).click(function(b){for(var c=b.target;"TD"!=c.tagName;)c=c.parentNode;var d=new Number(c.cellIndex),e=new Number(c.parentNode.rowIndex-1);a.opt.rowSelection&&0==d?c.children[0].checked?(jQuery(c).parent().addClass("selected"),a.raiseEvent(Biojs.Table.EVT_ON_ROW_SELECTED,{rowIndex:e,row:jQuery(c).parent()})):jQuery(c).parent().removeClass("selected"):a.raiseEvent(Biojs.Table.EVT_ON_CELL_CLICKED,{cell:c,rowIndex:e,colIndex:d}),Biojs.console.log(b)}),jQuery(a._tableSelector+"_wrapper table.dataTable thead tr th").click(function(b){var c=b.currentTarget,d=c.cellIndex;a.opt.rowSelection&&0==d?c.children[0].checked?(jQuery(a._tableSelector+" tr").addClass("selected"),jQuery(a._tableSelector+" tr td input").attr("checked",!0)):(jQuery(a._tableSelector+" tr").removeClass("selected"),jQuery(a._tableSelector+" tr td input").attr("checked",!1)):a.raiseEvent(Biojs.Table.EVT_ON_HEADER_CLICKED,{colName:c.innerHTML,colIndex:d}),Biojs.console.log(b)})}},{EVT_ON_CELL_CLICKED:"onCellClicked",EVT_ON_ROW_SELECTED:"onRowSelected",EVT_ON_HEADER_CLICKED:"onHeaderClicked",EVT_ON_DATA_ARRIVED:"onDataArrived"}),Biojs.Tooltip=Biojs.extend({constructor:function(){{var a=this;this.opt.arrowType}this._container=jQuery('<div id="biojsTooltip'+a.getId()+'"></div>').addClass("Tooltip"),this._arrow=jQuery('<div class="arrow"></div>').appendTo(a._container),this._body=jQuery('<div class="body"></div>').appendTo(a._container),this._container.appendTo("body"),this._initialize()},opt:{targetSelector:"a",cbRender:void 0,arrowType:"left_top",position:2,delay:200},eventTypes:["onShowUp"],_initialize:function(){var a,b=this,c=0,d=this.opt.targetSelector,e=this.opt.cbRender,f=this.opt.position;"function"!=typeof e&&(e=function(a){return jQuery(a).attr("title")}),this.setArrowType(this.opt.arrowType),this._arrow.css({position:"absolute","z-index":"99999"}),this._body.css({position:"absolute","z-index":"99998",margin:"0px"}),f==Biojs.Tooltip.MOUSE_POSITION?jQuery(d).mousemove(function(d){a=jQuery(d.target),c&&clearTimeout(c),c=0,content=e.call(b,d.target),b._body.html(content),b._show(),b._setPosition({left:d.pageX-10,top:d.pageY-10},{width:20,height:20}),b.raiseEvent(Biojs.Tooltip.EVT_ON_SHOW_UP,{target:a})
}).mouseout(function(){c=setTimeout("Biojs.getInstance("+b.getId()+")._hide()",b.opt.delay)}):jQuery(d).mouseover(function(d){a=jQuery(d.target),c&&clearTimeout(c),c=0,content=e.call(b,d.target),b._body.html(content),b._show(),b._setPosition(a.offset(),{width:a.width(),height:a.height()}),b.raiseEvent(Biojs.Tooltip.EVT_ON_SHOW_UP,{target:a})}).mouseout(function(){c=setTimeout("Biojs.getInstance("+b.getId()+")._hide()",b.opt.delay)}),b._container.mouseover(function(){clearTimeout(c),c=0,b._show()}).mouseout(function(){c=setTimeout("Biojs.getInstance("+b.getId()+")._hide()",b.opt.delay)}),this._hide()},_hide:function(){this._container.hide()},_show:function(){this._container.show()},_setPosition:function(a,b){var c=this._arrow,d=this.opt.arrowType,e={top:a.top,left:a.left},f=this._body,g={};c.removeClass(),c.addClass("arrow "+d.match(/^(left|top|right|bottom)/g)[0]),d==Biojs.Tooltip.ARROW_LEFT_TOP?(e.top+=Math.floor(b.height/2)-Math.floor(c.height()/2),e.left+=c.width()+b.width,g.left=e.left+c.width()-1,g.top=e.top+Math.floor(c.height()/2)-Math.floor(f.height()/4)):d==Biojs.Tooltip.ARROW_LEFT_MIDDLE?(e.top+=Math.floor(b.height/2)-Math.floor(c.height()/2),e.left+=c.width()+b.width,g.left=e.left+c.width()-1,g.top=e.top+Math.floor(c.height()/2)-Math.floor(f.height()/2)):d==Biojs.Tooltip.ARROW_LEFT_BOTTOM?(e.top+=Math.floor(b.height/2)-Math.floor(c.height()/2),e.left+=c.width()+b.width,g.left=e.left+c.width()-1,g.top=e.top+Math.floor(c.height()/2)-Math.floor(.75*f.height())):d==Biojs.Tooltip.ARROW_TOP_LEFT?(e.top+=b.height,e.left+=Math.floor(b.width/2)-Math.floor(c.width()/2),g.left=e.left+Math.floor(c.height()/2)-Math.floor(f.width()/4),g.top=e.top+c.height()-1):d==Biojs.Tooltip.ARROW_TOP_MIDDLE?(e.top+=b.height,e.left+=Math.floor(b.width/2)-Math.floor(c.width()/2),g.left=e.left+Math.floor(c.height()/2)-Math.floor(f.width()/2),g.top=e.top+c.height()-1):d==Biojs.Tooltip.ARROW_TOP_RIGHT?(e.top+=b.height,e.left+=Math.floor(b.width/2)-Math.floor(c.width()/2),g.left=e.left+Math.floor(c.height()/2)-Math.floor(.75*f.width()),g.top=e.top+c.height()-1):d==Biojs.Tooltip.ARROW_RIGHT_TOP?(e.top+=Math.floor(b.height/2)-Math.floor(c.height()/2),e.left-=c.width(),g.left=e.left-f.outerWidth()+1,g.top=e.top+Math.floor(c.height()/2)-Math.floor(f.height()/4)):d==Biojs.Tooltip.ARROW_RIGHT_MIDDLE?(e.top+=Math.floor(b.height/2)-Math.floor(c.height()/2),e.left-=c.width(),g.left=e.left-f.outerWidth()+1,g.top=e.top+Math.floor(c.height()/2)-Math.floor(f.height()/2)):d==Biojs.Tooltip.ARROW_RIGHT_BOTTOM?(e.top+=Math.floor(b.height/2)-Math.floor(c.height()/2),e.left-=c.width(),g.left=e.left-f.outerWidth()+1,g.top=e.top+Math.floor(c.height()/2)-Math.floor(.75*f.height())):d==Biojs.Tooltip.ARROW_BOTTOM_LEFT?(e.top-=c.height(),e.left+=Math.floor(b.width/2)+Math.floor(c.width()/2),g.left=e.left+Math.floor(c.width()/2)-Math.floor(f.width()/4),g.top=e.top-f.outerHeight()+1):d==Biojs.Tooltip.ARROW_BOTTOM_MIDDLE?(e.top-=c.height(),e.left+=Math.floor(b.width/2)-Math.floor(c.width()/2),g.left=e.left+Math.floor(c.width()/2)-Math.floor(f.width()/2),g.top=e.top-f.outerHeight()+1):d==Biojs.Tooltip.ARROW_BOTTOM_RIGHT&&(e.top-=c.height(),e.left+=Math.floor(b.width/2)-Math.floor(c.width()/2),g.left=e.left+Math.floor(c.width()/2)-Math.floor(.75*f.width()),g.top=e.top-f.outerHeight()+1),this._arrow.css(e),this._body.css(g)},setArrowType:function(a){var b=a.match(/^(left|top|right|bottom)/g)[0];void 0!==b&&(this.opt.arrowType=a)},getArrowType:function(){return this.opt.arrowType},getIdentifier:function(){return this._container.attr("id")},setIdentifier:function(a){return this._container.attr("id",a)}},{ARROW_LEFT_TOP:"left_top",ARROW_LEFT_MIDDLE:"left_middle",ARROW_LEFT_BOTTOM:"left_bottom",ARROW_TOP_LEFT:"top_left",ARROW_TOP_MIDDLE:"top_middle",ARROW_TOP_RIGHT:"top_right",ARROW_RIGHT_TOP:"right_top",ARROW_RIGHT_MIDDLE:"right_middle",ARROW_RIGHT_BOTTOM:"right_bottom",ARROW_BOTTOM_LEFT:"bottom_left",ARROW_BOTTOM_MIDDLE:"bottom_middle",ARROW_BOTTOM_RIGHT:"bottom_right",EVT_ON_SHOW_UP:"onShowUp",MOUSE_POSITION:1,ELEMENT_POSITION:2}),Biojs.Tree=Biojs.extend({constructor:function(){var a=this;this._container=jQuery("#"+this.opt.target),this._container.ready(function(){a._initialize()})},opt:{show_lost_taxa:!1,tree_view:"",annotation_option:"annotation_grid",species_nodes:190,alignment_length:"",domains_file:"",json_tree:"",species_tree:"",image_path:"",newick_tree:"",tree_data:"",tree_target:"",max_annot_div_width:"",default_view:"ensembl",annot_target:"",no_genes:"",tree:"",highlight_gene:"",load_from_variable:void 0,load_from_web:void 0,json_tree_string:"",json_alignment_string:"",json_domain_string:"",root:"",show_real_branchlength:!1,alignment_font_size:8,sequence:"",id:"",target:"",format:"FASTA",selection:{start:0,end:0},columns:{size:35,spacedEach:10},highlights:[],annotations:[],sequenceUrl:"http://www.ebi.ac.uk/das-srv/uniprot/das/uniprot/sequence",modelTreeOn:"",duplication_circle_size:15,circle_size:3,sequence_rect_width:12,leaf_group_x:188,sequence_start_y:300,link_type:"elbow",leaf_space:"300",i:0,duration:500,two_window:!1,root:"",diagonal:"",fontSize:10,tree_representation_type:"not-radial",max_seq_representation:400,selectionColor:"Yellow",selectionFontColor:"black",highlightFontColor:"red",highlightBackgroundColor:"white",fontFamily:'"Andale mono", courier, monospace',fontSize:"12px",fontColor:"inherit",backgroundColor:"inherit",width:400,availablewidth:1500,height:void 0,formatSelectorVisible:!0},eventTypes:[],_headerDiv:null,_contentDiv:null,_initialize:function(){var a=this;this.padding={top:0,right:10,bottom:0,left:10},a.opt.two_window&&(this.opt.tree_target="tree_panel",this.opt.annot_target="annotation_panel"),jQuery('<div id="tree_panel" ></div><div id="annotation_panel" ></div>').appendTo("#"+this.opt.target),jQuery('<div id="tree_spinner"><img src="http://www.mapmatters.org/img/spinner_large.gif" alt="Loading tree" height="22" width="22">Loading tree data...</div>').appendTo("#"+this.opt.tree_target),jQuery('<div id="annotation_spinner"><img  src="http://www.mapmatters.org/img/spinner_large.gif" alt="Loading annotation" height="22" width="22">Loading annotation data...</div>').appendTo("#"+this.opt.annot_target),jQuery("#tree_spinner").hide(),jQuery("#annotation_spinner").hide(),this.tree_data=this.__readTree({load_from_variable:this.opt.load_from_variable,tree_format:this.opt.formatOptions.tree,tree_data:this.opt.json_tree,tree_data_variable:this.opt.json_tree_string,load_from_web:this.opt.load_from_web})},_setVisualSpace:function(a){{var b,c,d,e=(a.width,a.height),f=a.two_window,g=a.annot_div_width,h=this,i=[40,240,40,240],j=1e3-i[0]-i[0];1840-i[0]-i[2]}f?(b=d3.select("#"+h.opt.target).style("width"),div_heigth=parseInt(d3.select("#"+h.opt.target).style("height")),d=b.replace("px",""),d=parseInt(d/2),c=d+"px",Biojs.console.enable("half width is "+d+" ("+b+"), "+c)):(b=d3.select("#"+this.opt.target).style("width"),div_heigth=parseInt(d3.select("#"+this.opt.target).style("height"))),h.opt.div_width_half=d,Biojs.console.enable("heigth is "+div_heigth+" and width is "+b),h.opt.availablewidth=b;var j=window,k=document,l=k.documentElement,m=k.getElementsByTagName("body")[0],n=j.innerWidth||l.clientWidth||m.clientWidth,o=j.innerHeight||l.clientHeight||m.clientHeight;Biojs.console.enable("x: "+n+" y: "+o),Biojs.console.enable("setting height to "+2*e),h.opt.two_window?(this.opt.tree_panel=d3.select("#"+this.opt.tree_target).append("svg:svg").attr("class","svg_container").attr("width",d).attr("height",e).style("overflow","scroll").append("svg:g").attr("class","drawarea"),this.opt.tree_panel=this.opt.tree_panel.append("svg:g").attr("class","treearea").append("svg:g").attr("transform","translate("+i[3]+","+i[0]+")"),this.opt.annot_panel=d3.select("#"+this.opt.annot_target).append("svg:svg"),this.opt.annot_panel.append("svg:g").attr("class","axisarea"),Biojs.console.enable("annotation svg with: "+g),this.opt.annot_panel.attr("class","svg_container").attr("width",g).attr("height",e+200).attr("id","annotation_svg_container").style("overflow","auto").append("svg:g").attr("class","annot_area"),this.opt.annot_panel=this.opt.annot_panel.append("svg:g").attr("class","annotationarea").style("padding","20").append("svg:g").attr("transform","translate("+i[3]+","+i[0]+")")):(this.opt.vis=d3.select("#"+this.opt.target).append("svg:svg").attr("class","svg_container").attr("width",b).attr("height",e).append("svg:g").attr("class","drawarea"),this.opt.vis.append("svg:g").attr("class","axisarea"),this.opt.vis=this.opt.vis.append("svg:g").attr("class","treearea").append("svg:g").attr("transform","translate("+i[3]+","+i[0]+")"))},_setTreeSpace:function(a){{var b,c,d,e=(a.width,a.height),f=a.two_window,g=(a.annot_div_width,this),h=[40,240,40,240],i=1e3-h[0]-h[0];1840-h[0]-h[2]}f?(b=d3.select("#"+g.opt.target).style("width"),div_heigth=parseInt(d3.select("#"+g.opt.target).style("height")),d=b.replace("px",""),d=parseInt(d/2),c=d+"px",Biojs.console.enable("half width is "+d+" ("+b+"), "+c)):(b=d3.select("#"+this.opt.target).style("width"),div_heigth=parseInt(d3.select("#"+this.opt.target).style("height"))),g.opt.div_width_half=d,g.opt.availablewidth=b;var i=window,j=document,k=j.documentElement,l=j.getElementsByTagName("body")[0],m=i.innerWidth||k.clientWidth||l.clientWidth,n=i.innerHeight||k.clientHeight||l.clientHeight;Biojs.console.enable("x: "+m+" y: "+n),Biojs.console.enable("setting height to "+2*e),g.opt.two_window?(this.opt.tree_panel=d3.select("#"+this.opt.tree_target).append("svg:svg").attr("class","svg_container").attr("width",d).attr("height",e).style("overflow","scroll").append("svg:g").attr("class","drawarea"),this.opt.tree_panel=this.opt.tree_panel.append("svg:g").attr("class","treearea").append("svg:g").attr("transform","translate("+h[3]+","+h[0]+")")):(this.opt.vis=d3.select("#"+this.opt.target).append("svg:svg").attr("class","svg_container").attr("width",b).attr("height",e).append("svg:g").attr("class","drawarea"),this.opt.vis.append("svg:g").attr("class","axisarea"),this.opt.vis=this.opt.vis.append("svg:g").attr("class","treearea").append("svg:g").attr("transform","translate("+h[3]+","+h[0]+")"))},__slideZoom:function(a){Biojs.console.enable("ready to zoom-slide:"+a),zoom_slider({scale:[a]})},_addZoom:function(){var a=this;a.zoom_behavior=d3.behavior.zoom().scaleExtent([.5,2]).on("zoom",zoom),a.opt.two_window?(Biojs.console.enable("adding to annot"),d3.select("#"+this.opt.annot_target+" svg").call(a.zoom_behavior)):(Biojs.console.enable("not adding to annot"),d3.select("#"+this.opt.target+" svg").call(a.zoom_behavior))},__removeZoom:function(){self.zoom_behavior=d3.behavior.zoom().scaleExtent([.5,2]).on("zoom",null),d3.select("#"+this.opt.target+" svg").call(self.zoom_behavior)},__resetZoom:function(){var a=this;a.zoom_behavior=d3.behavior.zoom().scaleExtent([.5,2]).on("zoom",null),a.zoom_behavior.scale(1),a.zoom_behavior.translate([0,0]);var b=d3.select("#"+this.opt.target+" svg");b.transition().duration(500).attr("transform","translate("+zoom.translate()+") scale("+zoom.scale()+")")},__comparator:function(a,b){var c=a.children?a.name.replace(/_\d+/g,""):a.taxon,d=b.children?b.name.replace(/_\d+/g,""):b.taxon,e=new Object;e.Tetraodon_nigroviridis=0,e.Takifugu_rubripes=1,e.Tetraodontidae=2,e.Oreochromis_niloticus=3,e.Gasterosteus_aculeatus=4,e.Oryzias_latipes=5,e.Xiphophorus_maculatus=6,e.Atherinomorpha=7,e.Smegmamorpha=8,e.Percomorpha=9,e.Gadus_morhua=10,e.Holacanthopterygii=11,e.Danio_rerio=12,e.Clupeocephala=13,e.Tupaia_belangeri=14,e.Cavia_porcellus=15,e.Spermophilus_tridecemlineatus=16,e.Rattus_norvegicus=17,e.Mus_musculus=18,e.Murinae=19,e.Dipodomys_ordii=20,e.Sciurognathi=21,e.Rodentia=22,e.Oryctolagus_cuniculus=23,e.Ochotona_princeps=24,e.Lagomorpha=25,e.Glires=26,e.Otolemur_garnettii=27,e.Microcebus_murinus=28,e.Strepsirrhini=29,e.Nomascus_leucogenys=30,e.Pongo_abelii=31,e.Homo_sapiens=-3,e.Pan_troglodytes=-2,e.Gorilla_gorilla=-1,e.Homininae=0,e.Hominidae=36,e.Hominoidea=37,e.Macaca_mulatta=38,e.Catarrhini=39,e.Callithrix_jacchus=40,e.Simiiformes=41,e.Tarsius_syrichta=42,e.Haplorrhini=43,e.Primates=44,e.Euarchontoglires=-3,e.Procavia_capensis=46,e.Loxodonta_africana=47,e.Echinops_telfairi=48,e.Afrotheria=49,e.Pteropus_vampyrus=50,e.Myotis_lucifugus=51,e.Chiroptera=52,e.Equus_caballus=53,e.Vicugna_pacos=54,e.Bos_taurus=55,e.Sus_scrofa=56,e.Tursiops_truncatus=57,e.Cetartiodactyla=58,e.Felis_catus=59,e.Mustela_putorius_furo=60,e.Ailuropoda_melanoleuca=61,e.Canis_lupus_familiaris=62,e.Caniformia=63,e.Carnivora=64,e.Sorex_araneus=65,e.Erinaceus_europaeus=66,e.Insectivora=67,e.Laurasiatheria=68,e.Dasypus_novemcinctus=69,e.Choloepus_hoffmanni=70,e.Xenarthra=71,e.Eutheria=72,e.Monodelphis_domestica=73,e.Macropus_eugenii=74,e.Sarcophilus_harrisii=75,e.Metatheria=76,e.Theria=77,e.Ornithorhynchus_anatinus=78,e.Mammalia=79,e.Pelodiscus_sinensis=80,e.Anolis_carolinensis=81,e.Taeniopygia_guttata=82,e.Meleagris_gallopavo=83,e.Gallus_gallus=84,e.Phasianidae=85,e.Neognathae=86,e.Sauria=87,e.Sauropsida=88,e.Amniota=89,e.Xenopus_tropicalis=90,e.Tetrapoda=91,e.Latimeria_chalumnae=92,e.Sarcopterygii=93,e.Euteleostomi=94,e.Petromyzon_marinus=95,e.Vertebrata=96,e.Ciona_savignyi=97,e.Ciona_intestinalis=98,e.Ciona=99,e.Chordata=100,e.Strongylocentrotus_purpuratus=101,e.Deuterostomia=102,e.Lottia_gigantea=103,e.Capitella_teleta=104,e.Helobdella_robusta=105,e.Annelida=106,e.Lophotrochozoa=107,e.Ixodes_scapularis=108,e.Atta_cephalotes=109,e.Apis_mellifera=110,e.Aculeata=111,e.Nasonia_vitripennis=112,e.Apocrita=113,e.Drosophila_virilis=114,e.Drosophila_mojavensis=115,e.Drosophila=116,e.Drosophila_grimshawi=117,e.Drosophila_willistoni=118,e.Drosophila_pseudoobscura_pseudoobscura=119,e.Drosophila_persimilis=120,e.pseudoobscura_subgroup=121,e.Drosophila_yakuba=122,e.Drosophila_simulans=123,e.Drosophila_sechellia=124,e.Drosophila_melanogaster=125,e.Drosophila_erecta=126,e.melanogaster_subgroup=127,e.Drosophila_ananassae=128,e.melanogaster_group=129,e.Sophophora=130,e.Drosophila=131,e.Anopheles_darlingi=132,e.Anopheles_gambiae=133,e.Anopheles=134,e.Culex_quinquefasciatus=135,e.Aedes_aegypti=136,e.Culicinae=137,e.Culicidae=138,e.Diptera=139,e.Heliconius_melpomene=140,e.Danaus_plexippus=141,e.Nymphalidae=142,e.Bombyx_mori=143,e.Obtectomera=144,e.Tribolium_castaneum=145,e.Endopterygota=146,e.Pediculus_humanus_corporis=147,e.Acyrthosiphon_pisum=148,e.Paraneoptera=149,e.Neoptera=150,e.Daphnia_pulex=151,e.Pancrustacea=152,e.Arthropoda=153,e.Trichinella_spiralis=154,e.Pristionchus_pacificus=155,e.Bursaphelenchus_xylophilus=156,e.Meloidogyne_hapla=157,e.Tylenchida=158,e.Strongyloides_ratti=159,e.Heterorhabditis_bacteriophora=160,e.Caenorhabditis_briggsae_AF16=161,e.Caenorhabditis_japonica=162,e.Caenorhabditis_brenneri=163,e.Caenorhabditis_remanei=164,e.Caenorhabditis_elegans=165,e.Caenorhabditis=166,e.Rhabditoidea=167,e.Rhabditida=168,e.Chromadorea=169,e.Nematoda=170,e.Ecdysozoa=171,e.Protostomia=172,e.Schistosoma_mansoni=173,e.Bilateria=174,e.Nematostella_vectensis=175,e.Eumetazoa=176,e.Amphimedon_queenslandica=177,e.Trichoplax_adhaerens=178,e.Metazoa=179,e.Saccharomyces_cerevisiae_S288c=180,e["Schizosaccharomyces_pombe_972h-"]=181,e.Ascomycota=182,e.Proterospongia=183,e.Monosiga_brevicollis=184,e.Codonosigidae=185,e.Opisthokonta=186,e.Arabidopsis_thaliana=187,e.Eukaryota=188;var f=e[c]>e[d];return f},__redraw:function(a){a.vis;Biojs.console.enable("in zoom")},__readAnnotation:function(a){var b,c=this,d=a.load_from_variable,e=a.format,f=a.data_source,g=a.data_variable,h=a.load_from_web;if(Biojs.console.enable("load annotation from web is: "+d),d?(Biojs.console.enable("load from variable selected"),Biojs.console.enable(g),b=JSON.parse(g)):h&&(b=g),"json"==e){Biojs.console.enable("json selected");var i=f;Biojs.console.enable("loading annotation from "+i),jQuery.ajax({url:i,dataType:"json",async:!1,beforeSend:function(){jQuery("#annotation_spinner").show()},complete:function(){jQuery("#annotation_spinner").hide()},success:function(a){Biojs.console.enable("have result"),b=a,c.annotation_data=a,c.__update_annotation(b)},error:function(){alert("Failed to retrieve annotations from "+i)}})}return b},__readNHFormat:function(a){var b,c=a.result;Biojs.console.enable("have result");var d=newick.parse(c);Biojs.console.enable(d);var e=d3.layout.cluster().size([360,1]).sort(null).value(function(a){return a.length}).children(function(a){return a.branchset}).separation(function(){return 1});b=e(d);e.nodes(d);return b},__collapseTree:function(){var a,b=this;if(jQuery.each(b.selected_nodes,function(c,d){return d.name==b.opt.highlight_gene?(a=d,!1):void 0}),a)for(var c=a;parent=c.parent;)parent.children.forEach(function(a){return a.name===c.name?(c=parent,!1):void(a.children&&(a._collapsed_children=get_all_childs(a).length-1,a._children=a.children,a.children=null))}),c=parent;b.root=b.selected_nodes[0],b.____update_tree(b.selected_nodes[0]),b.__update_annotation()},__readTree:function(a){var b,c=this,d=a.load_from_variable,e=a.tree_format,f=a.tree_data,g=a.tree_data_variable,h=a.load_from_web;if(Biojs.console.enable("load from web is: "+h),d)Biojs.console.enable("load from variable selected"),Biojs.console.enable(g),"json"==e?b=JSON.parse(g):(Biojs.console.enable("read nh tree"),b=c.__readNHFormat({result:g}));else if(h)b=g;else if("json"==e)Biojs.console.enable("json selected"),jQuery.ajax({url:f,dataType:"json",beforeSend:function(){jQuery("#tree_spinner").show()},complete:function(){jQuery("#tree_spinner").hide()},success:function(a){if(Biojs.console.enable("have result"),b=a,c.root=b,c.all_data=b,c.____update_tree(b),c.opt.two_window)Biojs.console.enable("remove spinner"),jQuery("#tree_spinner").remove,$("#tree_spinner").remove(),c.domain_data=c.__readAnnotation({load_from_variable:c.opt.load_from_variable,format:"json",data_source:c.opt.domains_file,data_variable:c.opt.json_domain_string}),Biojs.console.enable("remove spinner"),jQuery("#annotation_spinner").remove,$("#annotation_spinner").remove();else{{rects.selectAll(".domain").data(function(a){return a.domains})}c.__update_annotation()}c.opt.highlight_gene&&c.__collapseTree()}});else{Biojs.console.enable("nh selected");var i="../../main/resources/dependencies/data/trees/life.txt";Biojs.console.enable("loading tree from "+i),jQuery.ajax({url:i,async:!1,success:function(a){return Biojs.console.enable("have result"),b=c.__readNHFormat({result:a})},error:function(){alert("Failed to retrieve annotations from "+i)}})}return Biojs.console.enable(b),b},_iterateTree:function(a){var b=this;for(var c in a){var d=a[c];"taxon"===c&&(Biojs.console.enable(d),"Homo_sapiens"==d&&(Biojs.console.enable("delete it"),delete d)),"object"==typeof d&&b._iterateTree(d)}return a},_clear_divs:function(){jQuery(".added_button").remove(),jQuery("#tree").empty(),jQuery("#tree_panel").empty(),jQuery("#annotation_panel").empty(),jQuery("#YourOwnDivId").empty(),Biojs.console.enable("cleared divs")},__showModelTree:function(){this.opt.modelTreeOn="on",Biojs.console.enable("model tree with "+full_tree.length),this.__update()},__showFullTree:function(a){this.opt.modelTreeOn="",Biojs.console.enable("full tree with "+a.length);var b=this.__readTree({load_from_variable:this.opt.load_from_variable,tree_format:this.opt.formatOptions.tree,tree_data:a,tree_data_variable:this.opt.json_tree_string,load_from_web:this.opt.load_from_web}),c=d3.layout.cluster(),d=c.nodes(b),e=(this.opt.tree.size,11*d.length);this.opt.tree.size([e,this.opt.div_width_half-this.opt.leaf_space]),d3.select("#"+this.opt.tree_target+" svg").style("height",e),this.__update(b)},__addAxis:function(a){var b=a.max_value,c=a.max_width;b+=20*b/100,Biojs.console.enable("adding axis :max_seq_length "+b+"  max_width:"+c+" max_value: "+b);var d=d3.scale.linear().domain([0,b]).range([0,this.opt.max_seq_representation]),e=d3.svg.axis().scale(d).orient("bottom");jQuery(".axis").remove(),d3.select(".axisarea").append("svg").attr("class","axis").attr("x",0).attr("y",0).attr("orient","top").call(e)},_highlightGeneData:function(a,b){Biojs.console.enable("looking at "+b.name);var c=b.name,d=d3.selectAll(".treearea").selectAll("g.node").filter(function(a){return a.taxon==c});jQuery.each(d,function(){var a=d3.select(this);a.name="ahhhhh"}),Biojs.console.enable("some test here")},_highlightSpeciesData:function(a,b){if(!b.children){var c=d3.select(a).select("svg circle");c.attr("r",6)}},_deHighlightSpeciesData:function(a,b){if(!b.children){var c=d3.select(a).select("svg circle");c.attr("r",0)}},__set_branchlengths:function(a,b){var c=this,d=c.opt.plottableDomain,e=c.opt.max_branch_length;b+=null!=a.branch_length&&"N/A"!=a.branch_length?0===a.branch_length?0:d(0===a.depth?parseFloat(.1*e):a.branch_length<.01?e:a.branch_length>2?e:a.branch_length):d(e),a.y=b;var f=b;a.children&&a.children.forEach(function(a){c.__set_branchlengths(a,f)})},__show_gene_annotation:function(){show_leaf_common_name({target:this.opt.target})},__show_uniprot_annotation:function(){show_leaf_uniprot({target:this.opt.target})},__toggleAll:function(a){a.children&&a.children.forEach(toggle)},__toggle:function(a){a.children?(a._children=a.children,a.children=null):(a.children=a._children,a._children=null)},__toggle_branchlength:function(){var a=jQuery(".annotation_panel .node");Biojs.console.enable("Found "+a.length+" nodes"),a.remove(),Biojs.console.enable("about to toggle branch length is: "+this.opt.show_real_branchlength),this.opt.show_real_branchlength=this.opt.show_real_branchlength?!1:!0,this.____update_tree()},__show_alignments:function(){this.opt.annotation_option="alignment",Biojs.console.enable("showing alignments now"),this.__update()},__show_domains:function(){for(var a=document.getElementsByClassName("annotationarea");a.firstChild;)a.removeChild(a.firstChild);this.opt.__show_alignments=!1,this.opt.__show_domains=!0,this.opt.annotation_option="domains",Biojs.console.enable("showing domains now"),this.__update()},__show_bootstrap:function(){d3.select("#"+this.opt.target+" svg").selectAll(".bootstrap").attr("visibility","")},__hide_bootstrap:function(){d3.select("#"+this.opt.target+" svg").selectAll(".bootstrap").attr("visibility","hidden")},__show_taxlevel:function(){d3.select("#"+this.opt.target+" svg").selectAll(".innerNode_label").attr("visibility","")},__hide_taxlevel:function(){d3.select("#"+this.opt.target+" svg").selectAll(".innerNode_label").attr("visibility","hidden")},____update_tree:function(){var a=this,b=this.root,c=0;this.opt.tree=d3.layout.cluster();var d=this.opt.tree,e=d.nodes(b).reverse();this.opt.height=11*e.length,this.opt.div_width=parseInt(d3.select("#"+this.opt.target).style("width")),a.opt.two_window&&(this.opt.__show_alignments?this.opt.max_annot_div_width=d3.max(a.alignment_data,function(a){return+a.alignment_length})*this.opt.alignment_font_size:(f=d3.select("#"+a.opt.target).style("width"),div_width_half=f.replace("px",""),div_width_half=parseInt(div_width_half/2),this.opt.div_width_half=div_width_half,this.opt.max_annot_div_width=div_width_half,this.opt.max_seq_representation=div_width_half)),$("#tree_panel svg").length||this._setVisualSpace({width:f,height:this.opt.height,two_window:a.opt.two_window,annot_div_width:this.opt.max_annot_div_width});var f,g=(this.opt.width-this.padding.left-this.padding.right,this.opt.height-this.padding.top-this.padding.bottom);a.opt.two_window?(f=parseInt(d3.select("#"+this.opt.tree_target).style("width")),this.opt.leaf_space=parseInt(f/4),this.opt.tree.separation(function(a,b){return a.parent===b.parent?4:4}).sort(this.__comparator).size([g,a.opt.div_width_half-this.opt.leaf_space])):(f=parseInt(d3.select("#"+this.opt.target).style("width"))-400,this.opt.leaf_space=parseInt(f/2),this.opt.tree.separation(function(a,b){return a.parent===b.parent?4:4}).size([g,f-this.opt.leaf_space])),this.opt.diagonal=d3.svg.diagonal().projection(function(a){return[a.y,a.x]}),a.opt.two_window?(Biojs.console.enable("domaincolors: opt.annot_panel"),this.__setDomainColors({target:this.opt.annot_panel})):(Biojs.console.enable("domaincolors: opt.vis"),this.__setDomainColors({target:this.opt.vis}));var h=d3.select(".treearea"),i=(d3.select(".treearea"),d3.select(".annotationarea")),e=this.opt.tree.nodes(b),j=e;if("json"==a.opt.formatOptions.tree?(Biojs.console.enable("using json in branch length test"),j=e.slice(0)):(Biojs.console.enable("well, selecting nodes and setting branch lengths"),j=e[0].slice(0)),a.selected_nodes=j,j=a.selected_nodes,e=a.selected_nodes,a.opt.show_real_branchlength){Biojs.console.enable("switched on real branch length"),"json"===!a.opt.formatOptions.tree&&(Biojs.console.enable("well, selecting nodes and setting branch lengths"),j=e[0].slice(0)),a.opt.plottable_tree_space=a.opt.div_width_half-a.opt.leaf_space,a.opt.max_branch_length=d3.max(j,function(a){return+a.branch_length}),a.opt.max_depth=d3.max(j,function(a){return+a.depth});var k=a.opt.max_depth*a.opt.max_branch_length;a.opt.plottableDomain=d3.scale.linear().domain([0,k]).range([0,a.opt.plottable_tree_space]),a.__set_branchlengths(j[0],0)}a.nodes=e,this.opt.domainScale=d3.scale.linear().domain([0,4e3]).range([0,400]),this.opt.divScale=d3.scale.linear().domain([0,5]).range([0,this.opt.availablewidth]);var l=h.selectAll("g.node").data(j,function(a){return a.id||(a.id=++c)});this.nodeEnter=l.enter().append("svg:g").attr("class","node").on("click",function(b){Biojs.console.enable("clicked!!!!"),Biojs.console.enable("clicked!!!!"),a._collapseNode(b)}).on("contextmenu",function(b){var c=(d3.mouse(this),document.getElementById("tree_panel").offsetLeft,document.getElementById("tree_panel").offsetTop,d3.event.x),d=d3.event.y;this.current_d=b,d3.select("#my_custom_menu").style("position","absolute").style("left",c+"px").style("top",d+"px").style("display","block"),a._buildContextMenu(b),d3.event.preventDefault()}).on("mouseover",function(b){var c=this;a._highlightSpeciesData(c,b)}).on("mouseout",function(b){var c=this;a._deHighlightSpeciesData(c,b)});var m=h.selectAll("path.link").data(d.links(e),function(a){return a.source.id+"-"+a.target.id});draw_nodes({nodeEnter:this.nodeEnter,node:l,source:a.tree_data,circle_size:this.opt.circle_size,tree_representation_type:this.opt.tree_representation_type,availablewidth:this.opt.availablewidth});var n="reconciledView"==a.opt.tree_view?!0:!1;set_links({link:m,link_type:this.opt.link_type,duration:this.opt.duration,species_silhouette:n});var o=get_subtree_color_data({nodeEnter:this.nodeEnter,highlight_gene:this.opt.highlight_gene,target:this.opt.target});jQuery(".clade_tax_rect").remove();var p=color_subtrees({subtree_colors:o,target:this.opt.target});this._addLegend({target:"legend_panel",legend_dictionary:p}),"reconciledView"==a.opt.tree_view&&a.____showSpeciesTreeSilhouette({annot_target:i});get_gene_color_stats({nodeEnter:this.nodeEnter,highlight_gene:this.opt.highlight_gene,target:this.opt.target});jQuery(".tax_color_rect").remove();draw_circles({nodeEnter:this.nodeEnter,circle_size:this.opt.circle_size}),draw_images({nodeEnter:this.nodeEnter,image_path:this.opt.image_path}),draw_taxon_names({nodeEnter:this.nodeEnter,show_taxa:this.opt.show_taxa,highlight_gene:this.opt.highlight_gene,default_view:this.opt.default_view}),draw_bootstraps({nodeEnter:this.nodeEnter,visibility:"hidden"});a.__setTooltips()},__update:function(a){var b=this,c=a,d=d3.select(".treearea"),e=(d3.select(".treearea"),d3.select(".annotationarea")),f=0;this.opt.tree=d3.layout.cluster();var g,h=this.opt.tree,i=h.nodes(c);"json"==b.opt.formatOptions.tree?(Biojs.console.enable("using json in branch length test"),g=i.slice(0)):(Biojs.console.enable("well, selecting nodes and setting branch lengths"),g=i[0].slice(0),b.__set_branchlengths(g[0],0)),b.selected_nodes=g,i=g,b.nodes=i,b.opt.show_real_branchlength&&(Biojs.console.enable("switched on real branch length"),b.__set_branchlengths(i[0],0)),b.opt.two_window&&(Biojs.console.enable("remove spinner"),jQuery("#tree_spinner").remove,jQuery("#annotation_spinner").remove,$("#tree_spinner").remove(),$("#annotation_spinner").remove());this.__get_max_values(),this.opt.annotation_option&&"speciestree"!=this.opt.annotation_option&&this.opt.two_window&&this.__addAxis({max_value:this.opt.max_value,max_width:this.opt.max_width}),this.opt.domainScale=d3.scale.linear().domain([0,this.opt.max_seq_length]).range([0,this.opt.max_seq_representation]),this.opt.divScale=d3.scale.linear().domain([0,5]).range([0,this.opt.availablewidth]);var j=d.selectAll("g.node").data(h.nodes(c),function(a){return a.id||(a.id=++f)});this.nodeEnter=j.enter().append("svg:g").attr("class","node").on("click",function(a){Biojs.console.enable("uff, clicked"),b._focus(a)});var k=d.selectAll("path.link").data(h.links(i),function(a){return a.source.id+"-"+a.target.id});draw_nodes({nodeEnter:this.nodeEnter,node:j,source:b.tree_data,circle_size:this.opt.circle_size,tree_representation_type:this.opt.tree_representation_type,availablewidth:this.opt.availablewidth});var l="reconciledView"==b.opt.tree_view?!0:!1;set_links({link:k,link_type:this.opt.link_type,duration:this.opt.duration,species_silhouette:l});var m=get_subtree_color_data({nodeEnter:this.nodeEnter,highlight_gene:this.opt.highlight_gene,target:this.opt.target});jQuery(".clade_tax_rect").remove();var n=color_subtrees({subtree_colors:m,target:this.opt.target});this._addLegend({target:"legend_panel",legend_dictionary:n}),"reconciledView"==b.opt.tree_view&&b.____showSpeciesTreeSilhouette({annot_target:e});get_gene_color_stats({nodeEnter:this.nodeEnter,highlight_gene:this.opt.highlight_gene,target:this.opt.target});jQuery(".tax_color_rect").remove();draw_circles({nodeEnter:this.nodeEnter,circle_size:this.opt.circle_size}),draw_images({nodeEnter:this.nodeEnter,image_path:this.opt.image_path}),draw_taxon_names({nodeEnter:this.nodeEnter,show_taxa:this.opt.show_taxa,highlight_gene:this.opt.highlight_gene,default_view:this.opt.default_view}),draw_bootstraps({nodeEnter:this.nodeEnter,visibility:"hidden"});if(Biojs.console.enable("showing annotation: "+this.opt.annotation_option),"speciestree"==this.opt.annotation_option)Biojs.console.enable("showing speciestree"),b.__showSpeciesTree({annot_target:e});else if("alignment"==this.opt.annotation_option||"domains"==this.opt.annotation_option||"seq_domains"==this.opt.annotation_option){var o=b.__getNodeIndices({selected_nodes:g});switch(this.opt.annotation_option){case"alignment":Biojs.console.enable("adding alignment"),b.__showAlignments({nodeindex:o,annot_target:e});break;case"domains":Biojs.console.enable("adding domains"),b.__showDomains({nodeindex:o,annot_target:e});break;case"seq_domains":Biojs.console.enable("adding seq_domains"),b.__showSeqDomains({nodeindex:o,annot_target:e});break;default:Biojs.console.enable("no annotation selected")}}b.__setTooltips()},__update_annotation:function(){var a=this,b=a.annotation_data,c=(d3.select(".treearea"),d3.select(".treearea"),d3.select(".annotationarea"));a.domain_data=b;if(this.__get_max_values({annotation:b}),this.opt.annotation_option&&"speciestree"!=this.opt.annotation_option&&this.opt.two_window&&this.__addAxis({max_value:this.opt.max_value,max_width:this.opt.max_width}),this.opt.domainScale=d3.scale.linear().domain([0,this.opt.max_seq_length]).range([0,this.opt.max_seq_representation]),this.opt.divScale=d3.scale.linear().domain([0,5]).range([0,this.opt.availablewidth]),Biojs.console.enable("showing annotation: "+this.opt.annotation_option),"speciestree"==this.opt.annotation_option)Biojs.console.enable("showing speciestree"),a.__showSpeciesTree({annot_target:c});else if("alignment"==this.opt.annotation_option||"domains"==this.opt.annotation_option||"annotation_grid"==this.opt.annotation_option||"seq_domains"==this.opt.annotation_option){var d=a.__getNodeIndices({selected_nodes:this.nodes});switch(this.opt.annotation_option){case"alignment":Biojs.console.enable("adding alignment"),a.__showAlignments({nodeindex:d,annot_target:c});break;case"domains":Biojs.console.enable("adding domains"),a.__showDomains({nodeindex:d,annot_target:c});break;case"seq_domains":Biojs.console.enable("adding seq_domains"),a.__showSeqDomains({nodeindex:d,annot_target:c});
break;case"annotation_grid":Biojs.console.enable("adding annotation_grid"),a.__showAnnotationGrid({nodeindex:d,annot_target:c});break;default:Biojs.console.enable("no annotation selected")}}a.__setTooltips()},__get_max_values:function(a){var b=a.annotation;this.opt.two_window?this.opt.annotation_option&&("seq_domains"==this.opt.annotation_option?(this.opt.max_value=d3.max(b,function(a){return+a.alignment_length}),this.opt.max_width=this.opt.max_value,this.opt.max_seq_length=this.opt.max_value):(this.opt.max_width=d3.max(b,function(a){return+a.seq_length}),this.opt.max_value=this.opt.max_width,this.opt.max_seq_length=this.opt.max_width)):(this.opt.max_width=d3.max(b,function(a){return+a.seq_length}),this.opt.max_value=this.opt.max_value,this.opt.max_seq_length=this.opt.max_width)},__getNodeIndices:function(a){for(var b=a.selected_nodes,c=new Object,d=0;d<b.length;d++){var e=b[d],f=e.name,g=e.x;c[f]=g}return c.length<1&&Biojs.console.enable("could not map annotations"),c},__showAlignments:function(a){var b=a.nodeindex,c=a.annot_target,d=this;Biojs.console.enable("nodeindex is: "),Biojs.console.enable(b);var e=c.selectAll("g.node").data(d.alignment_data);e.exit().remove(),this.annot_nodeEnter=e.enter().append("svg:g").filter(function(a){return b.hasOwnProperty(a.name)}).attr("class","node").on("mouseover",function(a){var b=this;d._highlightSpeciesData(b,a)}).on("mouseout",function(a){var b=this;d._deHighlightSpeciesData(b,a)}),d.opt.two_window&&(this.nodeEnter=this.annot_nodeEnter),draw_nodes({two_window:d.opt.two_window,nodeEnter:this.nodeEnter,nodeindex:b,node:e,source:d.tree_data,tree_representation_type:this.opt.tree_representation_type});var f=this.nodeEnter.selectAll("text").data(function(a){return a.sequence});this.aligned_sequences=draw_alignment_sequences({alignment_patterns:f,domainScale:this.opt.domainScale,leaf_group_x:this.opt.leaf_group_x,sequence_start_y:this.opt.sequence_start_y,two_window:this.opt.two_window,nodeindex:b,alignment_font_size:this.opt.alignment_font_size,visibility:""})},__showAnnotationGrid:function(a){var b=a.nodeindex,c=(a.annot_target,this);Object.size=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c};var d=(Object.size(b),"<table>");jQuery.each(c.annotation_data,function(a,b){d+="<tr>",b.xref&&(d+=b.xref.protein_id?"<td>"+b.xref.protein_id+"</td>":"<td></td>",d+=b.xref.sf_name?"<td>"+b.xref.sf_name+"</td>":"<td></td>",d+=b.xref.definition?"<td>"+b.xref.definition+"</td>":"<td></td>",d+=b.xref.gene_id?"<td>"+b.xref.gene_id+"</td>":"<td></td>",d+=b.xref.molecular_function?"<td>"+b.xref.molecular_function+"</td>":"<td></td>",d+=b.xref.biological_process?"<td>"+b.xref.biological_process+"</td>":"<td></td>",d+=b.xref.cellular_component?"<td>"+b.xref.cellular_component+"</td>":"<td></td>",d+=b.xref.protein_class?"<td>"+b.xref.protein_class+"</td>":"<td></td>"),d+="</tr>"}),d+="</table>",jQuery(d).appentTo("#annotation_panel")},__showSeqDomains:function(a){var b=a.nodeindex,c=a.annot_target,d=this;Object.size=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c};var e=Object.size(b),f={};Biojs.console.enable("looking at the domains, nodeindex: "+e),Biojs.console.enable(d.domain_data);var g,f={};jQuery.each(d.domain_data,function(a,b){var c=0,d=1,e=[];if(b.cigar_string)for(var g=0,h=b.cigar_string.match(/(\d*\w)/g),i=0;i<h.length;i++){var j,k=h[i].match(/(\d*)(\w)/),l=k[2];if(j=k[1]?parseInt(k[1]):1,"d"===l.toLowerCase()&&(c+=j),"m"===l.toLowerCase()){for(var m=0;j>m;m++){void 0===f[b.name]&&(f[b.name]={});var n=m+d;f[b.name][n]=c+n}d+=j,e.push({type:l,length:j,offset:g})}g+=j}b.domains&&jQuery.each(b.domains,function(a,c){void 0!==f[b.name]&&(c.domain_start=f[b.name][c.domain_start],c.domain_stop=f[b.name][c.domain_stop])}),b.cigar_array=e}),this.opt.cigarScale=d3.scale.linear().domain([0,this.opt.max_value]).range([0,this.opt.max_seq_representation]);var h=c.selectAll("g.node").data(d.domain_data);this.annot_nodeEnter=h.enter().append("svg:g").filter(function(a){return Biojs.console.enable(b.hasOwnProperty(a.name)?"take "+a.name:"could not map "+a.name),b.hasOwnProperty(a.name)}).attr("class","node").on("mouseover",function(a){var b=this;d._highlightSpeciesData(b,a)}).on("mouseout",function(a){var b=this;d._deHighlightSpeciesData(b,a)}),h.exit().remove(),d.opt.two_window&&(this.nodeEnter=this.annot_nodeEnter);var g=this.opt.max_value;draw_nodes({two_window:d.opt.two_window,nodeEnter:this.nodeEnter,nodeindex:b,node:h,source:d.tree_data,tree_representation_type:this.opt.tree_representation_type});{var i=draw_cigar_borders({nodeEnter:this.nodeEnter,domainScale:this.opt.cigarScale,leaf_group_x:this.opt.leaf_group_x+2,sequence_start_y:this.opt.sequence_start_y,two_window:this.opt.two_window,nodeindex:b,visibility:"",alignment_length:g}),j=i.selectAll(".cigar_rect").data(function(a){return a.cigar_array}),k=(draw_cigar_sequences({domains:j,domainScale:this.opt.cigarScale,leaf_group_x:this.opt.leaf_group_x+4,sequence_rect_width:this.opt.sequence_rect_width-4,sequence_start_y:this.opt.sequence_start_y,two_window:this.opt.two_window,nodeindex:b,visibility:""}),i.selectAll(".domain").data(function(a){return a.domains}));i.selectAll(".leaf_label")}this.all_domains=draw_domains({domains:k,sequence_start_y:this.opt.sequence_start_y,domainScale:this.opt.cigarScale,sequence_rect_width:this.opt.sequence_rect_width,two_window:this.opt.two_window,leaf_group_x:this.opt.leaf_group_x,domain_colors:this.opt.domain_colors,visibility:""})},__showDomains:function(a){var b=a.nodeindex,c=a.annot_target,d=this;Object.size=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c};var e=(Object.size(b),c.selectAll("g.node").data(d.domain_data));this.annot_nodeEnter=e.enter().append("svg:g").filter(function(a){return b.hasOwnProperty(a.name)}).attr("class","node").on("mouseover",function(a){var b=this;d._highlightSpeciesData(b,a)}).on("mouseout",function(a){var b=this;d._deHighlightSpeciesData(b,a)}),e.exit().remove(),d.opt.two_window&&(this.nodeEnter=this.annot_nodeEnter),draw_nodes({two_window:d.opt.two_window,nodeEnter:this.nodeEnter,nodeindex:b,node:e,source:d.tree_data,tree_representation_type:this.opt.tree_representation_type});var f=draw_sequences({nodeEnter:this.nodeEnter,domainScale:this.opt.domainScale,leaf_group_x:this.opt.leaf_group_x,sequence_start_y:this.opt.sequence_start_y,two_window:this.opt.two_window,nodeindex:b,visibility:""});Biojs.console.enable("after sequence drawn");{var g=f.selectAll(".domain").data(function(a){return a.domains});f.selectAll(".leaf_label")}Biojs.console.enable("setting domainscale to "+this.opt.max_seq_length),this.opt.domainScale=d3.scale.linear().domain([0,this.opt.max_seq_length]).range([0,this.opt.max_seq_representation]),Biojs.console.enable(" after domainscale"),this.all_domains=draw_domains({domains:g,sequence_start_y:this.opt.sequence_start_y,domainScale:this.opt.domainScale,sequence_rect_width:this.opt.sequence_rect_width,two_window:this.opt.two_window,leaf_group_x:this.opt.leaf_group_x,domain_colors:this.opt.domain_colors,visibility:""})},____showSpeciesTreeSilhouette:function(a){var b=a.annot_target,c=!1,d="species_link",e=0;Biojs.console.enable("before reading tree"),this.species_tree_data=this.__readTree({load_from_variable:this.opt.load_from_variable,tree_format:this.opt.formatOptions.tree,tree_data:this.opt.species_tree,tree_data_variable:this.opt.json_tree_string,load_from_web:this.opt.load_from_web});var f=d3.layout.cluster(),g=f.nodes(this.species_tree_data),h=11*g.length;jQuery("#annotation_svg_container").height(h),Biojs.console.enable("d3.layout.cluster: "+h+", "+this.opt.div_width_half+"-"+this.opt.leaf_space);var i=this.opt.div_width_half-this.opt.leaf_space,j=d3.layout.cluster().separation(function(a,b){return a.parent===b.parent?4:4}).size([h,i]);Biojs.console.enable("read tree"),Biojs.console.enable(this.species_tree_data);var k=j.nodes(this.species_tree_data),l=b.selectAll("g.node").data(k,function(a){var b=a.id||(a.id=++e);return b});this.speciesnodeEnter=l.enter().append("svg:g").attr("class","node"),draw_nodes({nodeEnter:this.speciesnodeEnter,node:l,source:this.species_tree_data,right2left:c,circle_size:this.opt.circle_size,tree_representation_type:this.opt.tree_representation_type,availablewidth:this.opt.div_width_half});var m=b.selectAll("path."+d).data(j.links(k),function(a){return a.target.id});set_links({link:m,link_type:this.opt.link_type,duration:this.opt.duration,right2left:c,availablewidth:this.opt.div_width_half,species_silhouette:!0,class_type:d,opacity:.3,node_thickness:30})},__showSpeciesTree:function(a){var b=a.annot_target,c="species_link",d=!0,e=this;Biojs.console.enable("before reading tree"),this.species_tree_data=this.__readTree({load_from_variable:this.opt.load_from_variable,tree_format:this.opt.formatOptions.tree,tree_data:this.opt.species_tree,tree_data_variable:this.opt.json_tree_string,load_from_web:this.opt.load_from_web});var f=5*this.opt.species_nodes;jQuery("#annotation_svg_container").height(f),Biojs.console.enable("d3.layout.cluster: "+f+", "+this.opt.div_width_half+"-"+this.opt.leaf_space);var g=this.opt.div_width_half-this.opt.leaf_space,h=d3.layout.cluster().separation(function(a,b){return a.parent===b.parent?1:1}).size([f,g]);Biojs.console.enable("read tree"),Biojs.console.enable(this.species_tree_data);var i={},j=[];e._getGTNodeInfo({speciesNode2Path:j,geneNode2Coordinate:i});var k=h.nodes(this.species_tree_data),l=0,m=b.selectAll("g.node").data(k,function(a){return a.id||(a.id=++l)});this.speciesnodeEnter=m.enter().append("svg:g").attr("class","node").on("mouseover",function(a){var b=this;e._highlightGeneData(b,a)}),draw_nodes({nodeEnter:this.speciesnodeEnter,node:m,source:this.species_tree_data,right2left:d,circle_size:this.opt.circle_size,tree_representation_type:this.opt.tree_representation_type,availablewidth:this.opt.div_width_half});var n=b.selectAll("path.link").data(h.links(k),function(a){return a.target.id});set_links({link:n,link_type:this.opt.link_type,duration:this.opt.duration,right2left:d,availablewidth:this.opt.div_width_half,class_type:c,genePresence:i});var i=(draw_circles({nodeEnter:this.speciesnodeEnter,circle_size:this.opt.circle_size}),draw_taxon_names({nodeEnter:this.speciesnodeEnter,show_taxa:this.opt.show_taxa,right2left:d,highlight_gene:this.opt.highlight_gene,model_organisms:this.opt.model_organisms,genePresence:i}),{}),j=[];e.selected_nodes.forEach(function(a){var b={y:a.y,x:a.x};i[a.taxon]=b})},_getGTNodeInfo:function(a){{var b=this,c=a.geneNode2Coordinate;a.speciesNode2Path}b.selected_nodes.forEach(function(a){var b={y:a.y,x:a.x};c[a.taxon]=b})},__setTooltips:function(){add_tipsy({where:".leaf_label",default_view:this.opt.default_view}),add_tipsy({where:".domain",default_view:this.opt.default_view}),add_tipsy({where:".clade_tax_rect",default_view:this.opt.default_view})},__setControls:function(){},__setDomainColors:function(a){var b=a.target;Biojs.console.enable("set domain colors to: "+b);var c=new Object;c[0]="domain_gradient",c[1]="domain_gradient2",c[2]="domain_gradient3",c[3]="domain_gradient4",c[4]="domain_gradient5",c[5]="domain_gradient6";var d=b.append("svg:defs").append("svg:linearGradient").attr("id","line_gradient").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("x1","0").attr("y1","0").attr("x2","2").attr("y2","0").attr("gradientTransform","matrix(1,0,0,1,0,0)");d.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","0%").attr("stop-color","#999999"),d.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","40%").attr("stop-color","#eeeeee"),d.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","60%").attr("stop-color","#cccccc"),d.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","100%").attr("stop-color","#999999");var e=b.append("svg:defs").append("svg:linearGradient").attr("id","domain_gradient").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("x1","0").attr("y1","1").attr("x2","6.12").attr("y2","0").attr("gradientTransform","matrix(1,0,0,1,0,0)");e.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","0%").attr("stop-color","#FF8585"),e.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","50%").attr("stop-color","#7a1e74"),e.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","60%").attr("stop-color","#7a1e74"),e.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","100%").attr("stop-color","#ffffff");var f=b.append("svg:defs").append("svg:linearGradient").attr("id","domain_gradient2").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("x1","0").attr("y1","1").attr("x2","6.12").attr("y2","0").attr("gradientTransform","matrix(1,0,0,1,0,0)");f.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","0%").attr("stop-color","#0099CC"),f.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","50%").attr("stop-color","#7a1e74"),f.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","60%").attr("stop-color","#7a1e74"),f.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","100%").attr("stop-color","#ffffff");var g=b.append("svg:defs").append("svg:linearGradient").attr("id","domain_gradient3").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("x1","0").attr("y1","1").attr("x2","6.12").attr("y2","0").attr("gradientTransform","matrix(1,0,0,1,0,0)");g.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","0%").attr("stop-color","#CCF2CC"),g.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","50%").attr("stop-color","#7a1e74"),g.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","60%").attr("stop-color","#7a1e74"),g.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","100%").attr("stop-color","#ffffff");var h=b.append("svg:defs").append("svg:linearGradient").attr("id","domain_gradient4").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("x1","0").attr("y1","1").attr("x2","6.12").attr("y2","0").attr("gradientTransform","matrix(1,0,0,1,0,0)");h.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","0%").attr("stop-color","#14101f"),h.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","50%").attr("stop-color","#7a1e74"),h.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","60%").attr("stop-color","#7a1e74"),h.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","100%").attr("stop-color","#ffffff");var i=b.append("svg:defs").append("svg:linearGradient").attr("id","domain_gradient5").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("x1","0").attr("y1","1").attr("x2","6.12").attr("y2","0").attr("gradientTransform","matrix(1,0,0,1,0,0)");i.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","0%").attr("stop-color","#623e32"),i.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","50%").attr("stop-color","#7a1e74"),i.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","60%").attr("stop-color","#7a1e74"),i.append("svg:stop").attr("webkit-tap-highlight-color","rgba(0, 0, 0, 0)").attr("offset","100%").attr("stop-color","#ffffff"),this.opt.domain_colors=c},_collapseNode:function(a){Biojs.console.enable("collapsing "+a.name),a.children?(a._collapsed_children=get_all_childs(a).length-1,a._children=a.children,a.children=null):(a.children=a._children,a._children=null),this.____update_tree(a),this.__update_annotation(a)},__expandNode:function(){},__getMaxSeqLength:function(a){var b,c=a.leaves;Biojs.console.enable("looking at "+c.length+" leaves");for(var d=0;d<c.length;d++){Biojs.console.enable("first leaf is: "),Biojs.console.enable(c[d]),Biojs.console.enable(c[d].seq_length);var e=c[d].seq_length;e>=b&&(b=e)}return b},__setModelOrganisms:function(){var a=new Object;a.Homo_sapiens="red",a.Pan_troglodytes="red",a.Mus_musculus="blue",a.Xenopus_tropicalis="blue",a.Gallus_gallus="blue",a.Drosophila_melanogaster="blue",a.Arabidopsis_thaliana="blue",a.Caenorhabditis_elegans="blue",this.opt.model_organisms=a},_pruneTree:function(a){for(var b=this,c=(new Object,new Array,a.length);c>=0;c--)if(a[c]){var d=a[c],e=a[c].name,f=d.parent,g=a[c].taxon;if(Biojs.console.enable("Looking at node: "+e+" taxon: "+g),d.children||Biojs.console.enable("is a leaf"),!b.opt.model_organisms[g]&&!d.children){var f=d.parent;("undefined"==typeof f.children2hide||0==f.children2hide.length)&&(f.children2hide={}),f.children2hide[e]=1,a.splice(c,1)}if(Biojs.console.enable("is a innerNode"),Biojs.console.enable(d.children2hide),Biojs.console.enable(d.children2add),d.children2hide){d._children=d.children;var h,i=0;for(h in d.children2hide)d.children2hide.hasOwnProperty(h)&&i++;if(i==d.children.length&&"undefined"!=typeof d.parent)Biojs.console.enable("hide all children"),d.children=null,("undefined"==typeof f.children2hide||0==f.children2hide.length)&&(f.children2hide={}),Biojs.console.enable("splice current node from selected nodes"),f.children2hide[e]=1;else{for(var j=d.children.slice(0),k=0;k<d.children.length;k++){var l=(d.children[k],d.children[k].name);Biojs.console.enable("looking at child: "+l),d.children2hide[l]&&(Biojs.console.enable("slicing it no: "+k+" out!"),j.splice(k,1))}d.children=j.slice(0)}}if(d.children2add){var m=0;for(h in d.children2add)d.children2add.hasOwnProperty(h)&&m++;d.children="undefined"!=typeof d.children&&d.children instanceof Array?d.children:[];for(h in d.children2add)d.children.push(d.children2add[h])}"undefined"!=typeof d.children&&d.children instanceof Array&&(Biojs.console.enable("now we have: "+d.children.length+" nodes"),1==d.children.length&&"undefined"!=typeof d.parent&&(("undefined"==typeof f.children2add||0==f.children2add.length)&&(f.children2add={}),f.children2add[d.children[0].name]=d.children[0],Biojs.console.enable("wow, just one child. tell my parent to hide/ignore this inner node!"),("undefined"==typeof f.children2hide||0==f.children2hide.length)&&(f.children2hide={}),f.children2hide[e]=1,Biojs.console.enable("splice current node from selected nodes"),a.splice(c,1)))}else Biojs.console.enable("could not look at node "+c);Biojs.console.enable("done with the nodes")},_focus:function(a){var b=this;b.root=b.current_d?b.current_d:a,b.____update_tree()},_reset_tree:function(){var a=this;this.root=this.all_data,a.____update_tree(),a.__update_annotation()},_prune:function(a,b){for(var c=this,d=0;d<a.length;++d){var e=a[d];if(e.label===b)return a.splice(d,1),!0;if(e.children&&c._prune(e.children,b))return 0===e.children.length&&(delete e.children,a.splice(d,1)),!0}},_addLegend:function(a){var b=a.target,c=a.legend_dictionary,d="<svg xmlns='http://www.w3.org/2000/svg' version='1.1'>";for(var e in c)Biojs.console.enable("<span style='background-color:"+c[e]+"'>"+e+"</span><br>"),d+="<rect width='10' height='5'  style='fill:"+c[e]+";stroke-width:1;stroke:rgb(0,0,0)'/><text>"+e+"</text>";d+="</svg>",jQuery("#"+b).html(d),Biojs.console.enable("added to #legend_panel: "+d)},_buildContextMenu:function(){jQuery('<li class="context-menu-item icon icon-cut"><span>Information: </span></li>').appendTo("#my_custom_menu ul"),jQuery("<li class=\"context-menu-item icon icon-cut\"><a id='collapseNode' href='#' onclick=self._collapseNode()<span>collapse: </span></a></li>").appendTo("#my_custom_menu ul"),jQuery("<li class=\"context-menu-item icon icon-cut\"><a id='focus' href='#' <span id='focus'>focus on this node: </span></a></li>").appendTo("#my_custom_menu ul")},_buildDivs:function(){var a=this;jQuery(' internal nodes: <a href="#" onclick="show_internal_text();return false"><img class="added_button" style="width: 24px; height: 24px;" src="http://dev.treefam.org/static/images/tree_controls/branchlength_onoff_active.svg.png" title="show/ hide internal-node labels"></a><a href="#" onclick="hide_internal_text();return false"><img class="gwt-Image added_button" style="width: 24px; height: 24px;" src="http://dev.treefam.org/static/images/tree_controls/branchlength_onoff_disabled.svg.png" title="show/ hide leaf-node labels"></a><a href="#" onclick="__show_bootstrap();return false"><img class="hide_domains added_button" style="width: 24px; height: 24px;" src="http://dev.treefam.org/static/images/tree_controls/bootstrap_onoff_active.svg.png" title="show bootstrap values"></a><a href="#" onclick="__hide_bootstrap();return false"><img class="hide_domains added_button" style="width: 24px; height: 24px;" src="http://dev.treefam.org/static/images/tree_controls/bootstrap_onoff_disabled.svg.png" title="hide bootstrap values"></a>leaves: <a href="#" onclick="show_leaf_common_name();return false"><img class="hide_domains dotted_line added_button" style="height: 25px;" src="http://dev.treefam.org/static/images/tree_controls/leaflabel_align_disabled.svg.png" title="show common names"></a><a href="#" onclick="show_leaf_taxa();return false"><img class="hide_domains added_button" style="width: 24px; height: 24px;" src="http://dev.treefam.org/static/images/tree_controls/leaflabel_align_disabled.svg.png" title="show taxa names"></a><a href="#" onclick="show_leaf_uniprot();return false"><img class="hide_domains added_button" style="height: 40px;" src="http://dev.treefam.org/static/images/uniprot_logo.jpeg" title="show Uniprot links"></a>').appendTo("#tv_controls"),Biojs.console.enable("finished building div"),jQuery("img.increase_font").click(function(){a.opt.fontSize=parseInt(a.opt.fontSize)+1+"px",d3.select("svg").selectAll(".text").attr("font-size",function(){return a.opt.fontSize})}),jQuery("img.decrease_font").click(function(){a.opt.fontSize=parseInt(a.opt.fontSize)-1+"px",d3.select("svg").selectAll(".text").attr("font-size",function(){return a.opt.fontSize})})},_setTaxaToShow:function(){var a=new Object;a.Metazoa=1,a.Bilateria=1,a.Mammalia=1,a.Dipteria=1,a.Primates=1,a.Arabidopsis_thaliana=1,this.opt.show_taxa=a},__drawProteinDomains:function(){Biojs.console.enable("drawing protein domains");{var a=draw_sequences({nodeEnter:this.nodeEnter,domainScale:this.opt.domainScale,leaf_group_x:this.opt.leaf_group_x,sequence_start_y:this.opt.sequence_start_y,visibility:""}),b=a.selectAll(".domain").data(function(a){return a.domains});draw_domains({domains:b,sequence_start_y:this.opt.sequence_start_y,domainScale:this.opt.domainScale,sequence_rect_width:this.opt.sequence_rect_width,leaf_group_x:this.opt.leaf_group_x,domain_colors:this.opt.domain_colors,visibility:""})}}},{EVT_ON_SELECTION_CHANGE:"onSelectionChange",EVT_ON_SELECTION_CHANGED:"onSelectionChanged",EVT_ON_ANNOTATION_CLICKED:"onAnnotationClicked"}),Biojs.UniProtDiseaseSummary=Biojs.extend({constructor:function(){this.setUniProtDasUrl(this.opt.uniProtDasUrl),this._component_wrapper_id="UDS_component_wrapper"},setUniProtDasUrl:function(a){var b=this;b._clearHtmlTemplate(),b._url,b._url=""!=b.opt.proxyUrl?b.opt.proxyUrl+"?url="+a:a,jQuery.ajax({type:"GET",url:b._url,dataType:"xml",success:function(a){b._processDasUniProtXml(a)},error:function(a){b._processErrorRequest(a)}})},_processErrorRequest:function(a){var b=this;Biojs.console.log("ERROR: "+a),b.raiseEvent(Biojs.UniProtDiseaseSummary.EVT_ON_REQUEST_ERROR,{message:a})},_drawHtmlTemplate:function(){var a="#"+this.opt.target,b=jQuery(a),c=jQuery('<div style="width:'+this.opt.width+'" id="'+this._component_wrapper_id+'"></div>').appendTo(b);jQuery("<div id='UDS_info'></div>").appendTo(c),jQuery("<div id='UDS_warnings'></div>").appendTo(c)},_clearHtmlTemplate:function(){{var a="#"+this.opt.target;jQuery(a).html("")}},_drawComponentTitle:function(){if(this.opt.componentTitle){var a="#"+this._component_wrapper_id,b=jQuery(a);jQuery("<div class='UDS_table_title'>Involvement in disease</div>").appendTo(b)}},_drawComments:function(){var a=jQuery("#UDS_info"),b=jQuery("<div class='UDS_table_wrapper'></div>"),c=jQuery('<table class="UDS_table"></table>').appendTo(b);if(this.opt.tableHeader){var d=jQuery("<tr class='UDS_header'></tr>").appendTo(c);jQuery("<td>Notes</td>").appendTo(d),jQuery("<td>References</td>").appendTo(d)}var e=!0,f="UDS_even",g=0;for(i=0;i<this._comments.length;i++)if(e=!0,this.opt.keywordFiltereing.length>0&&(e=this._isAnyKewordInText(this.opt.keywordFiltereing,this._comments[i].notes[0])),e){f="UDS_odd"==f?"UDS_even":"UDS_odd";var h=jQuery("<tr class='"+f+"'></tr>").appendTo(c);jQuery("<td class='UDS_notes'>"+this._comments[i].notes[0]+"</td>").appendTo(h);var l="",m="";for(j=0;j<this._comments[i].omimAccs.length;j++)l+='<a target="_blank" href="http://www.omim.org/entry/'+this._comments[i].omimAccs[j]+'">'+this._comments[i].omimAccs[j]+"</a>, ";for(l.length>0&&(l=l.substring(0,l.length-2),l="<span class='UDS_omim_title'>Links to OMIM:</span><div class='UDS_accs'>"+l+"</div>"),k=0;k<this._comments[i].pubmedAccs.length;k++)m+='<a target="_blank" href="http://www.ncbi.nlm.nih.gov/pubmed/'+this._comments[i].pubmedAccs[k]+'">'+this._comments[i].pubmedAccs[k]+"</a>, ";m.length>0&&(m=m.substring(0,m.length-2),m="<span class='UDS_pubmed_title'>Links to Pubmed:</span><div class='UDS_accs'>"+m+"</div>"),jQuery("<td class='UDS_references' style='width:"+this.opt.referencesColumnWidth+"'>"+l+m+"</td>").appendTo(h),g++}0==g?jQuery("#UDS_warnings").html("No disease notes found for this query"):b.appendTo(a)},_isAnyKewordInText:function(a,b){var c=!1;a:for(j=0;j<a.length;j++)if(-1!=b.toLowerCase().indexOf(a[j].toLowerCase())){c=!0;break a}return c},_drawKeywords:function(){var a=jQuery("#UDS_info"),b="",c=!0;for(i=0;i<this._keywords.length;i++)c=!0,this.opt.keywordFiltereing.length>0&&(c=this._isAnyKewordInText(this.opt.keywordFiltereing,this._keywords[i].label)),c&&(b+="<a target='_blank' href='"+this._keywords[i].link+"'>"+this._keywords[i].label+"</a>, ");if(b.length>0)b=b.substring(0,b.length-2),b="<div class='UDS_keywords_wrapper'><span class='UDS_keywords_title'>Keywords: </span><span class='UDS_keywords'>"+b+"</span></div>",jQuery(b).appendTo(a);else{var d=jQuery("#UDS_info").html();jQuery("#UDS_warnings").html(d.length>0?"No disease keywords or notes found for this query":"No disease keywords found for this query")}},_processDasUniProtXml:function(a){Biojs.console.log("SUCCESS: data received"),this._keywords=new Array,this._comments=new Array;var b=this;jQuery(a).find("FEATURE").each(function(){var a=jQuery(this).find("TYPE")[0],c=jQuery(a).attr("category");"keyword"==c.toLowerCase()?b._setKeyword(this):"comment"==c.toLowerCase()&&b._setComment(this)}),this._drawHtmlTemplate(),this._drawComponentTitle(),this._drawComments(),this._drawKeywords()},_setKeyword:function(a){var b=new Object;b.label=jQuery(a).attr("label"),b.link="http://www.uniprot.org/keywords/?query="+jQuery(a).attr("label"),this._keywords.push(b)},_setComment:function(a){var b="DISEASE: ",c=new Object;c.omimAccs=new Array,c.pubmedAccs=new Array,c.notes=new Array,jQuery(a).find("NOTE").each(function(){var a=/\[MIM\:[0-9]*\]/i,d=jQuery(this).text();if(0==d.indexOf(b)&&(d=d.substring(b.length,d.length)),null!=d.match(a)){var e=d.match(a)[0],f=d.indexOf(e),g=parseInt(f)+e.length;d=d.substring(0,f-1)+d.substring(g,d.length),c.omimAccs.push(e.substring(5,e.length-1))}c.notes.push(d)}),jQuery(a).find("LINK").each(function(){var a=jQuery(this).attr("href");pubmedAcc="";var b="http://www.ncbi.nlm.nih.gov/pubmed/",d=a.indexOf(b);0==d&&(pubmedAcc=a.substring(b.length,a.length),c.pubmedAccs.push(pubmedAcc))}),this._comments.push(c),Biojs.console.log(c.omimAccs),Biojs.console.log(c.pubmedAccs),Biojs.console.log(c.notes)},opt:{target:"uniprotDiseaseSummary",uniProtDasUrl:"http://www.ebi.ac.uk/das-srv/uniprot/das/uniprot/features?segment=P08123;type=BS:01019",keywordFiltereing:[],proxyUrl:"../biojs/dependencies/proxy/proxy.php",width:"100%",referencesColumnWidth:"150px",tableHeader:!1,componentTitle:!1},eventTypes:[]});var Biojs=function(){};Biojs.EventHandler=function(a){this.eventType=a,this.listeners=[],this.addListener=function(a){"function"==typeof a&&this.listeners.push(a)},this.removeListener=function(a){if("function"==typeof a){var b=Biojs.Utils.indexOf(this.listeners,a);-1!=b&&this.listeners.splice(b,1)}},this.triggerEvent=function(a){for(var b in this.listeners)this.listeners[b](a)}},Biojs.Event=function(a,b,c){this.source=c,this.type=a;for(var d in b)this[d]=b[d]},Biojs.Utils={clone:function(a){var b=a instanceof Array?[]:{};for(i in a)b[i]=a[i]&&"object"==typeof a[i]?Biojs.Utils.clone(a[i]):a[i];return b},isEmpty:function(a){if(a instanceof Array)return a.length<=0;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},indexOf:function(a,b,c){var d;if(b){if(indexOf)return indexOf.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},console:{enable:function(){if(window.console)this.log=function(a){console.log(a)};else if(window.opera)this.log=function(a){window.opera.postError(a)};else{var a=window.open("","myconsole","width=350,height=250,menubar=0,toolbar=0,status=0,scrollbars=1,resizable=1");a?(a.document.writeln('<html><head><title>BioJS Console</title></head><body bgcolor=white onLoad="self.focus()"><div id="Biojs.console"></div></body></html>'),a.document.close(),Biojs.console.domDocument=a.document,Biojs.console.domDivNode=a.document.getElementById("Biojs.console"),this.log=function(a){var b="";if(a instanceof Array)for(c=0;c<a.length;c++)b+="["+c+"]="+a[c]+" ";else if(a instanceof String||"string"==typeof a)b=a;else for(var c in a)b+="["+c+"]="+a[c]+" ";textNode=Biojs.console.domDocument.createTextNode(b),line=Biojs.console.domDocument.createElement("pre"),line.appendChild(textNode),Biojs.console.domDivNode.appendChild(line)}):alert("Please activate the pop-up window in this page in order to enable the BioJS console")}},log:function(){}}},Biojs.extend=function(a,b){var c=Biojs.prototype.extend;Biojs._prototyping=!0;var d=new this;if(d.eventTypes instanceof Array)for(var e in d.eventTypes)a.eventTypes.push(d.eventTypes[e]);if(d.opt instanceof Object)for(var f in d.opt)a.opt[f]=d.opt[f];c.call(d,a),d.base=function(){},delete Biojs._prototyping;var g=d.constructor,h=d.constructor=function(){function a(){}if(!Biojs._prototyping){if(this.constructor==h){a.prototype=d;var b=new a;return b.setOptions(arguments[0]),b.setEventHandlers(b.eventTypes),b.biojsObjectId=Biojs.uniqueId(),Biojs.addInstance(b),g.apply(b,arguments),b}g.apply(this,arguments)}};return h.ancestor=this,h.extend=this.extend,h.forEach=this.forEach,h.implement=this.implement,h.prototype=d,h.valueOf=function(a){return"object"==a?h:g.valueOf()},h.toString=this.toString,c.call(h,b),"function"==typeof h.init&&h.init(),h},Biojs.prototype={extend:function(a,b){if(arguments.length>1){var c=this[a];if(c&&"function"==typeof b&&(!c.valueOf||c.valueOf()!=b.valueOf())&&/\bbase\b/.test(b)){var d=b.valueOf();b=function(){var a=this.base||Biojs.prototype.base;this.base=c;var b=d.apply(this,arguments);return this.base=a,b},b.valueOf=function(a){return"object"==a?b:d},b.toString=Biojs.toString}this[a]=b}else if(a){var e=Biojs.prototype.extend;Biojs._prototyping||"function"==typeof this||(e=this.extend||e);for(var f={toSource:null},g=["constructor","toString","valueOf"],h=Biojs._prototyping?0:1;i=g[h++];)a[i]!=f[i]&&e.call(this,i,a[i]);for(var i in a)f[i]||e.call(this,i,a[i])}return this},addListener:function(a,b){if(this._eventHandlers)for(var c in this._eventHandlers)if(a==this._eventHandlers[c].eventType)return void this._eventHandlers[c].addListener(b)},removeListener:function(a,b){if(this._eventHandlers)for(var c in this._eventHandlers)if(a==this._eventHandlers[c].eventType)return void this._eventHandlers[c].removeListener(b)},setEventHandlers:function(a){this._eventHandlers=[];
var b=function(a){return function(b){a.listeners.push(b)}};if("object"==typeof a)for(var c=0;c<a.length;c++){var d=new Biojs.EventHandler(a[c]);this._eventHandlers.push(d),this[a[c]]=new b(d)}},raiseEvent:function(a,b){for(var c in this._eventHandlers)if(a==this._eventHandlers[c].eventType)return void this._eventHandlers[c].triggerEvent(b)},setOptions:function(a){if(this.opt instanceof Object){this.opt=Biojs.Utils.clone(this.opt);for(var b in a)this.opt[b]=a[b]}},listen:function(a,b,c){a instanceof Biojs&&"function"==typeof c&&a.addListener(b,c)},getId:function(){return this.biojsObjectId}},Biojs=Biojs.extend({constructor:function(){this.extend(arguments[0])},vaueOf:function(){return"Biojs"}},{ancestor:Object,version:"1.0",forEach:function(a,b,c){for(var d in a)void 0===this.prototype[d]&&b.call(c,a[d],d,a)},implement:function(){for(var a=0;a<arguments.length;a++)"function"==typeof arguments[a]?arguments[a](this.prototype):this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())},uniqueId:function(){return"undefined"==typeof Biojs.prototype.__uniqueid&&(Biojs.prototype.__uniqueid=0),Biojs.prototype.__uniqueid++},addInstance:function(a){return"undefined"==typeof Biojs.prototype.__instances&&(Biojs.prototype.__instances={}),Biojs.prototype.__instances[a.biojsObjectId]=a},getInstance:function(a){return Biojs.prototype.__instances[a]},registerGlobal:function(a,b){window[a]=b},getGlobal:function(a){return window[a]},console:Biojs.Utils.console,EventHandler:Biojs.EventHandler,Event:Biojs.Event,Utils:Biojs.Utils}),Biojs.wigExplorer=Biojs.extend({zoomSlider:"",slider_stop:0,slider_start:0,track:[],width:1,height:1,data_last_start:1,data_first_start:1,max:0,span:null,chrom:[],data:[],main_data:[],constructor:function(){var a=this;a.vis=null,a.color=null,a.foci=[],this.track,this._container=$("#wigFeaturePainter-holder"),$(this._container).addClass("graph"),this._container.css({"font-family":a.opt.fontFamily,"background-color":a.opt.selectionBackgroundColor,color:a.opt.fontColor,"font-size":"36px","text-align":"center","vertical-align":"middle",width:"700px",height:"100px",bottom:"0px"}),this._container.css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none"}),this.color=a.opt.selectionBackgroundColor,this.paintFeatures(a.opt.dataSet)},opt:{target:"YourOwnDivId",dataSet:"",fontFamily:'"Andale mono", courier, monospace',fontColor:"white",backgroundColor:"",selectionFontColor:"black",selectionBackgroundColor:"yellow",width:"100%",height:"130",radius:10,reference:null},eventTypes:[],_updateDraw:function(a,b,c){var d=this;a&&b&&(this.slider_start+=a,this.slider_stop+=b),c||(c=d.opt.target),this.slider_start<this.data_first_start&&(a==b&&(this.slider_stop+=this.data_first_start-this.slider_start),this.slider_start=this.data_first_start),this.slider_stop>this.data_last_start&&(a==b&&(this.slider_start+=this.data_last_start-this.slider_stop),this.slider_stop=this.data_last_start),parseFloat(this.slider_start)<parseFloat(this.slider_stop)&&this.paintWig(this.slider_start,this.slider_stop,c)},paintFeatures:function(a){void 0!=a?(this._setDataSource(a),this._init()):alert("Dataset not defined ")},_init:function(){Biojs.wigExplorer.myself=this;var a=this,b=jQuery("#"+this.opt.target);b.text(""),b.append(this._withSliderOnly(100)),b.append("<div id="+this.opt.target+"_wigFeaturePainter-holder></div>");var c=document.getElementById(this.opt.target+"_wigFeaturePainter-holder");if(!c)throw this.$errorMsg=jQuery('<div id="wigFeaturePainter-errorInit"></div>').html("There was an unexpected failure, the image cannot be displayed.").dialog({autoOpen:!0,title:"Error",modal:!0}),"Error";c.innerHTML="",c.style.height="250px",c.style.width="700px",this.width=$("#"+a.opt.target+"_wigFeaturePainter-holder").width(),this.height=$("#"+a.opt.target+"_wigFeaturePainter-holder").height(),this.r=a.opt.radius,a.opt.width=a.opt.width.toString(),a.opt.width=a.opt.width.indexOf("%")>=1?a.opt.width.toString():parseInt(this.width),a.opt.height=a.opt.height.toString(),a.opt.height.indexOf("%")>=1&&(a.opt.height=a.opt.height.toString()),this.height=-1!=a.opt.height.indexOf("%")?1*this.height*a.opt.height.substring(0,a.opt.height.length-1)/100:1*a.opt.height,a.opt.height=parseInt(this.height),a.color=function(){return d3.scale.ordinal().range(a.colors)}(),jQuery.ajax({type:"GET",url:a.opt.dataSet,dataType:"text",success:function(b){var c=b.split("\n"),d=c.length;if(b.indexOf("variableStep")>=0||b.indexOf("fixedStep")>=0){a.chrom=[];for(var e=0;d>e;e++)if(c[e].indexOf("chrom")>=0){var f=c[e].split(/\s+/)[1].split("=")[1];a.chrom.indexOf(f)<0&&a.chrom.push(f)}a._buildReferenceSelector()}else alert("Unknown format detected")},error:function(a,b){alert(b)}})},_buildReferenceSelector:function(){var a=this;this._headerDiv=jQuery("#"+a.opt.target+"_selectorMenu"),this._headerDiv.css({"font-family":'"Heveltica Neue", Arial, "sans serif"',"font-size":"14px"}).append("Reference: ");for(var b="<select id="+a.opt.target+"ref_selector>",c=0;c<this.chrom.length;c++)b+="<option value='"+this.chrom[c]+"'>"+this.chrom[c]+"</option>";b+="/<select>",this._formatSelector=jQuery(b).appendTo(a._headerDiv),this._formatSelector.change(function(){a.opt.reference=jQuery(this).val(),a.setReference(a.opt.reference,a.opt.target)}),a.setReference(this._formatSelector.val())},_withSliderOnly:function(a){var b=this,c='<table width="'+a+'px"><tr><td width="75%"><div  id="'+b.opt.target+'_wigFeaturePainter-slider" style="margin-left: 10px;"></div></td><td><div id="'+b.opt.target+'_selectorMenu"> </div></td></tr></table><br/>';return c},_paintSlider:function(){var a=this;if(document.getElementById(a.opt.target+"_wigFeaturePainter-slider")){var b=jQuery("#"+a.opt.target+"_wigFeaturePainter-slider");b.text(""),b.append('<label for="wigFeaturePainter-slider-values"></label>'),b.append('<div type="text" id="wigFeaturePainter-slider-values" style="margin-bottom:5px" />');var c=this.track.length-1,d=parseInt(this.track[c][0])-parseInt(this.track[0][0]),e=parseInt(d/20);this.zoomSlider=jQuery('<div id="wigFeaturePainter-slider-bar" style="width:300px"></div>').appendTo(b);var f="<div id = "+a.opt.dataSet+' class="ui-button ui-widget ui-corner-all ui-button-text-only zoomin" ><span title="Zoom In" class="ui-button ui-icon ui-icon-zoomin"></span></div><div id = '+a.opt.dataSet+' class="ui-button ui-widget ui-corner-all ui-button-text-only zoomout"  ><span title="Zoom Out" class="ui-button ui-icon ui-icon-zoomout"></span></div><div id = '+a.opt.dataSet+' class="ui-button ui-widget ui-corner-all ui-button-text-only left"  ><span title="Left" class="ui-button ui-icon ui-icon-arrowthick-1-w"></span></div><div id = '+a.opt.dataSet+' class="ui-button ui-widget ui-corner-all ui-button-text-only right"  ><span title="Right" class="ui-button ui-icon ui-icon-arrowthick-1-e"></span></div>';jQuery(b).html(""),this._updateSelector=jQuery(f).appendTo(b),this._updateSelector.click(function(){jQuery(this).hasClass("left")?a._updateDraw(-1*e,-1*e,a.opt.target):jQuery(this).hasClass("right")?a._updateDraw(e,e,a.opt.target):jQuery(this).hasClass("zoomin")?a._updateDraw(e,-1*e,a.opt.target):jQuery(this).hasClass("zoomout")&&a._updateDraw(-1*e,e,a.opt.target)})}},setReference:function(a){var b=this,c=!1;jQuery.ajax({type:"GET",url:b.opt.dataSet,dataType:"text",success:function(d){var e=[],f=0,g=d.split("\n"),h=g.length,i=null,j=!1;if(d.indexOf("variableStep")>=0){for(var g=d.split("\n"),h=g.length,k=0;h>k;k++)if(g[k].indexOf("chrom")>=0){var l=g[k].split(/\s+/)[1].split("=")[1];c=!1,l==a&&(g[k].indexOf("span")>=0&&(i=g[k].split(/\s+/)[2].split("=")[1]),c=!0,j=!0)}else{if(g[k].indexOf("#")>=0)continue;if(c){var m=g[k].split(/\s+/);e.push([m[0],m[1],i]),parseInt(m[1])>parseInt(f)&&(f=m[1])}}if(b.max=f,b.track=e,0==j)alert("Selected reference not found");else if(e.length>0){var n=parseInt(e[0][0]),o=parseInt(e[e.length-1][0]);b.slider_start=n,b.slider_stop=o,b.data_last_start=o,b.data_first_start=n}else alert("No data for selected reference")}else if(d.indexOf("fixedStep")>=0){for(var g=d.split("\n"),h=g.length,n=null,p=null,j=!1,k=0;h>k;k++)if(g[k].indexOf("chrom")>=0){var q=g[k].split(/\s+/),l=g[k].split(/\s+/)[1].split("=")[1];c=!1,l==a&&(n=q[2].split("=")[1],p=q[3].split("=")[1],g[k].indexOf("span")>=0&&(i=q[4].split("=")[1]),c=!0,j=!0)}else{if(g[k].indexOf("#")>=0)continue;if(c){var m=g[k];n=parseInt(n)+parseInt(p),e.push([n,m,i]),parseInt(m)>parseInt(f)&&(f=m)}}if(b.max=f,b.track=e,0==j)alert("Selected reference not found");else if(e.length>0){var n=parseInt(e[0][0]),o=parseInt(e[e.length-1][0]);b.slider_start=n,b.slider_stop=o,b.data_last_start=o,b.data_first_start=n}else alert(null==n||null==p?"Unknown format detected":"No data for selected reference")}else alert("Unknown format detected")},error:function(a,b){alert(b)}}).done(function(){b._paintSlider(),b._updateDraw()})},paintWig:function(a,b,c){var d=this;if(this.track.length>0){var e=this.opt.selectionBackgroundColor,f="50px",g="0px",h=[],i=this.height,j=this.width,k=this.max;if(a&&b)a<d.slider_start&&(a=d.slider_start),b>d.slider_stop&&(b=d.slider_stop),h=this.track,h=jQuery.grep(h,function(c){return c[0]>=a&&c[0]<=b});else{h=this.track;var l=this.track.length-1;b=parseInt(this.track[l][0]),a=parseInt(this.track[0][0])}var m=parseInt(j)/(b-a),l=h.length-1;if(l>0){this._clear(c);var n=d3.select("#"+c+"_wigFeaturePainter-holder").append("svg").attr("width",this.width+20).attr("height",$("#"+c+"_wigFeaturePainter-holder").height()).append("g").attr("transform","translate("+f+","+g+")");this._container=jQuery("#"+c+"_wigFeaturePainter-holder");var o=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear"),p=parseInt(h[l][0])+parseInt(h[1][0]-h[0][0]),q=parseInt(h[0][0])-parseInt(h[1][0]-h[0][0]);0>q&&(q=0),h.splice(0,0,[q,0]),h.splice(h.length,0,[p,0]);var r=[],s=0,t=parseInt(h[1][0]-h[0][0]);(t>parseInt(h[2][0]-h[1][0])||t>parseInt(h[3][0]-h[2][0]))&&(t=parseInt(t>parseInt(h[2][0]-h[1][0])?h[2][0]-h[1][0]:h[3][0]-h[2][0]));for(var u=0;u<h.length-1;){var v;v=a>0?(h[u][0]-a)*m:h[u][0]*m;var w=i-h[u][1]*i/k;if(r.push({x:v,y:w}),u++,s<h[u][0]-t){v=a>0?(parseInt(s)+parseInt(t)-a)*m:(parseInt(s)+parseInt(t))*m;var w=i;r.push({x:v,y:w}),v=a>0?(parseInt(h[u][0])-parseInt(t)-a)*m:(parseInt(h[u][0])-parseInt(t))*m;var w=i;r.push({x:v,y:w})}s=h[u][0]}v=a>0?(h[h.length-1][0]-a)*m:h[h.length-1][0]*m;var w=i-h[h.length-1][1]*i/k;r.push({x:v,y:w});var x=n.selectAll("path").data([1]),y=[],z=h[0][0],t=(h[h.length-1][0]-h[0][0])/10;for(u=0;10>u;u++)y.push(h[u][2]?[[parseInt(z)+parseInt(u*t)],[h[u][2]]]:[[parseInt(z)+parseInt(u*t)]]);var A=n.selectAll("text.day").data(y);A.enter().append("svg:text").attr("x",40).attr("y",155).attr("transform",function(b){return a>0?"translate("+((b[0]-a)*m+150)+",100)rotate(90)":"translate("+(b[0]*m+150)+",100)rotate(90)"}).text(function(a){return a[0]>1e6?parseFloat(a[0]/1e6).toFixed(2)+"M":a[0]>1e3?parseFloat(a[0]/1e3).toFixed(2)+"K":a[1]?parseInt(a[0])+" - "+(parseInt(a[0])+parseInt(a[1])):parseInt(a[0])});var B=n.selectAll("line.bottom").data(y);B.enter().insert("svg:line").attr("class","line").attr("x1",function(b){return parseInt(a>0?(b[0]-a)*m:b[0]*m)}).attr("y1",130).attr("x2",function(b){return parseInt(a>0?(b[0]-a)*m:b[0]*m)}).attr("y2",140).attr("stroke",function(){return"black"}),x.enter().append("svg:path").attr("width",200).attr("height",200).attr("class","path").attr("stroke",function(){return"steelblue"}).attr("stroke-width",function(){return"1px"}).attr("fill",function(){return e}).attr("d",o(r))}}else alert("Reference not set: use instance.setReference")},_clear:function(a){jQuery("#"+a+"_wigFeaturePainter-holder").html("")},_setDataSource:function(a){this.opt.dataSet=a},_addSimpleClickTrigger:function(){var a=this;this._container.find("span").click(function(b){var c=jQuery(b.target).text(),d={selected:c};a.raiseEvent("onClick",d)})}},{myself:void 0});
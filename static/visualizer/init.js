define("src/util/util",[],function(){function makejPathFunction(jpath){if(!jpath)return noop;for(var jpaths2=jpath.replace(regJpath,""),splitted=jpaths2.split("."),l=splitted.length-1,ifArray=[],ifString,ifElement="el",i=0;l>i;i++)ifElement+='["'+splitted[i].replace(regQuote,'\\"')+'"]',ifArray.push(ifElement+" != undefined");ifString=ifArray.join(" && "),ifString||(ifString="true");var functionEvaled=noop;return eval("functionEvaled = function( el ) { if (el && "+ifString+") return "+ifElement+'["'+splitted[l].replace(regQuote,'\\"')+'"]; };'),functionEvaled}function getCSS(a,b){if(a=a.toLowerCase(),document.styleSheets){for(var c,d,e,f=0;f<document.styleSheets.length;f++){c=document.styleSheets[f],d=0,e=!1;do if(e=c.cssRules?c.cssRules[d]:c.rules[d],e&&e.selectorText){if(e.selectorText.toLowerCase()==a)return b?(c.cssRules?c.deleteRule(d):c.removeRule(d),!0):e;d++}else d++;while(e)}return!1}}var uniqueid=0,months=["January","February","March","April","Mai","June","July","August","September","October","November","December"],days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],noop=function(){},regQuote=/"/g,regJpath=/^element\./;return{getCurrentLang:function(){return"en"},maskIframes:function(){$("iframe").each(function(){var a=$(this),b=a.position(),c=a.width(),d=a.height();a.before($("<div />").css({position:"absolute",width:c,height:d,top:b.top,left:b.left,background:"white",opacity:.5}).addClass("iframemask"))})},unmaskIframes:function(){$(".iframemask").remove()},getNextUniqueId:function(a){return a?"id_"+Date.now()+Math.round(1e5*Math.random()):"uniqid_"+ ++uniqueid},formatSize:function(a){for(var b=0;a>1024;)a/=1024,b++;var c=["o","Ko","Mo","Go","To"];return Math.round(10*a)/10+" "+c[b]},pad:function(a){return 10>a?"0"+a:a},getMonth:function(a){return months[a]},getDay:function(a){return days[a]},loadCss:function(a){if(this.loadedCss=this.loadedCss||{},!this.loadedCss[a]){this.loadedCss[a]=!0;var b=document.createElement("link");b.type="text/css",b.rel="stylesheet",b.href=require.toUrl(a);try{document.getElementsByTagName("head")[0].appendChild(b)}catch(c){}}},getDistinctColors:function(a){for(var b=[],c=0,d=0;360>d;d+=360/a){c++;var e=this.hsl2rgb(d,100,30+c%4*15);b.push([Math.round(255*e.r),Math.round(255*e.g),Math.round(255*e.b)])}return b},getNextColorRGB:function(a,b){return this.getDistinctColors(b)[a]},hsl2rgb:function(a,b,c){var d,e,f,g,h,i;return b/=100,c/=100,0===b?g=h=i=255*c:(e=.5>=c?c*(b+1):c+b-c*b,d=2*c-e,f=a/360,g=this.hueToRgb(d,e,f+1/3),h=this.hueToRgb(d,e,f),i=this.hueToRgb(d,e,f-1/3)),{r:g,g:h,b:i}},hueToRgb:function(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a},hexToRgb:function(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?[parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16)]:[0,0,0]},rgbToHex:function(a,b,c){return"#"+((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1)},getColor:function(a){if(Array.isArray(a))switch(a.length){case 3:return"rgb("+a.join(",")+")";case 4:return"rgba("+a.join(",")+")"}else if("object"==typeof a)return"rgb("+Math.round(255*a.r)+", "+Math.round(255*a.g)+", "+Math.round(255*a.b)+")";return a},makejPathFunction:makejPathFunction,addjPathFunction:function(a,b){a[b]=makejPathFunction(b)},getWebsafeFonts:function(){return[{title:"Arial",key:"Arial"},{title:"Arial Black",key:"'Arial Black'"},{title:"Comic Sans MS",key:"'Comic Sans MS'"},{title:"Courier",key:"Courier"},{title:"Courier new",key:"'Courier New'"},{title:"Georgia",key:"Georgia"},{title:"Helvetica",key:"Helvetica"},{title:"Impact",key:"Impact"},{title:"Palatino",key:"Palatino"},{title:"Times new roman",key:"'Times New Roman'"},{title:"Trebuchet MS",key:"'Trebuchet MS'"},{title:"Verdana",key:"Verdana"}]},getCSS:getCSS,removeCSS:function(a){return getCSS(a,!0)},addCSS:function(a){if(document.styleSheets){var b;return(b=getCSS(a))?b:(document.styleSheets[0].addRule?document.styleSheets[0].addRule(a,null,0):document.styleSheets[0].insertRule(a+" { }",0),getCSS(a))}},formatMoney:function(a,b,c,d){b=isNaN(b=Math.abs(b))?2:b,d=void 0==d?".":d,c=void 0==c?",":c;var e=0>a?"-":"",f=parseInt(a=Math.abs(+a||0).toFixed(b))+"",g=f.length;return g=g>3?g%3:0,e+(g?f.substr(0,g)+c:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+c)+(b?d+Math.abs(a-f).toFixed(b).slice(2):"")},safeAccess:function(){for(var a=arguments[0],b=1;b<arguments.length;b++)if(!(a=a[arguments[b]]))return!1;return a}}}),define("src/util/debug",[],function(){function a(a){f.push(a)}function b(a,b){return b?"ms"===b?a+"ms":"s"===b?a/1e3+"s":void 0:a}function c(){this._started=!1,this._paused=!1,this._steps=[],this._laps=[],this._sumElapsed=0,this._sums={}}var d=-1,e=window.console,f=[],g={setDebugLevel:function(a){d=a},error:function(b,c){d>=0&&(c instanceof Error&&c.stack?arguments[1]="\n"+c.stack:f.push.call(arguments,"\n"+Error().stack),e.error.apply(e,arguments)),d>-1&&a("ERROR : "+b)},warn:function(b){d>=1&&e.warn.apply(e,arguments),d>-1&&a("WARN  : "+b)},info:function(b){d>=2&&e.info.apply(e,arguments),d>-1&&a("INFO  : "+b)},debug:function(b){d>=3&&e.debug.apply(e,arguments),d>-1&&a("DEBUG : "+b)},trace:function(b){d>=4&&e.log.apply(e,arguments),d>-1&&a("TRACE : "+b)},dump:function(){e.log(f.join("\n")),f=[]},timer:function(){var a=new c;return a.start(),a},Timer:c};return c.prototype={start:function(){this._paused?(this._start=Date.now()-this._elapsed,this._paused=!1):this._started||(this._start=Date.now(),this._started=!0)},pause:function(){this._started&&!this._paused&&(this._paused=!0,this._elapsed=Date.now()-this._start)},time:function(a){return this._started&&!this._paused?b(Date.now()-this._start,a):void 0},step:function(a){if(this._started&&!this._paused){var c=Date.now(),d=c-this._start;return this._start=c,this._total+=d,this._steps.push(d),b(d,a)}},lap:function(a){if(this._started&&!this._paused){var c=Date.now()-this._start;return this._laps.push(c),b(this._total,a)}},sum:function(a){var b=Date.now()-this._start;a&&(this._sums[a]||(this._sums[a]=0),this._sums[a]+=b-this._sumElapsed),this._sumElapsed=b},getSteps:function(a){return this._steps.map(function(c){return b(c,a)})},getLaps:function(a){return this._laps.map(function(c){return b(c,a)})},getSums:function(a){var c={};for(var d in this._sums)c[d]=b(this._sums[d],a);return c}},g}),define("src/main/datas",["src/util/util","src/util/debug"],function(a,b){function c(a){if(a){for(var b in a)a.hasOwnProperty(b)&&(a[b]=c.check(a[b]));return c.check(a),a}}function d(a){var b=typeof a;if("number"===b||"string"===b||"boolean"===b)return a;if("undefined"!==b&&"function"!==b){var e,f,g;if(k(a))return l(a);if(a instanceof Array)for(g=a.length,e=new Array(g),a instanceof h&&(e=h(e)),f=0;g>f;f++)e[f]=d(a[f]);else{var i=Object.keys(a);for(g=i.length,e=a instanceof c?new c:{},f=0;g>f;f++)e[i[f]]=d(a[i[f]])}return e}}function e(a){this.s_=String(a)}function f(a){this.s_=Number(a)}function g(a){this.s_=Boolean(a)}function h(a,b,d){var e=[];if(a){if(!(a instanceof Array))throw"DataArray can only be constructed from arrays";for(var f=0,g=a.length;g>f;f++)e[f]=b?c.check(a[f],b,d):a[f]}return e.__proto__=h.prototype,e}function i(a,b){for(var c in b){var d=b[c];"object"==typeof d?d instanceof Array?a[c]=d:null!==d&&(a[c]||(a[c]={}),i(a[c],d)):a[c]=d}}function j(a){return a instanceof c||a instanceof h||k(a)}function k(a){return a instanceof e||a instanceof f||a instanceof g}function l(a){var b;switch(k(a)?(b=a.getType(),a=a.get()):b=typeof a,b){case"string":return new e(a);case"number":return new f(a);case"boolean":return new g(a)}}c.check=function(a,b){if(j(a))return a;if(a instanceof Array)return a.__proto__=h.prototype,a;if(null===a)return null;var d=typeof a;return"object"===d?(a.__proto__=c.prototype,a):b?l(a):a},c.recursiveTransform=function(a,b){a=c.check(a,b);var d,e;if(a instanceof Array)for(d=0,e=a.length;e>d;d++)a[d]=c.check(a[d],b),c.recursiveTransform(a[d],b);else if(a instanceof Object)for(d in a)a[d]=c.check(a[d],b),c.recursiveTransform(a[d],b);return a};for(var m={value:function(){return d(this)}},n=["charAt","charCodeAt","concat","fromCharCode","indexOf","lastIndexOf","localCompare","match","replace","search","slice","split","substr","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toUpperCase","trim"],o=0,p=n.length;p>o;o++)!function(a){e.prototype[n[a]]=function(){return String.prototype[n[a]].apply(this.s_,arguments)}}(o);e.prototype.getType=function(){return"string"},e.prototype.nativeConstructor=String,f.prototype.getType=function(){return"number"},f.prototype.nativeConstructor=Number,g.prototype.getType=function(){return"boolean"},g.prototype.nativeConstructor=Boolean,window.DataString=e,window.DataNumber=f,window.DataBoolean=g,h.prototype=Object.create(Array.prototype),Object.defineProperty(h.prototype,"constructor",h),window.DataObject=c,window.DataArray=h;var q={value:function(){var a={};for(var b in this)a[b]=j(this[b])?this[b].resurrect():this[b];return a}},r={value:function(){for(var a=[],b=0,c=this.length;c>b;b++)a[b]=j(this[b])?this[b].resurrect():this[b];return a}},s={value:function(a,b,d){if("string"==typeof a||"number"==typeof a){if(b){var e=this;return new Promise(function(b){e.get(!0).then(function(e){return"object"!=typeof e||null===e?b(e):"undefined"!=typeof e[a]?(j(e[a])||(e[a]=c.check(e[a],!0)),e[a]instanceof c?e[a].fetch(!0).then(b):b(e[a])):d?(e[a]=new d,b(e[a])):b()})})}var f=this.get();return"object"!=typeof f||null===f?f:("undefined"!=typeof f[a]&&(f[a]=c.check(f[a],1)),f[a])}return a===!0?this.hasOwnProperty("type")&&this.hasOwnProperty("value")?Promise.resolve(this.value):this.hasOwnProperty("type")&&this.hasOwnProperty("url")?this.fetch(!0):Promise.resolve(this):this.hasOwnProperty("value")&&this.hasOwnProperty("type")?this.value:this}},t={value:function(a,b,d){var e=c.check(b,!0);if(e){var f=e.getType();this[a]=c.check(this[a]);var g=void 0!==this[a]&&this[a].getType?this[a].getType():void 0;g!==f?this[a]=e:"string"===f||"number"===f||"boolean"===f?this[a].setValue(e.get(),d):e!==this[a]&&(this[a]=e)}else this[a]=e;return d||this.triggerChange(!1,[]),this[a]}},u={value:function(a){if("string"==typeof a&&(a=a.split("."),a.shift()),!a||0===a.length)return Promise.resolve(this);a=a.slice();var b=a.shift(),d=this;return new Promise(function(e){d.get(b,!0).then(function(b){b=c.check(b,!0),b&&0!==a.length?b.getChild(a).then(e):e(b)})})}},v={value:function(a,b){if(a&&a.split&&(a=a.split("."),a.shift()),!a||0===a.length)return Promise.resolve(this);a=a.slice();var d=a.shift(),e=this,f=0==a.length?b:"number"==typeof d?h:c;return this.get(d,!0,f).then(function(f){return e.get()[d]=c.check(f),f&&f.linkToParent&&f.linkToParent(e,d),f&&0!==a.length?f.trace(a,b):f})}},w={value:function(a,b){if(a&&a.split&&(a=a.split("."),a.shift()),!a||0===a.length)return this;a=a.slice();var d=a.shift(),e=this,f=0==a.length?b:"number"==typeof d?h:c,g=this.get(d,!1,f);return e.get()[d]=c.check(g),g&&g.linkToParent&&g.linkToParent(e,d),g&&0!==a.length?g.traceSync(a,b):g}},x={value:function(a,b){if(Array.isArray(a)||(a=[a]),a){a=a.slice();var c=a.shift(),d=this.get(c);if(null!==d)return 0===a.length?d:void 0===d?void 0:d.getChildSync(a,b)}}},y={value:function(a,b){this.__parent||(a[b]=this,Object.defineProperty(this,"__parent",{value:a,writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(this,"__name",{value:b,writable:!1,configurable:!1,enumerable:!1}))}},z={value:function(a,b,d,e){var f=this;"string"==typeof a&&(a=a.split("."),a.shift()),a=a.slice();var g=a.length;if(0===g)throw new Error("setChild cannot be called with an empty jPath");var i=a.shift();if(1===g){var j=f.set(i,b,!0);return void(j&&j.linkToParent?(j.linkToParent(f,i),j.triggerChange(!1,d)):f.triggerChange(!1,d))}var k=0===a.length?e:"number"==typeof a[0]?h:c,l=i,m=[a,b,d,e];return this.get(i,!0,k).then(function(a){f.set(l,a,!0),a.linkToParent(f,l),a.setChild.apply(a,m)})}},A={value:function(a){if(this._dataChange)for(var b in this._dataChange)this._dataChange[b].apply(this,a);this.__parent&&(a[0].jpath.unshift(this.__name),this.__parent._triggerBubble.call(this.__parent,a))}},B={value:function(a,b){if(Array.isArray(b)||(b=void 0==b?[]:[b]),b.unshift({target:this,jpath:[]}),this._dataChange)for(var c in this._dataChange)this._dataChange[c].apply(this,b);a||this.__parent&&(b[0].jpath.unshift(this.__name),this.__parent._triggerBubble.call(this.__parent,b))}},C={value:function(b){this._dataChange||Object.defineProperty(this,"_dataChange",{value:{},enumerable:!1,writable:!0,configurable:!0});var c=a.getNextUniqueId(!0);return this._dataChange[c]=b,b.id=c,c}},D={value:function(a){return this._dataChange?(a.id&&(a=a.id),void delete this._dataChange[a]):(b.info("Could not unbind event. No listener for this object"),!1)}},E={value:function(){var a=typeof this;return"object"!==a?a:this instanceof Array?"array":this.hasOwnProperty("type")&&(this.hasOwnProperty("value")||this.hasOwnProperty("url"))?this.type:a}},F={value:function(a){if(this.value||!this.url)return Promise.resolve(this);var b=this;return new Promise(function(d,e){require(["src/util/urldata"],function(f){var g;a&&(g={Accept:"application/json"}),f.get(b.url,!1,b.timeout,g).then(function(a){a=c.check(a,!0),Object.defineProperty(b,"value",{enumerable:b._keep||!1,writable:!0,configurable:!1,value:a}),d(b)},e)})})}},G={value:function(a,b,c){"object"!=typeof a||a instanceof Array||(i(this,a),this.triggerChange(c,[b]))}},H={value:function(a,c,d){return this.triggerChange(d,[c]),b.warn("mergeWith method not yet implemented for DataArray")}},I={value:function(a){this.hasOwnProperty("type")&&this.hasOwnProperty("value")?this.value instanceof e||this.value instanceof f||this.value instanceof g?this.value.setValue(a):this.value=a:b.warn("Cannot set value of untyped DataObject")}},J={set:t,get:s,setChild:z,getChild:u,getChildSync:x,trace:v,duplicate:m,traceSync:w,onChange:C,unbindChange:D,triggerChange:B,_triggerBubble:A,linkToParent:y,getType:E,setValue:I};Object.defineProperties(c.prototype,J),Object.defineProperties(h.prototype,J),Object.defineProperty(c.prototype,"fetch",F),Object.defineProperty(c.prototype,"resurrect",q),Object.defineProperty(c.prototype,"mergeWith",G),Object.defineProperty(h.prototype,"resurrect",r),Object.defineProperty(h.prototype,"mergeWith",H);var K={value:function(){return this.s_}},L={value:function(){return Promise.resolve(this)}},M={value:function(a,b){this.s_=this.nativeConstructor(a),b||this.triggerChange(!1,[])}},N={value:function(){return String(this.s_)}},O={trace:v,onChange:C,unbindChange:D,triggerChange:B,linkToParent:y,toJSON:K,get:K,resurrect:K,getChild:L,valueOf:K,setValue:M,toString:N};Object.defineProperties(e.prototype,O),Object.defineProperties(f.prototype,O),Object.defineProperties(g.prototype,O)}),define("src/util/localdb",["jquery"],function(a){var b,c;return{open:function(){window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange;var d=a.Deferred();if(!indexedDB)return d.reject();if(b)return d.resolve();var e=indexedDB.open("ci",26);return e.onsuccess=function(a){c=!1,b=a.target.result,d.resolve()},e.onupgradeneeded=function(e){c=!1,b=e.target.result;a.Deferred(),a.Deferred();b.objectStoreNames.contains("localview")&&b.deleteObjectStore("localview"),b.objectStoreNames.contains("localdata")&&b.deleteObjectStore("localdata");var f=a.Deferred(),g=a.Deferred(),h=b.createObjectStore("localdata",{keyPath:"readURL"}),i=b.createObjectStore("localview",{keyPath:"readURL"});h.onsuccess=function(){f.resolve()},i.onsuccess=function(){g.resolve()},a.when(f,g).then(function(){d.resolve()})},e.onerror=function(a){console.log(a.target),d.reject()},e.oncomplete=function(a){console.warn(a.error)},d},getAll:function(c,d,e){var f=a.Deferred(),g=this;c="data"==c||"localdata"==c?"localdata":"localview";var h=b.transaction([c],"readwrite"),i=h.objectStore(c),j={};if(e)var k=i.get(d+";"+e);else var k=i.openCursor();return k.onsuccess=function(a){e?void 0==a.target.result?g.create(c,d,e).pipe(function(a){f.resolve(a)}):f.resolve(a.target.result):(a.target.result&&a.target.result.key.indexOf(d)>-1&&(j[a.target.result.value.branch]=a.target.result.value),a.target.result?a.target.result["continue"]():f.resolve(j))},k.onerror=function(){},f},create:function(c,d,e){obj={readURL:d+";"+e,url:d,branch:e,list:[],head:"{}"};var f=a.Deferred();c="data"==c||"localdata"==c?"localdata":"localview";var g=b.transaction(c,"readwrite"),h=g.objectStore(c),i=h.put(obj);return i.onsuccess=function(){f.resolve(obj)},f},storeToHead:function(c,d,e,f){var g=a.Deferred(),h=this;c="data"==c||"localdata"==c?"localdata":"localview";var i=b.transaction(c,"readwrite"),j=i.objectStore(c),k=j.get(d+";"+e);return k.onsuccess=function(a){if(a.target.result){var b=a.target.result;b.head=JSON.stringify(f);var i=j.put(b);i.onsuccess=function(){g.resolve(f)}}else h.create(c,d,e).done(function(){h.storeToHead(c,d,e,f).done(function(){g.resolve(f)})})},g},store:function(c,d,e,f){var g=a.Deferred();c="data"==c||"localdata"==c?"localdata":"localview";var h=b.transaction(c,"readwrite"),i=h.objectStore(c),j=i.get(d+";"+e),f=JSON.stringify(f);return j.onsuccess=function(a){if(null==a.target.result)b.create(c,d,e).done(function(a){var d=b.transaction(c,"readwrite"),e=d.objectStore(c);a.head=f;var h=e.put(a);h.onsuccess=function(){g.resolve(f)}});else{var h=a.target.result;h.list.push(f);var j=i.put(h);j.onsuccess=function(){g.resolve(f)}}},g},getHead:function(a,b,c){var d=this;return this.open().pipe(function(){return d.getAll(a,b,c).pipe(function(a){return a.head})})},getList:function(a,c,d){return b.getAll(a,c,d).pipe(function(a){return a.list})}}}),define("src/util/versionhandler",["src/util/util","src/util/localdb"],function(a,b){var c=function(){this.currentPath=[],this._allData={},this.dom=$("<div />"),this.versionChangeDeferred=$.Deferred(),this._data={},this.structure={server:{title:"Server",children:{head:{title:"Head"},stored:{title:"Stored",children:!0}}},local:{title:"Local DB",children:{head:{title:"Head"},stored:{title:"Stored",children:!0}}}}};return c.prototype={setType:function(a){this.type=a},set reviver(a){this._reviver=a},getData:function(){var a=this;return"server"==this.currentPath[1]?this._getServer().pipe(function(b){return"view"==a.type?a._data.server=new DataObject(b,!0):"data"==a.type?a._data.server=new DataObject(b,!0):void 0},function(){return!1}):this._getLocal().pipe(function(b){return"object"!=typeof el&&(el=JSON.parse(el)),"view"==a.type?a._data.local=new DataObject(b,!0):"data"==a.type?a._data.local=new DataObject(b,!0):void 0},function(){return!1})},getBranches:function(){var a=this;return $.when(this.getData()).pipe(function(b){var c={};for(var d in b)c[d]=d+" ("+(b[d].list.length+("local"==a.currentPath[1]?1:0))+")";return c})},getElements:function(){var a=this,b=this.currentPath[2];return $.when(this.getData()).pipe(function(c){data=c[b].list;var d={};"local"==a.currentPath[1]&&c[b].head&&(d.head=a.makeFilename(c[b].head));for(var e=data.length-1;e>=0;e--)d[data[e]._time]=a.makeFilename(data[e]);return d})},makeFilename:function(b){if(!b._time)return"Head";var c=new Date(b._time),d=c.getDate()+"/"+c.getMonth()+"/"+c.getFullYear()+" ";return d+=a.pad(c.getHours())+":"+a.pad(c.getMinutes())},_getLocal:function(){var a=this;return b.open().pipe(function(){return b.getAll(a.type,a._dirUrl).pipe(function(a){return console.log(a),a})})},_getServer:function(){var a=$.Deferred();return $.ajax({url:this.getUrl(),type:"get",dataType:"json",data:{action:"Dir"},success:function(b){for(var c in b){b[c].list=[];for(var d in b[c].revisions)b[c].list.push({_time:b[c].revisions[d]})}a.resolve(b)},error:function(){a.reject()}}),a},makeMenu:function(a){var b=this.structure,c=this;return 1==a?b={server:"Server",local:"Local Database"}:2==a?b=this.getBranches():3==a&&(b=this.getElements()),$.when(b).pipe(function(b){return b instanceof Array?c.arrayToMenu(b,a,c.currentPath[a-1]||null,c.currentPath[a-2]||null):c.objectToMenu(b,a,c.currentPath[a-1]||null,c.currentPath[a-2]||null)})},arrayToMenu:function(a,b,c,d){for(var e="",f=0,g=a.length;g>f;f++)e+='<li draggable="false" data-parent-parent="'+d+'" data-parent="'+c+'" data-el="'+a[f][1]+'"><a>'+a[f][0]+(3>b?'<ul draggable="false" class="ci-dataview-menu" data-level="'+(b+1)+'"><li><a>Fetching data...</a></li></ul>':"")+"</a></li>";return e},objectToMenu:function(a,b,c,d){var e="";for(var f in a)e+='<li draggable="false" data-parent-parent="'+d+'" data-el="'+f+'" data-parent="'+c+'"><a>'+a[f]+(3>b?'<ul draggable="false" class="ci-dataview-menu" data-level="'+(b+1)+'"><li><a>Fetching data...</a></li></ul>':"")+"</a></li>";return e},bindEventsMenu:function(a){var b=this;a.on("mouseenter","li",function(){var a=$(this);if(!(a.find(".ci-fetched").length>0)){var c=a.parent(),d=c.data("level");if(b.currentPath[d]=a.data("el"),3!=d)return b.makeMenu(d+1).then(function(c){c=$(c),a.find("ul").html(c).addClass("ci-fetched"),d+1==3&&"head"==b.currentPath[2]&&c.find("ul").remove(),b._menu.menu("refresh")},function(){a.find("ul").html("<li><a>No element here</a></li>").addClass("ci-fetched"),b._menu.menu("refresh")}),!1}}),a.on("mouseup","li",function(){var a=$(this),c=a.parent(),d=c.data("level");b.currentPath[d]=a.data("el"),a.find("ul").length>0||b.clickLeaf(a)})},buildDom:function(a){var b='<ul draggable="false" class="ci-dataview">';return b+=this._buildDomEl(1,this.currentPath[1]),b+=this._buildDomEl(2,this.currentPath[2]),b+=this._buildDomEl(3,this.makeFilename(a)),b+'<li class="ci-spacer"></li></ul>'},_buildDomEl:function(a,b){var c,d;return 1==a?"server"==b?(c="On Server",d="server"):(c="Local DB",d="local"):2==a?(c=b,d=b):(c=b,d=b),'<li draggable="false" class="ci-dataview-lvl ci-dataview-lvl-'+a+'" data-level="'+a+'" data-value="'+escape(d)+'">'+c+"</li>"+(3>a?'<li class="inter">></li>':"")},bindEventsDom:function(a){var b=this;a.on("mousedown","li",function(){var a=$(this),c=a.position();b.makeMenu(a.data("level")).done(function(d){d=$('<ul draggable="false" class="ci-dataview-menu" data-level="'+a.data("level")+'"></ul>').append(d).menu(),b._menu=d,b.bindEventsMenu(d),d.appendTo("#visualizer-dataviews").css({position:"absolute",left:c.left,top:c.top+a.outerHeight(!0)})})}),$(document).on("mouseup",function(){$(".ci-dataview-menu").remove()})},getDom:function(){return this.dom},doUpdateButtons:function(){this.updateButtons&&this.updateButtons(this.type,this.currentPath[3],this.currentPath[1])},make:function(a){this.currentElement=a,this.doUpdateButtons();var b=$(this.buildDom(a));this.bindEventsDom(b),this.dom.empty().html(b),this.versionChange().notify(a),this._html=b},versionChange:function(){return this.versionChangeDeferred},clickLeaf:function(a){var b=this,c=a.data("el"),d=a.data("parent"),e=a.data("parent-parent");if("server"==e){var f={branch:d};"head"!==c&&(f.revision=c),this.getFromServer(f).done(function(a){b.currentPath[1]="server",b.currentPath[2]=d,b.currentPath[3]=c,b.make(a,d,c),b._savedServer=JSON.stringify(a),b.onReload(a)})}else $.when(this.getData()).done(function(a){if(a=a[d],"head"==c)a=a.head;else for(var e=0,f=a.list.length;f>e;e++)if(a.list[e]._time==c){a=a.list[e];break}b.currentPath[1]="local",b.currentPath[2]=d,b.currentPath[3]=c,b.make(a,d,c),b._savedLocal=JSON.stringify(a),b.onReload(a)})},loadReadonly:function(a){var b=this,c=this._defaultUrl;$.ajax({url:c,timeout:2e5,dataType:"text",success:function(c){c=b._reviver(JSON.parse(c)),b.make(c),b._onLoaded(c),a.resolve()}})},load:function(a,b,c){function d(a,b,c){f.currentPath[1]="local",f.currentPath[2]=b,f.currentPath[3]=c,f._savedLocal=JSON.stringify(a),f.make(a,f.currentPath[2],f.currentPath[3]),g.resolve(a),f._onLoaded(a)}function e(a,b,c){f.currentPath[1]="server",f.currentPath[2]=b,f.currentPath[3]=c,f.make(a,f.currentPath[2],f.currentPath[3]),f._savedServer=JSON.stringify(a),g.resolve(a),f._onLoaded(a)}this._dirUrl=a,this._defaultUrl=c,this.defaultBranch=b;var f=this,g=$.Deferred();if(!this._dirUrl&&this._defaultUrl)return this.loadReadonly(g),g;{var h=this.defaultBranch||"Master",i=this.getFromServer({branch:h,action:"Load"});f._getLocalHead(h)}return $.when(i).then(function(a){var b=a._name||f.defaultBranch,c=a._time||"head",g=(a._saved||0,f._getLocalHead(b));$.when(g).then(function(g){if(g._saved){{g._saved||0}g._name=b,e(a,b,c)}else f.serverCopy(a,b,"head").done(function(){d(a,a._name,"head")})},function(){e(a,b,c)})},function(){$.when(f._getLocalHead(h)).then(function(a){d(a,h,a._time||"head")})}),g},getUrl:function(){return this._dirUrl},getMonth:function(b){return a.getMonth(b)},getDay:function(b){return a.getDay(b)},_getLocalHead:function(a){a=a||"Master";return b.getHead(this.type,this._dirUrl,a).pipe(function(a){return"object"!=typeof a&&(a=JSON.parse(a)),a})},_localSave:function(a,c,d){var e=this;return a._local=!0,a._time="head"==c?!1:Date.now(),a._saved=Date.now(),b.open().pipe(function(){return b["head"==c?"storeToHead":"store"](e.type,e._dirUrl,d,a).pipe(function(b){return e.currentPath[1]="local",e.currentPath[2]=d,e.currentPath[3]=a._time||"head",b})})},localSave:function(a){this._localSave(a,a._time,a._name)},localSnapshot:function(a){a&&this._localSave(a,"stored",a._name||"Master").pipe(function(a){return a._time=!1,a})},localAutosave:function(a,b,c){var d=this;this._autosaveLocal&&window.clearInterval(this._autosaveLocal),a&&(this._autosaveLocal=window.setInterval(function(){var a=b();d._localSave(a,"head",a._name||"Master").done(function(){c&&c()})},1e4))},localBranch:function(a,b){a._name=b,a._time=!1;var c=this;return this._localSave(a,"head",b).pipe(function(a){c.make(a,c.currentPath[2],c.currentPath[3])})},localRevert:function(a){var b=this;a._time=!1,this._localSave(a,"head",a._name||"Master").done(function(a){b.make(a,b.currentPath[2],b.currentPath[3])})},autosaveServer:function(a,b,c){var d=this;this._autosaveServer&&window.clearInterval(this._autosaveServer),a&&(this._autosaveServer=window.setInterval(function(){d._saveToServer(b()).done(function(){c&&c()})},1e4))},_saveToServer:function(a){return a._local=!1,a._saved=Date.now(),a._time=Date.now(),this._savedServer=JSON.stringify(a),$.ajax({type:"post",url:this.getUrl(),data:{content:this._savedServer,branch:a._name,revision:a._saved,action:"Save"}})},getFromServer:function(a){var b=this,c=$.Deferred(),d=this.getUrl()||this._defaultUrl;return d?(a.action="Load",$.ajax({dataType:"text",type:"get",url:d,cache:!1,data:a||{},success:function(a){b._savedServer=a,a=b._reviver(JSON.parse(a)),c.resolve(a)},error:function(){c.reject()}}),c):c.resolve({})},serverCopy:function(a,b){var c=this;return a._name=a._name||b||"Master",a._time=!1,a._saved=Date.now(),this._localSave(a,"head",a._name).pipe(function(b){return c.make(b,a._name,"head")})},serverPush:function(a){return this._saveToServer(a)},_onLoaded:function(a){var b;b=DataObject.check(a,1),this.onLoaded(b)}},c}),define("src/main/variables",["jquery","src/util/util","src/main/datas","src/util/debug"],function(a,b,c,d){function e(a){return j[a]?j[a]:f(a)}function f(a){return j[a]=new l(a),j[a]}function g(a,b,c,d){var f=e(a),g=!1;f.killFilter&&f.killFilter(),f.killFilter=!1,d&&(g=function(a,b,c){require([d],function(d){return d.kill&&(f.killFilter=d.kill),d.filter?d.filter(a,b,c):void c("No filter function defined")})}),b?f.setjPath(b,g):f.createData([a],c,g)}function h(){return Object.keys(j).sort()}function i(a){var b,c,d,e,f,g=a.jpath,h=g.length;a:for(d in j)if(b=j[d],c=b.getjPath()){for(f=Math.min(c.length,h),e=0;f>e;e++)if(g[e]!==c[e])continue a;b.triggerChange()}}var j={},k=new DataObject;k.onChange(i);var l=function(a){var b={writable:!0,enumerable:!1};Object.defineProperties(this,{_name:b,_jpath:b,_value:b,listenedBy:b,listeners:b}),this.setName(a),this.listenedBy={},this.listeners=[]};return a.extend(!0,l.prototype,{setName:function(a){this._name=a},getName:function(){return this._name},setjPath:function(a,b){this._jpath=a,"string"==typeof this._jpath&&(this._jpath=this._jpath.split("."),this._jpath.shift()),this.triggerChange(b)},getjPath:function(){return this._jpath},createData:function(a,b,c){k.setChild(a,b),this.setjPath(a,c)},getData:function(){return this._value},setData:function(a){k.setChild(this.getjPath(),a),this._setValue(a),a.triggerChange()},_setValue:function(a){this._value=a},getValue:function(){return this._value},listen:function(a,b){this.listenedBy[a.getId()]&&d.warn("This module already listens the variable "+this.getName()+". No new listener is added"),this.listenedBy[a.getId()]=!0,this.listeners.push(b)},triggerChange:function(a){var b=this;this.rejectCurrentPromise&&(this.rejectCurrentPromise("latency"),this.rejectCurrentPromise=!1),this.currentPromise=new Promise(function(c,e){b.rejectCurrentPromise=e;var f=c,g=e;k.trace(b._jpath).then(function(c){function e(c){a?new Promise(function(b,d){a(c,b,d)}).then(function(a){a=DataObject.check(a,!0),b._setValue(a),f(a)},function(a){d.warn("Error during variable filtering : ",a),g("filter")}):(b._setValue(c),f(c))}c&&c.fetch?c.fetch().then(e):e(c)},function(a){g(a)})}),this.currentPromise.catch(function(a){"filter"!==a&&"latency"!==a&&d.error("Error in getting the variable through variable.js",a)});for(var c=0,e=b.listeners.length;e>c;c++)b.listeners[c].call(b,b)},onReady:function(){return this.currentPromise}}),{getVariable:e,setVariable:g,getNames:h,getData:function(){return k}}}),define("src/util/versioning",["src/util/versionhandler","src/util/debug","src/main/variables"],function(a,b,c){function d(a,b){var c;a.data&&(p.data.url!==a.data.url||p.data.urls!==a.data.urls&&p.data.branch!==a.data.branch)?(c=f(a.data.urls,a.data.branch,a.data.url),p.data=a.data):c=$.Deferred().resolve(),a.view&&(p.view.url!==a.view.url||p.view.urls!==a.view.urls&&p.view.branch!==a.view.branch)&&c.done(function(){e(a.view.urls,a.view.branch,a.view.url),p.view=a.view}),b&&require(["uri/URI.fragmentQuery"],function(b){var c=new b(window.location.href);a.data&&(c["remove"+q](["dataURL","dataBranch","results"]),a.data.urls?(c["add"+q]("results",a.data.urls),a.data.branch&&c["add"+q]("dataBranch",a.data.branch)):a.data.url&&c["add"+q]("dataURL",a.data.url)),a.view&&(c["remove"+q](["viewURL","viewBranch","views"]),a.view.urls?(c["add"+q]("views",a.view.urls),a.view.branch&&c["add"+q]("viewBranch",a.view.branch)):a.view.url&&c["add"+q]("viewURL",a.view.url)),window.history.pushState({type:"viewchange",value:a},"",c.href())})}function e(a,b,c){return m.load(a,b,c)}function f(a,b,c){return l.load(a,b,c)}function g(a){var b;for(b in n)delete n[b];for(b in a)n[b]=DataObject.recursiveTransform(a[b])}function h(a){var b,c;for(b in o)delete o[b];for(b in a)c=DataObject.check(a[b],!0),o[b]=c,c.linkToParent(o,b);o.triggerChange()}function i(a){return isNaN(a)?0/0:parseInt(a)}function j(a){if(!a)return b.error("no version");var c=a.split(".");if(3!==c.length)return b.error("version number is invalid: "+a);var d={major:i(c[0]),minor:i(c[1]),patch:i(c[2]),prerelease:!1},e=c[2].split("-");return e.length>1&&(d.patch=parseInt(e[0]),d.prerelease=e[1]),d.major>=0&&d.minor>=0&&d.patch>=0?d:b.error("version number is invalid: "+a)}var k=[2,5,1].join(".");if(!j(k))throw new Error("Version number is invalid: "+k);var l=new a,m=new a,n=new DataObject,o=c.getData(),p={view:{},data:{}},q="Search";return m.version=k,l.setType("data"),m.setType("view"),l.reviver=function(a){return DataObject.check(a,1,!1)},m.reviver=function(a){return DataObject.check(a,1,!1)},window.onpopstate=function(a){a.state&&"viewchange"===a.state.type&&d(a.state.value,!1)},{get version(){return String(k)},setView:e,setData:f,getView:function(){return n},getViewJSON:function(a){return JSON.stringify(n,null,a)},getData:function(){return o},getDataJSON:function(a){return JSON.stringify(o,null,a)},getViewHandler:function(){return m},getDataHandler:function(){return l},setViewLoadCallback:function(a){this.viewCallback=a;
var b=this;m.onLoaded=function(c){g(c),a.call(b,n)},m.onReload=function(c){g(c),a.call(b,n,!0)}},setDataLoadCallback:function(a){this.dataCallback=a;var b=this;l.onLoaded=function(c){h(c),a.call(b,o)},l.onReload=function(c){h(c),a.call(b,o,!0)}},setViewJSON:function(a){g(a),this.viewCallback(n,!0),m.versionChange().notify(n)},setDataJSON:function(a){h(a),this.dataCallback(o,!0)},blankView:function(){this.setViewJSON({})},switchView:d,setURLType:function(a){q=a},isViewLocked:function(){return this.getView().configuration.lockView||!1},semver:j}}),define("src/header/header",["require","jquery","src/util/versioning"],function(a,b,c){var d=[];return{init:function(a){var d=this;a.elements&&this.loadHeaderElements(a.elements),this.dom=b('<div id="header"><div id="title"><div></div></div></div>'),b("#ci-visualizer").prepend(this.dom),this.setHeight(a.height||"30px"),this._titleDiv=b("#title").children("div"),this._titleDiv.attr("contenteditable","true").bind("keypress",function(a){a.stopPropagation(),13===a.keyCode&&(a.preventDefault(),b(this).trigger("blur"))}).bind("blur",function(){c.getView().configuration.set("title",b(this).text().replace(/[\r\n]/g,""))}),c.getViewHandler().versionChange().progress(function(a){d.setTitle(a)})},setHeight:function(a){this.dom.css("height",a),b("#modules-grid").css("margin-top",a)},setTitle:function(a){this._titleDiv.text(a.configuration?a.configuration.title:"Untitled")},loadHeaderElements:function(a){if(b.isArray(a)){for(var c=this,e=0,f=a.length;f>e;e++)this.addHeaderElement(e,this.createElement(a[e]));b.when.apply(b.when,d).then(function(){c.buildHeaderElements(arguments)})}},addHeaderElement:function(a,b){d[a]=b},createElement:function(c){var d=b.Deferred();return a(["./components/"+c.type],function(a){var b=new a;b.init(c),d.resolve(b)}),d.promise()},buildHeaderElements:function(a){this.ul&&this.ul.empty(),this.ul=this.ul||b("<ul />").appendTo(this.dom);for(var c=0,d=a.length;d>c;c++)this.ul.append(a[c].getDom())}}}),define("src/util/event",[],function(){function a(){}var b=Array.prototype.slice;return a.prototype.on=function(a){return this.topics=this.topics||[],this.topics[a]=this.topics[a]||$.Callbacks(),this.topics[a].add.apply(this.topics[a],b.call(arguments,1)),this},a.prototype.off=function(a){return this.topics&&this.topics[a]&&this.topics[a].remove.apply(this.topics[a],b.call(arguments,1)),this},a.prototype.trigger=function(a){this.topics&&this.topics[a]&&this.topics[a].fireWith(this,b.call(arguments,1))},a}),define("src/util/repository",["jquery","src/util/event"],function(a,b){var c=-1,d=function(a,b,c,e){for(var f=0,g=b.length;g>f;f++)if(b[f]instanceof Array)d(a,b[f],c,e);else if(a._keys[b[f]]=a._keys[b[f]]||[],e)a._keys[b[f]].push(c);else{var h=a._keys[b[f]].indexOf(c);if(-1==h)continue;a._keys[b[f]].splice(h,1)}},e=function(a,b){for(var c=b.slice(0),d={},e=0,g=a.length;g>e;e++)d[a[e]]=!0;return f(d,c,!0)},f=function(a,b,c){var d,e,g=0,h=[];for(g=0,d=b.length;d>g;g++){if(e=b[g],e instanceof Array&&(e=f(a,e,!c)),!a[e]&&!c)return null;a[e]&&h.push(e)}return h},g=function(a){this._killers={},this._value=[],this.options=a||{doNotSave:!1},this.on("change",function(a,b){var c={};this._keys=this._keys||[],a=a instanceof Array?a:[a];for(var d=0;d<a.length;d++)if(void 0!=this._keys[a[d]])for(var f=0;f<this._keys[a[d]].length;f++)c[this._keys[a[d]][f]]=!0;for(var d in c){var g=this._callbacks[d];if(g){var h=e(g[0],a);(h.length>0||(!h||0==h.length)&&g[2])&&g[1](b,h)}}})};return a.extend(g.prototype,b.prototype),g.prototype.get=function(a){return this.options.doNotSave!==!0?this._value[a]:void 0},g.prototype.set=function(a,b,c){a instanceof Array?a.length||(a=[]):a=[a],this._value=this._value||[],this.options.doNotSave!==!0&&(this._value[a]=[a,b]),c||this.trigger("change",a,b)},g.prototype.listen=function(a,b,e,f){if(this._keys=this._keys||{},this._callbacks=this._callbacks||[],a instanceof Array||(a=[a]),a&&void 0!=a.length&&0!=a.length){var g=++c;return this._callbacks[g]=[a,b,e],f&&(this._killers[f]=this._killers[f]||[],this._killers[f].push(g)),d(this,a,g,!0),c}},g.prototype.kill=function(a){if(this._killers[a]){for(var b=this._killers[a],c=0,e=b.length;e>c;c++)d(this,this._callbacks[b[c]][0],b[c],!1),delete this._callbacks[b[c]];this._killers[a]=[]}},g.prototype.resetVariables=function(){this._keys={},this._value=[]},g.prototype.resetCallbacks=function(){this._killers={},this._callbacks=[]},g.prototype.unListen=function(a,b){this._keys=this._keys||{},this._callbacks=this._callbacks||[],this._callbacks[b]=void 0,d(this,a,b,!1)},g.prototype.resendAll=function(){if(this.options.doNotSave!==!0)for(var a in this._value)this.set(this._value[a][0],this._value[a][1])},g.prototype.getKeys=function(){var a=this._value,b=[];for(var c in a)b.push(c);return b},g}),define("src/data/structures",[],function(){var a={mol2d:"string",molfile2D:"string",jme:"string",doi:"string",gif:"string",svg:"string",picture:"string",string:"string",jpg:"string",jpeg:"string",png:"string",svg:"string",number:"number",mf:"string",jcamp:"string",downloadLink:"string",html:"string","boolean":"boolean",array:"array",colorBar:{type:"array",elements:{type:"array",elements:["number","string"]}},indicator:{type:"array",elements:{color:"string",bgcolor:"string",text:"string","class":"string",icon:"string",css:"object",tooltip:"string"}},styledValue:{type:"object",elements:{css:"object",value:"object"}},arrayXY:{type:"array",elements:["number","number"]},matrix:{type:"object"},tree:{type:"object"},fromTo:{type:"object",elements:{from:"number",to:"number"}},loading:{type:"object",elements:{title:"string",series:{type:"array",nbElements:6,elements:{type:"object",elements:{label:"string",data:{type:"array",elements:{type:"object",elements:{a:"number",c:"string",h:"number",info:"object",l:"string",u:"string",n:"string",o:"number",w:"number",x:"number",y:"number"}}}}}}}},gridSelector:{type:"object",elements:{categories:{type:"array",elements:{type:"object",elements:{selectorType:"string",name:"string",label:"string",defaultValue:"number",defaultMaxValue:"number",defaultMinValue:"number",maxValue:"number",minValue:"number"}}},variables:{type:"array",elements:{type:"object",elements:{name:"string",label:"strig"}}}}},chemical:{type:"object",elements:{_entryID:"int",supplierName:"string",_dateCreated:"string",_dateLastModified:"string",iupac:{type:"array",nbElements:2,elements:{type:"object",elements:{value:"string",language:"string"}}},mf:{type:"array",nbElements:2,elements:{type:"object",elements:{value:"mf",mw:"int",exactMass:"int"}}},mol:{type:"array",nbElements:2,elements:{type:"object",elements:{value:"molfile2D",gif:"gif"}}},rn:{type:"array",nbElements:2,elements:{type:"object",elements:{value:"int"}}},batchID:"string",catalogID:"string",entryDetails:"chemicalDetails"}},chemicalDetails:{type:"object",elements:{_entryID:"int",supplierName:"string",_dateCreated:"string",_dateLastModified:"string",iupac:{type:"array",elements:{type:"object",elements:{value:"string",language:"string"}}},mf:{type:"array",elements:{type:"object",elements:{value:"mf",mw:"int",exactMass:"int"}}},mol:{type:"array",elements:{type:"object",elements:{value:"molfile2D",gif:"gif"}}},rn:{type:"array",elements:{type:"object",elements:{value:"int"}}},batchID:"string",catalogID:"string",bp:{type:"array",elements:{type:"object",elements:{pressure:"number",high:"number",low:"number"}}},mp:{type:"array",elements:{type:"object",elements:{pressure:"number",high:"number",low:"number"}}},rn:{type:"array",elements:{type:"object",elements:{value:"number"}}},density:{type:"array",elements:{type:"object",elements:{high:"number",low:"number",temperature:"number"}}},mol3d:{type:"array",elements:"molfile3d"},ir:{type:"array",elements:{type:"object",elements:{conditions:"string",solvent:"string",jcamp:"jcamp",view:{type:"object",elements:{description:"string",value:"string",url:"string",pdf:"string"}}}}},nmr:{type:"array",elements:{type:"object",elements:{pressure:"string",solvent:"string",experiment:"string",frequency:"number",nucleus:"string",temperature:"string",jcamp:"jcamp",view:{type:"object",elements:{description:"string",value:"string",url:"string",pdf:"string"}}}}},nmrExperiment:{type:"object",elements:{"1H":{type:"array",elements:{type:"object",elements:{pressure:"string",solvent:"string",experiment:"string",frequency:"number",nucleus:"string",temperature:"string",jcamp:"jcamp",view:{type:"object",elements:{description:"string",value:"string",url:"string",pdf:"string"}}}}},"13C":{type:"array",elements:{type:"object",elements:{pressure:"string",solvent:"string",experiment:"string",frequency:"number",nucleus:"string",temperature:"string",jcamp:"jcamp",view:{type:"object",elements:{description:"string",value:"string",url:"string",pdf:"string"}}}}},cosy:{type:"array",elements:{type:"object",elements:{pressure:"string",solvent:"string",experiment:"string",frequency:"number",nucleus:"string",temperature:"string",jcamp:"jcamp",view:{type:"object",elements:{description:"string",value:"string",url:"string",pdf:"string"}}}}},hsqc:{type:"array",elements:{type:"object",elements:{pressure:"string",solvent:"string",experiment:"string",frequency:"number",nucleus:"string",temperature:"string",jcamp:"jcamp",view:{type:"object",elements:{description:"string",value:"string",url:"string",pdf:"string"}}}}},hmbc:{type:"array",elements:{type:"object",elements:{pressure:"string",solvent:"string",experiment:"string",frequency:"number",nucleus:"string",temperature:"string",jcamp:"jcamp",view:{type:"object",elements:{description:"string",value:"string",url:"string",pdf:"string"}}}}},jresolv:{type:"array",elements:{type:"object",elements:{pressure:"string",solvent:"string",experiment:"string",frequency:"number",nucleus:"string",temperature:"string",jcamp:"jcamp",view:{type:"object",elements:{description:"string",value:"string",url:"string",pdf:"string"}}}}}}},mass:{type:"array",elements:{type:"object",elements:{experiment:"string",jcamp:"jcamp"}}},massExperiment:{type:"object",elements:{hplcMS:{type:"array",elements:{type:"object",elements:{experiment:"string",jcamp:"jcamp"}}},gcMS:{type:"array",elements:{type:"object",elements:{experiment:"string",jcamp:"jcamp"}}},ms:{type:"array",elements:{type:"object",elements:{experiment:"string",jcamp:"jcamp"}}}}}}},geojson:"object",pdb:"string",magres:"string",jsmolscript:"string"},b=function(){return Object.keys(this).sort()},c=function(a,b){if(this[a]){var c,d={type:a};if("string"==typeof this[a])switch(this[a]){case"string":c=b;break;case"number":c=parseFloat(b);break;case"boolean":c=!!b;break;default:c=JSON.parse(b)}else c=JSON.parse(b);return d.value=c,DataObject.check(d,!0)}};return Object.defineProperty(a,"_getList",{value:b}),Object.defineProperty(a,"_parse",{value:c}),a}),define("src/util/datatraversing",["jquery","src/data/structures"],function(a,b){function c(b,d){var e=g(b),f=d.shift();return f?e&&(e=e[f])!==!1?h(e).pipe(function(a){return c(a,d)}):a.Deferred().reject():a.Deferred().resolve(b)}function d(a,b,c,e,f){var i,j=g(a);if("object"!=typeof j&&b.length>0&&(j={}),1==b.length)return j[b[0]]=c;var l=b.shift();return l?((i=j[l])||(i={},j[l]=i),h(i).pipe(function(a){return d(a,b,c)}).done(function(){f||k(j,e)})):void 0}function e(a){return a?a._options?a._options:{}:{}}function f(a){return a?a._highlight?a._highlight:[]:[]}function g(a){return"undefined"!=typeof a?"object"==typeof a&&a.url?h(a).pipe(function(a){return a.value}):a.value&&a.type?a.value:a:void 0}function h(b){var c=a.Deferred();if("undefined"==typeof b||null==b)return c.reject();var d=i(b);return b.url&&b.type?(require(["src/util/urldata"],function(a){a.get(b.url,!1,b.timeout).then(function(a){a={type:d,value:a},c.resolve(a)},function(){console.log("Fetching error")})}),c):c.resolve(b)}function i(a){if(void 0!=a){if(a.getType)return a.getType();var c=typeof a;return"object"==c?a instanceof Array?"array":b[a.type]&&(a.value||a.url)?a.type:"undefined"!=typeof a.type&&a.value?void console.error("Type "+a.type+" could not be found"):"object":c}}function j(a,b,c){a.__onDataChanged||(a.__onDataChanged=[]),a.__onDataChanged.push([b,c])}function k(a,b){if(a.__onDataChanged)for(var c=0,d=a.__onDataChanged.length;d>c;c++)(void 0!==b&&a.__onDataChanged[c][1]!==b||void 0===b)&&a.__onDataChanged[c][0].call(a,a)}return{getType:i,getValueIfNeeded:g,fetchElementIfNeeded:h,getValueFromJPath:function(b,d){if(!d)return a.Deferred().resolve(b);d.split||(d="");var e=d.split(".");return e.shift(),c(b,e)},setValueFromJPath:function(a,b,c,e,f){b.split||(b="");var g=b.split(".");return g.shift(),(e===!0||e===!1)&&(f=e,e=void 0),d(a,g,c,e,f)},getJPathsFromStructure:function(a,c,d,e){if(a){var f,g,h=[];if(a.elements)switch(e?e+="."+c:e=c="element",d.push({title:c,children:h,key:e}),a.type){case"object":for(g in a.elements)this.getJPathsFromStructure(a.elements[g],g+"",h,e);break;case"array":for(a.elements instanceof Array||(a.elements=[a.elements]),f=Math.min(5,a.elements.length||0),a.nbElements&&(f=a.nbElements),g=0;f>g;g++)this.getJPathsFromStructure(a.elements[g]||a.elements[0],g+"",h,e)}else"string"==typeof a&&"object"==typeof b[a]?this.getJPathsFromStructure(b[a],c,d,e):(e&&null!=e?e+="."+c:e=c="element",d.push({title:c,children:h,key:e}))}},getStructureFromElement:function(a){var c={};if(a){a.getType||(a=DataObject.check(a,!0));var d=a.getType();if("array"==d){c.type="array",c.elements=[];for(var e=Math.min(5,a.length),f=0;e>f;f++)c.elements[f]=this.getStructureFromElement(a.get(f,!1,!0))}else if("object"==d){c.type="object",c.elements={};for(var f in a)c.elements[f]=this.getStructureFromElement(a.get(f,!1,!0))}else c=d&&b[d]&&(a.value||a.url)?b[d]:d;return c}},getJPathsFromElement:function(a,c){if(c||(c=[]),void 0!==a&&null!=a){if(a.structure)this.getJPathsFromStructure(a.structure,null,c);else if(a.type&&b[a.type]&&(a.value||a.url))this.getJPathsFromStructure(b[a.type],null,c);else{var d=this.getStructureFromElement(a,d);this.getJPathsFromStructure(d,null,c)}return c}},get:function(a){if(a){if("function"==typeof a.get)return a.get();if(a.type&&a.value)return a.value}return a},getHighlights:f,getOptions:e,triggerDataChange:k,listenDataChange:j}}),define("src/util/actionmanager",["require"],function(require){function doScripts(){var data=getActionScripts();if(data&&!evaluatedScripts){for(var evaled={},i=0,l=data.length;l>i;i++)eval("evaled[ [ data[ i ].groups.action[ 0 ].name[ 0 ] ] ] = function(value) { "+data[i].groups.action[0].script[0]+" }");evaluatedScripts=evaled}}function getActionScripts(){return Versioning.getView().actionscripts||[]}function setActionScripts(a){evaluatedScripts=void 0,Versioning.getView().actionscripts=a,doScripts(a)}function setActionFiles(a){Versioning.getView().actionfiles=a,doFiles()}function doFiles(){var a=Versioning.getView().actionfiles;if(actionsFiles={},a)for(var b=0,c=a[0].groups.action[0].length;c>b;b++)actionsFiles[a[0].groups.action[0][b].name]=actionsFiles[a[0].groups.action[0][b].name]||[],actionsFiles[a[0].groups.action[0][b].name].push({file:a[0].groups.action[0][b].file,mode:a[0].groups.action[0][b].mode})}function executeActionFile(a,b){switch(a.mode){case"amd":require([a.file],function(a){a(b)});break;case"worker":var c=new Worker(a.file);c.postMessage({method:"actionValue",value:b}),c.onmessage=function(a){if(a.data.method)switch(a.data.method){case"getVar":if(!(a.data.variables instanceof Array))return;for(var b={},d=0,e=a.data.variables.length;e>d;d++)b[a.data.variables[d]]=API.getVar(a.data.variables[d]);c.postMessage({method:"getVar",variables:b});break;case"setVar":if(!a.data.variables)return;for(var d in a.data.variables)API.setVar(d,a.data.variables[d]);break;case"terminate":c.terminate();break;case"sendAction":if(!a.data.actionName)return;API.executeAction(a.data.actionName,a.data.actionValue);break;case"highlight":if(!a.data.highlightId)return;API.highlightId(a.data.highlightId,a.data.highlightValue||!1)}}}}var Versioning;require(["src/util/versioning"],function(a){Versioning=a});var API;require(["src/util/api"],function(a){API=a});var evaluatedScripts,actionsFiles;return{setScriptsFromForm:function(a){setActionScripts(a)},setFilesFromForm:function(a){setActionFiles(a)},viewHasChanged:function(a){setActionScripts(a.actionscripts),doFiles()},getScriptsForm:function(){return Versioning.getView().actionscripts||[]},getFilesForm:function(){return Versioning.getView().actionfiles||[]},execute:function(a,b){if(evaluatedScripts[a]&&evaluatedScripts[a](b),actionsFiles[a])for(var c=0,d=actionsFiles[a].length;d>c;c++)executeActionFile(actionsFiles[a][c],b)}}}),define("src/util/api",["src/util/datatraversing","src/util/actionmanager","src/main/variables"],function(a,b,c){function d(a,b,d,e){var f=b?b.getjPath().concat(d):d;b&&b.getData().trace(d),c.setVariable(a,f,!1,e)}function e(a){return c.getVariable(a)}function f(a,b,d){c.setVariable(a,!1,b,d)}function g(a,b,d,e){b=DataObject.check(b,!0),b&&b.getChild?b.getChild(d).then(function(b){c.setVariable(a,!1,b,e)}):c.setVariable(a,!1,b,e)}function h(a,b){a&&(a instanceof Array&&(a={_highlight:a}),"undefined"!=typeof a._highlight&&this.repositoryHighlights.set(a._highlight,b))}function i(a,b){this.repositoryHighlights.set(a,b)}var j,k=!1,l=["undefined","all","global-configuration","configuration","copy","paste","duplicate","add","layers","remove","export","print","refresh","tofront","toback","move","custom","fullscreen"],m=$('<div id="loading-visualizer"><div class="title">Loading</div><div class="animation"><div /><div /><div /><div /></div><div class="subtitle" id="loading-message"></div></div>'),n={},o=0;return{getRepositoryData:function(){return this.repositoryData},setRepositoryData:function(a){this.repositoryData=a},getRepositoryHighlights:function(){return this.repositoryHighlights},setRepositoryHighlights:function(a){this.repositoryHighlights=a},getRepositoryActions:function(){return this.repositoryActions},setRepositoryActions:function(a){this.repositoryActions=a},setVar:d,setVariable:d,resetVariables:function(){c.eraseAll()},getVar:e,getVariable:e,createData:f,createDataJpath:g,listenHighlight:function(){arguments[0]&&"undefined"!=typeof arguments[0]._highlight&&(arguments[0]=arguments[0]._highlight,this.repositoryHighlights.listen.apply(this.repositoryHighlights,arguments))},killHighlight:function(){this.repositoryHighlights.kill.apply(this.repositoryHighlights,arguments)},highlight:h,highlightId:i,setHighlight:h,doAction:function(a,b){this.repositoryActions.set(a,b)},executeAction:function(a,c){b.execute(a,c)},getAllFilters:function(){return j},setAllFilters:function(a){j=a,j.unshift({file:"",name:"No filter"})},viewLock:function(){$("body").addClass("locked"),k=!0},isViewLocked:function(){return k},setContextMenu:function(a){l=a},getContextMenu:function(){return l},loading:function(a){0==o&&$("#ci-visualizer").append(m),n[a]||(n[a]=$("<div>"+a+"</div>"),o++,$("#loading-message").append(n[a]))},stopLoading:function(a){n[a]&&(o--,n[a].detach(),n[a]=null,0==o&&m.detach())},dev_fctCalled:function(){},dev_fctUncalled:function(){},dev_assert:function(){}}}),define("src/util/context",["jquery","src/util/api","modules/modulefactory"],function(a,b){var c;return{listen:function(d,e,f,g){e[0]instanceof Array||(e=[e]),d.addEventListener("contextmenu",function(d){f&&f(c);for(var h=0,i=e.length;i>h;h++)!function(a,e,f){b.isViewLocked()||-1===b.getContextMenu().indexOf("all")&&-1===b.getContextMenu().indexOf(a.attr("name")||"undefined")||((f&&f(d,a)||!f)&&c.append(a),a.bind("click",function(a){e&&e.call(this,d,a)}))}(a(e[h][0]),e[h][1],e[h][2]);g&&g(c)},!0)},unlisten:function(a){a.removeEventListener("contextmenu")},getRootDom:function(){return this.dom},init:function(b){this.dom=b;var d,e;b.addEventListener("contextmenu",function(b){c&&(c.hasClass("ui-menu")&&c.menu("destroy"),c.remove()),c=null,d=b.pageY,e=b.pageX;var f=a('<ul class="ci-contextmenu"></ul>').css({position:"absolute",left:e,top:d,"z-index":1e4}).appendTo(a("body"));c=f;var g=function(){c&&(c.hasClass("ui-menu")&&c.menu("destroy"),c.remove()),c=null,a(document).unbind("click",g)};a(document).bind("click",g)},!0),b.parentNode.addEventListener("contextmenu",function(a){if(c.children().length>0){c.menu({select:function(a,b){b.item.attr("name")}}),a.preventDefault(),a.stopPropagation();var b=c.height(),f=c.width(),g=document.documentElement.clientHeight,h=document.documentElement.clientWidth;return d+b>g&&c.css("top",Math.max(0,g-b-10)),e+f>h&&c.css("left",Math.max(0,h-f-10)),!1}},!1)}}}),define("src/util/fullscreen",[],function(){function a(){var a=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement,f=b.view;a?(d=a.getAttribute("style"),a.setAttribute("style","height:100%; width:100%; background-color:white;"),c=a,e={height:f.height,width:f.width},f.height=b.getDomContent().height(),f.width=b.getDomContent().width()):(c.setAttribute("style",d),f.height=e.height,f.width=e.width,d=e=c=null),b.view.onResize()}var b,c,d,e;return document.addEventListener("fullscreenchange",a),document.addEventListener("webkitfullscreenchange",a),document.addEventListener("mozfullscreenchange",a),document.addEventListener("MSFullscreenChange",a),{requestFullscreen:function(a){if(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled){b=a;var c=a.getDomContent()[0];c.requestFullscreen?c.requestFullscreen():c.webkitRequestFullscreen?c.webkitRequestFullscreen():c.mozRequestFullScreen?c.mozRequestFullScreen():c.msRequestFullscreen&&c.msRequestFullscreen()}}}}),define("modules/module",["jquery","src/util/context","src/util/api","src/util/util","src/util/fullscreen","src/util/debug","src/main/variables","src/main/grid"],function(a,b,c,d,e,f,g){function h(b){var c=b.definition.getChildSync("url",!0).get(),e="";return c.toString&&(c=c.toString()),c.indexOf("http://")>-1&&(e=".js"),b.viewReady=new Promise(function(a){b._resolveView=a}),b.controllerReady=new Promise(function(a){b._resolveController=a}),b.modelReady=new Promise(function(a){b._resolveModel=a}),b._onReady=Promise.all([b.viewReady,b.controllerReady,b.modelReady]),b._onReady.then(function(){b.updateAllView()},function(a){f.error("Caught error in module ready state",a)}).catch(function(a){f.error("Caught error while updating module",a)}),new Promise(function(f,g){return c?(d.loadCss(c+"style.css"),void require([c+"model"+e,c+"view"+e,c+"controller"+e],function(c,d,e){b.model=new c,b.view=new d,b.controller=new e,b.controller.moduleInformation&&(b.dom=a(b.buildDom()),b.domContent=b.dom.children().children(".ci-module-content"),b.domHeader=b.dom.children().children(".ci-module-header"),b.domLoading=b.dom.children().children(".ci-module-loading"),b.domWrapper=b.dom,b.view.setModule(b),b.controller.setModule(b),b.model.setModule(b),b.view.initDefault(),b.view.init(),b.controller.init(),b.model.init(),f(b))})):void g()})}var i=function(a){this.definition=DataObject.recursiveTransform(a),this.definition.configuration=this.definition.configuration||new DataObject,this.definition.layers=this.definition.layers||new DataObject,this.ready=h(this),this.ready.catch(function(a){f.error("Caught error in module initialization.",a)})};return i.prototype={buildDom:function(){var a="";return a+='<div class="ci-module-wrapper ci-module-displaywrapper ci-module-',a+=this.controller.moduleInformation.cssClass,a+='" data-module-id="',a+=this.definition.id,a+='"',a+=' style="z-index: ',a+=this.definition.zindex||0,a+='"',a+='><div class="ci-module"><div class="ci-module-header',a+='"><div class="ci-module-header-title">',a+=this.definition.title,a+="</div>",a+='<div class="ci-module-header-toolbar">',a+="<ul>",a+="</ul>",a+="</div>",a+='</div><div class="ci-module-content">',a+="</div>",a+='<div class="ci-module-loading">Loading ...</div>',a+="</div>"},onReady:function(){return this._onReady},updateView:function(a){this.onReady().then(function(){var b=c.getVariable(this.getNameFromRel(a));b&&this.view.update&&this.view.update[a]&&this.view.update[a].call(this.view,b[1],b[0][0])},function(a){f.error("Error during view update",a)})},updateAllView:function(){if(this.view.update&&this.definition)for(var a,b=this.vars_in(),d=0,e=b.length;e>d;d++)a=c.getVar(b[d].name),this.model.onVarChange(a)},getDomContent:function(){if("undefined"!=typeof this.domContent)return this.domContent;throw"The module has not been loaded yet"},getDomWrapper:function(){if("undefined"!=typeof this.domWrapper)return this.domWrapper;throw"The module has not been loaded yet"},getDomView:function(){if("function"==typeof this.view.getDom)return this.view.getDom();throw"The module's view doest not implement the getDom function"},getDomHeader:function(){if("undefined"!=typeof this.domHeader)return this.domHeader;throw"The module has not been loaded yet"},getAcceptedTypes:function(a){var b=this.controller.references;return b?b[a]:!1},getDataFromRel:function(a){return this.model&&this.model.data?this.model.data[a]||!1:void 0},getVariableFromRel:function(a){var b=this.getNameFromRel(a);return c.getVar(b)},getNameFromRel:function(a){for(var b=this.vars_in(),c=0,d=b.length;d>c;c++)if(b[c].rel==a)return b[c].name;return!1},getData:function(){return this.model.data},getDataRelFromName:function(a){for(var b=this.vars_in(),c=0,d=b.length,e=[];d>c;c++)b[c].name==a&&e.push(b[c].rel);return e},getActionRelFromName:function(a){for(var b=this.actions_in(),c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c].rel;return!1},inDom:function(){this.view.inDom(),this.controller.inDom(),this.model.inDom();var a=this;c.isViewLocked()||b.listen(this.getDomWrapper().get(0),[['<li name="fullscreen"><a><span class="ui-icon ui-icon-arrow-4-diag"></span> Fullscreen</a></li>',function(){a.enableFullscreen()}],['<li name="export"><a><span class="ui-icon ui-icon-suitcase"></span> Export</a></li>',function(){a.exportData()}],['<li name="print"><a><span class="ui-icon ui-icon-print"></span> Print</a></li>',function(){a.printView()}],['<li name="configuration"><a><span class="ui-icon ui-icon-gear"></span> Parameters</a></li>',function(){a.doConfig()}]])},enableFullscreen:function(){e.requestFullscreen(this)},toggleLayer:function(a){var b;if(b=this.getActiveLayer(a)){if(!b.display)return void this.hide();this.show(),this.setTitle(b.title),this.setDisplayWrapper(b.wrapper),this.setBackgroundColor(b.bgColor||[255,255,255,1]),this.activeLayerName=a;var c=require("src/main/grid");return c.setModuleSize(this),c.moduleResize(this),window.dispatchEvent(new Event("resize")),b}},eachLayer:function(a){for(var b in this.definition.layers)a(this.definition.layers[b],b)},setLayers:function(b,c){this.definition.layers=this.definition.layers||new DataObject;for(var d in b)this.definition.layers[d]||(this.definition.layers[d]=new DataObject,c?(a.extend(!0,this.definition.layers[d],i.prototype.emptyConfig),this.definition.layers[d].name=d):a.extend(!0,this.definition.layers[d],this.getActiveLayer(this.getActiveLayerName())),this.definition.layers[d]=this.definition.layers[d].duplicate())},getActiveLayerName:function(){return this.activeLayerName},getActiveLayer:function(a){return a?this.definition.layers[a]:!1},hide:function(){this.getDomWrapper().hide()},show:function(){this.getDomWrapper().show()},doConfig:function(){function b(a){if(a){var c=0,d=a.length,e=[];if(Array.isArray(a))for(;d>c;c++)e.push({key:a[c].file||"",title:a[c].name,children:b(a[c].children)});return e}}var d=this,e=a("<div></div>").dialog({modal:!0,position:["center",50],width:"80%",title:"Edit module preferences"});e.prev().remove(),e.parent().css("z-index",1e3);var f,h,i,j=this.controller.references,k=this.controller.events,l=0,m=c.getAllFilters();i=b(m);var n=[];for(h=g.getNames(),l=0,f=h.length;f>l;l++)n.push({title:h[l],label:h[l]});var o=[];for(h=c.getRepositoryActions().getKeys(),l=0,f=h.length;f>l;l++)o.push({title:h[l],label:h[l]});var p=d.controller.variablesIn,q=[];for(l=0,f=p.length;f>l;l++)j[p[l]]&&q.push({key:p[l],title:j[p[l]].label});var r=[],s=function(){for(var a in j)r[a]=d.model.getjPath(a)};s();var t=function(a,b){var c,d,e=0,f=[];if(!k[a])return{};switch(b){case"event":c=k[a].refVariable||[];break;case"action":c=k[a].refAction||[]}for(d=c.length;d>e;e++)f.push({key:c[e],title:j[c[e]].label});return f},u=[],v=[];for(l in k)k[l].refVariable&&u.push({title:k[l].label,key:l}),k[l].refAction&&v.push({title:k[l].label,key:l});var w=this.controller.actionsIn||{},x=[];for(l in w)x.push({title:w[l],key:l});var y={};d.eachLayer(function(a,b){y[b]=b}),require(["forms/form"],function(b){var c=new b({});c.init({onValueChanged:function(){}});var f={sections:{module_infos:{options:{title:"Module informations",icon:"info_rhombus"},groups:{group:{options:{type:"text"}}}},module_config:{options:{title:"General configuration",icon:"page_white_paint"},groups:{layerDisplay:{options:{title:"Display on layers",type:"list"},fields:{displayOn:{type:"checkbox",title:"Display on layers",options:y}}}},sections:{layer:{options:{title:"Shown on layers"},groups:{group:{options:{type:"list",multiple:!0,title:!0},fields:{layerName:{type:"text",multiple:!1,title:"Layer name",displayed:!1},moduletitle:{type:"text",multiple:!1,title:"Module title"},bgcolor:{type:"color",multiple:!1,title:"Background color"},modulewrapper:{type:"checkbox",title:"Module boundaries",options:{display:""}}}}}}}}}},g=d.controller.configurationStructure();g&&(f.sections.module_specific_config=a.extend(g,{options:{title:"Module configuration",icon:"page_white_wrench"}})),q.length>0&&(f.sections.vars_in={options:{title:"Variables in",icon:"basket_put"},groups:{group:{options:{type:"table",multiple:!0},fields:{rel:{type:"combo",title:"Reference",options:q},name:{type:"text",title:"From variable",options:n},filter:{type:"combo",title:"Filter variable",options:i}}}}}),u.length>0&&(f.sections.vars_out={options:{title:"Variables out",icon:"basket_remove"},groups:{group:{options:{type:"table",multiple:!0},fields:{event:{type:"combo",title:"Event",options:u},rel:{type:"combo",title:"Reference"},jpath:{type:"combo",title:"jPath",options:{},extractValue:function(a){var b=(a||"").split(".");return b.shift(),b},insertValue:function(a){return a=(a||[]).slice(0),a.unshift("element"),a.join(".")}},filter:{type:"combo",title:"Filter variable",options:i},name:{type:"text",title:"To variable"}}}}}),x.length>0&&(f.sections.actions_in={options:{title:"Actions in",icon:"door_in"},groups:{group:{options:{type:"table",multiple:!0},fields:{rel:{type:"combo",title:"Reference",options:x},name:{type:"text",title:"Action name",options:o}}}}}),v.length>0&&(f.sections.actions_out={options:{title:"Actions out",icon:"door_out"},groups:{group:{options:{type:"table",multiple:!0},fields:{event:{type:"combo",title:"On event",options:v},rel:{type:"combo",title:"Reference"},jpath:{type:"combo",title:"jPath",options:{},extractValue:function(a){if(a){var b=a.split(".");return b.shift(),b}},insertValue:function(a){return a=(a||[]).slice(0),a.unshift("element"),a.join(".")}},name:{type:"text",title:"Action name"}}}}}),c.setStructure(f),c.onStructureLoaded().done(function(){c.getSection("vars_out")&&(c.getSection("vars_out").getGroup("group").getField("event").options.onChange=function(b){b.groupElement&&a.when(b.groupElement.getFieldElementCorrespondingTo(b,"rel")).then(function(a){a&&a.setOptions(t(b.value,"event"))})},c.getSection("vars_out").getGroup("group").getField("rel").options.onChange=function(b){b.groupElement&&a.when(b.groupElement.getFieldElementCorrespondingTo(b,"jpath")).then(function(a){a&&a.setOptions(r[b.value])})}),c.getSection("actions_out")&&(c.getSection("actions_out").getGroup("group").getField("event").options.onChange=function(b){b.groupElement&&a.when(b.groupElement.getFieldElementCorrespondingTo(b,"rel")).then(function(a){a&&a.setOptions(t(b.value,"action"))})},c.getSection("actions_out").getGroup("group").getField("rel").options.onChange=function(b){b.groupElement&&a.when(b.groupElement.getFieldElementCorrespondingTo(b,"jpath")).then(function(a){a&&a.setOptions(r[b.value])
})});var b='<table class="moduleInformation"><tr><td>Module name</td><td>'+d.controller.moduleInformation.moduleName+"</td></tr><tr><td></td><td><small>"+d.controller.moduleInformation.description+"</small></td></tr><tr><td>Module author</td><td>"+d.controller.moduleInformation.author+"</td></tr><tr><td>Creation date</td><td>"+d.controller.moduleInformation.date+"</td></tr><tr><td>Released under</td><td>"+d.controller.moduleInformation.license+"</td></tr></table>",e=[],f=[];d.eachLayer(function(a,b){a.display&&f.push(b),e.push({_title:b,layerName:[b],moduletitle:[a.title],bgcolor:[a.bgColor||[255,255,255,0]],modulewrapper:[a.wrapper===!0||void 0===a.wrapper?"display":""]})});var g={sections:{module_config:[{groups:{layerDisplay:[{displayOn:[f]}]},sections:{layer:[{groups:{group:e}}]}}],module_infos:[{groups:{group:[b]}}],module_specific_config:[d.definition.configuration||{}],vars_out:[{groups:{group:[d.vars_out()]}}],vars_in:[{groups:{group:[d.vars_in()]}}],actions_in:[{groups:{group:[d.actions_in()]}}],actions_out:[{groups:{group:[d.actions_out()]}}]}};c.fill(g)}),c.addButton("Cancel",{color:"blue"},function(){e.dialog("close")}),c.addButton("Save",{color:"green"},function(){var a=c.getValue().sections;d.definition.layers=d.definition.layers||{};for(var b=a.module_config[0].sections.layer[0].groups.group,f=a.module_config[0].groups.layerDisplay[0].displayOn[0],g=0,h=b.length;h>g;g++)d.definition.layers[b[g].layerName[0]].display=f.indexOf(b[g].layerName[0])>-1,d.definition.layers[b[g].layerName[0]].title=b[g].moduletitle[0],d.definition.layers[b[g].layerName[0]].bgColor=b[g].bgcolor[0],d.definition.layers[b[g].layerName[0]].wrapper=b[g].modulewrapper[0].indexOf("display")>-1;a.vars_out&&d.setSendVars(a.vars_out[0].groups.group[0]),a.vars_in&&d.setSourceVars(a.vars_in[0].groups.group[0]),a.actions_in&&d.setActionsIn(a.actions_in[0].groups.group[0]),a.actions_out&&d.setActionsOut(a.actions_out[0].groups.group[0]),a.module_specific_config&&(d.definition.configuration=a.module_specific_config[0]),d.view.unload&&d.view.unload(),d.controller.init(),d.view.init(),d.view.inDom(),d.toggleLayer(d.getActiveLayerName()),d.model.resetListeners(),d.updateAllView(),e.dialog("close"),document.getElementById("header").scrollIntoView(!0)}),c.onLoaded().done(function(){e.html(c.makeDom()),c.inDom()})})},getConfiguration:function(a,b){var c,d=this.definition.configuration,e=this.controller.configAliases[a];if(e){for(var f=0,g=e.length;g>f;f++)if(d=d[e[f]],"undefined"==typeof d){c=this._getConfigurationDefault(e,a);break}}else console.warn("Alias "+e+" not defined "),console.trace();return"undefined"==typeof c&&(c=this._doConfigurationFunction(d,a)),"undefined"==typeof c&&(c=b),c},getConfigurationCheckbox:function(a,b){var c=this.getConfiguration(a);return c instanceof Array?c.indexOf(b)>-1:void 0},_getConfigurationDefault:function(a,b){this._cfgStructure=this._cfgStructure||this.controller.configurationStructure();for(var c=this._cfgStructure,d=0,e=a.length;e>d;d++)if("number"!=typeof a[d])if(c.fields)d--,c=c.fields;else if(c=c[a[d]],!c)return console.warn("Error in configuration file - Alias is not a correct jPath"),!1;return this._doConfigurationFunction(c.default,b)},_doConfigurationFunction:function(a,b){if(this.controller.configFunctions[b])try{return this.controller.configFunctions[b](a)}catch(c){return a}return a},getValue:function(){return"function"==typeof this.model.getValue?this.model.getValue():void 0},getPosition:function(a){var b=this.getActiveLayer(a);return b.position},getSize:function(a){var b=this.getActiveLayer(a);return b.size},getWidthPx:function(){return this.getDomContent().innerWidth()},getHeightPx:function(){return this.getDomContent().innerHeight()},getId:function(){return this.definition.id},setId:function(a){this.definition.set("id",a)},setSourceVars:function(a){this.definition.set("vars_in",a,!0)},setSendVars:function(a){this.definition.set("vars_out",a,!0);a.length},setActionsIn:function(a){this.definition.set("actions_in",a,!0)},setActionsOut:function(a){this.definition.set("actions_out",a,!0)},vars_in:function(){return!this.definition.vars_in&&this.definition.dataSource&&(this.definition.vars_in=this.definition.dataSource,delete this.definition.dataSource),this.definition.vars_in=this.definition.vars_in||new DataArray},vars_out:function(){return!this.definition.vars_out&&this.definition.dataSend&&(this.definition.vars_out=this.definition.dataSend,delete this.definition.dataSend),this.definition.vars_out=this.definition.vars_out||{}},actions_in:function(){return!this.definition.actions_in&&this.definition.actionsIn&&(this.definition.actions_in=this.definition.actionsIn,delete this.definition.actionsIn),this.definition.actions_in=this.definition.actions_in||{}},actions_out:function(){return!this.definition.actions_out&&this.definition.actionsOut&&(this.definition.actions_out=this.definition.actionsOut,delete this.definition.actionsOut),this.definition.actions_out=this.definition.actions_out||{}},getDefinition:function(){return this.definition},getTitle:function(){return this.definition.title},setTitle:function(a){this.definition.set("title",a),this.domHeader.find(".ci-module-header-title").text(a)},exportData:function(){var b=this;a('<div class="ci-module-export"><textarea></textarea></div>').dialog({modal:!0,title:"Export data from module "+b.getTitle(),width:"70%",height:500}).children("textarea").text(b.controller["export"]())},printView:function(){var a=this.controller.print(),b=window.open("","","");b.document.write(a),b.document.close(),b.focus()},setBackgroundColor:function(a){this.domContent.get(0).style.backgroundColor="rgba("+a.join(",")+")"},setDisplayWrapper:function(a){this.getDomWrapper()[a===!0||void 0==a?"addClass":"removeClass"]("ci-module-displaywrapper");try{this.getDomWrapper().resizable(a===!0||void 0==a?"enable":"disable")}catch(b){}},blankVariable:function(a){for(var b=this.getDataRelFromName(a),c=0;c<b.length;c++)this.view.blank[b[c]]&&this.view.blank[b[c]].call(this.view,a)},startLoading:function(a){for(var b=this.getDataRelFromName(a),c=0;c<b.length;c++)this.view.startLoading(b[c])},endLoading:function(a){for(var b=this.getDataRelFromName(a),c=0;c<b.length;c++)this.view.endLoading(b[c])},get emptyConfig(){return new DataObject({position:{left:0,top:0},size:{width:20,height:20},zIndex:0,display:!0,title:"",bgColor:[255,255,255,0],wrapper:!0,created:!0})}},i}),define("modules/modulefactory",["jquery","modules/module","src/util/debug"],function(a,b,c){function d(b){return a.getJSON(require.toUrl(b),{}).pipe(function(a){return e(a)})}function e(b){var c=[];for(var e in b.folders)!function(a){if("object"==typeof b.folders[a]){var e=b.folders[a];delete b.folders[a],b.folders[e.name||a]=e}else c.push(d(b.folders[a]+"folder.json").done(function(c){delete b.folders[a],b.folders[c.name]=c}))}(e);return a.when.apply(a,c).pipe(function(){return b})}function f(b){return new Promise(function(d){var e={folders:{}};a.getJSON(require.toUrl(b+"/folder.json")).then(function(a){if(e.name=a.name,e.modules=a.modules,a.folders&&a.folders instanceof Array){for(var g=[],h=0;h<a.folders.length;h++)g.push(f(b+"/"+a.folders[h]));Promise.all(g).then(function(a){for(var b=0;b<a.length;b++){var c=a[b];e.folders[c.name]=c}d(e)},function(a){c.error("Caught error in ModuleFactory",a)})}else"object"==typeof a.folders&&(e.folders=a.folders),d(e)})})}var g,h=0,i=[],j=new DataArray,k=[];return{getTypes:function(){return a.when.apply(a,k).pipe(function(){return g})},setModules:function(b){if(b instanceof Array)return this.oldSetModules(b);if(b.folders instanceof Array){var d={};b.modules&&(d.modules=b.modules),d.folders={};for(var e=0;e<b.folders.length;e++)if("object"==typeof b.folders[e]){var h=b.folders[e];a.extend(!0,d.folders,h.folders)}else f(b.folders[e]).then(function(b){a.extend(!0,d,b)},function(a){c.error("Caught error in ModuleFactory",a)});g=d}else g=b},oldSetModules:function(b){var c,f=0;if(!(b instanceof Array))return void(g=b);c=b.length;for(var h={};c>f;f++)"string"==typeof b[f]?!function(c){d(b[c]).then(function(b){a.extend(!0,h,b)})}(f):e(b[f]).then(function(b){a.extend(!0,h,b)});g=h},newModule:function(a){var c=new b(a);return c.setId(++h),i.push(c),j.push(a),c},removeModule:function(a){i.splice(i.indexOf(a),1),j.splice(j.indexOf(a.definition),1)},empty:function(){j=new DataArray,i=[]},getModules:function(){return i},getDefinitions:function(){return j}}}),define("src/main/grid",["jquery","jqueryui","src/util/util","modules/modulefactory","src/util/context","src/util/versioning","src/util/api","forms/form"],function(a,b,c,d,e,f,g,h){function i(b){var c=0;for(var d in E){var e=E[d].getPosition(H()),f=E[d].getSize(H());e.top&&f.height&&(c=Math.max(c,e.top+f.height))}y.css("height",Math.max(a(window).height()-a("#ci-header").outerHeight(!0)-1,F.yHeight*c+(b?1e3:0)))}function j(a){var b=d.newModule(a);m(b)}function k(a){var b=DataObject.recursiveTransform(JSON.parse(JSON.stringify(a.definition)));b.layers[H()].position.left+=2,b.layers[H()].position.top+=2,j(b)}function l(a){var b=a.getPosition(H()),c=a.getSize(H());a.getDomWrapper().css({top:Math.round(b.top)*x.yHeight,left:Math.round(b.left)*x.xWidth,width:Math.round(c.width)*x.xWidth,height:Math.round(c.height)*x.yHeight})}function m(b){b.setLayers(x.getChildSync("layers",!0),!0),b.ready.then(function(){b.getDomWrapper().appendTo(y);E.push(b),l(b),g.isViewLocked()||e.listen(b.getDomWrapper().get(0),[['<li name="tofront"><a><span class="ui-icon ui-icon-arrowreturn-1-n"></span> Move to front</a></li>',function(){p(b)}],['<li name="toback"><a><span class="ui-icon ui-icon-arrowreturn-1-s"></span> Move to back</a></li>',function(){q(b)}],['<li name="remove"><a><span class="ui-icon ui-icon-close"></span> Remove module</a></li>',function(){r(b)}],['<li name="move"><a><span class="ui-icon ui-icon-arrow-4"></span> Move</a></li>',function(a){var c=b.getDomWrapper().position(),d=a.pageX-c.left,e=a.pageY-c.top;s(b,d,e)}],['<li name="duplicate"><a><span class="ui-icon ui-icon-copy"></span> Duplicate</a></li>',function(){k(b)}],['<li name="copy"><a><span class="ui-icon ui-icon-copy"></span> Copy module</a></li>',function(){window.localStorage.setItem("ci-copy-module",JSON.stringify(b.definition))}]]),b.inDom&&b.inDom(),b.getDomHeader().bind("mousedown",function(){i(!0)}),g.isViewLocked()||b.getDomWrapper().resizable({grid:[x.xWidth,x.yHeight],start:function(){c.maskIframes(),b.resizing=!0},stop:function(){c.unmaskIframes(),n(b),b.resizing=!1,i(!1)},containment:"parent"}).draggable({grid:[x.xWidth,x.yHeight],containment:"parent",handle:".ci-module-header",start:function(){c.maskIframes(),i(!0),b.moving=!0},stop:function(){var d=a(this).position();c.unmaskIframes(),b.getPosition(H()).set("left",d.left/x.xWidth),b.getPosition(H()).set("top",d.top/x.yHeight),b.moving=!1,i(!1)},drag:function(){i(!0)}}).trigger("resize"),b.getDomWrapper().bind("mouseover",function(){b.resizing||b.moving||b.getDomHeader().hasClass("ci-hidden")&&(b.getDomHeader().removeClass("ci-hidden").addClass("ci-hidden-disabled"),n(b))}).bind("mouseout",function(){b.resizing||b.moving||b.getDomHeader().hasClass("ci-hidden-disabled")&&(b.getDomHeader().addClass("ci-hidden").removeClass("ci-hidden-disabled"),n(b))}),b.getDomWrapper().find(".ui-resizable-handle").bind("mousedown",function(){i(!0)}),b.getDomWrapper().on("click",".ci-module-expand",function(){b.getDomWrapper().height(b.getDomContent().outerHeight()+b.getDomHeader().outerHeight(!0)),n(b)}),n(b),b.toggleLayer(H())},function(a){Debug.error("Error during module dom initialization",a)})}function n(a){var b=a.getDomWrapper();a.getSize(H()).set("width",b.width()/x.xWidth),a.getSize(H()).set("height",b.height()/x.yHeight);var c=b.height()-(a.getDomHeader().is(":visible")?a.getDomHeader().outerHeight(!0):0);a.getDomContent().css({height:c}),a.view.width=a.getDomContent().width(),a.view.height=c,a.view.onResize()}function o(b){var c={},e=function(){var h=y.position(),i=Math.round((c.left-h.left)/x.xWidth),j=Math.round((c.top-h.top)/x.yHeight),k=Math.round(c.width/x.xWidth),l=Math.round(c.height/x.yHeight);c.div.remove(),c={};var n=d.newModule(new DataObject({url:b}));m(n);var o=n.getActiveLayer(H());o.position.set("left",i),o.position.set("top",j),o.size.set("width",k),o.size.set("height",l),o.wrapper=!0,o.title="Untitled",a(document).unbind("mousedown",f).unbind("mousemove",g).unbind("mouseup",e),y.css("cursor","default")},f=function(b){c.left=b.pageX,c.top=b.pageY,c.ileft=b.pageX,c.itop=b.pageY,c.div=a("<div>").css({border:"1px solid red",backgroundColor:"rgba(255, 0, 0, 0.2)",width:0,height:0,left:c.left,top:c.top,position:"absolute"}).appendTo(a("body"))},g=function(a){c.left&&(c.width=Math.abs(a.pageX-c.ileft),c.height=Math.abs(a.pageY-c.itop),c.left=Math.min(c.ileft,a.pageX),c.top=Math.min(c.itop,a.pageY),c.div.css({width:c.width,height:c.height,left:c.left,top:c.top}))};a(document).bind("mousedown",f).bind("mousemove",g).bind("mouseup",e),y.css("cursor","crosshair")}function p(b){var c,e=d.getModules(),f=b.dom,g=b.definition.zindex||1,h=0;for(c in e)e[c].definition.zindex=e[c].definition.zindex||1,e[c].definition.zindex>=g&&e[c].definition.zindex--,e[c].dom.css("zIndex",e[c].definition.zindex),h++;a(f).css("zIndex",h),b.definition.zindex=h}function q(b){var c,e=d.getModules(),f=b.dom,g=b.definition.zindex||1,h=0;for(c in e)e[c].definition.zindex=e[c].definition.zindex||1,e[c].definition.zindex<=g&&e[c].definition.zindex++,e[c].dom.css("zIndex",e[c].definition.zindex),h++;a(f).css("zIndex",1),b.definition.zindex=1}function r(a){a.controller&&a.controller.onBeforeRemove&&a.controller.onBeforeRemove()===!1||(a.getDomWrapper().remove().unbind(),d.removeModule(a),a.controller&&a.controller.onRemove&&a.controller.onRemove())}function s(b,d,e){z={module:b,div:b.getDomWrapper()},c.maskIframes();var f=function(a){y.position();z.top=a.pageY-e,z.left=a.pageX-d,z.div.css({top:z.top,left:z.left})},g=function(){if(z.left){var b=(y.position(),Math.max(0,Math.round(z.left/x.xWidth))),d=Math.max(0,Math.round(z.top/x.yHeight));z.module.getPosition(H()).top=d,z.module.getPosition(H()).left=b,z.div.css({top:d*x.yHeight,left:b*x.xWidth}),c.unmaskIframes(),z=null,a(document).unbind("click",g).unbind("mousemove",f)}};a(document).bind("click",g).bind("mousemove",f)}function t(b,c){var d=a.Deferred();if(c)return x.layers[c]={name:c};var e=a("<div></div>").dialog({modal:!0,position:["center",50],width:"80%",title:""}),f=new h({});return f.init(),f.setStructure({sections:{layeropts:{options:{},groups:{layeropts:{options:{type:"list",multiple:!0},fields:{layername:{type:"text",title:"Layer name",validation:{rules:[{nonEmpty:!0,feedback:{_class:!0,message:"The layer name cannot be empty"}}]}}}}}}}}),f.onStructureLoaded().done(function(){f.fill({})}),f.addButton("Validate",{color:"green"},function(){e.dialog("close");var a=f.getValue().sections.layeropts[0].groups.layeropts[0],c={name:a.layername[0]};x.layers[c.name]=c,d.resolve(c),u(),b&&v(c.name)}),f.onLoaded().done(function(){e.html(f.makeDom(2)),f.inDom()}),d}function u(a){G(function(b){b.setLayers(x.layers,a)})}function v(b){var c=x.layers[b]?x.layers[b]:t(!1,b);a.when(c).then(function(a){a&&(c=a),D=c.name,G(function(a){var b=a.toggleLayer(c.name);b&&l(a)})})}function w(a){for(var b in x.layers)a(x.layers[b],b)}var x,y,z,A,B,C=!1,D="Default layer",E=[],F={xWidth:10,yHeight:10},G=function(a){if(E)for(var b=0,c=E.length;c>b;b++)a(E[b])},H=function(){return D};return{init:function(b,c,f){function h(b,c){if(b.modules)for(var d=0,e=b.modules.length;e>d;d++)c.append('<li class="ci-item-newmodule" data-url="'+encodeURIComponent(b.modules[d].url)+'"><a>'+b.modules[d].moduleName+"</a></li>");if(b.folders)for(var d in b.folders){var f=a("<li><a>"+d+"</a></li>"),g=a("<ul />").appendTo(f);h(b.folders[d],g),c.append(f)}}C||(f&&(E=f),y=a(c),C=!0,g.isViewLocked()||(e.listen(e.getRootDom(),[['<li name="paste"><a><span class="ui-icon ui-icon-clipboard"></span>Paste module</a></li>',function(){var a=DataObject.recursiveTransform(JSON.parse(window.localStorage.getItem("ci-copy-module")));j(a)}]]),(g.getContextMenu().indexOf("all")>-1||g.getContextMenu().indexOf("add")>-1)&&e.listen(c,[],function(b){var c=a('<li name="add"><a> Add a module</a></li>'),e=a("<ul />").appendTo(c),f=d.getTypes();a.when(f).then(function(a){if("object"!=typeof a||Array.isArray(a)||(a=[a]),Array.isArray(a))for(var b=0,c=a.length;c>b;b++)h(a[b],e)}),a(b).append(c),c.bind("click",function(b){var c=a(b.target.parentNode).attr("data-url");c&&o(decodeURIComponent(c))})}),B=a("<li><a> Switch to layer</a></li>"),A=a("<ul />").appendTo(B),(g.getContextMenu().indexOf("all")>-1||g.getContextMenu().indexOf("layers")>-1)&&e.listen(c,[],function(b){A.empty(),w(function(b,c){var d=a('<li data-layer="'+encodeURIComponent(c)+'"><a><span />'+c+"</a></li>").data("layerkey",c).appendTo(A);c==D&&d.find("span").addClass("ui-icon ui-icon-check")}),a('<li data-layer=""><a>+ Add a new layer</a></li>').data("layerkey","-1").appendTo(A),a(b).append(B),B.bind("click",function(b){var c=a(b.target.parentNode).data("layerkey");"-1"!==c?v(c):"-1"==c&&t()})})),this.reset(b))},reset:function(b){x=b,x.layers=x.layers||{},x.xWidth||(x.xWidth=10),x.yHeight||(x.yHeight=10),a(y).empty(),i(),v(D)},addModule:m,addModuleFromJSON:j,checkDimensions:i,moduleResize:n,setModuleSize:l}}),define("src/util/viewmigration",["src/util/versioning","src/util/debug"],function(a,b){function c(a,b,c){if(a.modules){"string"==typeof c?c=[c]:c instanceof Array||(c=[""]);for(var d,e,f,g=0,h=a.modules.length,i=c.length;h>g;g++)if(d=a.modules[g],e=d.getChildSync(["url"]))for(f=0;i>f;f++)if(e.toString().indexOf(c[f])>=0){b(d);break}}}function d(a){return"display_value"===a?"./modules/types/display/single_value/":"jqgrid"===a?"./modules/types/display/jqgrid/":"fasttable"===a?"./modules/types/display/fasttable/":"2d_list"===a?"./modules/types/display/2d_list/":"hashmap"===a?"./modules/types/display/hashmap/":"postit"===a?"./modules/types/display/postit/":"iframe"===a?"./modules/types/display/iframe/":"webservice_search"===a?"./modules/types/server_interaction/webservice_search/":"button_url"===a?"./modules/types/server_interaction/button_url/":"filter"===a?"./modules/types/edition/filter/":"form"===a?"./modules/types/edition/form/":"form_simple"===a?"./modules/types/edition/form_simple/":"var_editor"===a?"./modules/types/edition/var_editor/":"graph_function"===a?"./modules/types/chart/advanced/plot_function/":"canvas_matrix"===a?"./modules/types/chart/advanced/canvas_matrix/":"dendrogram"===a?"./modules/types/chart/statistics/dendrogram/":"loading_plot"===a?"./modules/types/chart/statistics/loading_plot/":"phylogram"===a?"./modules/types/chart/statistics/phylogram/":"spectra_displayer"===a?"./modules/types/science/spectra/spectra_displayer/":"jsme"===a?"./modules/types/science/chemistry/jsme/":"jsmol"===a?"./modules/types/science/chemistry/jsmol/":"jsmol_script"===a?"./modules/types/science/chemistry/jsmol_script/":"mol2d"===a?"./modules/types/science/chemistry/mol2d/":"1dnmr"===a?"./modules/types/science/spectra/nmr/1dnmr/":"2dnmr"===a?"./modules/types/science/spectra/nmr/2dnmr/":"webservice_nmr_spin"===a?"./modules/types/science/spectra/nmr/webservice_nmr_spin/":"gcms"===a?"./modules/types/science/spectra/gcms/":"ivstability"===a?"./modules/types/science/spectra/ivstability/":"array_search"===a?"./modules/types/client_interaction/array_search/":"dragdrop"===a?"./modules/types/client_interaction/dragdrop/":"button_action"===a?"./modules/types/client_interaction/button_action/":"grid_selector"===a?"./modules/types/grid_selector/":"xyzoomnavigator"===a?"./modules/types/xyzoomnavigator/":"webservice_cron"===a?"./modules/types/webservice_cron/":void console.error("viewmigration problem: "+a+" is unknown")}function e(a){var b=a.getChildSync(["jpath"]);b&&b.split&&a.setChild(["jpath"],b.split(".").slice(1))}function f(c){if(0===Object.keys(c).length)return c.version=a.version,c;if(c._version&&(c.version=c._version,delete c._version),c.version===a.version)return c;switch("undefined"!=typeof c.version&&b.info("Migrating view from version "+c.version+" to "+a.version),c.version){case void 0:c.version="0.0.0";break;case"2.1":c.version="2.1.0";break;case"2.2":c.version="2.2.0";break;case"2.4.0b0":c.version="2.4.0-b0";break;case"2.4.0b1":c.version="2.4.0-b1";break;case"2.4.0b2":c.version="2.4.0-b2"}var d=a.semver(c.version);return d?(d.prerelease&&b.warn("Migrating a prerelease view, anything can happen !"),a.semver(a.version).prerelease&&b.warn("Migrating to a prerelease version of the visualizer, anything can happen !"),g(c,d),c.version=a.version,c):c}function g(a,c){var d,e,f,g,h,i,k,l,m;for(d=c.major;d<j.length;d++)if(h=j[d])for(e=d==c.major?c.minor:0;e<h.length;e++)if(i=h[e])for(f=d==c.major&&e==c.minor?c.patch:0;f<i.length;f++)if(k=i[f])if(d==c.major&&e==c.minor&&f==c.patch){if(c.prerelease)for(g=0;g<k.length;g++)l=k[g],l.label==c.prerelease?m=!0:m&&(b.debug("applying migration to v"+d+"."+e+"."+f+"-"+l.label),l.func(a))}else for(g=0;g<k.length;g++)l=k[g],b.debug("applying migration to v"+d+"."+e+"."+f+"-"+l.label),l.func(a)}function h(b,c){var d=a.semver(b);if(!d)throw new Error("invalid semver for migration function: "+b);if("function"!=typeof c)throw new Error("object passed for migration "+b+" has to be a function");var e=j[d.major]||(j[d.major]=[]),f=e[d.minor]||(e[d.minor]=[]),g=f[d.patch]||(f[d.patch]=[]);g.push(d.prerelease?{label:d.prerelease,func:c}:{label:"release",func:c})}var i=["2.1.0",function(a){if(a.entryPoint){a.variables=a.entryPoint.variables,delete a.entryPoint;for(var b=a.modules,c=0;c<b.length;c++){var d=b[c];d.position.left*=2,d.position.top*=2,d.size.width*=2,d.size.height*=2}}},"2.2.0",function(a){if(a.modules)for(var b=0;b<a.modules.length;b++){var c=a.modules[b];("grid"===c.type||"editable_grid"===c.type)&&(c.type="jqgrid")}},"2.2.1",function(a){if(a.modules)for(var b=0;b<a.modules.length;b++){var c=a.modules[b];c.url=d(c.type),delete c.type}},"2.2.2",function(a){c(a,function(a){a.url="./modules/types/array_search/configured_search/"},"types/client_interaction/array_search")},"2.2.3",function(a){a.title&&(a.configuration||(a.configuration=new DataObject),a.configuration.title=a.title,delete a.title),c(a,function(a){var b;for(a.url="modules/types/client_interaction/code_editor/","true"===a.configuration.groups.group[0].iseditable[0][0]&&(a.configuration.groups.group[0].iseditable[0][0]="editable"),delete a.configuration.groups.group[0].padding,a.configuration.groups.group[0].mode=["text"],b=0;b<a.vars_out.length;b++){var c=a.vars_out[b];c.event&&(c.event="onEditorChange",c.rel="value")}for(b=0;b<a.actions_out.length;b++){var d=a.actions_out[b];d.event&&(d.event="onButtonClick",d.rel="value")}},"types/science/chemistry/jsmol_script")},"2.2.4",function(a){c(a,function(a){var b=a.configuration.groups.group[0].url;b[0]&&(b[0]=b[0].replace(/<([a-zA-Z0-9]+)>/g,"{$1}"))},"types/server_interaction/webservice_search")},"2.2.5",function(a){c(a,function(a){for(var b=0;b<a.vars_out.length;b++){var c=a.vars_out[b];c.event="onRead","data"===c.rel?c.jpath=c.jpath+".content":"filename"===c.rel&&(c.rel="data",c.jpath=c.jpath+".filename")}},"types/client_interaction/dragdrop")},"2.3.0-beta1",function(a){a.grid=DataObject.recursiveTransform({layers:{"Default layer":{name:"Default layer"}},xWidth:10,yHeight:10}),c(a,function(a){a.layers||(a.layers=DataObject.recursiveTransform({"Default layer":{position:{left:a.position.left,top:a.position.top,right:0},size:{width:a.size.width,height:a.size.height},zIndex:a.zIndex,display:!0,title:a.title,bgColor:a.bgColor,wrapper:a.displayWrapper,created:!0,name:"Default layer"}}),delete a.title,delete a.position,delete a.size,delete a.zIndex,delete a.displayWrapper,delete a.bgColor)})},"2.4.0-b0",function(a){if(a.variables)for(var b=0;b<a.variables.length;b++)e(a.variables[b]);c(a,function(a){var b;if(a.vars_out)for(b=0;b<a.vars_out.length;b++)e(a.vars_out[b]);if(a.actions_out)for(b=0;b<a.actions_out.length;b++)e(a.actions_out[b])})},"2.4.0-b1",function(a){c(a,function(a){for(var b=a.vars_out,c=0;c<b.length;c++)b[c].setChild(["rel"],"output")},"types/edition/object_editor")},"2.4.0-b2",function(a){c(a,function(a){for(var b=a.vars_out,c=0;c<b.length;c++)b[c].setChild(["rel"],"filteredObject")},"types/edition/filter_editor")},"2.4.1",function(a){c(a,function(a){var b,c=a.configuration.sections.postvariables[0].groups.postvariables[0];for(b=0;b<c.length;b++)c[b].variable?c[b].destination="data":c.splice(b--,1);var d=a.configuration.groups.searchparams[0];for(b=0;b<d.length;b++)d[b].name?d[b].destination="url":d.splice(b--,1);var e=a.vars_in;for(b=0;b<e.length;b++)e[b].rel?"varinput"===e[b].rel?(a.configuration.sections.postvariables[0].groups.postvariables[0].push({name:e[b].name,destination:"url",variable:e[b].name,filter:"none"}),e.splice(b--,1)):"vartrigger"===e[b].rel&&a.configuration.sections.postvariables[0].groups.postvariables[0].push({name:e[b].name,destination:"url",variable:e[b].name,filter:"none"}):e.splice(b--,1)},"types/server_interaction/webservice_search")},"2.4.2",function(a){c(a,function(a){if(a.layers){var b,c=a.layers;for(var d in c)b=c[d],b.bgcolor&&(b.bgColor||(b.bgColor=b.bgcolor),delete b.bgcolor)}})}],j=[];if(i.length%2==1)throw new Error("Invalid length of the migrators array.");for(var k=0;k<i.length;k+=2)h(i[k],i[k+1]);return f}),define("src/util/cron",[],function(){var a=(window.setInterval,window.clearTimeout,{}),b=function(b,d,f,g,h){var i=b;if(a[i]){if(!g)return void console.warn("Cron already exists");e(i)}return a[i]=[b,d,!1,!1,f],h||c(i),i},c=function(b){!function(b){a[b][3]=window.setTimeout(function(){aj=$.ajax({url:a[b][0],timeout:1200,method:"get",success:function(d){a[b][4](d),c(b)}})},a[b][1])}(b)},d=function(b){return a[b]?void window.clearTimeout(a[b][3]):void console.warn("Cannot stop a cron that does not exist")},e=function(b){return a[b]?(d(b),void delete a[b]):void console.warn("Cannot remove a cron that does not exist")};return{start:c,remove:e,erase:e,stop:d,pause:d,create:b,make:b}}),!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define("pouchdb",a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.PouchDB=a()}}(function(){var define,module,exports;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(a,b){for(var c=0;c<a.length;c++)if(b(a[c],c)===!0)return a[c];return!1}function d(a){return function(b,c){b||c[0].error?a(b||c[0]):a(null,c[0])}}function e(a){var b={},c=[];return i.traverseRevTree(a,function(a,d,e,f){var g=d+"-"+e;return a&&(b[g]=0),void 0!==f&&c.push({from:f,to:g}),g}),c.reverse(),c.forEach(function(a){b[a.from]=void 0===b[a.from]?1+b[a.to]:Math.min(b[a.from],1+b[a.to])}),b}function f(a,b,c){var d="limit"in b?b.keys.slice(b.skip,b.limit+b.skip):b.skip>0?b.keys.slice(b.skip):b.keys;if(b.descending&&d.reverse(),!d.length)return a._allDocs({limit:0},c);var e={offset:b.skip};return n.all(d.map(function(c){var d=h.extend(!0,{key:c,deleted:"ok"},b);return["limit","skip","keys"].forEach(function(a){delete d[a]}),new n(function(b,f){a._allDocs(d,function(a,d){return a?f(a):(e.total_rows=d.total_rows,void b(d.rows[0]||{key:c,error:"not_found"}))})})})).then(function(a){return e.rows=a,e})}function g(){var a=this;k.call(this),a.autoCompact=function(b){return a.auto_compaction?function(c,d){if(c)b(c);else{var e=d.length,f=function(){e--,e||b(null,d)};d.forEach(function(b){b.ok?a.compactDocument(b.id,1,f):f()})}}:b};var b,c=0,d=["change","delete","create","update"];this.on("newListener",function(e){if(~d.indexOf(e)){if(c)return void c++;c++;var f=0;b=this.changes({conflicts:!0,include_docs:!0,continuous:!0,since:"now",onChange:function(b){b.seq<=f||(f=b.seq,a.emit("change",b),b.doc._deleted?a.emit("delete",b):"1"===b.doc._rev.split("-")[0]?a.emit("create",b):a.emit("update",b))}})}}),this.on("removeListener",function(a){~d.indexOf(a)&&(c--,c||b.cancel())})}var h=a("./utils"),i=a("./merge"),j=a("./deps/errors"),k=a("events").EventEmitter,l=a("./deps/upsert"),m=a("./changes"),n=h.Promise;h.inherits(g,k),b.exports=g,g.prototype.post=h.adapterFun("post",function(a,b,c){return"function"==typeof b&&(c=b,b={}),"object"!=typeof a||Array.isArray(a)?c(j.NOT_AN_OBJECT):void this.bulkDocs({docs:[a]},b,this.autoCompact(d(c)))}),g.prototype.put=h.adapterFun("put",h.getArguments(function(a){var b,c,e,f,g=a.shift(),i="_id"in g;if("object"!=typeof g||Array.isArray(g))return(f=a.pop())(j.NOT_AN_OBJECT);for(g=h.clone(g);b=a.shift(),c=typeof b,"string"!==c||i?"string"!==c||!i||"_rev"in g?"object"===c?e=b:"function"===c&&(f=b):g._rev=b:(g._id=b,i=!0),a.length;);e=e||{};var k=h.invalidIdError(g._id);return k?f(k):void this.bulkDocs({docs:[g]},e,this.autoCompact(d(f)))})),g.prototype.putAttachment=h.adapterFun("putAttachment",function(a,b,c,d,e,f){function g(a){return a._attachments=a._attachments||{},a._attachments[b]={content_type:e,data:d},h.put(a)}var h=this;return"function"==typeof e&&(f=e,e=d,d=c,c=null),"undefined"==typeof e&&(e=d,d=c,c=null),h.get(a).then(function(a){if(a._rev!==c)throw j.REV_CONFLICT;return g(a)},function(b){if(b.error===j.MISSING_DOC.error)return g({_id:a});throw b})}),g.prototype.removeAttachment=h.adapterFun("removeAttachment",function(a,b,c,d){var e=this;e.get(a,function(a,f){return a?void d(a):f._rev!==c?void d(j.REV_CONFLICT):f._attachments?(delete f._attachments[b],0===Object.keys(f._attachments).length&&delete f._attachments,void e.put(f,d)):d()})}),g.prototype.remove=h.adapterFun("remove",function(a,b,c){"function"==typeof b?(c=b,b={}):"string"==typeof b?a={_id:a,_rev:b}:void 0===b&&(b={}),b=h.clone(b),b.was_delete=!0;var e={_id:a._id,_rev:a._rev};e._deleted=!0,this.bulkDocs({docs:[e]},b,d(c))}),g.prototype.revsDiff=h.adapterFun("revsDiff",function(a,b,c){function d(a,b){j[a]||(j[a]={missing:[]}),j[a].missing.push(b)}function e(b,c){var e=a[b].slice(0);i.traverseRevTree(c,function(a,c,f,g,h){var i=c+"-"+f,j=e.indexOf(i);-1!==j&&(e.splice(j,1),"available"!==h.status&&d(b,i))}),e.forEach(function(a){d(b,a)})}"function"==typeof b&&(c=b,b={}),b=h.clone(b);var f=Object.keys(a),g=0,j={};f.map(function(b){this._getRevisionTree(b,function(d,h){if(d&&"not_found"===d.name&&"missing"===d.message)j[b]={missing:a[b]};else{if(d)return c(d);e(b,h)}return++g===f.length?c(null,j):void 0})},this)}),g.prototype.compactDocument=function(a,b,c){var d=this;this._getRevisionTree(a,function(f,g){if(f)return c(f);var h=e(g),j=[],k=[];Object.keys(h).forEach(function(a){h[a]>b&&j.push(a)}),i.traverseRevTree(g,function(a,b,c,d,e){var f=b+"-"+c;"available"===e.status&&-1!==j.indexOf(f)&&(e.status="missing",k.push(f))}),d._doCompaction(a,g,k,c)})},g.prototype.compact=h.adapterFun("compact",function(a,b){"function"==typeof a&&(b=a,a={});var c=this;this.changes({complete:function(a,d){if(a)return void b();var e=d.results.length;return e?void d.results.forEach(function(a){c.compactDocument(a.id,0,function(){e--,e||b()})}):void b()}})}),g.prototype.get=h.adapterFun("get",function(a,b,d){function e(){var c=[],e=f.length;return e?void f.forEach(function(f){g.get(a,{rev:f,revs:b.revs,attachments:b.attachments},function(a,b){c.push(a?{missing:f}:{ok:b}),e--,e||d(null,c)})}):d(null,c)}if("function"==typeof b&&(d=b,b={}),"string"!=typeof a)return d(j.INVALID_ID);var f=[],g=this;if(!b.open_revs)return this._get(a,b,function(a,e){if(b=h.clone(b),a)return d(a);var f=e.doc;if(!f)return d(new Error("no doc!"));var j=e.metadata,k=e.ctx;if(b.conflicts){var l=i.collectConflicts(j);l.length&&(f._conflicts=l)}if(b.revs||b.revs_info){var m=i.rootToLeaf(j.rev_tree),n=c(m,function(a){return-1!==a.ids.map(function(a){return a.id
}).indexOf(f._rev.split("-")[1])}),o=n.ids.map(function(a){return a.id}).indexOf(f._rev.split("-")[1])+1,p=n.ids.length-o;if(n.ids.splice(o,p),n.ids.reverse(),b.revs&&(f._revisions={start:n.pos+n.ids.length-1,ids:n.ids.map(function(a){return a.id})}),b.revs_info){var q=n.pos+n.ids.length;f._revs_info=n.ids.map(function(a){return q--,{rev:q+"-"+a.id,status:a.opts.status}})}}if(b.local_seq&&(f._local_seq=e.metadata.seq),b.attachments&&f._attachments){var r=f._attachments,s=Object.keys(r).length;if(0===s)return d(null,f);Object.keys(r).forEach(function(a){this._getAttachment(r[a],{encode:!0,ctx:k},function(b,c){f._attachments[a].data=c,--s||d(null,f)})},g)}else{if(f._attachments)for(var t in f._attachments)f._attachments.hasOwnProperty(t)&&(f._attachments[t].stub=!0);d(null,f)}});if("all"===b.open_revs)this._getRevisionTree(a,function(a,b){a&&(b=[]),f=i.collectLeaves(b).map(function(a){return a.rev}),e()});else{if(!Array.isArray(b.open_revs))return d(j.error(j.UNKNOWN_ERROR,"function_clause"));f=b.open_revs;for(var k=0;k<f.length;k++){var l=f[k];if("string"!=typeof l||!/^\d+-/.test(l))return d(j.error(j.BAD_REQUEST,"Invalid rev format"))}e()}}),g.prototype.getAttachment=h.adapterFun("getAttachment",function(a,b,c,d){var e=this;c instanceof Function&&(d=c,c={}),c=h.clone(c),this._get(a,c,function(a,f){return a?d(a):f.doc._attachments&&f.doc._attachments[b]?(c.ctx=f.ctx,void e._getAttachment(f.doc._attachments[b],c,d)):d(j.MISSING_DOC)})}),g.prototype.allDocs=h.adapterFun("allDocs",function(a,b){if("function"==typeof a&&(b=a,a={}),a=h.clone(a),a.skip="undefined"!=typeof a.skip?a.skip:0,"keys"in a){if(!Array.isArray(a.keys))return b(new TypeError("options.keys must be an array"));var c=["startkey","endkey","key"].filter(function(b){return b in a})[0];if(c)return void b(j.error(j.QUERY_PARSE_ERROR,"Query parameter `"+c+"` is not compatible with multi-get"));if("http"!==this.type())return f(this,a,b)}return this._allDocs(a,b)}),g.prototype.changes=function(a,b){return"function"==typeof a&&(b=a,a={}),new m(this,a,b)},g.prototype.close=h.adapterFun("close",function(a){return this._closed=!0,this._close(a)}),g.prototype.info=h.adapterFun("info",function(a){var b=this;this._info(function(c,d){if(c)return a(c);var e=b.prefix.length;d.db_name.length>e&&d.db_name.slice(0,e)===b.prefix&&(d.db_name=d.db_name.slice(e)),a(null,d)})}),g.prototype.id=h.adapterFun("id",function(a){return this._id(a)}),g.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},g.prototype.bulkDocs=h.adapterFun("bulkDocs",function(a,b,c){if("function"==typeof b&&(c=b,b={}),b=h.clone(b),Array.isArray(a)&&(a={docs:a}),!a||!a.docs||!Array.isArray(a.docs))return c(j.MISSING_BULK_DOCS);for(var d=0;d<a.docs.length;++d)if("object"!=typeof a.docs[d]||Array.isArray(a.docs[d]))return c(j.NOT_AN_OBJECT);return a=h.clone(a),"new_edits"in b||(b.new_edits="new_edits"in a?a.new_edits:!0),this._bulkDocs(a,b,this.autoCompact(c))}),g.prototype.registerDependentDatabase=h.adapterFun("registerDependentDatabase",function(a,b){function c(b){return b.dependentDbs=b.dependentDbs||{},b.dependentDbs[a]?!1:(b.dependentDbs[a]=!0,b)}var d=new this.constructor(a,{adapter:this._adapter});l(this,"_local/_pouch_dependentDbs",c,function(a){return a?b(a):b(null,{db:d})})})},{"./changes":6,"./deps/errors":10,"./deps/upsert":11,"./merge":16,"./utils":21,events:25}],2:[function(a,b){function c(a){for(var b=c.options,d=b.parser[b.strictMode?"strict":"loose"].exec(a),e={},f=14;f--;)e[b.key[f]]=d[f]||"";return e[b.q.name]={},e[b.key[12]].replace(b.q.parser,function(a,c,d){c&&(e[b.q.name][c]=d)}),e}function d(a){return/^_(design|local)/.test(a)?a:encodeURIComponent(a)}function e(a,b){if(/http(s?):/.test(a)){var d=c(a);d.remote=!0,(d.user||d.password)&&(d.auth={username:d.user,password:d.password});var e=d.path.replace(/(^\/|\/$)/g,"").split("/");if(d.db=e.pop(),d.path=e.join("/"),b=b||{},b=i.clone(b),d.headers=b.headers||{},b.auth||d.auth){var f=b.auth||d.auth,g=i.btoa(f.username+":"+f.password);d.headers.Authorization="Basic "+g}return b.headers&&(d.headers=b.headers),d}return{host:"",path:"/",db:a,auth:!1}}function f(a,b){return g(a,a.db+"/"+b)}function g(a,b){if(a.remote){var c=a.path?"/":"";return a.protocol+"://"+a.host+":"+a.port+"/"+a.path+c+b}return"/"+b}function h(a,b){function c(a,b){return i.ajax(i.extend({},n,a),b)}function h(a,d,e,f){d=i.clone(d);var h=k.getHost(f),j={source:l.db,target:h.protocol===l.protocol&&h.authority===l.authority?h.db:h.source};d.continuous&&(j.continuous=!0),d.create_target&&(j.create_target=!0),d.doc_ids&&(j.doc_ids=d.doc_ids),d.filter&&"string"==typeof d.filter&&(j.filter=d.filter),d.query_params&&(j.query_params=d.query_params);var m,n={},o={headers:l.headers,method:"POST",url:g(l,"_replicate"),body:j};e.cancel=function(){this.cancelled=!0,m&&!n.ok&&m.abort(),n._local_id&&(o.body={replication_id:n._local_id}),o.body.cancel=!0,c(o,function(a,c,e){return a?b(a):void i.call(d.complete,null,n,e)})},e.cancelled||(m=c(o,function(a,c,e){return a?b(a):(n.ok=!0,c._local_id&&(n._local_id=c._local_id),void i.call(d.complete,null,c,e))}))}var k=this;k.getHost=a.getHost?a.getHost:e;var l=k.getHost(a.name,a),m=f(l,"");k.getUrl=function(){return m};var n=a.ajax||{};a=i.clone(a);var o=function(){c({headers:l.headers,method:"PUT",url:m},function(a){a&&401===a.status?c({headers:l.headers,method:"HEAD",url:m},function(a){a?b(a):b(null,k)}):a&&412!==a.status?b(a):b(null,k)})};a.skipSetup||c({headers:l.headers,method:"GET",url:m},function(a){a?404===a.status?o():b(a):b(null,k)}),k.type=function(){return"http"},k.id=i.adapterFun("id",function(a){c({headers:l.headers,method:"GET",url:g(l,"")},function(b,c){var d=c&&c.uuid?c.uuid+l.db:f(l,"");a(null,d)})}),k.request=i.adapterFun("request",function(a,b){a.headers=l.headers,a.url=f(l,a.url),c(a,b)}),k.compact=i.adapterFun("compact",function(a,b){"function"==typeof a&&(b=a,a={}),a=i.clone(a),c({headers:l.headers,url:f(l,"_compact"),method:"POST"},function(){function c(){k.info(function(d,e){e.compact_running?setTimeout(c,a.interval||200):b()})}"function"==typeof b&&c()})}),k._info=function(a){c({headers:l.headers,method:"GET",url:f(l,"")},function(b,c){b?a(b):(c.host=f(l,""),a(null,c))})},k.get=i.adapterFun("get",function(a,b,e){"function"==typeof b&&(e=b,b={}),b=i.clone(b),void 0===b.auto_encode&&(b.auto_encode=!0);var g=[];b.revs&&g.push("revs=true"),b.revs_info&&g.push("revs_info=true"),b.local_seq&&g.push("local_seq=true"),b.open_revs&&("all"!==b.open_revs&&(b.open_revs=JSON.stringify(b.open_revs)),g.push("open_revs="+b.open_revs)),b.attachments&&g.push("attachments=true"),b.rev&&g.push("rev="+b.rev),b.conflicts&&g.push("conflicts="+b.conflicts),g=g.join("&"),g=""===g?"":"?"+g,b.auto_encode&&(a=d(a));var h={headers:l.headers,method:"GET",url:f(l,a+g)},j=a.split("/");(j.length>1&&"_design"!==j[0]&&"_local"!==j[0]||j.length>2&&"_design"===j[0]&&"_local"!==j[0])&&(h.binary=!0),c(h,function(a,b,c){return a?e(a):void e(null,b,c)})}),k.remove=i.adapterFun("remove",function(a,b,e){"function"==typeof b?(e=b,b={}):"string"==typeof b?a={_id:a,_rev:b}:void 0===b&&(b={}),c({headers:l.headers,method:"DELETE",url:f(l,d(a._id))+"?rev="+a._rev},e)}),k.getAttachment=i.adapterFun("getAttachment",function(a,b,c,e){"function"==typeof c&&(e=c,c={}),c=i.clone(c),void 0===c.auto_encode&&(c.auto_encode=!0),c.auto_encode&&(a=d(a)),c.auto_encode=!1,k.get(a+"/"+b,c,e)}),k.removeAttachment=i.adapterFun("removeAttachment",function(a,b,e,g){c({headers:l.headers,method:"DELETE",url:f(l,d(a)+"/"+b)+"?rev="+e},g)}),k.putAttachment=i.adapterFun("putAttachment",function(a,b,e,g,h,i){"function"==typeof h&&(i=h,h=g,g=e,e=null),"undefined"==typeof h&&(h=g,g=e,e=null);var j=d(a)+"/"+b,k=f(l,j);e&&(k+="?rev="+e);var m={headers:l.headers,method:"PUT",url:k,processData:!1,body:g,timeout:6e4};m.headers["Content-Type"]=h,c(m,i)}),k.put=i.adapterFun("put",i.getArguments(function(a){var b,e,g,h,k=a.shift(),m="_id"in k;if("object"!=typeof k||Array.isArray(k))return(h=a.pop())(j.NOT_AN_OBJECT);for(k=i.clone(k);b=a.shift(),e=typeof b,"string"!==e||m?"string"!==e||!m||"_rev"in k?"object"===e?g=i.clone(b):"function"===e&&(h=b):k._rev=b:(k._id=b,m=!0),a.length;);g=g||{};var n=i.invalidIdError(k._id);if(n)return h(n);var o=[];g&&"undefined"!=typeof g.new_edits&&o.push("new_edits="+g.new_edits),o=o.join("&"),""!==o&&(o="?"+o),c({headers:l.headers,method:"PUT",url:f(l,d(k._id))+o,body:k},h)})),k.post=i.adapterFun("post",function(a,b,c){return"function"==typeof b&&(c=b,b={}),b=i.clone(b),"object"!=typeof a?c(j.NOT_AN_OBJECT):("_id"in a||(a._id=i.uuid()),void k.put(a,b,c))}),k._bulkDocs=function(a,b,d){"undefined"!=typeof b.new_edits&&(a.new_edits=b.new_edits),c({headers:l.headers,method:"POST",url:f(l,"_bulk_docs"),body:a},d)},k.allDocs=i.adapterFun("allDocs",function(a,b){"function"==typeof a&&(b=a,a={}),a=i.clone(a);var d,e=[],g="GET";if(a.conflicts&&e.push("conflicts=true"),a.descending&&e.push("descending=true"),a.include_docs&&e.push("include_docs=true"),a.key&&e.push("key="+encodeURIComponent(JSON.stringify(a.key))),a.startkey&&e.push("startkey="+encodeURIComponent(JSON.stringify(a.startkey))),a.endkey&&e.push("endkey="+encodeURIComponent(JSON.stringify(a.endkey))),"undefined"!=typeof a.inclusive_end&&e.push("inclusive_end="+!!a.inclusive_end),"undefined"!=typeof a.limit&&e.push("limit="+a.limit),"undefined"!=typeof a.skip&&e.push("skip="+a.skip),e=e.join("&"),""!==e&&(e="?"+e),"undefined"!=typeof a.keys){var h=2e3,j="keys="+encodeURIComponent(JSON.stringify(a.keys));j.length+e.length+1<=h?e+=(-1!==e.indexOf("?")?"&":"?")+j:(g="POST",d=JSON.stringify({keys:a.keys}))}c({headers:l.headers,method:g,url:f(l,"_all_docs"+e),body:d},b)}),k._changes=function(a){var b=25;a=i.clone(a),a.timeout=a.timeout||3e4;var d={timeout:a.timeout-5e3},e="undefined"!=typeof a.limit?a.limit:!1;0===e&&(e=1);var g;g="returnDocs"in a?a.returnDocs:!0;var h=e;if(a.style&&(d.style=a.style),(a.include_docs||a.filter&&"function"==typeof a.filter)&&(d.include_docs=!0),a.continuous&&(d.feed="longpoll"),a.conflicts&&(d.conflicts=!0),a.descending&&(d.descending=!0),a.filter&&"string"==typeof a.filter&&(d.filter=a.filter,"_view"===a.filter&&a.view&&"string"==typeof a.view&&(d.view=a.view)),a.query_params&&"object"==typeof a.query_params)for(var k in a.query_params)a.query_params.hasOwnProperty(k)&&(d[k]=a.query_params[k]);var m,n,o=function(g,i){if(!a.aborted){d.since=g,a.descending?e&&(d.limit=h):d.limit=!e||h>b?b:h;var j="?"+Object.keys(d).map(function(a){return a+"="+d[a]}).join("&"),k={headers:l.headers,method:"GET",url:f(l,"_changes"+j),timeout:a.timeout};n=g,a.aborted||(m=c(k,i))}},p=10,q=0,r={results:[]},s=function(c,d){if(!a.aborted){var f=0;if(d&&d.results){f=d.results.length,r.last_seq=d.last_seq;var k={};k.query=a.query_params,d.results=d.results.filter(function(b){h--;var c=i.filterChange(a)(b);return c&&(g&&r.results.push(b),i.call(a.onChange,b)),c})}else if(c)return a.aborted=!0,void i.call(a.complete,c);d&&d.last_seq&&(n=d.last_seq);var l=e&&0>=h||d&&b>f||a.descending;if((!a.continuous||e&&0>=h)&&l)i.call(a.complete,null,r);else{c?q+=1:q=0;var m=1<<q,t=p*m,u=a.maximumWait||3e4;if(t>u)return void i.call(a.complete,c||j.UNKNOWN_ERROR);setTimeout(function(){o(n,s)},t)}}};return o(a.since||0,s),{cancel:function(){a.aborted=!0,m&&m.abort()}}},k.revsDiff=i.adapterFun("revsDif",function(a,b,d){"function"==typeof b&&(d=b,b={}),c({headers:l.headers,method:"POST",url:f(l,"_revs_diff"),body:a},function(a,b){d(a,b)})}),k._close=function(a){a()},k.replicateOnServer=function(a,b,c){return k.taskqueue.isReady?void a.info(function(d,e){h(a,b,c,e.host)}):(k.taskqueue.addTask("replicateOnServer",[a,b,c]),c)},k.destroy=i.adapterFun("destroy",function(a){c({url:f(l,""),method:"DELETE",headers:l.headers},function(b,c){b?(k.emit("error",b),a(b)):(k.emit("destroyed"),a(null,c))})})}var i=a("../utils"),j=a("../deps/errors");c.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},h.destroy=i.toPromise(function(a,b,c){var d=e(a,b);b=b||{},"function"==typeof b&&(c=b,b={}),b=i.clone(b),b.headers=d.headers,b.method="DELETE",b.url=f(d,"");var g=b.ajax||{};b=i.extend({},b,g),i.ajax(b,c)}),h.valid=function(){return!0},b.exports=h},{"../deps/errors":10,"../utils":21}],3:[function(a,b){(function(c,d){function e(a,b,c){try{a.apply(b,c)}catch(d){window.PouchDB&&window.PouchDB.emit("error",d)}}function f(){if(!p.running&&p.queue.length){p.running=!0;var a=p.queue.shift();a.action(function(b,d){e(a.callback,this,[b,d]),p.running=!1,c.nextTick(f)})}}function g(a){return function(b){var c=b.target&&b.target.error&&b.target.error.name||b.target;a(n.error(n.IDB_ERROR,c,b.type))}}function h(){var a="_pouch__checkModernIdb_"+(d.navigator&&d.navigator.appVersion),b=l.hasLocalStorage()&&d.localStorage[a];if(b)return JSON.parse(b);var c="_pouch__checkModernIdb",e=null===d.indexedDB.open(c,1).onupgradeneeded;return d.indexedDB.deleteDatabase&&d.indexedDB.deleteDatabase(c),l.hasLocalStorage()&&(d.localStorage[a]=JSON.stringify(e)),e}function i(a,b){var c=this;p.queue.push({action:function(b){j(c,a,b)},callback:b}),f()}function j(a,b,e){function f(a){a.createObjectStore(r,{keyPath:"id"}).createIndex("seq","seq",{unique:!0}),a.createObjectStore(s,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),a.createObjectStore(t,{keyPath:"digest"}),a.createObjectStore(u,{keyPath:"id",autoIncrement:!1}),a.createObjectStore(v)}function h(a){var b=a.currentTarget.transaction.objectStore(r);b.openCursor().onsuccess=function(a){var c=a.target.result;if(c){var d=c.value,e=l.isDeleted(d),f=l.isLocalId(d.id);d.deletedOrLocal=e||f?"1":"0",b.put(d),c["continue"]()}else b.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1})}}function j(a,b){return a._bulk_seq-b._bulk_seq}function k(a,b,c){var e="startkey"in b?b.startkey:!1,f="endkey"in b?b.endkey:!1,g="key"in b?b.key:!1,h=b.skip||0,i="number"==typeof b.limit?b.limit:-1,j=b.inclusive_end!==!1,k="descending"in b&&b.descending?"prev":null,o=!1;k&&e&&f&&(o=f,f=!1);var p=null;try{e&&f?p=d.IDBKeyRange.bound(e,f,!1,!j):e?p=k?d.IDBKeyRange.upperBound(e):d.IDBKeyRange.lowerBound(e):f?p=k?d.IDBKeyRange.lowerBound(f,!j):d.IDBKeyRange.upperBound(f,!j):g&&(p=d.IDBKeyRange.only(g))}catch(q){return"DataError"===q.name&&0===q.code?c(null,{total_rows:a,offset:b.skip,rows:[]}):c(n.error(n.IDB_ERROR,q.name,q.message))}var t=A.transaction([r,s],"readonly");t.oncomplete=function(){c(null,{total_rows:a,offset:b.skip,rows:w})};var u=t.objectStore(r),v=k?u.openCursor(p,k):u.openCursor(p),w=[];v.onsuccess=function(a){function c(a,c){if(l.isLocalId(a.id))return d["continue"]();var e={id:a.id,key:a.id,value:{rev:f}};if(b.include_docs){e.doc=c,e.doc._rev=f,e.doc._doc_id_rev&&delete e.doc._doc_id_rev,b.conflicts&&(e.doc._conflicts=m.collectConflicts(a));for(var g in e.doc._attachments)e.doc._attachments.hasOwnProperty(g)&&(e.doc._attachments[g].stub=!0)}var k=l.isDeleted(a,f);if("ok"===b.deleted)k&&(e.value.deleted=!0,e.doc=null),w.push(e);else if(!k&&h--<=0){if(o){if(j&&e.key<o)return;if(!j&&e.key<=o)return}if(w.push(e),0===--i)return}d["continue"]()}if(a.target.result){var d=a.target.result,e=d.value,f=e.winningRev||m.winningRev(e);if(b.include_docs){var g=t.objectStore(s).index("_doc_id_rev"),k=e.id+"::"+f;g.get(k).onsuccess=function(a){c(d.value,a.target.result)}}else c(e)}}}function p(a){if(-1!==B)return a(null,B);var b,c=A.transaction([r],"readonly"),e=c.objectStore(r).index("deletedOrLocal");e.count(d.IDBKeyRange.only("0")).onsuccess=function(a){b=a.target.result},c.onerror=g(a),c.oncomplete=function(){B=b,a(null,B)}}var q=2,r="document-store",s="by-sequence",t="attach-store",u="meta-store",v="detect-blob-support",w=b.name,x=null,y=null,z=!1,A=null,B=-1;a.type=function(){return"idb"},a._id=l.toPromise(function(a){a(null,y)}),a._bulkDocs=function(a,b,c){function d(a){var b=a.target.result;b.updateSeq=(b.updateSeq||0)+I,F.objectStore(u).put(b)}function e(){if(!D.length)return void(F.objectStore(u).get(u).onsuccess=d);var a=D.shift(),b=a.metadata.id;if(b in H)return p(H[b],a);var c=F.objectStore(r).get(b);c.onsuccess=function(b){var c=b.target.result;c?p(c,a):q(a)}}function f(){var a=[];G.sort(j),G.forEach(function(b){if(delete b._bulk_seq,b.error)return void a.push(b);var c=b.metadata,d=m.winningRev(c);a.push({ok:!0,id:c.id,rev:d}),l.isLocalId(c.id)}),i.Changes.notify(w),B=-1,c(null,a)}function h(a,b){if(a.stub)return b();if("string"==typeof a.data){var d;try{d=atob(a.data)}catch(e){var f=n.error(n.BAD_ARG,"Attachments need to be base64 encoded");return c(f)}if(a.digest="md5-"+l.MD5(d),x){var g=a.content_type;d=l.fixBinary(d),a.data=l.createBlob([d],{type:g})}return b()}var h=new FileReader;h.onloadend=function(){var c=l.arrayBufferToBinaryString(this.result);a.digest="md5-"+l.MD5(c),x||(a.data=btoa(c)),b()},h.readAsArrayBuffer(a.data)}function k(a){function b(){c++,D.length===c&&a()}if(!D.length)return a();var c=0;D.forEach(function(a){function c(){e++,e===d.length&&b()}var d=a.data&&a.data._attachments?Object.keys(a.data._attachments):[];if(!d.length)return b();var e=0;for(var f in a.data._attachments)a.data._attachments.hasOwnProperty(f)&&h(a.data._attachments[f],c)})}function o(a,b,c,d){function e(a){h||(a?(h=a,d(h)):i===j.length&&g())}function f(a){i++,e(a)}function g(){a.data._doc_id_rev=a.data._id+"::"+a.data._rev;var e=F.objectStore(s).index("_doc_id_rev");e.getKey(a.data._doc_id_rev).onsuccess=function(e){var f=e.target.result?F.objectStore(s).put(a.data,e.target.result):F.objectStore(s).put(a.data);f.onsuccess=function(e){var f=a.metadata;f.seq=e.target.result,delete f.rev;var g=l.isLocalId(f.id);f.deletedOrLocal=c||g?"1":"0",f.winningRev=b;var h=F.objectStore(r).put(f);h.onsuccess=function(){delete f.deletedOrLocal,delete f.winningRev,G.push(a),H[a.metadata.id]=a.metadata,l.call(d)}}}}var h=null,i=0;a.data._id=a.metadata.id,a.data._rev=a.metadata.rev,I++,c&&(a.data._deleted=!0);var j=a.data._attachments?Object.keys(a.data._attachments):[];for(var k in a.data._attachments)if(a.data._attachments[k].stub)i++,e();else{var m=a.data._attachments[k].data;delete a.data._attachments[k].data;var n=a.data._attachments[k].digest;y(a,n,m,f)}j.length||g()}function p(a,b){var c=m.merge(a.rev_tree,b.metadata.rev_tree[0],1e3),d=l.isDeleted(a),f=l.isDeleted(b.metadata),g=d&&f&&z||!d&&z&&"new_leaf"!==c.conflicts;if(g)return G.push(v(n.REV_CONFLICT,b._bulk_seq)),e();b.metadata.rev_tree=c.tree;var h=m.winningRev(b.metadata);f=l.isDeleted(b.metadata,h),o(b,h,f,e)}function q(a){var c=m.winningRev(a.metadata),d=l.isDeleted(a.metadata,c);return"was_delete"in b&&d?(G.push(n.MISSING_DOC),e()):void o(a,c,d,e)}function v(a,b){return a._bulk_seq=b,a}function y(a,b,c,d){var e=F.objectStore(t);e.get(b).onsuccess=function(f){var g=f.target.result&&f.target.result.refs||{},h=[a.metadata.id,a.metadata.rev].join("@"),i={digest:b,body:c,refs:g};i.refs[h]=!0,e.put(i).onsuccess=function(){l.call(d)}}}var z=b.new_edits,C=a.docs,D=C.map(function(a,b){var c=l.parseDoc(a,z);return c._bulk_seq=b,c}),E=D.filter(function(a){return a.error});if(E.length)return c(E[0]);var F,G=[],H={},I=0;k(function(){F=A.transaction([r,s,t,u],"readwrite"),F.onerror=g(c),F.ontimeout=g(c),F.oncomplete=f,e()})},a._get=function(a,b,c){function d(){c(g,{doc:e,metadata:f,ctx:h})}var e,f,g,h;b=l.clone(b),h=b.ctx?b.ctx:A.transaction([r,s,t],"readonly"),h.objectStore(r).get(a).onsuccess=function(a){if(f=a.target.result,!f)return g=n.MISSING_DOC,d();if(l.isDeleted(f)&&!b.rev)return g=n.error(n.MISSING_DOC,"deleted"),d();var c=h.objectStore(s),i=b.rev||f.winningRev||m.winningRev(f),j=f.id+"::"+i;c.index("_doc_id_rev").get(j).onsuccess=function(a){return e=a.target.result,e&&e._doc_id_rev&&delete e._doc_id_rev,e?void d():(g=n.MISSING_DOC,d())}}},a._getAttachment=function(a,b,c){var d,e;b=l.clone(b),e=b.ctx?b.ctx:A.transaction([r,s,t],"readonly");var f=a.digest,g=a.content_type;e.objectStore(t).get(f).onsuccess=function(a){var e=a.target.result.body;if(b.encode)if(x){var f=new FileReader;f.onloadend=function(){var a=l.arrayBufferToBinaryString(this.result);d=btoa(a),c(null,d)},f.readAsArrayBuffer(e)}else d=e,c(null,d);else x?d=e:(e=l.fixBinary(atob(e)),d=l.createBlob([e],{type:g})),c(null,d)}},a._allDocs=function(a,b){p(function(c,d){return c?b(c):0===a.limit?b(null,{total_rows:d,offset:a.skip,rows:[]}):void k(d,a,b)})},a._info=function(a){p(function(b,c){if(b)return a(b);if(null===A){var d=new Error("db isn't open");return d.id="idbNull",a(d)}var e=0,f=A.transaction([u],"readonly");f.objectStore(u).get(u).onsuccess=function(a){e=a.target.result&&a.target.result.updateSeq||0},f.oncomplete=function(){a(null,{db_name:w,doc_count:c,update_seq:e})}})},a._changes=function(b){function c(){o=A.transaction([r,s]),o.oncomplete=f;var a;a=h?o.objectStore(s).openCursor(d.IDBKeyRange.lowerBound(b.since,!0),h):o.objectStore(s).openCursor(d.IDBKeyRange.lowerBound(b.since,!0)),a.onsuccess=e,a.onerror=onerror}function e(a){var c=a.target.result;if(c){var d=c.value;if(l.isLocalId(d._id)||b.doc_ids&&-1===b.doc_ids.indexOf(d._id))return c["continue"]();var e=o.objectStore(r);e.get(d._id).onsuccess=function(a){var e=a.target.result;j<e.seq&&(j=e.seq);var f=e.winningRev||m.winningRev(e);if(d._rev!==f)return c["continue"]();delete d._doc_id_rev;var g=b.processChange(d,e,b);g.seq=c.key,t(g)&&(q++,n&&p.push(g),b.onChange(g)),q!==k&&c["continue"]()}}}function f(){b.continuous||b.complete(null,{results:p,last_seq:j})}if(b=l.clone(b),b.continuous){var g=w+":"+l.uuid();return i.Changes.addListener(w,g,a,b),i.Changes.notify(w),{cancel:function(){i.Changes.removeListener(w,g)}}}var h=b.descending?"prev":null,j=0;b.since=b.since&&!h?b.since:0;var k="limit"in b?b.limit:-1;0===k&&(k=1);var n;n="returnDocs"in b?b.returnDocs:!0;var o,p=[],q=0,t=l.filterChange(b);c()},a._close=function(a){return null===A?a(n.NOT_OPEN):(A.close(),delete o[w],A=null,void a())},a._getRevisionTree=function(a,b){var c=A.transaction([r],"readonly"),d=c.objectStore(r).get(a);d.onsuccess=function(a){var c=a.target.result;c?b(null,c.rev_tree):b(n.MISSING_DOC)}},a._doCompaction=function(a,b,c,d){var e=A.transaction([r,s],"readwrite"),f=e.objectStore(r);f.get(a).onsuccess=function(d){var f=d.target.result;f.rev_tree=b;var g=c.length;c.forEach(function(b){var c=e.objectStore(s).index("_doc_id_rev"),d=a+"::"+b;c.getKey(d).onsuccess=function(a){var b=a.target.result;b&&(e.objectStore(s)["delete"](b),g--,g||e.objectStore(r).put(f))}})},e.oncomplete=function(){l.call(d)}};var C=o[w];if(C)return A=C.idb,x=C.blobSupport,y=C.instanceId,z=C.idStored,void c.nextTick(function(){e(null,a)});var D=d.indexedDB.open(w,q);"openReqList"in i||(i.openReqList={}),i.openReqList[w]=D,D.onupgradeneeded=function(a){var b=a.target.result;a.oldVersion<1&&f(b),a.oldVersion<2&&h(a)},D.onsuccess=function(b){A=b.target.result,A.onversionchange=function(){A.close(),delete o[w]},A.onabort=function(){A.close(),delete o[w]};var c=A.transaction([u,v],"readwrite"),d=c.objectStore(u).get(u);d.onsuccess=function(b){var d=function(){null!==x&&z&&(o[w]={idb:A,blobSupport:x,instanceId:y,idStored:z,loaded:!0},e(null,a))},f=b.target.result||{id:u};w+"_id"in f?(y=f[w+"_id"],z=!0,d()):(y=l.uuid(),f[w+"_id"]=y,c.objectStore(u).put(f).onsuccess=function(){z=!0,d()});try{c.objectStore(v).put(l.createBlob(),"key"),x=!0}catch(g){x=!1}finally{d()}}},D.onerror=g(e)}function k(a,b,c){"openReqList"in i||(i.openReqList={}),i.Changes.removeAllListeners(a),i.openReqList[a]&&i.openReqList[a].result&&i.openReqList[a].result.close();var e=d.indexedDB.deleteDatabase(a);e.onsuccess=function(){i.openReqList[a]&&(i.openReqList[a]=null),l.hasLocalStorage()&&delete d.localStorage[a],delete o[a],c(null,{ok:!0})},e.onerror=g(c)}var l=a("../utils"),m=a("../merge"),n=a("../deps/errors"),o={},p={running:!1,queue:[]};i.valid=function(){return d.indexedDB&&h()},i.destroy=l.toPromise(function(a,b,c){p.queue.push({action:function(c){k(a,b,c)},callback:c}),f()}),i.Changes=new l.Changes,b.exports=i}).call(this,a("/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../deps/errors":10,"../merge":16,"../utils":21,"/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":26}],4:[function(a,b){b.exports=["idb","websql"]},{}],5:[function(a,b){(function(c){function d(a){return"'"+a+"'"}function e(a,b,c,d,e){return"SELECT "+a+" FROM "+("string"==typeof b?b:b.join(" JOIN "))+(c?" ON "+c:"")+(d?" WHERE "+("string"==typeof d?d:d.join(" AND ")):"")+(e?" ORDER BY "+e:"")}function f(a){return function(b){var c=b&&b.constructor.toString().match(/function ([^\(]+)/),d=c&&c[1]||b.type,e=b.target||b.message;a(l.error(l.WSQ_ERROR,e,d))}}function g(a){return decodeURIComponent(window.escape(a))}function h(a,b){for(var c="",d="UTF-8"===b?2:4,e=0,f=a.length;f>e;e+=d){var h=a.substring(e,e+d);4===d&&(h=h.substring(2,4)+h.substring(0,2)),c+=String.fromCharCode(parseInt(h,16))}return c="UTF-8"===b?g(c):c}function i(a,b){function d(){j.hasLocalStorage()&&(c.localStorage["_pouch__websqldb_"+H]=!0),b(null,F)}function g(a){a.executeSql(x),a.executeSql("ALTER TABLE "+s+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){a.executeSql(v),a.executeSql("ALTER TABLE "+r+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){a.executeSql(w);var b="SELECT "+r+".winningseq AS seq, "+r+".json AS metadata FROM "+s+" JOIN "+r+" ON "+s+".seq = "+r+".winningseq";a.executeSql(b,[],function(a,b){for(var c=[],d=[],e=0;e<b.rows.length;e++){var f=b.rows.item(e),g=f.seq,h=JSON.parse(f.metadata);j.isDeleted(h)&&c.push(g),j.isLocalId(h.id)&&d.push(h.id)}a.executeSql("UPDATE "+r+"SET local = 1 WHERE id IN ("+d.map(function(){return"?"}).join(",")+")",d),a.executeSql("UPDATE "+s+" SET deleted = 1 WHERE seq IN ("+c.map(function(){return"?"}).join(",")+")",c)})})})}function m(a){for(;I.length>0;){var b=I.pop();b(null,G)}A(a)}function A(a){a.executeSql("SELECT dbid, hex(dbid) AS hexId FROM "+u,[],function(a,b){var c=b.rows.item(0).dbid,d=b.rows.item(0).hexId;E=d.length===2*c.length?"UTF-8":"UTF-16"})}function B(a,b){if(0===b){var c="CREATE TABLE IF NOT EXISTS "+u+" (update_seq, dbid, db_version INTEGER)",d="CREATE TABLE IF NOT EXISTS "+t+" (digest, json, body BLOB)",e="CREATE TABLE IF NOT EXISTS "+r+" (id unique, json, winningseq, local TINYINT(1))",f="CREATE TABLE IF NOT EXISTS "+s+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, doc_id_rev UNIQUE, json, deleted TINYINT(1))";a.executeSql(d),a.executeSql(e,[],function(){a.executeSql(x),a.executeSql(w)}),a.executeSql(f,[],function(){a.executeSql(v)}),a.executeSql(c,[],function(){var b="INSERT INTO "+u+" (update_seq, db_version, dbid) VALUES (?, ?, ?)";G=j.uuid(),a.executeSql(b,[0,q,G]),m(a)})}else 1===b&&(g(a),a.executeSql("UPDATE "+u+" SET db_version = "+q)),a.executeSql("SELECT dbid FROM "+u,[],function(a,b){G=b.rows.item(0).dbid,m(a)})}function C(){K.transaction(function(a){a.executeSql("SELECT sql FROM sqlite_master WHERE tbl_name = "+u,[],function(a,b){b.rows.length?/db_version/.test(b.rows.item(0).sql)?a.executeSql("SELECT db_version FROM "+u,[],function(a,b){var c=b.rows.item(0).db_version;B(a,c)}):a.executeSql("ALTER TABLE "+u+" ADD COLUMN db_version INTEGER",[],function(){B(a,1)}):B(a,0)})},f(b),d)}function D(a,b){if(-1!==J)return b(J);var c=e("COUNT("+r+".id) AS 'num'",[r,s],y,[s+".deleted=0",r+".local=0"]);a.executeSql(c,[],function(a,c){J=c.rows.item(0).num,b(J)})}var E,F=this,G=null,H=a.name,I=[],J=-1,K=n(H,o,H,p);return K?("function"!=typeof K.readTransaction&&(K.readTransaction=K.transaction),j.isCordova()&&"undefined"!=typeof c?c.addEventListener(H+"_pouch",function L(){c.removeEventListener(H+"_pouch",L,!1),C()},!1):C(),F.type=function(){return"websql"},F._id=j.toPromise(function(a){a(null,G)}),F._info=function(a){K.readTransaction(function(b){D(b,function(c){var d="SELECT update_seq FROM "+u;b.executeSql(d,[],function(b,d){var e=d.rows.item(0).update_seq;a(null,{db_name:H,doc_count:c,update_seq:e})})})},f(a))},F._bulkDocs=function(a,b,c){function d(a,b){return a._bulk_seq-b._bulk_seq}function g(){var a=[];D.sort(d),D.forEach(function(b){if(delete b._bulk_seq,b.error)return void a.push(b);var c=b.metadata,d=k.winningRev(c);a.push({ok:!0,id:c.id,rev:d}),j.isLocalId(c.id)||z++}),i.Changes.notify(H);var b="SELECT update_seq FROM "+u;C.executeSql(b,[],function(b,d){var e=d.rows.item(0).update_seq+z,f="UPDATE "+u+" SET update_seq=?";b.executeSql(f,[e],function(){c(null,a)})})}function h(a,b){if(a.stub)return b();if("string"==typeof a.data){try{a.data=atob(a.data)}catch(d){var e=l.error(l.BAD_ARG,"Attachments need to be base64 encoded");return c(e)}var f=j.fixBinary(a.data);a.data=j.createBlob([f],{type:a.content_type})}var g=new FileReader;g.onloadend=function(){var c=j.arrayBufferToBinaryString(this.result);a.data=c,a.digest="md5-"+j.MD5(c),b()},g.readAsArrayBuffer(a.data)}function m(a){function b(){c++,A.length===c&&a()}if(!A.length)return a();var c=0;A.forEach(function(a){function c(){e++,e===d.length&&b()}var d=a.data&&a.data._attachments?Object.keys(a.data._attachments):[],e=0;if(!d.length)return b();for(var f in a.data._attachments)a.data._attachments.hasOwnProperty(f)&&h(a.data._attachments[f],c)})}function n(a,b,c,d,f){function g(){var b=a.data,d=b._id+"::"+b._rev,f=c?1:0,g=e("seq",s,null,"doc_id_rev=?");C.executeSql(g,[d],function(a,c){var e,g;c.rows.length?(e="UPDATE "+s+" SET json=?, deleted=? WHERE doc_id_rev=?;",g=[JSON.stringify(b),f,d],C.executeSql(e,g,function(a){k(a,c.rows.item(0).seq)})):(e="INSERT INTO "+s+" (doc_id_rev, json, deleted) VALUES (?, ?, ?);",g=[d,JSON.stringify(b),f],C.executeSql(e,g,function(a,b){k(a,b.insertId)}))})}function h(a){l||(a?(l=a,d(l)):m===n.length&&g())}function i(a){m++,h(a)}function k(c,e){a.metadata.seq=e,delete a.metadata.rev;var g=f?"UPDATE "+r+" SET json=?, winningseq=(SELECT seq FROM "+s+" WHERE doc_id_rev=?) WHERE id=?":"INSERT INTO "+r+" (id, winningseq, json, local) VALUES (?, ?, ?, ?);",h=JSON.stringify(a.metadata),i=a.metadata.id+"::"+b,k=j.isLocalId(a.metadata.id)?1:0,l=f?[h,i,a.metadata.id]:[a.metadata.id,e,h,k];c.executeSql(g,l,function(){D.push(a),E[a.metadata.id]=a.metadata,d()})}var l=null,m=0;a.data._id=a.metadata.id,a.data._rev=a.metadata.rev,c&&(a.data._deleted=!0);var n=a.data._attachments?Object.keys(a.data._attachments):[];for(var o in a.data._attachments)if(a.data._attachments[o].stub)m++,h();else{var p=a.data._attachments[o].data;delete a.data._attachments[o].data;var q=a.data._attachments[o].digest;w(a,q,p,i)}n.length||g()}function o(a,b){var c=k.merge(a.rev_tree,b.metadata.rev_tree[0],1e3),d=j.isDeleted(b.metadata),e=j.isDeleted(a),f=e&&d&&x||!e&&x&&"new_leaf"!==c.conflicts;if(f)return D.push(v(l.REV_CONFLICT,b._bulk_seq)),q();b.metadata.rev_tree=c.tree;var g=k.winningRev(b.metadata);d=j.isDeleted(b.metadata,g),n(b,g,d,q,!0)}function p(a){var c=k.winningRev(a.metadata),d=j.isDeleted(a.metadata,c);return"was_delete"in b&&d?(D.push(l.MISSING_DOC),q()):void n(a,c,d,q,!1)}function q(){if(!A.length)return g();var a=A.shift(),b=a.metadata.id;return b in E?o(E[b],a):void C.executeSql("SELECT json FROM "+r+" WHERE id = ?",[b],function(b,c){if(c.rows.length){var d=JSON.parse(c.rows.item(0).json);o(d,a)}else p(a)})}function v(a,b){return a._bulk_seq=b,a}function w(a,b,c,d){var e=[a.metadata.id,a.metadata.rev].join("@"),f={digest:b},g="SELECT digest, json FROM "+t+" WHERE digest=?";C.executeSql(g,[b],function(a,h){h.rows.length?(f.refs=JSON.parse(h.rows.item(0).json).refs,g="UPDATE "+t+" SET json=?, body=? WHERE digest=?",a.executeSql(g,[JSON.stringify(f),c,b],function(){d()
})):(f.refs={},f.refs[e]=!0,g="INSERT INTO "+t+"(digest, json, body) VALUES (?, ?, ?)",a.executeSql(g,[b,JSON.stringify(f),c],function(){d()}))})}var x=b.new_edits,y=a.docs,z=0,A=y.map(function(a,b){var c=j.parseDoc(a,x);return c._bulk_seq=b,c}),B=A.filter(function(a){return a.error});if(B.length)return c(B[0]);var C,D=[],E={};m(function(){K.transaction(function(a){C=a,q()},f(c),function(){J=-1})})},F._get=function(a,b,c){function d(){c(h,{doc:f,metadata:g,ctx:m})}b=j.clone(b);var f,g,h;if(!b.ctx)return void K.readTransaction(function(d){b.ctx=d,F._get(a,b,c)});var i,k,m=b.ctx;b.rev?(i=e(z,[r,s],null,[s+".doc_id_rev=?",r+".id=?"]),k=[a+"::"+b.rev,a]):(i=e(z,[r,s],y,r+".id=?"),k=[a]),m.executeSql(i,k,function(a,c){if(!c.rows.length)return h=l.MISSING_DOC,d();var e=c.rows.item(0);return g=JSON.parse(e.metadata),e.deleted&&!b.rev?(h=l.error(l.MISSING_DOC,"deleted"),d()):(f=JSON.parse(e.data),void d())})},F._allDocs=function(a,b){var c,d=[],g="startkey"in a?a.startkey:!1,h="endkey"in a?a.endkey:!1,i="key"in a?a.key:!1,j="descending"in a?a.descending:!1,l="limit"in a?a.limit:-1,m="skip"in a?a.skip:0,n=a.inclusive_end!==!1,o=[],p=[r+".local = 0"];if(i!==!1)p.push(r+".id = ?"),o.push(i);else if(g!==!1||h!==!1){if(g!==!1&&(p.push(r+".id "+(j?"<=":">=")+" ?"),o.push(g)),h!==!1){var q=j?">":"<";n&&(q+="="),p.push(r+".id "+q+" ?"),o.push(h)}i!==!1&&(p.push(r+".id = ?"),o.push(i))}"ok"!==a.deleted&&p.push(s+".deleted = 0"),K.readTransaction(function(b){D(b,function(f){if(c=f,0!==l){var g=e(z,[r,s],y,p,r+".id "+(j?"DESC":"ASC"));g+=" LIMIT "+l+" OFFSET "+m,b.executeSql(g,o,function(b,c){for(var e=0,f=c.rows.length;f>e;e++){var g=c.rows.item(e),h=JSON.parse(g.metadata),i=JSON.parse(g.data),j=i._rev,l={id:h.id,key:h.id,value:{rev:j}};if(a.include_docs){l.doc=i,l.doc._rev=j,a.conflicts&&(l.doc._conflicts=k.collectConflicts(h));for(var m in l.doc._attachments)l.doc._attachments.hasOwnProperty(m)&&(l.doc._attachments[m].stub=!0)}if(g.deleted){if("ok"!==a.deleted)continue;l.value.deleted=!0,l.doc=null}d.push(l)}})}})},f(b),function(){b(null,{total_rows:c,offset:a.skip,rows:d})})},F._changes=function(a){function b(){var b=[r+".winningseq > "+a.since,r+".local = 0"],c=[];a.doc_ids&&(b.push(r+".id IN ("+a.doc_ids.map(function(){return"?"}).join(",")+")"),c=a.doc_ids);var i=e(z,[r,s],y,b,r+".winningseq "+(d?"DESC":"ASC")),l=j.filterChange(a);a.view||a.filter||(i+=" LIMIT "+f),K.readTransaction(function(b){b.executeSql(i,c,function(b,c){for(var d=0,e=0,i=c.rows.length;i>e;e++){var j=c.rows.item(e),m=JSON.parse(j.metadata);d<j.seq&&(d=j.seq);var n=JSON.parse(j.data),o=a.processChange(n,m,a);if(o.seq=j.seq,l(o)&&(k++,g&&h.push(o),a.onChange(o)),k===f)break}a.continuous||a.complete(null,{results:h,last_seq:d})})})}if(a=j.clone(a),a.continuous){var c=H+":"+j.uuid();return i.Changes.addListener(H,c,F,a),i.Changes.notify(H),{cancel:function(){i.Changes.removeListener(H,c)}}}var d=a.descending;a.since=a.since&&!d?a.since:0;var f="limit"in a?a.limit:-1;0===f&&(f=1);var g;g="returnDocs"in a?a.returnDocs:!0;var h=[],k=0;b()},F._close=function(a){a()},F._getAttachment=function(a,b,c){var d,e=b.ctx,f=a.digest,g=a.content_type,i="SELECT hex(body) as body FROM "+t+" WHERE digest=?";e.executeSql(i,[f],function(a,e){var f=h(e.rows.item(0).body,E);b.encode?d=btoa(f):(f=j.fixBinary(f),d=j.createBlob([f],{type:g})),c(null,d)})},F._getRevisionTree=function(a,b){K.readTransaction(function(c){var d="SELECT json AS metadata FROM "+r+" WHERE id = ?";c.executeSql(d,[a],function(a,c){if(c.rows.length){var d=JSON.parse(c.rows.item(0).metadata);b(null,d.rev_tree)}else b(l.MISSING_DOC)})})},void(F._doCompaction=function(a,b,c,d){return c.length?void K.transaction(function(e){var f="SELECT json AS metadata FROM "+r+" WHERE id = ?";e.executeSql(f,[a],function(e,f){if(!f.rows.length)return j.call(d);var g=JSON.parse(f.rows.item(0).metadata);g.rev_tree=b;var h=0;c.forEach(function(b){var f=a+"::"+b,i="DELETE FROM "+s+" WHERE doc_id_rev = ?";e.executeSql(i,[f],function(b){if(++h===c.length){var e="UPDATE "+r+" SET json = ? WHERE id = ?";b.executeSql(e,[JSON.stringify(g),a],function(){d()})}})})})}):d()})):b(l.UNKNOWN_ERROR)}var j=a("../utils"),k=a("../merge"),l=a("../deps/errors"),m={},n=j.getArguments(function(a){if("undefined"!=typeof c){if(c.navigator&&c.navigator.sqlitePlugin&&c.navigator.sqlitePlugin.openDatabase)return navigator.sqlitePlugin.openDatabase.apply(navigator.sqlitePlugin,a);if(c.sqlitePlugin&&c.sqlitePlugin.openDatabase)return c.sqlitePlugin.openDatabase.apply(c.sqlitePlugin,a);var b=m[a[0]];return b||(b=m[a[0]]=c.openDatabase.apply(c,a)),b}}),o=1,p=0,q=2,r=d("document-store"),s=d("by-sequence"),t=d("attach-store"),u=d("metadata-store"),v="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+s+" (seq, deleted)",w="CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+r+" (local, id)",x="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+r+" (winningseq)",y=s+".seq = "+r+".winningseq",z=s+".seq AS seq, "+s+".deleted AS deleted, "+s+".json AS data, "+r+".json AS metadata";i.valid=function(){if("undefined"!=typeof c){if(c.navigator&&c.navigator.sqlitePlugin&&c.navigator.sqlitePlugin.openDatabase)return!0;if(c.sqlitePlugin&&c.sqlitePlugin.openDatabase)return!0;if(c.openDatabase)return!0}return!1},i.destroy=j.toPromise(function(a,b,d){i.Changes.removeAllListeners(a);var e=n(a,o,a,p);e.transaction(function(a){var b=[r,s,t,u];b.forEach(function(b){a.executeSql("DROP TABLE IF EXISTS "+b,[])})},f(d),function(){j.hasLocalStorage()&&(delete c.localStorage["_pouch__websqldb_"+a],delete c.localStorage[a]),d(null,{ok:!0})})}),i.Changes=new j.Changes,b.exports=i}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../deps/errors":10,"../merge":16,"../utils":21}],6:[function(a,b){function c(a,b,c){function d(){f.cancel()}h.call(this);var f=this;this.db=a,b=b?e.clone(b):{};var g=c||b.complete||function(){},i=b.complete=e.once(function(b,c){b?f.emit("error",b):f.emit("complete",c),f.removeAllListeners(),a.removeListener("destroyed",d)});g&&(f.on("complete",function(a){g(null,a)}),f.on("error",function(a){g(a)}));var j=b.onChange;j&&f.on("change",j),a.once("destroyed",d),b.onChange=function(a){b.isCancelled||(f.emit("change",a),f.startSeq&&f.startSeq<=a.seq&&(f.emit("uptodate"),f.startSeq=!1),a.deleted?f.emit("delete",a):1===a.changes.length&&"1-"===a.changes[0].rev.slice(0,2)?f.emit("create",a):f.emit("update",a))};var k=new e.Promise(function(a,c){b.complete=function(b,d){b?c(b):a(d)}});f.once("cancel",function(){j&&f.removeListener("change",j),b.complete(null,{status:"cancelled"})}),this.then=k.then.bind(k),this["catch"]=k["catch"].bind(k),this.then(function(a){i(null,a)},i),a.taskqueue.isReady?f.doChanges(b):a.taskqueue.addTask(function(){f.isCancelled?f.emit("cancel"):f.doChanges(b)})}function d(a,b,c){var d=[{rev:a._rev}];"all_docs"===c.style&&(d=f.collectLeaves(b.rev_tree).map(function(a){return{rev:a.rev}}));var g={id:b.id,changes:d,doc:a};return e.isDeleted(b,a._rev)&&(g.deleted=!0),c.conflicts&&(g.doc._conflicts=f.collectConflicts(b),g.doc._conflicts.length||delete g.doc._conflicts),g}var e=a("./utils"),f=a("./merge"),g=a("./deps/errors"),h=a("events").EventEmitter,i=a("./evalFilter"),j=a("./evalView");b.exports=c,e.inherits(c,h),c.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},c.prototype.doChanges=function(a){var b=this,c=a.complete;if(a=e.clone(a),"live"in a&&!("continuous"in a)&&(a.continuous=a.live),a.processChange=d,"latest"===a.since&&(a.since="now"),a.since||(a.since=0),"now"===a.since)return void this.db.info().then(function(d){return b.isCancelled?void c(null,{status:"cancelled"}):(a.since=d.update_seq-1,void b.doChanges(a))},c);if(a.continuous&&"now"!==a.since&&this.db.info().then(function(a){b.startSeq=a.update_seq-1},function(a){if("idbNull"!==a.id)throw a}),"http"!==this.db.type()&&a.filter&&"string"==typeof a.filter)return this.filterChanges(a);"descending"in a||(a.descending=!1),a.limit=0===a.limit?1:a.limit,a.complete=c;var f=this.db._changes(a);if(f&&"function"==typeof f.cancel){var g=b.cancel;b.cancel=e.getArguments(function(a){f.cancel(),g.apply(this,a)})}},c.prototype.filterChanges=function(a){var b=this,c=a.complete;if("_view"===a.filter){if(!a.view||"string"!=typeof a.view){var d=new Error("`view` filter parameter is not provided.");return d.status=g.BAD_REQUEST.status,d.name=g.BAD_REQUEST.name,d.error=!0,void c(d)}var e=a.view.split("/");this.db.get("_design/"+e[0],function(d,f){if(b.isCancelled)return void c(null,{status:"cancelled"});if(d)return void c(d);if(f&&f.views&&f.views[e[1]]){var h=j(f.views[e[1]].map);return a.filter=h,void b.doChanges(a)}var i=f.views?"missing json key: "+e[1]:"missing json key: views";d||(d=new Error(i),d.status=g.MISSING_DOC.status,d.name=g.MISSING_DOC.name,d.error=!0),c(d)})}else{var f=a.filter.split("/");this.db.get("_design/"+f[0],function(d,e){if(b.isCancelled)return void c(null,{status:"cancelled"});if(d)return void c(d);if(e&&e.filters&&e.filters[f[1]]){var h=i(e.filters[f[1]]);return a.filter=h,void b.doChanges(a)}var j=e&&e.filters?"missing json key: "+f[1]:"missing json key: filters";return d||(d=new Error(j),d.status=g.MISSING_DOC.status,d.name=g.MISSING_DOC.name,d.error=!0),void c(d)})}}},{"./deps/errors":10,"./evalFilter":13,"./evalView":14,"./merge":16,"./utils":21,events:25}],7:[function(a,b){(function(c){function d(a){a&&c.debug&&console.error(a)}function e(a,b,c){if(!(this instanceof e))return new e(a,b,c);var j=this;("function"==typeof b||"undefined"==typeof b)&&(c=b,b={}),"object"==typeof a&&(b=a,a=void 0),"undefined"==typeof c&&(c=d),b=b||{};var k=c;j.auto_compaction=b.auto_compaction,j.prefix=e.prefix,f.call(j),j.taskqueue=new h;var l=new i(function(d,f){c=function(a,b){return a?f(a):(delete b.then,void d(b))},b=g.clone(b);var h,i,k=b.name||a;return function(){try{if("string"!=typeof k)throw i=new Error("Missing/invalid DB name"),i.code=400,i;if(h=e.parseAdapter(k,b),b.originalName=k,b.name=h.name,b.adapter=b.adapter||h.adapter,j._adapter=b.adapter,!e.adapters[b.adapter])throw i=new Error("Adapter is missing"),i.code=404,i;if(!e.adapters[b.adapter].valid())throw i=new Error("Invalid Adapter"),i.code=404,i}catch(a){j.taskqueue.fail(a),j.changes=g.toPromise(function(b){b.complete&&b.complete(a)})}}(),i?f(i):(j.adapter=b.adapter,j.replicate={},j.replicate.from=function(a,b,c){return e.replicate(a,j,b,c)},j.replicate.to=function(a,b,c){return e.replicate(j,a,b,c)},j.sync=function(a,b,c){return e.sync(j,a,b,c)},j.replicate.sync=j.sync,j.destroy=g.adapterFun("destroy",function(a){var b=this;b.info(function(b,c){return b?a(b):void e.destroy(c.db_name,a)})}),e.adapters[b.adapter].call(j,b,function(a){function d(a){"destroyed"===a&&(j.emit("destroyed"),e.removeListener(b.name,d))}return a?void(c&&(j.taskqueue.fail(a),c(a))):(e.on(b.name,d),j.emit("created",j),e.emit("created",b.originalName),j.taskqueue.ready(j),void c(null,j))}),b.skipSetup&&j.taskqueue.ready(j),void(g.isCordova()&&cordova.fireWindowEvent(b.name+"_pouch",{})))});l.then(function(a){k(null,a)},k),j.then=l.then.bind(l),j["catch"]=l["catch"].bind(l)}var f=a("./adapter"),g=a("./utils"),h=a("./taskqueue"),i=g.Promise;g.inherits(e,f),b.exports=e}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter":1,"./taskqueue":20,"./utils":21}],8:[function(a,b){function c(a,b){function c(b,c,d){if(a.binary||a.json||!a.processData||"string"==typeof b){if(!a.binary&&a.json&&"string"==typeof b)try{b=JSON.parse(b)}catch(e){return d(e)}}else b=JSON.stringify(b);Array.isArray(b)&&(b=b.map(function(a){var b;return a.ok?a:a.error&&"conflict"===a.error?(b=f.REV_CONFLICT,b.id=a.id,b):a.error&&"forbidden"===a.error?(b=f.FORBIDDEN,b.id=a.id,b.reason=a.reason,b):a.missing?(b=f.MISSING_DOC,b.missing=a.missing,b):a})),d(null,b,c)}function h(a,b){var c,d,e,g;try{c=JSON.parse(a.responseText);for(g in f)if(f.hasOwnProperty(g)&&f[g].name===c.error){e=f[g];break}e||(e=f.UNKNOWN_ERROR,a.status&&(e.status=a.status),a.statusText&&(a.name=a.statusText)),d=f.error(e,c.reason)}catch(h){for(var g in f)if(f.hasOwnProperty(g)&&f[g].status===a.status){e=f[g];break}e||(e=f.UNKNOWN_ERROR,a.status&&(e.status=a.status),a.statusText&&(a.name=a.statusText)),d=f.error(e)}b(d)}var i=!1,j=g.getArguments(function(a){i||(b.apply(this,a),i=!0)});"function"==typeof a&&(j=a,a={}),a=g.clone(a);var k={method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1};if(a=g.extend(!0,k,a),"GET"===a.method&&!a.cache){var l=-1!==a.url.indexOf("?");a.url+=(l?"&":"?")+"_nonce="+g.uuid(16)}var m,n;n=a.xhr?new a.xhr:new XMLHttpRequest,n.open(a.method,a.url),n.withCredentials=!0,a.json&&(a.headers.Accept="application/json",a.headers["Content-Type"]=a.headers["Content-Type"]||"application/json",a.body&&a.processData&&"string"!=typeof a.body&&(a.body=JSON.stringify(a.body))),a.binary&&(n.responseType="arraybuffer");var o=function(a,b,c){var d="";if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}document.cookie=a+"="+b+d+"; path=/"};for(var p in a.headers)if("Cookie"===p){var q=a.headers[p].split("=");o(q[0],q[1],10)}else n.setRequestHeader(p,a.headers[p]);"body"in a||(a.body=null);var r=function(){i||(n.abort(),h(n,j))};if(n.onreadystatechange=function(){if(4===n.readyState&&!i)if(clearTimeout(m),n.status>=200&&n.status<300){var b;b=a.binary?e([n.response||""],{type:n.getResponseHeader("Content-Type")}):n.responseText,c(b,n,j)}else h(n,j)},a.timeout>0&&(m=setTimeout(r,a.timeout),n.onprogress=function(){clearTimeout(m),m=setTimeout(r,a.timeout)},"undefined"==typeof d&&(d=-1!==Object.keys(n).indexOf("upload")),d&&(n.upload.onprogress=n.onprogress)),a.body&&a.body instanceof Blob){var s=new FileReader;s.onloadend=function(){for(var a="",b=new Uint8Array(this.result),c=b.byteLength,d=0;c>d;d++)a+=String.fromCharCode(b[d]);a=g.fixBinary(a),n.send(a)},s.readAsArrayBuffer(a.body)}else n.send(a.body);return{abort:r}}var d,e=a("./blob.js"),f=a("./errors"),g=a("../utils");b.exports=c},{"../utils":21,"./blob.js":9,"./errors":10}],9:[function(a,b){(function(a){function c(b,c){b=b||[],c=c||{};try{return new Blob(b,c)}catch(d){if("TypeError"!==d.name)throw d;for(var e=a.BlobBuilder||a.MSBlobBuilder||a.MozBlobBuilder||a.WebKitBlobBuilder,f=new e,g=0;g<b.length;g+=1)f.append(b[g]);return f.getBlob(c.type)}}b.exports=c}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],10:[function(a,b,c){function d(a){this.status=a.status,this.name=a.error,this.message=a.reason,this.error=!0}d.prototype__proto__=Error.prototype,d.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message})},c.UNAUTHORIZED=new d({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),c.MISSING_BULK_DOCS=new d({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),c.MISSING_DOC=new d({status:404,error:"not_found",reason:"missing"}),c.REV_CONFLICT=new d({status:409,error:"conflict",reason:"Document update conflict"}),c.INVALID_ID=new d({status:400,error:"invalid_id",reason:"_id field must contain a string"}),c.MISSING_ID=new d({status:412,error:"missing_id",reason:"_id is required for puts"}),c.RESERVED_ID=new d({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),c.NOT_OPEN=new d({status:412,error:"precondition_failed",reason:"Database not open"}),c.UNKNOWN_ERROR=new d({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),c.BAD_ARG=new d({status:500,error:"badarg",reason:"Some query argument is invalid"}),c.INVALID_REQUEST=new d({status:400,error:"invalid_request",reason:"Request was invalid"}),c.QUERY_PARSE_ERROR=new d({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),c.DOC_VALIDATION=new d({status:500,error:"doc_validation",reason:"Bad special document member"}),c.BAD_REQUEST=new d({status:400,error:"bad_request",reason:"Something wrong with the request"}),c.NOT_AN_OBJECT=new d({status:400,error:"bad_request",reason:"Document must be a JSON object"}),c.DB_MISSING=new d({status:404,error:"not_found",reason:"Database not found"}),c.IDB_ERROR=new d({status:500,error:"indexed_db_went_bad",reason:"unknown"}),c.WSQ_ERROR=new d({status:500,error:"web_sql_went_bad",reason:"unknown"}),c.LDB_ERROR=new d({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),c.FORBIDDEN=new d({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),c.error=function(a,b,c){function d(){this.message=b,c&&(this.name=c)}return d.prototype=a,new d(b)}},{}],11:[function(a,b){function c(a,b,c){return new e(function(e,f){return b&&"object"==typeof b&&(b=b._id),"string"!=typeof b?f(new Error("doc id is required")):void a.get(b,function(g,h){if(g)return"not_found"!==g.name?f(g):e(d(a,c({_id:b}),c));var i=c(h);return i?void e(d(a,i,c)):e(h)})})}function d(a,b,d){return a.put(b)["catch"](function(e){if("conflict"!==e.name)throw e;return c(a,b,d)})}var e=a("../utils").Promise;b.exports=function(a,b,d,e){return"function"!=typeof e?c(a,b,d):void c(a,b,d).then(function(a){e(null,a)},e)}},{"../utils":21}],12:[function(a,b){function c(a){return 0|Math.random()*a}function d(a,b){b=b||e.length;var d="",f=-1;if(a){for(;++f<a;)d+=e[c(b)];return d}for(;++f<36;)switch(f){case 8:case 13:case 18:case 23:d+="-";break;case 19:d+=e[3&c(16)|8];break;default:d+=e[c(16)]}return d}var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");b.exports=d},{}],13:[function(_dereq_,module,exports){function evalFilter(input){return eval(["(function () { return ",input," })()"].join(""))}module.exports=evalFilter},{}],14:[function(_dereq_,module,exports){function evalView(input){return eval(["(function () {","  return function (doc) {","    var emitted = false;","    var emit = function (a, b) {","      emitted = true;","    };","    var view = "+input+";","    view(doc);","    if (emitted) {","      return true;","    }","  }","})()"].join("\n"))}module.exports=evalView},{}],15:[function(a,b){(function(c){var d=a("./setup");b.exports=d,d.ajax=a("./deps/ajax"),d.extend=a("pouchdb-extend"),d.utils=a("./utils"),d.Errors=a("./deps/errors"),d.replicate=a("./replicate").replicate,d.sync=a("./sync"),d.version=a("./version");var e=a("./adapters/http");if(d.adapter("http",e),d.adapter("https",e),d.adapter("idb",a("./adapters/idb")),d.adapter("websql",a("./adapters/websql")),d.plugin(a("pouchdb-mapreduce")),!c.browser){var f=a("./adapters/leveldb");d.adapter("ldb",f),d.adapter("leveldb",f)}}).call(this,a("/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"./adapters/http":2,"./adapters/idb":3,"./adapters/leveldb":24,"./adapters/websql":5,"./deps/ajax":8,"./deps/errors":10,"./replicate":17,"./setup":18,"./sync":19,"./utils":21,"./version":22,"/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":26,"pouchdb-extend":47,"pouchdb-mapreduce":50}],16:[function(a,b){function c(a){for(var b,c=a.shift(),d=[c.id,c.opts,[]],e=d;a.length;)c=a.shift(),b=[c.id,c.opts,[]],e[2].push(b),e=b;return d}function d(a,b){for(var c=[{tree1:a,tree2:b}],d=!1;c.length>0;){var e=c.pop(),f=e.tree1,g=e.tree2;(f[1].status||g[1].status)&&(f[1].status="available"===f[1].status||"available"===g[1].status?"available":"missing");for(var h=0;h<g[2].length;h++)if(f[2][0]){for(var i=!1,j=0;j<f[2].length;j++)f[2][j][0]===g[2][h][0]&&(c.push({tree1:f[2][j],tree2:g[2][h]}),i=!0);i||(d="new_branch",f[2].push(g[2][h]),f[2].sort())}else d="new_leaf",f[2][0]=g[2][h]}return{conflicts:d,tree:a}}function e(a,b,c){var e,f=[],g=!1,h=!1;return a.length?(a.forEach(function(a){if(a.pos===b.pos&&a.ids[0]===b.ids[0])e=d(a.ids,b.ids),f.push({pos:a.pos,ids:e.tree}),g=g||e.conflicts,h=!0;else if(c!==!0){var i=a.pos<b.pos?a:b,j=a.pos<b.pos?b:a,k=j.pos-i.pos,l=[],m=[];for(m.push({ids:i.ids,diff:k,parent:null,parentIdx:null});m.length>0;){var n=m.pop();0!==n.diff?n.ids&&n.ids[2].forEach(function(a,b){m.push({ids:a,diff:n.diff-1,parent:n.ids,parentIdx:b})}):n.ids[0]===j.ids[0]&&l.push(n)}var o=l[0];o?(e=d(o.ids,j.ids),o.parent[2][o.parentIdx]=e.tree,f.push({pos:i.pos,ids:i.ids}),g=g||e.conflicts,h=!0):f.push(a)}else f.push(a)}),h||f.push(b),f.sort(function(a,b){return a.pos-b.pos}),{tree:f,conflicts:g||"internal_node"}):{tree:[b],conflicts:"new_leaf"}}function f(a,b){var d=h.rootToLeaf(a).map(function(a){var d=a.ids.slice(-b);return{pos:a.pos+(a.ids.length-d.length),ids:c(d)}});return d.reduce(function(a,b){return e(a,b,!0).tree},[d.shift()])}var g=a("pouchdb-extend"),h={};h.merge=function(a,b,c){a=g(!0,[],a),b=g(!0,{},b);var d=e(a,b);return{tree:f(d.tree,c),conflicts:d.conflicts}},h.winningRev=function(a){var b=[];return h.traverseRevTree(a.rev_tree,function(a,c,d,e,f){a&&b.push({pos:c,id:d,deleted:!!f.deleted})}),b.sort(function(a,b){return a.deleted!==b.deleted?a.deleted>b.deleted?1:-1:a.pos!==b.pos?b.pos-a.pos:a.id<b.id?1:-1}),b[0].pos+"-"+b[0].id},h.traverseRevTree=function(a,b){for(var c,d=a.slice();c=d.pop();)for(var e=c.pos,f=c.ids,g=f[2],h=b(0===g.length,e,f[0],c.ctx,f[1]),i=0,j=g.length;j>i;i++)d.push({pos:e+1,ids:g[i],ctx:h})},h.collectLeaves=function(a){var b=[];return h.traverseRevTree(a,function(a,c,d,e,f){a&&b.unshift({rev:c+"-"+d,pos:c,opts:f})}),b.sort(function(a,b){return b.pos-a.pos}),b.map(function(a){delete a.pos}),b},h.collectConflicts=function(a){var b=h.winningRev(a),c=h.collectLeaves(a.rev_tree),d=[];return c.forEach(function(a){a.rev===b||a.opts.deleted||d.push(a.rev)}),d},h.rootToLeaf=function(a){var b=[];return h.traverseRevTree(a,function(a,c,d,e,f){if(e=e?e.slice(0):[],e.push({id:d,opts:f}),a){var g=c+1-e.length;b.unshift({pos:g,ids:e})}return e}),b},b.exports=h},{"pouchdb-extend":47}],17:[function(a,b,c){function d(){m.call(this),this.cancelled=!1;var a=this,b=new k.Promise(function(b,c){a.once("complete",b),a.once("error",c)});a.then=function(a,c){return b.then(a,c)},a["catch"]=function(a){return b["catch"](a)},a["catch"](function(){})}function e(a,b,c){var d=c.filter?c.filter.toString():"";return a.id().then(function(a){return b.id().then(function(b){var e=a+b+d+JSON.stringify(c.query_params)+c.doc_ids;return"_local/"+k.MD5(e)})})}function f(a,b,c){return a.get(b)["catch"](function(a){if(404===a.status)return{_id:b};throw a}).then(function(b){return b.last_seq=c,a.put(b)})}function g(a,b,c){this.src=a,this.target=b,this.id=c}function h(a,b,c,d,e){function f(){if(0!==x.docs.length){var a=x.docs;return c.bulkDocs({docs:a},{new_edits:!1}).then(function(a){if(e.cancelled)throw r(),new Error("cancelled");var b=[];if(a.forEach(function(a){a.ok||(L.doc_write_failures++,b.push(new Error(a.reason||a.message||"Unknown reason")))}),b.length>0){var c=new Error("bulkDocs error");throw c.other_errors=b,q("target.bulkDocs failed to write docs",c),new Error("bulkWrite partial failure")}},function(b){throw L.doc_write_failures+=a.length,b})}}function h(){var a=x.diffs,c=Object.keys(a)[0],d=a[c].missing;return b.get(c,{revs:!0,open_revs:d,attachments:!0}).then(function(b){b.forEach(function(b){return e.cancelled?r():void(b.ok&&(L.docs_read++,x.pendingRevs++,x.docs.push(b.ok),delete a[b.ok._id]))})})}function i(){return Object.keys(x.diffs).length>0?h().then(i):k.Promise.resolve()}function j(){var a=Object.keys(x.diffs).filter(function(a){var b=x.diffs[a].missing;return 1===b.length&&"1-"===b[0].slice(0,2)});return b.allDocs({keys:a,include_docs:!0}).then(function(a){if(e.cancelled)throw r(),new Error("cancelled");a.rows.forEach(function(a){!a.doc||a.deleted||"1-"!==a.value.rev.slice(0,2)||a.doc._attachments&&0!==Object.keys(a.doc._attachments).length||(L.docs_read++,x.pendingRevs++,x.docs.push(a.doc),delete x.diffs[a.id])})})}function l(){return"http"===b.type()?j().then(i):i()}function m(){return A=!0,K.writeCheckpoint(x.seq).then(function(){if(A=!1,e.cancelled)throw r(),new Error("cancelled");L.last_seq=D=x.seq,L.docs_written+=x.docs.length,e.emit("change",k.clone(L)),x=void 0,v()})["catch"](function(a){throw A=!1,q("writeCheckpoint completed with error",a),a})}function n(){var a={};return x.changes.forEach(function(b){a[b.id]=b.changes.map(function(a){return a.rev})}),c.revsDiff(a).then(function(a){if(e.cancelled)throw r(),new Error("cancelled");x.diffs=a,x.pendingRevs=0})}function o(){if(!e.cancelled&&!x){if(0===y.length)return void p(!0);x=y.shift(),n().then(l).then(f).then(m).then(o)["catch"](function(a){q("batch processing terminated with error",a)})}}function p(a){return 0===z.changes.length?void(0!==y.length||x||((E&&M.live||B)&&e.emit("uptodate",k.clone(L)),B&&r())):void((a||B||z.changes.length>=F)&&(y.push(z),z={seq:0,changes:[],docs:[]},o()))}function q(a,b){C||(L.ok=!1,L.status="aborted",b.message=a,L.errors.push(b),y=[],z={seq:0,changes:[],docs:[]},r())}function r(){if(!(C||e.cancelled&&(L.status="cancelled",A)))if(L.status=L.status||"complete",L.end_time=new Date,L.last_seq=D,C=e.cancelled=!0,L.errors.length>0){var a=L.errors.pop();L.errors.length>0&&(a.other_errors=L.errors),a.result=L,e.emit("error",a)}else e.emit("complete",L)}function s(a){return e.cancelled?r():(I++,0!==z.changes.length||0!==y.length||x||e.emit("outofdate",k.clone(L)),z.seq=a.seq,z.changes.push(a),void p(0===y.length))}function t(a){return H=!1,e.cancelled?r():(I>0?(M.since=a.last_seq,v()):E?(M.live=!0,v()):B=!0,void p(!0))}function u(a){return H=!1,e.cancelled?r():void q("changes rejected",a)}function v(){!H&&!B&&y.length<G&&(H=!0,I=0,b.changes(M).on("change",s).then(t)["catch"](u))}function w(){K.getCheckpoint().then(function(a){D=a,M={since:D,limit:F,style:"all_docs",doc_ids:J,returnDocs:!1},d.filter&&(M.filter=d.filter),d.query_params&&(M.query_params=d.query_params),v()})["catch"](function(a){q("getCheckpoint rejected with ",a)})}var x,y=[],z={seq:0,changes:[],docs:[]},A=!1,B=!1,C=!1,D=0,E=d.continuous||d.live||!1,F=d.batch_size||100,G=d.batches_limit||10,H=!1,I=0,J=d.doc_ids,K=new g(b,c,a),L={ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]},M={};e.ready(b,c),e.once("cancel",r),"function"==typeof d.onChange&&e.on("change",d.onChange),"function"==typeof d.complete&&(e.once("error",d.complete),e.once("complete",function(a){d.complete(null,a)})),"undefined"==typeof d.since?w():(A=!0,K.writeCheckpoint(d.since).then(function(){return A=!1,e.cancelled?void r():(D=d.since,void w())})["catch"](function(a){throw A=!1,q("writeCheckpoint completed with error",a),a}))}function i(a){return"string"==typeof a?new l(a):a.then?a:k.Promise.resolve(a)}function j(a,b,c,f){"function"==typeof c&&(f=c,c={}),"undefined"==typeof c&&(c={}),c.complete||(c.complete=f||function(){}),c=k.clone(c),c.continuous=c.continuous||c.live;var g=new d(c);return i(a).then(function(a){return i(b).then(function(b){if(!c.server)return e(a,b,c).then(function(d){g.emit("id",d),h(d,a,b,c,g)});if("function"!=typeof a.replicateOnServer)throw new TypeError("Server replication not supported for "+a.type()+" adapter");if(a.type()!==b.type())throw new TypeError("Server replication for different adapter types ("+a.type()+" and "+b.type()+") is not supported");a.replicateOnServer(b,c,g)})})["catch"](function(a){g.emit("error",a),c.complete(a)}),g}var k=a("./utils"),l=a("./index"),m=a("events").EventEmitter;k.inherits(d,m),d.prototype.cancel=function(){this.cancelled=!0,this.emit("cancel")},d.prototype.ready=function(a,b){function c(){e.cancel()}function d(){e.removeAllListeners(),a.removeListener("destroyed",c),b.removeListener("destroyed",c)}var e=this;a.once("destroyed",c),b.once("destroyed",c),this.then(d,d)},g.prototype.writeCheckpoint=function(a){var b=this;return this.updateTarget(a).then(function(){return b.updateSource(a)})},g.prototype.updateTarget=function(a){return f(this.target,this.id,a)},g.prototype.updateSource=function(a){var b=this;return this.readOnlySource?k.Promise.resolve(!0):f(this.src,this.id,a)["catch"](function(a){if(401===a.status)return b.readOnlySource=!0,!0;throw a})},g.prototype.getCheckpoint=function(){var a=this;return a.target.get(a.id).then(function(b){return a.src.get(a.id).then(function(a){return b.last_seq===a.last_seq?a.last_seq:0},function(c){if(404===c.status&&b.last_seq)return a.src.put({_id:a.id,last_seq:0}).then(function(){return 0},function(c){return 401===c.status?(a.readOnlySource=!0,b.last_seq):0});throw c})})["catch"](function(a){if(404!==a.status)throw a;return 0})},c.replicate=j},{"./index":15,"./utils":21,events:25}],18:[function(a,b){(function(c){var d=a("./constructor"),e=a("./utils"),f=e.Promise,g=a("events").EventEmitter;d.adapters={},d.preferredAdapters=a("./adapters/preferredAdapters.js"),d.prefix="_pouch_";var h=new g,i=["on","addListener","emit","listeners","once","removeAllListeners","removeListener","setMaxListeners"];i.forEach(function(a){d[a]=h[a].bind(h)}),d.setMaxListeners(0),d.parseAdapter=function(a,b){var f,g,h=a.match(/([a-z\-]*):\/\/(.*)/);if(h){if(a=/http(s?)/.test(h[1])?h[1]+"://"+h[2]:h[2],f=h[1],!d.adapters[f].valid())throw"Invalid adapter";return{name:a,adapter:h[1]}}var i="idb"in d.adapters&&"websql"in d.adapters&&e.hasLocalStorage()&&c.localStorage["_pouch__websqldb_"+d.prefix+a];if("undefined"!=typeof b&&b.db)g="leveldb";else for(var j=0;j<d.preferredAdapters.length;++j)if(g=d.preferredAdapters[j],g in d.adapters){if(i&&"idb"===g)continue;break}if(f=d.adapters[g],g&&f){var k="use_prefix"in f?f.use_prefix:!0;return{name:k?d.prefix+a:a,adapter:g}}throw"No valid adapter found"},d.destroy=e.toPromise(function(a,b,c){function e(){i.destroy(h,b,function(a,b){a?c(a):(d.emit("destroyed",h),d.emit(h,"destroyed"),c(null,b||{ok:!0}))})}("function"==typeof b||"undefined"==typeof b)&&(c=b,b={}),"object"==typeof a&&(b=a,a=void 0);var g=d.parseAdapter(b.name||a,b),h=g.name,i=d.adapters[g.adapter],j="use_prefix"in i?i.use_prefix:!0,k=j?h.replace(new RegExp("^"+d.prefix),""):h;new d(k,{adapter:g.adapter},function(a,b){return a?c(a):void b.get("_local/_pouch_dependentDbs",function(a,b){if(a)return"not_found"!==a.name?c(a):e();var h=b.dependentDbs,i=Object.keys(h).map(function(a){var b=j?a.replace(new RegExp("^"+d.prefix),""):a;return d.destroy(b,{adapter:g.adapter})});f.all(i).then(e,function(a){c(a)})})})}),d.allDbs=e.toPromise(function(a){var b=new Error("allDbs method removed");b.stats="400",a(b)}),d.adapter=function(a,b){b.valid()&&(d.adapters[a]=b)},d.plugin=function(a){Object.keys(a).forEach(function(b){d.prototype[b]=a[b]})},b.exports=d}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapters/preferredAdapters.js":4,"./constructor":7,"./utils":21,events:25}],19:[function(a,b){function c(a,b,f,g){function h(a){o||(o=!0,l.emit("cancel",a))}function i(a){l.emit("change",{direction:"pull",change:a})}function j(a){l.emit("change",{direction:"push",change:a})}function k(a,b){"change"!==a||b!==i&&b!==j?"cancel"===a&&b===h?l.removeAllListeners("cancel"):a in p&&b===p[a]&&l.removeAllListeners(a):l.removeAllListeners("change")}if(!(this instanceof c))return new c(a,b,f,g);var l=this;"function"==typeof f&&(g=f,f={}),"undefined"==typeof f&&(f={}),this.canceled=!1,f=d.clone(f);var m,n;"onChange"in f&&(m=f.onChange,delete f.onChange),"function"!=typeof g||f.complete?"complete"in f&&(n=f.complete,delete f.complete):n=g,this.push=e(a,b,f),this.pull=e(b,a,f);var o=!1,p={};this.on("newListener",function(a){"change"===a?(l.pull.on("change",i),l.push.on("change",j)):"cancel"===a?(l.pull.on("cancel",h),l.push.on("cancel",h)):"error"===a||"complete"===a||a in p||(p[a]=function(b){l.emit(a,b)},l.pull.on(a,p[a]),l.push.on(a,p[a]))}),this.on("removeListener",function(a){"change"===a?(l.pull.removeListener("change",i),l.push.removeListener("change",j)):"cancel"===a?(l.pull.removeListener("cancel",h),l.push.removeListener("cancel",h)):a in p&&"function"==typeof p[a]&&(l.pull.removeListener(a,p[a]),l.push.removeListener(a,p[a]),delete p[a])}),this.pull.on("removeListener",k),this.push.on("removeListener",k);var q=d.Promise.all([this.push,this.pull]).then(function(a){var b={push:a[0],pull:a[1]};
return l.emit("complete",b),n&&n(null,b),l.removeAllListeners(),b},function(a){throw l.cancel(),l.emit("error",a),n&&n(a),l.removeAllListeners(),a});this.then=function(a,b){return q.then(a,b)},this["catch"]=function(a){return q["catch"](a)}}var d=a("./utils"),e=a("./replicate").replicate,f=a("events").EventEmitter;b.exports=c,d.inherits(c,f),c.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())}},{"./replicate":17,"./utils":21,events:25}],20:[function(a,b){function c(){this.isReady=!1,this.failed=!1,this.queue=[]}b.exports=c,c.prototype.execute=function(){var a,b;if(this.failed)for(;a=this.queue.shift();)"function"!=typeof a?(b=a.parameters[a.parameters.length-1],"function"==typeof b?b(this.failed):"changes"===a.name&&"function"==typeof b.complete&&b.complete(this.failed)):a(this.failed);else if(this.isReady)for(;a=this.queue.shift();)"function"==typeof a?a():a.task=this.db[a.name].apply(this.db,a.parameters)},c.prototype.fail=function(a){this.failed=a,this.execute()},c.prototype.ready=function(a){return this.failed?!1:0===arguments.length?this.isReady:(this.isReady=a?!0:!1,this.db=a,void this.execute())},c.prototype.addTask=function(a,b){if("function"!=typeof a){var c={name:a,parameters:b};return this.queue.push(c),this.failed&&this.execute(),c}this.queue.push(a),this.failed&&this.execute()}},{}],21:[function(a,b,c){(function(b,d){function e(a){var b={};return a.forEach(function(a){b[a]=!0}),b}function f(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function g(){if(!(this instanceof g))return new g;var a=this;m.call(this),this.isChrome=f(),this.listeners={},this.hasLocal=!1,this.isChrome||(this.hasLocal=c.hasLocalStorage()),this.isChrome?chrome.storage.onChanged.addListener(function(b){null!=b.db_name&&a.emit(b.dbName.newValue)}):this.hasLocal&&(d.addEventListener?d.addEventListener("storage",function(b){a.emit(b.key)}):d.attachEvent("storage",function(b){a.emit(b.key)}))}var h=a("crypto"),i=a("md5-jkmyers"),j=a("./merge");c.extend=a("pouchdb-extend"),c.ajax=a("./deps/ajax"),c.createBlob=a("./deps/blob"),c.uuid=a("./deps/uuid"),c.getArguments=a("argsarray");var k=a("./deps/buffer"),l=a("./deps/errors"),m=a("events").EventEmitter;c.Promise="function"==typeof d.Promise?d.Promise:a("bluebird");var n=c.Promise,o=e(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree"]);c.clone=function(a){return c.extend(!0,{},a)},c.inherits=a("inherits"),c.invalidIdError=function(a){return a?"string"!=typeof a?l.INVALID_ID:/^_/.test(a)&&!/^_(design|local)/.test(a)?l.RESERVED_ID:void 0:l.MISSING_ID},c.call=c.getArguments(function(a){if(a.length){var b=a.shift();"function"==typeof b&&b.apply(this,a)}}),c.isLocalId=function(a){return/^_local/.test(a)},c.isDeleted=function(a,b){b||(b=j.winningRev(a));var c=b.indexOf("-");-1!==c&&(b=b.substring(c+1));var d=!1;return j.traverseRevTree(a.rev_tree,function(a,c,e,f,g){e===b&&(d=!!g.deleted)}),d},c.filterChange=function(a){return function(b){var c={},d=a.filter&&"function"==typeof a.filter;if(c.query=a.query_params,a.filter&&d&&!a.filter.call(this,b.doc,c))return!1;if(a.doc_ids&&-1===a.doc_ids.indexOf(b.id))return!1;if(a.include_docs)for(var e in b.doc._attachments)b.doc._attachments.hasOwnProperty(e)&&(b.doc._attachments[e].stub=!0);else delete b.doc;return!0}},c.parseDoc=function(a,b){var d,e,f,g={status:"available"};if(a._deleted&&(g.deleted=!0),b)if(a._id||(a._id=c.uuid()),e=c.uuid(32,16).toLowerCase(),a._rev){if(f=/^(\d+)-(.+)$/.exec(a._rev),!f)throw"invalid value for property '_rev'";a._rev_tree=[{pos:parseInt(f[1],10),ids:[f[2],{status:"missing"},[[e,g,[]]]]}],d=parseInt(f[1],10)+1}else a._rev_tree=[{pos:1,ids:[e,g,[]]}],d=1;else if(a._revisions&&(a._rev_tree=[{pos:a._revisions.start-a._revisions.ids.length+1,ids:a._revisions.ids.reduce(function(a,b){return null===a?[b,g,[]]:[b,{status:"missing"},[a]]},null)}],d=a._revisions.start,e=a._revisions.ids[0]),!a._rev_tree){if(f=/^(\d+)-(.+)$/.exec(a._rev),!f)return l.BAD_ARG;d=parseInt(f[1],10),e=f[2],a._rev_tree=[{pos:parseInt(f[1],10),ids:[f[2],g,[]]}]}var h=c.invalidIdError(a._id);if(h)return h;a._id=decodeURIComponent(a._id),a._rev=[d,e].join("-");var i={metadata:{},data:{}};for(var j in a)if(a.hasOwnProperty(j)){var k="_"===j[0];if(k&&!o[j])return h=l.error(l.DOC_VALIDATION),h.reason+=": "+j,h;k&&"_attachments"!==j?i.metadata[j.slice(1)]=a[j]:i.data[j]=a[j]}return i},c.isCordova=function(){return"undefined"!=typeof cordova||"undefined"!=typeof PhoneGap||"undefined"!=typeof phonegap},c.hasLocalStorage=function(){if(f())return!1;try{return d.localStorage}catch(a){return!1}},c.Changes=g,c.inherits(g,m),g.prototype.addListener=function(a,b,d,e){function f(){d.changes({include_docs:e.include_docs,conflicts:e.conflicts,continuous:!1,descending:!1,filter:e.filter,view:e.view,since:e.since,query_params:e.query_params,onChange:function(a){a.seq>e.since&&!e.cancelled&&(e.since=a.seq,c.call(e.onChange,a))}})}this.listeners[b]||(this.listeners[b]=f,this.on(a,f))},g.prototype.removeListener=function(a,b){b in this.listeners&&m.prototype.removeListener.call(this,a,this.listeners[b])},g.prototype.notifyLocalWindows=function(a){this.isChrome?chrome.storage.local.set({dbName:a}):this.hasLocal&&(localStorage[a]="a"===localStorage[a]?"b":"a")},g.prototype.notify=function(a){this.emit(a),this.notifyLocalWindows(a)},c.atob=b.browser&&"atob"in d?function(a){return atob(a)}:function(a){var b=new k(a,"base64");if(b.toString("base64")!==a)throw"Cannot base64 encode full string";return b.toString("binary")},c.btoa=b.browser&&"btoa"in d?function(a){return btoa(a)}:function(a){return new k(a,"binary").toString("base64")},c.fixBinary=function(a){if(!b.browser)return a;for(var c=a.length,d=new ArrayBuffer(c),e=new Uint8Array(d),f=0;c>f;f++)e[f]=a.charCodeAt(f);return d},c.once=function(a){var b=!1;return c.getArguments(function(c){if(b)throw"function"==typeof console.trace&&console.trace(),new Error("once called  more than once");b=!0,a.apply(this,c)})},c.toPromise=function(a){return c.getArguments(function(d){var e,f=this,g="function"==typeof d[d.length-1]?d.pop():!1;g&&(e=function(a,c){b.nextTick(function(){g(a,c)})});var h=new n(function(b,e){var g;try{var h=c.once(function(a,c){a?e(a):b(c)});d.push(h),g=a.apply(f,d),g&&"function"==typeof g.then&&b(g)}catch(i){e(i)}});return e&&h.then(function(a){e(null,a)},e),h.cancel=function(){return this},h})},c.adapterFun=function(a,b){return c.toPromise(c.getArguments(function(d){if(this._closed)return n.reject(new Error("database is closed"));var e=this;return this.taskqueue.isReady?b.apply(this,d):new c.Promise(function(b,c){e.taskqueue.addTask(function(f){f?c(f):b(e[a].apply(e,d))})})}))},c.arrayBufferToBinaryString=function(a){for(var b="",c=new Uint8Array(a),d=c.byteLength,e=0;d>e;e++)b+=String.fromCharCode(c[e]);return b},c.cancellableFun=function(a,b,d){d=d?c.clone(!0,{},d):{};var e=new m,f=d.complete||function(){},g=d.complete=c.once(function(a,b){a?f(a):(e.emit("end",b),f(null,b)),e.removeAllListeners()}),h=d.onChange||function(){},i=0;b.on("destroyed",function(){e.removeAllListeners()}),d.onChange=function(a){h(a),a.seq<=i||(i=a.seq,e.emit("change",a),a.deleted?e.emit("delete",a):1===a.changes.length&&"1-"===a.changes[0].rev.slice(0,1)?e.emit("create",a):e.emit("update",a))};var j=new n(function(a,b){d.complete=function(c,d){c?b(c):a(d)}});return j.then(function(a){g(null,a)},g),j.cancel=function(){j.isCancelled=!0,b.taskqueue.isReady&&d.complete(null,{status:"cancelled"})},b.taskqueue.isReady?a(b,d,j):b.taskqueue.addTask(function(){j.isCancelled?d.complete(null,{status:"cancelled"}):a(b,d,j)}),j.on=e.on.bind(e),j.once=e.once.bind(e),j.addListener=e.addListener.bind(e),j.removeListener=e.removeListener.bind(e),j.removeAllListeners=e.removeAllListeners.bind(e),j.setMaxListeners=e.setMaxListeners.bind(e),j.listeners=e.listeners.bind(e),j.emit=e.emit.bind(e),j},c.Crypto={},c.MD5=c.Crypto.MD5=function(a){return b.browser?i(a):h.createHash("md5").update(a).digest("hex")}}).call(this,a("/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./deps/ajax":8,"./deps/blob":9,"./deps/buffer":24,"./deps/errors":10,"./deps/uuid":12,"./merge":16,"/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":26,argsarray:23,bluebird:32,crypto:24,events:25,inherits:27,"md5-jkmyers":46,"pouchdb-extend":47}],22:[function(a,b){b.exports="2.2.3"},{}],23:[function(a,b){function c(a){return function(){var b=arguments.length;if(b){for(var c=[],d=-1;++d<b;)c[d]=arguments[d];return a.call(this,c)}return a.call(this,[])}}b.exports=c},{}],24:[function(){},{}],25:[function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}b.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length))throw b=arguments[1],b instanceof Error?b:TypeError('Uncaught, unspecified "error" event.');if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];c.apply(this,h)}else if(f(c)){for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];for(j=c.slice(),e=j.length,i=0;e>i;i++)j[i].apply(this,h)}return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned){var e;e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?d(a._events[b])?1:a._events[b].length:0}},{}],26:[function(a,b){var c=b.exports={};c.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),c.title="browser",c.browser=!0,c.env={},c.argv=[],c.binding=function(){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(){throw new Error("process.chdir is not supported")}},{}],27:[function(a,b){b.exports="function"==typeof Object.create?function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],28:[function(a,b){function c(){}b.exports=c},{}],29:[function(a,b){var c=a("./promise"),d=a("./reject"),e=a("./resolve"),f=a("./INTERNAL"),g=a("./handlers"),h=d(new TypeError("must be an array"));b.exports=function(a){function b(a,b){function c(a){i[b]=a,++j===d&&g.resolve(l,i)}e(a).then(c,function(a){g.reject(l,a)})}if("[object Array]"!==Object.prototype.toString.call(a))return h;var d=a.length;if(!d)return e([]);for(var i=new Array(d),j=0,k=-1,l=new c(f);++k<d;)b(a[k],k);return l}},{"./INTERNAL":28,"./handlers":31,"./promise":33,"./reject":35,"./resolve":36}],30:[function(a,b){function c(a){var b=a&&a.then;return a&&"object"==typeof a&&"function"==typeof b?function(){b.apply(a,arguments)}:void 0}b.exports=c},{}],31:[function(a,b,c){var d=a("./tryCatch"),e=a("./getThen"),f=a("./resolveThenable"),g=a("./states");c.resolve=function(a,b){var h=d(e,b);if("error"===h.status)return c.reject(a,h.value);var i=h.value;if(i)f.safely(a,i);else{a.state=g.FULFILLED,a.outcome=b;for(var j=-1,k=a.queue.length;++j<k;)a.queue[j].callFulfilled(b)}return a},c.reject=function(a,b){a.state=g.REJECTED,a.outcome=b;for(var c=-1,d=a.queue.length;++c<d;)a.queue[c].callRejected(b);return a}},{"./getThen":30,"./resolveThenable":37,"./states":38,"./tryCatch":39}],32:[function(a,b,c){b.exports=c=a("./promise"),c.resolve=a("./resolve"),c.reject=a("./reject"),c.all=a("./all")},{"./all":29,"./promise":33,"./reject":35,"./resolve":36}],33:[function(a,b){function c(a){if(!(this instanceof c))return new c(a);if("function"!=typeof a)throw new TypeError("reslover must be a function");this.state=g.PENDING,this.queue=[],a!==e&&f.safely(this,a)}var d=a("./unwrap"),e=a("./INTERNAL"),f=a("./resolveThenable"),g=a("./states"),h=a("./queueItem");b.exports=c,c.prototype["catch"]=function(a){return this.then(null,a)},c.prototype.then=function(a,b){if("function"!=typeof a&&this.state===g.FULFILLED||"function"!=typeof b&&this.state===g.REJECTED)return this;var f=new c(e);if(this.state!==g.PENDING){var i=this.state===g.FULFILLED?a:b;d(f,i,this.outcome)}else this.queue.push(new h(f,a,b));return f}},{"./INTERNAL":28,"./queueItem":34,"./resolveThenable":37,"./states":38,"./unwrap":40}],34:[function(a,b){function c(a,b,c){this.promise=a,"function"==typeof b&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),"function"==typeof c&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}var d=a("./handlers"),e=a("./unwrap");b.exports=c,c.prototype.callFulfilled=function(a){d.resolve(this.promise,a)},c.prototype.otherCallFulfilled=function(a){e(this.promise,this.onFulfilled,a)},c.prototype.callRejected=function(a){d.reject(this.promise,a)},c.prototype.otherCallRejected=function(a){e(this.promise,this.onRejected,a)}},{"./handlers":31,"./unwrap":40}],35:[function(a,b){function c(a){var b=new d(e);return f.reject(b,a)}var d=a("./promise"),e=a("./INTERNAL"),f=a("./handlers");b.exports=c},{"./INTERNAL":28,"./handlers":31,"./promise":33}],36:[function(a,b){function c(a){if(a)return a instanceof d?a:f.resolve(new d(e),a);var b=typeof a;switch(b){case"boolean":return g;case"undefined":return i;case"object":return h;case"number":return j;case"string":return k}}var d=a("./promise"),e=a("./INTERNAL"),f=a("./handlers");b.exports=c;var g=f.resolve(new d(e),!1),h=f.resolve(new d(e),null),i=f.resolve(new d(e),void 0),j=f.resolve(new d(e),0),k=f.resolve(new d(e),"")},{"./INTERNAL":28,"./handlers":31,"./promise":33}],37:[function(a,b,c){function d(a,b){function c(b){h||(h=!0,e.reject(a,b))}function d(b){h||(h=!0,e.resolve(a,b))}function g(){b(d,c)}var h=!1,i=f(g);"error"===i.status&&c(i.value)}var e=a("./handlers"),f=a("./tryCatch");c.safely=d},{"./handlers":31,"./tryCatch":39}],38:[function(a,b,c){c.REJECTED=["REJECTED"],c.FULFILLED=["FULFILLED"],c.PENDING=["PENDING"]},{}],39:[function(a,b){function c(a,b){var c={};try{c.value=a(b),c.status="success"}catch(d){c.status="error",c.value=d}return c}b.exports=c},{}],40:[function(a,b){function c(a,b,c){d(function(){var d;try{d=b(c)}catch(f){return e.reject(a,f)}d===a?e.reject(a,new TypeError("Cannot resolve promise with itself")):e.resolve(a,d)})}var d=a("immediate"),e=a("./handlers");b.exports=c},{"./handlers":31,immediate:41}],41:[function(a,b){function c(){e=!0;for(var a,b,c=h.length;c;){for(b=h,h=[],a=-1;++a<c;)b[a]();c=h.length}e=!1}function d(a){1!==h.push(a)||e||f()}for(var e,f,g=[a("./nextTick"),a("./mutation.js"),a("./messageChannel"),a("./stateChange"),a("./timeout")],h=[],i=-1,j=g.length;++i<j;)if(g[i]&&g[i].test&&g[i].test()){f=g[i].install(c);break}b.exports=d},{"./messageChannel":42,"./mutation.js":43,"./nextTick":24,"./stateChange":44,"./timeout":45}],42:[function(a,b,c){(function(a){c.test=function(){return a.setImmediate?!1:"undefined"!=typeof a.MessageChannel},c.install=function(b){var c=new a.MessageChannel;return c.port1.onmessage=b,function(){c.port2.postMessage(0)}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],43:[function(a,b,c){(function(a){var b=a.MutationObserver||a.WebKitMutationObserver;c.test=function(){return b},c.install=function(c){var d=0,e=new b(c),f=a.document.createTextNode("");return e.observe(f,{characterData:!0}),function(){f.data=d=++d%2}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],44:[function(a,b,c){(function(a){c.test=function(){return"document"in a&&"onreadystatechange"in a.document.createElement("script")},c.install=function(b){return function(){var c=a.document.createElement("script");return c.onreadystatechange=function(){b(),c.onreadystatechange=null,c.parentNode.removeChild(c),c=null},a.document.documentElement.appendChild(c),b}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],45:[function(a,b,c){c.test=function(){return!0},c.install=function(a){return function(){setTimeout(a,0)}}},{}],46:[function(a,b,c){!function(a,d){"function"==typeof define&&define.amd?define(d):"object"==typeof c?b.exports=d():a.md5=d()}(this,function(){function a(a,b){var g=a[0],h=a[1],i=a[2],j=a[3];g=c(g,h,i,j,b[0],7,-680876936),j=c(j,g,h,i,b[1],12,-389564586),i=c(i,j,g,h,b[2],17,606105819),h=c(h,i,j,g,b[3],22,-1044525330),g=c(g,h,i,j,b[4],7,-176418897),j=c(j,g,h,i,b[5],12,1200080426),i=c(i,j,g,h,b[6],17,-1473231341),h=c(h,i,j,g,b[7],22,-45705983),g=c(g,h,i,j,b[8],7,1770035416),j=c(j,g,h,i,b[9],12,-1958414417),i=c(i,j,g,h,b[10],17,-42063),h=c(h,i,j,g,b[11],22,-1990404162),g=c(g,h,i,j,b[12],7,1804603682),j=c(j,g,h,i,b[13],12,-40341101),i=c(i,j,g,h,b[14],17,-1502002290),h=c(h,i,j,g,b[15],22,1236535329),g=d(g,h,i,j,b[1],5,-165796510),j=d(j,g,h,i,b[6],9,-1069501632),i=d(i,j,g,h,b[11],14,643717713),h=d(h,i,j,g,b[0],20,-373897302),g=d(g,h,i,j,b[5],5,-701558691),j=d(j,g,h,i,b[10],9,38016083),i=d(i,j,g,h,b[15],14,-660478335),h=d(h,i,j,g,b[4],20,-405537848),g=d(g,h,i,j,b[9],5,568446438),j=d(j,g,h,i,b[14],9,-1019803690),i=d(i,j,g,h,b[3],14,-187363961),h=d(h,i,j,g,b[8],20,1163531501),g=d(g,h,i,j,b[13],5,-1444681467),j=d(j,g,h,i,b[2],9,-51403784),i=d(i,j,g,h,b[7],14,1735328473),h=d(h,i,j,g,b[12],20,-1926607734),g=e(g,h,i,j,b[5],4,-378558),j=e(j,g,h,i,b[8],11,-2022574463),i=e(i,j,g,h,b[11],16,1839030562),h=e(h,i,j,g,b[14],23,-35309556),g=e(g,h,i,j,b[1],4,-1530992060),j=e(j,g,h,i,b[4],11,1272893353),i=e(i,j,g,h,b[7],16,-155497632),h=e(h,i,j,g,b[10],23,-1094730640),g=e(g,h,i,j,b[13],4,681279174),j=e(j,g,h,i,b[0],11,-358537222),i=e(i,j,g,h,b[3],16,-722521979),h=e(h,i,j,g,b[6],23,76029189),g=e(g,h,i,j,b[9],4,-640364487),j=e(j,g,h,i,b[12],11,-421815835),i=e(i,j,g,h,b[15],16,530742520),h=e(h,i,j,g,b[2],23,-995338651),g=f(g,h,i,j,b[0],6,-198630844),j=f(j,g,h,i,b[7],10,1126891415),i=f(i,j,g,h,b[14],15,-1416354905),h=f(h,i,j,g,b[5],21,-57434055),g=f(g,h,i,j,b[12],6,1700485571),j=f(j,g,h,i,b[3],10,-1894986606),i=f(i,j,g,h,b[10],15,-1051523),h=f(h,i,j,g,b[1],21,-2054922799),g=f(g,h,i,j,b[8],6,1873313359),j=f(j,g,h,i,b[15],10,-30611744),i=f(i,j,g,h,b[6],15,-1560198380),h=f(h,i,j,g,b[13],21,1309151649),g=f(g,h,i,j,b[4],6,-145523070),j=f(j,g,h,i,b[11],10,-1120210379),i=f(i,j,g,h,b[2],15,718787259),h=f(h,i,j,g,b[9],21,-343485551),a[0]=l(g,a[0]),a[1]=l(h,a[1]),a[2]=l(i,a[2]),a[3]=l(j,a[3])}function b(a,b,c,d,e,f){return b=l(l(b,a),l(d,f)),l(b<<e|b>>>32-e,c)}function c(a,c,d,e,f,g,h){return b(c&d|~c&e,a,c,f,g,h)}function d(a,c,d,e,f,g,h){return b(c&e|d&~e,a,c,f,g,h)}function e(a,c,d,e,f,g,h){return b(c^d^e,a,c,f,g,h)}function f(a,c,d,e,f,g,h){return b(d^(c|~e),a,c,f,g,h)}function g(b){txt="";var c,d=b.length,e=[1732584193,-271733879,-1732584194,271733878];for(c=64;c<=b.length;c+=64)a(e,h(b.substring(c-64,c)));b=b.substring(c-64);var f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(c=0;c<b.length;c++)f[c>>2]|=b.charCodeAt(c)<<(c%4<<3);if(f[c>>2]|=128<<(c%4<<3),c>55)for(a(e,f),c=0;16>c;c++)f[c]=0;return f[14]=8*d,a(e,f),e}function h(a){var b,c=[];for(b=0;64>b;b+=4)c[b>>2]=a.charCodeAt(b)+(a.charCodeAt(b+1)<<8)+(a.charCodeAt(b+2)<<16)+(a.charCodeAt(b+3)<<24);return c}function i(a){for(var b="",c=0;4>c;c++)b+=m[a>>8*c+4&15]+m[a>>8*c&15];return b}function j(a){for(var b=0;b<a.length;b++)a[b]=i(a[b]);return a.join("")}function k(a){return j(g(a))}function l(a,b){return a+b&4294967295}function l(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}var m="0123456789abcdef".split("");return"5d41402abc4b2a76b9719d911017c592"!=k("hello"),k})},{}],47:[function(a,b){function c(a){return null===a?String(a):"object"==typeof a||"function"==typeof a?h[l.call(a)]||"object":typeof a}function d(a){return null!==a&&a===a.window}function e(a){if(!a||"object"!==c(a)||a.nodeType||d(a))return!1;try{if(a.constructor&&!m.call(a,"constructor")&&!m.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}var e;for(e in a);return void 0===e||m.call(a,e)}function f(a){return"function"===c(a)}function g(){var a,b,c,d,h,i,j=arguments[0]||{},k=1,l=arguments.length,m=!1;for("boolean"==typeof j&&(m=j,j=arguments[1]||{},k=2),"object"==typeof j||f(j)||(j={}),l===k&&(j=this,--k);l>k;k++)if(null!=(a=arguments[k]))for(b in a)if(!(b in Object.prototype)){if(c=j[b],d=a[b],j===d)continue;m&&d&&(e(d)||(h=n(d)))?(h?(h=!1,i=c&&n(c)?c:[]):i=c&&e(c)?c:{},j[b]=g(m,i,d)):void 0!==d&&(n(a)&&f(d)||(j[b]=d))}return j}for(var h={},i=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],j=0;j<i.length;j++){var k=i[j];h["[object "+k+"]"]=k.toLowerCase()}var l=h.toString,m=h.hasOwnProperty,n=Array.isArray||function(a){return"array"===c(a)};b.exports=g},{}],48:[function(a,b){var c=a("./upsert"),d=a("./utils"),e=d.Promise;b.exports=function(a){var b=a.db,f=a.viewName,g=a.map,h=a.reduce,i=a.temporary,j=g.toString()+(h&&h.toString())+"undefined";if(!i&&b._cachedViews){var k=b._cachedViews[j];if(k)return e.resolve(k)}return b.info().then(function(a){function e(a){a.views=a.views||{};var b=f;-1===b.indexOf("/")&&(b=f+"/"+f);var c=a.views[b]=a.views[b]||{};return c[k]?void 0:(c[k]=!0,a)}var k=a.db_name+"-mrview-"+(i?"temp":d.MD5(j));return c(b,"_local/mrviews",e).then(function(){return b.registerDependentDatabase(k).then(function(a){var c=a.db;c.auto_compaction=!0;var d={name:k,db:c,sourceDB:b,adapter:b.adapter,mapFun:g,reduceFun:h};return d.db.get("_local/lastSeq")["catch"](function(a){if("not_found"!==a.name)throw a}).then(function(a){return d.seq=a?a.seq:0,i||(b._cachedViews=b._cachedViews||{},b._cachedViews[j]=d,d.db.on("destroyed",function(){delete b._cachedViews[j]})),d})})})})}},{"./upsert":55,"./utils":56}],49:[function(_dereq_,module,exports){module.exports=function(func,emit,sum,log,isArray,toJSON){return eval(" ("+func+");")}},{}],50:[function(a,b,c){function d(a){return-1===a.indexOf("/")?[a,a]:a.split("/")}function e(a,b,c){try{return{output:b.apply(null,c)}}catch(d){return a.emit("error",d),{error:d}}}function f(a,b){var c=w(a.key,b.key);return 0!==c?c:w(a.value,b.value)}function g(a,b,c){return c=c||0,"number"==typeof b?a.slice(c,b+c):c>0?a.slice(c):a}function h(a){var b=new Error("builtin "+a+" function requires map values to be numbers or number arrays");return b.name="invalid_value",b.status=500,b}function i(a){for(var b=0,c=0,d=a.length;d>c;c++){var e=a[c];if("number"!=typeof e){if(!Array.isArray(e))throw h("_sum");b="number"==typeof b?[b]:b;for(var f=0,g=e.length;g>f;f++){var i=e[f];if("number"!=typeof i)throw h("_sum");"undefined"==typeof b[f]?b.push(i):b[f]+=i}}else"number"==typeof b?b+=e:b[0]+=e}return b}function j(a,b,c,d){var e=b[a];"undefined"!=typeof e&&(d&&(e=encodeURIComponent(JSON.stringify(e))),c.push(a+"="+e))}function k(a,b){var c=a.descending?"endkey":"startkey",d=a.descending?"startkey":"endkey";if("undefined"!=typeof a[c]&&"undefined"!=typeof a[d]&&w(a[c],a[d])>0)throw new s("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(b.reduce&&a.reduce!==!1){if(a.include_docs)throw new s("{include_docs:true} is invalid for reduce");if(a.keys&&a.keys.length>1&&!a.group&&!a.group_level)throw new s("Multi-key fetches for reduce views must use {group: true}")}if(a.group_level){if("number"!=typeof a.group_level)throw new s('Invalid value for integer: "'+a.group_level+'"');if(a.group_level<0)throw new s('Invalid value for positive integer: "'+a.group_level+'"')}}function l(a,b,c){var e,f=[],g="GET";if(j("reduce",c,f),j("include_docs",c,f),j("limit",c,f),j("descending",c,f),j("group",c,f),j("group_level",c,f),j("skip",c,f),j("startkey",c,f,!0),j("endkey",c,f,!0),j("inclusive_end",c,f),j("key",c,f,!0),f=f.join("&"),f=""===f?"":"?"+f,"undefined"!=typeof c.keys){var h=2e3,i="keys="+encodeURIComponent(JSON.stringify(c.keys));i.length+f.length+1<=h?f+=("?"===f[0]?"&":"?")+i:(g="POST","string"==typeof b?e=JSON.stringify({keys:c.keys}):b.keys=c.keys)}if("string"==typeof b){var k=d(b);return a.request({method:g,url:"_design/"+k[0]+"/_view/"+k[1]+f,body:e})}return e=e||{},Object.keys(b).forEach(function(a){e[a]=Array.isArray(b[a])?b[a]:b[a].toString()}),a.request({method:"POST",url:"_temp_view"+f,body:e})}function m(a){return function(b){if("not_found"===b.name)return a;throw b}}function n(a,b,c){var d="_local/doc_"+a;return b.db.get(d)["catch"](m({_id:d,keys:[]})).then(function(d){return b.db.allDocs({keys:d.keys,include_docs:!0}).then(function(b){var e=b.rows.map(function(a){return a.doc}).filter(function(a){return a}),f=c[a],g={};e.forEach(function(a){g[a._id]=!0,a._deleted=!f[a._id],a._deleted||(a.value=f[a._id])});var h=Object.keys(f);return h.forEach(function(a){g[a]||e.push({_id:a,value:f[a]})}),d.keys=B.uniq(h.concat(d.keys)),e.splice(0,0,d),e})})}function o(a,b,c){var d="_local/lastSeq";return a.db.get(d)["catch"](m({_id:d,seq:0})).then(function(d){var e=Object.keys(b);return C.all(e.map(function(c){return n(c,a,b)})).then(function(b){var e=[];return b.forEach(function(a){e=e.concat(a)}),d.seq=c,e.push(d),a.db.bulkDocs({docs:e})})})}function p(a,b,c){0===c.group_level&&delete c.group_level;var d,f=c.group||c.group_level;d=G[a.reduceFun]?G[a.reduceFun]:A(a.reduceFun.toString(),null,i,t,Array.isArray,JSON.parse);var h=[],j=c.group_level;b.forEach(function(a){var b=h[h.length-1],c=f?a.key:null;return f&&Array.isArray(c)&&"number"==typeof j&&(c=c.length>j?c.slice(0,j):c),b&&0===w(b.key[0][0],c)?(b.key.push([c,a.id]),void b.value.push(a.value)):void h.push({key:[[c,a.id]],value:[a.value]})});for(var k=0,l=h.length;l>k;k++){var m=h[k],n=e(a.sourceDB,d,[m.key,m.value,!1]);m.value=n.error?null:n.output,m.key=m.key[0][0]}return{rows:g(h,c.limit,c.skip)}}function q(a){return a.request({method:"POST",url:"_view_cleanup"})}function r(a,b,c){if("http"===a.type())return l(a,b,c);if("string"!=typeof b){k(c,b);var e={db:a,viewName:"temp_view/temp_view",map:b.map,reduce:b.reduce,temporary:!0};return E.add(function(){return z(e).then(function(a){function b(){return a.db.destroy()}return B.fin(H(a).then(function(){return I(a,c)}),b)})}),E.finish()}var f=b,g=d(f),h=g[0],i=g[1];return a.get("_design/"+h).then(function(b){var d=b.views&&b.views[i];if(!d||"string"!=typeof d.map){var e=new Error("ddoc "+h+" has no view named "+i);throw e.name="not_found",e.status=400,e}k(c,d);var g={db:a,viewName:f,map:d.map,reduce:d.reduce};return z(g).then(function(a){return"ok"===c.stale||"update_after"===c.stale?("update_after"===c.stale&&H(a),I(a,c)):H(a).then(function(){return I(a,c)})})})}function s(a){this.status=400,this.name="query_parse_error",this.message=a,this.error=!0;try{Error.captureStackTrace(this,s)}catch(b){}}var t,u=a("pouchdb-collate"),v=a("./taskqueue"),w=u.collate,x=u.toIndexableString,y=u.normalizeKey,z=a("./create-view"),A=a("./evalfunc");t="undefined"!=typeof console&&"function"==typeof console.log?Function.prototype.bind.call(console.log,console):function(){};var B=a("./utils"),C=B.Promise,D=new v,E=new v,F=50,G={_sum:function(a,b){return i(b)},_count:function(a,b){return b.length},_stats:function(a,b){function c(a){for(var b=0,c=0,d=a.length;d>c;c++){var e=a[c];b+=e*e}return b}return{sum:i(b),min:Math.min.apply(null,b),max:Math.max.apply(null,b),count:b.length,sumsqr:c(b)}}},H=B.sequentialize(D,function(a){function b(a,b){d.push({id:g._id,key:y(a),value:y(b)})}function c(b,c){return function(){return o(a,b,c)}}var d,g,h;if("function"==typeof a.mapFun&&2===a.mapFun.length){var j=a.mapFun;h=function(a){return j(a,b)}}else h=A(a.mapFun.toString(),b,i,t,Array.isArray,JSON.parse);var k=a.seq||0,l=new v;return new C(function(b,i){function j(){l.finish().then(function(){a.seq=k,b()})}function m(){function b(a){i(a)}a.sourceDB.changes({conflicts:!0,include_docs:!0,since:k,limit:F}).on("complete",function(b){var i=b.results;if(!i.length)return j();for(var n={},o=0,p=i.length;p>o;o++){var q=i[o];if("_"!==q.doc._id[0]){d=[],g=q.doc,g._deleted||e(a.sourceDB,h,[g]),d.sort(f);for(var r={},s=0,t=d.length;t>s;s++){var u=d[s],v=x([u.key,u.id,s]);r[v]=u}n[q.doc._id]=r}k=q.seq}return l.add(c(n,k)),i.length<F?j():m()}).on("error",b)}m()})}),I=B.sequentialize(D,function(a,b){function c(b){return b.include_docs=!0,a.db.allDocs(b).then(function(a){return e=a.total_rows,a.rows.map(function(a){return a.doc.value})})}function d(c){var d;if(d=f?p(a,c,b):{total_rows:e,offset:g,rows:c},b.include_docs){var h=c.map(function(b){var c=b.value,d=c&&"object"==typeof c&&c._id||b.id;return a.sourceDB.get(d).then(function(a){b.doc=a},function(){})});return C.all(h).then(function(){return d})}return d}var e,f=a.reduceFun&&b.reduce!==!1,g=b.skip||0;"undefined"==typeof b.keys||b.keys.length||(b.limit=0,delete b.keys);var h=function(a){return a.reduce(function(a,b){return a.concat(b)})};if("undefined"!=typeof b.keys){var i=b.keys,j=i.map(function(a){var b={startkey:x([a]),endkey:x([a,{}])};
return c(b)});return C.all(j).then(h).then(d)}var k={descending:b.descending};if("undefined"!=typeof b.startkey&&(k.startkey=x(b.descending?[b.startkey,{}]:[b.startkey])),"undefined"!=typeof b.endkey){var l=b.inclusive_end!==!1;b.descending&&(l=!l),k.endkey=x(l?[b.endkey,{}]:[b.endkey])}if("undefined"!=typeof b.key){var m=x([b.key]),n=x([b.key,{}]);k.descending?(k.endkey=m,k.startkey=n):(k.startkey=m,k.endkey=n)}return f||("number"==typeof b.limit&&(k.limit=b.limit),k.skip=g),c(k).then(d)}),J=B.sequentialize(D,function(a){return a.get("_local/mrviews").then(function(b){var c={};Object.keys(b.views).forEach(function(a){var b=d(a),e="_design/"+b[0],f=b[1];c[e]=c[e]||{},c[e][f]=!0});var e={keys:Object.keys(c),include_docs:!0};return a.allDocs(e).then(function(d){var e={};d.rows.forEach(function(a){var d=a.key.substring(8);Object.keys(c[a.key]).forEach(function(c){var f=d+"/"+c;b.views[f]||(f=c);var g=Object.keys(b.views[f]),h=a.doc&&a.doc.views&&a.doc.views[c];g.forEach(function(a){e[a]=e[a]||h})})});var f=Object.keys(e).filter(function(a){return!e[a]}),g=f.map(function(b){return a.constructor.destroy(b,{adapter:a.adapter})});return C.all(g).then(function(){return{ok:!0}})})},m({ok:!0}))});c.viewCleanup=B.callbackify(function(){var a=this;return"http"===a.type()?q(a):J(a)}),c.query=function(a,b,c){"function"==typeof b&&(c=b,b={}),b=B.extend({},b),"function"==typeof a&&(a={map:a});var d=this,e=C.resolve().then(function(){return r(d,a,b)});return B.promisedCallback(e,c),e},B.inherits(s,Error)},{"./create-view":48,"./evalfunc":49,"./taskqueue":54,"./utils":56,"pouchdb-collate":52}],51:[function(a,b){function c(a){if(!a||"[object Object]"!==e.call(a)||a.nodeType||a.setInterval)return!1;var b=d.call(a,"constructor"),c=d.call(a.constructor.prototype,"isPrototypeOf");if(a.constructor&&!b&&!c)return!1;var f;for(f in a);return void 0===f||d.call(a,f)}var d=Object.prototype.hasOwnProperty,e=Object.prototype.toString;b.exports=function f(){var a,b,d,e,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;for("boolean"==typeof i&&(l=i,i=arguments[1]||{},j=2),"object"!=typeof i&&"function"!=typeof i&&(i={});k>j;j++)if(null!=(a=arguments[j]))for(b in a)d=i[b],e=a[b],i!==e&&(l&&e&&(c(e)||(g=Array.isArray(e)))?(g?(g=!1,h=d&&Array.isArray(d)?d:[]):h=d&&c(d)?d:{},i[b]=f(l,h,e)):void 0!==e&&(i[b]=e));return i}},{}],52:[function(a,b,c){function d(a){if(null!==a)switch(typeof a){case"boolean":return a?1:0;case"number":return i(a);case"string":return a.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var b=Array.isArray(a),d=b?a:Object.keys(a),e=-1,f=d.length,g="";if(b)for(;++e<f;)g+=c.toIndexableString(d[e]);else for(;++e<f;){var h=d[e];g+=c.toIndexableString(h)+c.toIndexableString(a[h])}return g}return""}function e(a,b){for(var d=Math.min(a.length,b.length),e=0;d>e;e++){var f=c.collate(a[e],b[e]);if(0!==f)return f}return a.length===b.length?0:a.length>b.length?1:-1}function f(a,b){return a===b?0:a>b?1:-1}function g(a,b){for(var d=Object.keys(a),e=Object.keys(b),f=Math.min(d.length,e.length),g=0;f>g;g++){var h=c.collate(d[g],e[g]);if(0!==h)return h;if(h=c.collate(a[d[g]],b[e[g]]),0!==h)return h}return d.length===e.length?0:d.length>e.length?1:-1}function h(a){var b=["boolean","number","string","object"],c=b.indexOf(typeof a);return~c?null===a?1:Array.isArray(a)?5:3>c?c+2:c+3:Array.isArray(a)?5:void 0}function i(a){if(0===a)return"1";var b=a.toExponential().split(/e\+?/),c=parseInt(b[1],10),d=0>a,e=d?"0":"2",f=(d?-c:c)-j,g=m.padLeft(f.toString(),"0",k);e+=l+g;var h=Math.abs(parseFloat(b[0]));d&&(h=10-h);var i=h.toFixed(20);return i=i.replace(/\.?0+$/,""),e+=l+i}var j=-324,k=3,l="",m=a("./utils");c.collate=function(a,b){if(a===b)return 0;a=c.normalizeKey(a),b=c.normalizeKey(b);var d=h(a),i=h(b);if(d-i!==0)return d-i;if(null===a)return 0;switch(typeof a){case"number":return a-b;case"boolean":return a===b?0:b>a?-1:1;case"string":return f(a,b)}return Array.isArray(a)?e(a,b):g(a,b)},c.normalizeKey=function(a){switch(typeof a){case"undefined":return null;case"number":return 1/0===a||a===-1/0||isNaN(a)?null:a;case"object":var b=a;if(Array.isArray(a)){var d=a.length;a=new Array(d);for(var e=0;d>e;e++)a[e]=c.normalizeKey(b[e])}else{if(a instanceof Date)return a.toJSON();if(null!==a){a={};for(var f in b)if(b.hasOwnProperty(f)){var g=b[f];"undefined"!=typeof g&&(a[f]=c.normalizeKey(g))}}}}return a},c.toIndexableString=function(a){var b="\x00";return a=c.normalizeKey(a),h(a)+l+d(a)+b}},{"./utils":53}],53:[function(a,b,c){function d(a,b,c){for(var d="",e=c-a.length;d.length<e;)d+=b;return d}c.padLeft=function(a,b,c){var e=d(a,b,c);return e+a},c.padRight=function(a,b,c){var e=d(a,b,c);return a+e},c.stringLexCompare=function(a,b){var c,d=a.length,e=b.length;for(c=0;d>c;c++){if(c===e)return 1;var f=a.charAt(c),g=b.charAt(c);if(f!==g)return g>f?-1:1}return e>d?-1:0},c.intToDecimalForm=function(a){var b=0>a,c="";do{var d=b?-Math.ceil(a%10):Math.floor(a%10);c=d+c,a=b?Math.ceil(a/10):Math.floor(a/10)}while(a);return b&&"0"!==c&&(c="-"+c),c}},{}],54:[function(a,b){function c(){this.promise=new d(function(a){a()})}var d=a("./utils").Promise;c.prototype.add=function(a){return this.promise=this.promise["catch"](function(){}).then(function(){return a()}),this.promise},c.prototype.finish=function(){return this.promise},b.exports=c},{"./utils":56}],55:[function(a,b){function c(a,b,c){return new e(function(e,f){return b&&"object"==typeof b&&(b=b._id),"string"!=typeof b?f(new Error("doc id is required")):void a.get(b,function(g,h){if(g)return"not_found"!==g.name?f(g):e(d(a,c({_id:b}),c));var i=c(h);return i?void e(d(a,i,c)):e(h)})})}function d(a,b,d){return a.put(b)["catch"](function(e){if("conflict"!==e.name)throw e;return c(a,b,d)})}var e=a("./utils").Promise;b.exports=c},{"./utils":56}],56:[function(a,b,c){(function(b,d){c.Promise="function"==typeof d.Promise?d.Promise:a("lie"),c.uniq=function(a){var b={};return a.forEach(function(a){b[a]=!0}),Object.keys(b)},c.inherits=a("inherits"),c.extend=a("extend");var e=a("argsarray");c.promisedCallback=function(a,c){return c&&a.then(function(a){b.nextTick(function(){c(null,a)})},function(a){b.nextTick(function(){c(a)})}),a},c.callbackify=function(a){return e(function(b){var d=b.pop(),e=a.apply(this,b);return"function"==typeof d&&c.promisedCallback(e,d),e})},c.fin=function(a,b){return a.then(function(a){var c=b();return"function"==typeof c.then?c.then(function(){return a}):a},function(a){var c=b();if("function"==typeof c.then)return c.then(function(){throw a});throw a})},c.sequentialize=function(a,b){return function(){var c=arguments,d=this;return a.add(function(){return b.apply(d,c)})}};var f=a("crypto"),g=a("md5-jkmyers");c.MD5=function(a){return b.browser?g(a):f.createHash("md5").update(a).digest("hex")}}).call(this,a("/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":26,argsarray:23,crypto:24,extend:51,inherits:27,lie:32,"md5-jkmyers":46}]},{},[15])(15)}),function(a){function b(a){throw RangeError(E[a])}function c(a,b){for(var c=a.length;c--;)a[c]=b(a[c]);return a}function d(a,b){return c(a.split(D),b).join(".")}function e(a){for(var b,c,d=[],e=0,f=a.length;f>e;)b=a.charCodeAt(e++),b>=55296&&56319>=b&&f>e?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),e--)):d.push(b);return d}function f(a){return c(a,function(a){var b="";return a>65535&&(a-=65536,b+=H(a>>>10&1023|55296),a=56320|1023&a),b+=H(a)}).join("")}function g(a){return 10>a-48?a-22:26>a-65?a-65:26>a-97?a-97:t}function h(a,b){return a+22+75*(26>a)-((0!=b)<<5)}function i(a,b,c){var d=0;for(a=c?G(a/x):a>>1,a+=G(a/b);a>F*v>>1;d+=t)a=G(a/F);return G(d+(F+1)*a/(a+w))}function j(a){var c,d,e,h,j,k,l,m,n,o,p=[],q=a.length,r=0,w=z,x=y;for(d=a.lastIndexOf(A),0>d&&(d=0),e=0;d>e;++e)a.charCodeAt(e)>=128&&b("not-basic"),p.push(a.charCodeAt(e));for(h=d>0?d+1:0;q>h;){for(j=r,k=1,l=t;h>=q&&b("invalid-input"),m=g(a.charCodeAt(h++)),(m>=t||m>G((s-r)/k))&&b("overflow"),r+=m*k,n=x>=l?u:l>=x+v?v:l-x,!(n>m);l+=t)o=t-n,k>G(s/o)&&b("overflow"),k*=o;c=p.length+1,x=i(r-j,c,0==j),G(r/c)>s-w&&b("overflow"),w+=G(r/c),r%=c,p.splice(r++,0,w)}return f(p)}function k(a){var c,d,f,g,j,k,l,m,n,o,p,q,r,w,x,B=[];for(a=e(a),q=a.length,c=z,d=0,j=y,k=0;q>k;++k)p=a[k],128>p&&B.push(H(p));for(f=g=B.length,g&&B.push(A);q>f;){for(l=s,k=0;q>k;++k)p=a[k],p>=c&&l>p&&(l=p);for(r=f+1,l-c>G((s-d)/r)&&b("overflow"),d+=(l-c)*r,c=l,k=0;q>k;++k)if(p=a[k],c>p&&++d>s&&b("overflow"),p==c){for(m=d,n=t;o=j>=n?u:n>=j+v?v:n-j,!(o>m);n+=t)x=m-o,w=t-o,B.push(H(h(o+x%w,0))),m=G(x/w);B.push(H(h(m,0))),j=i(d,r,f==g),d=0,++f}++d,++c}return B.join("")}function l(a){return d(a,function(a){return B.test(a)?j(a.slice(4).toLowerCase()):a})}function m(a){return d(a,function(a){return C.test(a)?"xn--"+k(a):a})}var n="object"==typeof exports&&exports,o="object"==typeof module&&module&&module.exports==n&&module,p="object"==typeof global&&global;(p.global===p||p.window===p)&&(a=p);var q,r,s=2147483647,t=36,u=1,v=26,w=38,x=700,y=72,z=128,A="-",B=/^xn--/,C=/[^ -~]/,D=/\x2E|\u3002|\uFF0E|\uFF61/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},F=t-u,G=Math.floor,H=String.fromCharCode;if(q={version:"1.2.3",ucs2:{decode:e,encode:f},decode:j,encode:k,toASCII:m,toUnicode:l},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("uri/punycode",[],function(){return q});else if(n&&!n.nodeType)if(o)o.exports=q;else for(r in q)q.hasOwnProperty(r)&&(n[r]=q[r]);else a.punycode=q}(this),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("uri/IPv6",b):a.IPv6=b(a)}(this,function(a){function b(a){var b=a.toLowerCase(),c=b.split(":"),d=c.length,e=8;""===c[0]&&""===c[1]&&""===c[2]?(c.shift(),c.shift()):""===c[0]&&""===c[1]?c.shift():""===c[d-1]&&""===c[d-2]&&c.pop(),d=c.length,-1!==c[d-1].indexOf(".")&&(e=7);var f;for(f=0;d>f&&""!==c[f];f++);if(e>f){for(c.splice(f,1,"0000");c.length<e;)c.splice(f,0,"0000");d=c.length}for(var g,h=0;e>h;h++){g=c[h].split("");for(var i=0;3>i&&("0"===g[0]&&g.length>1);i++)g.splice(0,1);c[h]=g.join("")}var j=-1,k=0,l=0,m=-1,n=!1;for(h=0;e>h;h++)n?"0"===c[h]?l+=1:(n=!1,l>k&&(j=m,k=l)):"0"==c[h]&&(n=!0,m=h,l=1);l>k&&(j=m,k=l),k>1&&c.splice(j,k,""),d=c.length;var o="";for(""===c[0]&&(beststr=":"),h=0;d>h&&(o+=c[h],h!==d-1);h++)o+=":";return""===c[d-1]&&(o+=":"),o}function c(){return a.IPv6===this&&(a.IPv6=d),this}var d=a&&a.IPv6;return{best:b,noConflict:c}}),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("uri/SecondLevelDomains",b):a.SecondLevelDomains=b(a)}(this,function(a){var b=a&&a.SecondLevelDomains,c=Object.prototype.hasOwnProperty,d={list:{ac:"com|gov|mil|net|org",ae:"ac|co|gov|mil|name|net|org|pro|sch",af:"com|edu|gov|net|org",al:"com|edu|gov|mil|net|org",ao:"co|ed|gv|it|og|pb",ar:"com|edu|gob|gov|int|mil|net|org|tur",at:"ac|co|gv|or",au:"asn|com|csiro|edu|gov|id|net|org",ba:"co|com|edu|gov|mil|net|org|rs|unbi|unmo|unsa|untz|unze",bb:"biz|co|com|edu|gov|info|net|org|store|tv",bh:"biz|cc|com|edu|gov|info|net|org",bn:"com|edu|gov|net|org",bo:"com|edu|gob|gov|int|mil|net|org|tv",br:"adm|adv|agr|am|arq|art|ato|b|bio|blog|bmd|cim|cng|cnt|com|coop|ecn|edu|eng|esp|etc|eti|far|flog|fm|fnd|fot|fst|g12|ggf|gov|imb|ind|inf|jor|jus|lel|mat|med|mil|mus|net|nom|not|ntr|odo|org|ppg|pro|psc|psi|qsl|rec|slg|srv|tmp|trd|tur|tv|vet|vlog|wiki|zlg",bs:"com|edu|gov|net|org",bz:"du|et|om|ov|rg",ca:"ab|bc|mb|nb|nf|nl|ns|nt|nu|on|pe|qc|sk|yk",ck:"biz|co|edu|gen|gov|info|net|org",cn:"ac|ah|bj|com|cq|edu|fj|gd|gov|gs|gx|gz|ha|hb|he|hi|hl|hn|jl|js|jx|ln|mil|net|nm|nx|org|qh|sc|sd|sh|sn|sx|tj|tw|xj|xz|yn|zj",co:"com|edu|gov|mil|net|nom|org",cr:"ac|c|co|ed|fi|go|or|sa",cy:"ac|biz|com|ekloges|gov|ltd|name|net|org|parliament|press|pro|tm","do":"art|com|edu|gob|gov|mil|net|org|sld|web",dz:"art|asso|com|edu|gov|net|org|pol",ec:"com|edu|fin|gov|info|med|mil|net|org|pro",eg:"com|edu|eun|gov|mil|name|net|org|sci",er:"com|edu|gov|ind|mil|net|org|rochest|w",es:"com|edu|gob|nom|org",et:"biz|com|edu|gov|info|name|net|org",fj:"ac|biz|com|info|mil|name|net|org|pro",fk:"ac|co|gov|net|nom|org",fr:"asso|com|f|gouv|nom|prd|presse|tm",gg:"co|net|org",gh:"com|edu|gov|mil|org",gn:"ac|com|gov|net|org",gr:"com|edu|gov|mil|net|org",gt:"com|edu|gob|ind|mil|net|org",gu:"com|edu|gov|net|org",hk:"com|edu|gov|idv|net|org",id:"ac|co|go|mil|net|or|sch|web",il:"ac|co|gov|idf|k12|muni|net|org","in":"ac|co|edu|ernet|firm|gen|gov|i|ind|mil|net|nic|org|res",iq:"com|edu|gov|i|mil|net|org",ir:"ac|co|dnssec|gov|i|id|net|org|sch",it:"edu|gov",je:"co|net|org",jo:"com|edu|gov|mil|name|net|org|sch",jp:"ac|ad|co|ed|go|gr|lg|ne|or",ke:"ac|co|go|info|me|mobi|ne|or|sc",kh:"com|edu|gov|mil|net|org|per",ki:"biz|com|de|edu|gov|info|mob|net|org|tel",km:"asso|com|coop|edu|gouv|k|medecin|mil|nom|notaires|pharmaciens|presse|tm|veterinaire",kn:"edu|gov|net|org",kr:"ac|busan|chungbuk|chungnam|co|daegu|daejeon|es|gangwon|go|gwangju|gyeongbuk|gyeonggi|gyeongnam|hs|incheon|jeju|jeonbuk|jeonnam|k|kg|mil|ms|ne|or|pe|re|sc|seoul|ulsan",kw:"com|edu|gov|net|org",ky:"com|edu|gov|net|org",kz:"com|edu|gov|mil|net|org",lb:"com|edu|gov|net|org",lk:"assn|com|edu|gov|grp|hotel|int|ltd|net|ngo|org|sch|soc|web",lr:"com|edu|gov|net|org",lv:"asn|com|conf|edu|gov|id|mil|net|org",ly:"com|edu|gov|id|med|net|org|plc|sch",ma:"ac|co|gov|m|net|org|press",mc:"asso|tm",me:"ac|co|edu|gov|its|net|org|priv",mg:"com|edu|gov|mil|nom|org|prd|tm",mk:"com|edu|gov|inf|name|net|org|pro",ml:"com|edu|gov|net|org|presse",mn:"edu|gov|org",mo:"com|edu|gov|net|org",mt:"com|edu|gov|net|org",mv:"aero|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro",mw:"ac|co|com|coop|edu|gov|int|museum|net|org",mx:"com|edu|gob|net|org",my:"com|edu|gov|mil|name|net|org|sch",nf:"arts|com|firm|info|net|other|per|rec|store|web",ng:"biz|com|edu|gov|mil|mobi|name|net|org|sch",ni:"ac|co|com|edu|gob|mil|net|nom|org",np:"com|edu|gov|mil|net|org",nr:"biz|com|edu|gov|info|net|org",om:"ac|biz|co|com|edu|gov|med|mil|museum|net|org|pro|sch",pe:"com|edu|gob|mil|net|nom|org|sld",ph:"com|edu|gov|i|mil|net|ngo|org",pk:"biz|com|edu|fam|gob|gok|gon|gop|gos|gov|net|org|web",pl:"art|bialystok|biz|com|edu|gda|gdansk|gorzow|gov|info|katowice|krakow|lodz|lublin|mil|net|ngo|olsztyn|org|poznan|pwr|radom|slupsk|szczecin|torun|warszawa|waw|wroc|wroclaw|zgora",pr:"ac|biz|com|edu|est|gov|info|isla|name|net|org|pro|prof",ps:"com|edu|gov|net|org|plo|sec",pw:"belau|co|ed|go|ne|or",ro:"arts|com|firm|info|nom|nt|org|rec|store|tm|www",rs:"ac|co|edu|gov|in|org",sb:"com|edu|gov|net|org",sc:"com|edu|gov|net|org",sh:"co|com|edu|gov|net|nom|org",sl:"com|edu|gov|net|org",st:"co|com|consulado|edu|embaixada|gov|mil|net|org|principe|saotome|store",sv:"com|edu|gob|org|red",sz:"ac|co|org",tr:"av|bbs|bel|biz|com|dr|edu|gen|gov|info|k12|name|net|org|pol|tel|tsk|tv|web",tt:"aero|biz|cat|co|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel",tw:"club|com|ebiz|edu|game|gov|idv|mil|net|org",mu:"ac|co|com|gov|net|or|org",mz:"ac|co|edu|gov|org",na:"co|com",nz:"ac|co|cri|geek|gen|govt|health|iwi|maori|mil|net|org|parliament|school",pa:"abo|ac|com|edu|gob|ing|med|net|nom|org|sld",pt:"com|edu|gov|int|net|nome|org|publ",py:"com|edu|gov|mil|net|org",qa:"com|edu|gov|mil|net|org",re:"asso|com|nom",ru:"ac|adygeya|altai|amur|arkhangelsk|astrakhan|bashkiria|belgorod|bir|bryansk|buryatia|cbg|chel|chelyabinsk|chita|chukotka|chuvashia|com|dagestan|e-burg|edu|gov|grozny|int|irkutsk|ivanovo|izhevsk|jar|joshkar-ola|kalmykia|kaluga|kamchatka|karelia|kazan|kchr|kemerovo|khabarovsk|khakassia|khv|kirov|koenig|komi|kostroma|kranoyarsk|kuban|kurgan|kursk|lipetsk|magadan|mari|mari-el|marine|mil|mordovia|mosreg|msk|murmansk|nalchik|net|nnov|nov|novosibirsk|nsk|omsk|orenburg|org|oryol|penza|perm|pp|pskov|ptz|rnd|ryazan|sakhalin|samara|saratov|simbirsk|smolensk|spb|stavropol|stv|surgut|tambov|tatarstan|tom|tomsk|tsaritsyn|tsk|tula|tuva|tver|tyumen|udm|udmurtia|ulan-ude|vladikavkaz|vladimir|vladivostok|volgograd|vologda|voronezh|vrn|vyatka|yakutia|yamal|yekaterinburg|yuzhno-sakhalinsk",rw:"ac|co|com|edu|gouv|gov|int|mil|net",sa:"com|edu|gov|med|net|org|pub|sch",sd:"com|edu|gov|info|med|net|org|tv",se:"a|ac|b|bd|c|d|e|f|g|h|i|k|l|m|n|o|org|p|parti|pp|press|r|s|t|tm|u|w|x|y|z",sg:"com|edu|gov|idn|net|org|per",sn:"art|com|edu|gouv|org|perso|univ",sy:"com|edu|gov|mil|net|news|org",th:"ac|co|go|in|mi|net|or",tj:"ac|biz|co|com|edu|go|gov|info|int|mil|name|net|nic|org|test|web",tn:"agrinet|com|defense|edunet|ens|fin|gov|ind|info|intl|mincom|nat|net|org|perso|rnrt|rns|rnu|tourism",tz:"ac|co|go|ne|or",ua:"biz|cherkassy|chernigov|chernovtsy|ck|cn|co|com|crimea|cv|dn|dnepropetrovsk|donetsk|dp|edu|gov|if|in|ivano-frankivsk|kh|kharkov|kherson|khmelnitskiy|kiev|kirovograd|km|kr|ks|kv|lg|lugansk|lutsk|lviv|me|mk|net|nikolaev|od|odessa|org|pl|poltava|pp|rovno|rv|sebastopol|sumy|te|ternopil|uzhgorod|vinnica|vn|zaporizhzhe|zhitomir|zp|zt",ug:"ac|co|go|ne|or|org|sc",uk:"ac|bl|british-library|co|cym|gov|govt|icnet|jet|lea|ltd|me|mil|mod|national-library-scotland|nel|net|nhs|nic|nls|org|orgn|parliament|plc|police|sch|scot|soc",us:"dni|fed|isa|kids|nsn",uy:"com|edu|gub|mil|net|org",ve:"co|com|edu|gob|info|mil|net|org|web",vi:"co|com|k12|net|org",vn:"ac|biz|com|edu|gov|health|info|int|name|net|org|pro",ye:"co|com|gov|ltd|me|net|org|plc",yu:"ac|co|edu|gov|org",za:"ac|agric|alt|bourse|city|co|cybernet|db|edu|gov|grondar|iaccess|imt|inca|landesign|law|mil|net|ngo|nis|nom|olivetti|org|pix|school|tm|web",zm:"ac|co|com|edu|gov|net|org|sch"},has_expression:null,is_expression:null,has:function(a){return!!a.match(d.has_expression)},is:function(a){return!!a.match(d.is_expression)},get:function(a){var b=a.match(d.has_expression);return b&&b[1]||null},noConflict:function(){return a.SecondLevelDomains===this&&(a.SecondLevelDomains=b),this},init:function(){var a="";for(var b in d.list)if(c.call(d.list,b)){var e="("+d.list[b]+")."+b;a+="|("+e+")"}d.has_expression=new RegExp("\\.("+a.substr(1)+")$","i"),d.is_expression=new RegExp("^("+a.substr(1)+")$","i")}};return d.init(),d}),function(a,b){"object"==typeof exports?module.exports=b(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"==typeof define&&define.amd?define("uri/URI",["./punycode","./IPv6","./SecondLevelDomains"],b):a.URI=b(a.punycode,a.IPv6,a.SecondLevelDomains,a)}(this,function(a,b,c,d){function e(a,b){return this instanceof e?(void 0===a&&(a="undefined"!=typeof location?location.href+"":""),this.href(a),void 0!==b?this.absoluteTo(b):this):new e(a,b)}function f(a){return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function g(a){return void 0===a?"Undefined":String(Object.prototype.toString.call(a)).slice(8,-1)}function h(a){return"Array"===g(a)}function i(a,b){var c,d,e={};if(h(b))for(c=0,d=b.length;d>c;c++)e[b[c]]=!0;else e[b]=!0;for(c=0,d=a.length;d>c;c++)void 0!==e[a[c]]&&(a.splice(c,1),d--,c--);return a}function j(a,b){var c,d;if(h(b)){for(c=0,d=b.length;d>c;c++)if(!j(a,b[c]))return!1;return!0}var e=g(b);for(c=0,d=a.length;d>c;c++)if("RegExp"===e){if("string"==typeof a[c]&&a[c].match(b))return!0}else if(a[c]===b)return!0;return!1}function k(a,b){if(!h(a)||!h(b))return!1;if(a.length!==b.length)return!1;a.sort(),b.sort();for(var c=0,d=a.length;d>c;c++)if(a[c]!==b[c])return!1;return!0}function l(a){return escape(a)}function m(a){return encodeURIComponent(a).replace(/[!'()*]/g,l).replace(/\*/g,"%2A")}var n=d&&d.URI;e.version="1.12.1";var o=e.prototype,p=Object.prototype.hasOwnProperty;e._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:e.duplicateQueryParameters,escapeQuerySpace:e.escapeQuerySpace}},e.duplicateQueryParameters=!1,e.escapeQuerySpace=!0,e.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,e.idn_expression=/[^a-z0-9\.-]/i,e.punycode_expression=/(xn--)/i,e.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,e.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,e.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,e.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/},e.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},e.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,e.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src"},e.getDomAttribute=function(a){if(!a||!a.nodeName)return void 0;var b=a.nodeName.toLowerCase();return"input"===b&&"image"!==a.type?void 0:e.domAttributes[b]},e.encode=m,e.decode=decodeURIComponent,e.iso8859=function(){e.encode=escape,e.decode=unescape},e.unicode=function(){e.encode=m,e.decode=decodeURIComponent},e.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}}},e.encodeQuery=function(a,b){var c=e.encode(a+"");return void 0===b&&(b=e.escapeQuerySpace),b?c.replace(/%20/g,"+"):c},e.decodeQuery=function(a,b){a+="",void 0===b&&(b=e.escapeQuerySpace);try{return e.decode(b?a.replace(/\+/g,"%20"):a)}catch(c){return a}},e.recodePath=function(a){for(var b=(a+"").split("/"),c=0,d=b.length;d>c;c++)b[c]=e.encodePathSegment(e.decode(b[c]));return b.join("/")},e.decodePath=function(a){for(var b=(a+"").split("/"),c=0,d=b.length;d>c;c++)b[c]=e.decodePathSegment(b[c]);return b.join("/")};var q,r={encode:"encode",decode:"decode"},s=function(a,b){return function(c){return e[b](c+"").replace(e.characters[a][b].expression,function(c){return e.characters[a][b].map[c]})}};for(q in r)e[q+"PathSegment"]=s("pathname",r[q]);e.encodeReserved=s("reserved","encode"),e.parse=function(a,b){var c;return b||(b={}),c=a.indexOf("#"),c>-1&&(b.fragment=a.substring(c+1)||null,a=a.substring(0,c)),c=a.indexOf("?"),c>-1&&(b.query=a.substring(c+1)||null,a=a.substring(0,c)),"//"===a.substring(0,2)?(b.protocol=null,a=a.substring(2),a=e.parseAuthority(a,b)):(c=a.indexOf(":"),c>-1&&(b.protocol=a.substring(0,c)||null,b.protocol&&!b.protocol.match(e.protocol_expression)?b.protocol=void 0:"file"===b.protocol?a=a.substring(c+3):"//"===a.substring(c+1,c+3)?(a=a.substring(c+3),a=e.parseAuthority(a,b)):(a=a.substring(c+1),b.urn=!0))),b.path=a,b},e.parseHost=function(a,b){var c,d,e=a.indexOf("/");return-1===e&&(e=a.length),"["===a.charAt(0)?(c=a.indexOf("]"),b.hostname=a.substring(1,c)||null,b.port=a.substring(c+2,e)||null):a.indexOf(":")!==a.lastIndexOf(":")?(b.hostname=a.substring(0,e)||null,b.port=null):(d=a.substring(0,e).split(":"),b.hostname=d[0]||null,b.port=d[1]||null),b.hostname&&"/"!==a.substring(e).charAt(0)&&(e++,a="/"+a),a.substring(e)||"/"},e.parseAuthority=function(a,b){return a=e.parseUserinfo(a,b),e.parseHost(a,b)},e.parseUserinfo=function(a,b){var c,d=a.indexOf("/"),f=d>-1?a.lastIndexOf("@",d):a.indexOf("@");return f>-1&&(-1===d||d>f)?(c=a.substring(0,f).split(":"),b.username=c[0]?e.decode(c[0]):null,c.shift(),b.password=c[0]?e.decode(c.join(":")):null,a=a.substring(f+1)):(b.username=null,b.password=null),a},e.parseQuery=function(a,b){if(!a)return{};if(a=a.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!a)return{};for(var c,d,f,g={},h=a.split("&"),i=h.length,j=0;i>j;j++)c=h[j].split("="),d=e.decodeQuery(c.shift(),b),f=c.length?e.decodeQuery(c.join("="),b):null,g[d]?("string"==typeof g[d]&&(g[d]=[g[d]]),g[d].push(f)):g[d]=f;return g},e.build=function(a){var b="";return a.protocol&&(b+=a.protocol+":"),a.urn||!b&&!a.hostname||(b+="//"),b+=e.buildAuthority(a)||"","string"==typeof a.path&&("/"!==a.path.charAt(0)&&"string"==typeof a.hostname&&(b+="/"),b+=a.path),"string"==typeof a.query&&a.query&&(b+="?"+a.query),"string"==typeof a.fragment&&a.fragment&&(b+="#"+a.fragment),b},e.buildHost=function(a){var b="";return a.hostname?(e.ip6_expression.test(a.hostname)?b+=a.port?"["+a.hostname+"]:"+a.port:a.hostname:(b+=a.hostname,a.port&&(b+=":"+a.port)),b):""},e.buildAuthority=function(a){return e.buildUserinfo(a)+e.buildHost(a)},e.buildUserinfo=function(a){var b="";return a.username&&(b+=e.encode(a.username),a.password&&(b+=":"+e.encode(a.password)),b+="@"),b},e.buildQuery=function(a,b,c){var d,f,g,i,j="";for(f in a)if(p.call(a,f)&&f)if(h(a[f]))for(d={},g=0,i=a[f].length;i>g;g++)void 0!==a[f][g]&&void 0===d[a[f][g]+""]&&(j+="&"+e.buildQueryParameter(f,a[f][g],c),b!==!0&&(d[a[f][g]+""]=!0));else void 0!==a[f]&&(j+="&"+e.buildQueryParameter(f,a[f],c));return j.substring(1)},e.buildQueryParameter=function(a,b,c){return e.encodeQuery(a,c)+(null!==b?"="+e.encodeQuery(b,c):"")},e.addQuery=function(a,b,c){if("object"==typeof b)for(var d in b)p.call(b,d)&&e.addQuery(a,d,b[d]);else{if("string"!=typeof b)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===a[b])return void(a[b]=c);"string"==typeof a[b]&&(a[b]=[a[b]]),h(c)||(c=[c]),a[b]=a[b].concat(c)}},e.removeQuery=function(a,b,c){var d,f,g;if(h(b))for(d=0,f=b.length;f>d;d++)a[b[d]]=void 0;else if("object"==typeof b)for(g in b)p.call(b,g)&&e.removeQuery(a,g,b[g]);else{if("string"!=typeof b)throw new TypeError("URI.addQuery() accepts an object, string as the first parameter");void 0!==c?a[b]===c?a[b]=void 0:h(a[b])&&(a[b]=i(a[b],c)):a[b]=void 0}},e.hasQuery=function(a,b,c,d){if("object"==typeof b){for(var f in b)if(p.call(b,f)&&!e.hasQuery(a,f,b[f]))return!1;return!0}if("string"!=typeof b)throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter");switch(g(c)){case"Undefined":return b in a;case"Boolean":var i=Boolean(h(a[b])?a[b].length:a[b]);return c===i;case"Function":return!!c(a[b],b,a);case"Array":if(!h(a[b]))return!1;var l=d?j:k;return l(a[b],c);case"RegExp":return h(a[b])?d?j(a[b],c):!1:Boolean(a[b]&&a[b].match(c));case"Number":c=String(c);case"String":return h(a[b])?d?j(a[b],c):!1:a[b]===c;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},e.commonPath=function(a,b){var c,d=Math.min(a.length,b.length);for(c=0;d>c;c++)if(a.charAt(c)!==b.charAt(c)){c--;break}return 1>c?a.charAt(0)===b.charAt(0)&&"/"===a.charAt(0)?"/":"":(("/"!==a.charAt(c)||"/"!==b.charAt(c))&&(c=a.substring(0,c).lastIndexOf("/")),a.substring(0,c+1))},e.withinString=function(a,b,c){c||(c={});var d=c.start||e.findUri.start,f=c.end||e.findUri.end,g=c.trim||e.findUri.trim,h=/[a-z0-9-]=["']?$/i;for(d.lastIndex=0;;){var i=d.exec(a);if(!i)break;var j=i.index;if(c.ignoreHtml){var k=a.slice(Math.max(j-3,0),j);if(k&&h.test(k))continue}var l=j+a.slice(j).search(f),m=a.slice(j,l).replace(g,"");if(!c.ignore||!c.ignore.test(m)){l=j+m.length;var n=b(m,j,l,a);a=a.slice(0,j)+n+a.slice(l),d.lastIndex=j+n.length}}return d.lastIndex=0,a},e.ensureValidHostname=function(b){if(b.match(e.invalid_hostname_characters)){if(!a)throw new TypeError("Hostname '"+b+"' contains characters other than [A-Z0-9.-] and Punycode.js is not available");if(a.toASCII(b).match(e.invalid_hostname_characters))throw new TypeError("Hostname '"+b+"' contains characters other than [A-Z0-9.-]")}},e.noConflict=function(a){if(a){var c={URI:this.noConflict()};return URITemplate&&"function"==typeof URITemplate.noConflict&&(c.URITemplate=URITemplate.noConflict()),b&&"function"==typeof b.noConflict&&(c.IPv6=b.noConflict()),SecondLevelDomains&&"function"==typeof SecondLevelDomains.noConflict&&(c.SecondLevelDomains=SecondLevelDomains.noConflict()),c}return d.URI===this&&(d.URI=n),this},o.build=function(a){return a===!0?this._deferred_build=!0:(void 0===a||this._deferred_build)&&(this._string=e.build(this._parts),this._deferred_build=!1),this},o.clone=function(){return new e(this)},o.valueOf=o.toString=function(){return this.build(!1)._string},r={protocol:"protocol",username:"username",password:"password",hostname:"hostname",port:"port"},s=function(a){return function(b,c){return void 0===b?this._parts[a]||"":(this._parts[a]=b||null,this.build(!c),this)}};for(q in r)o[q]=s(r[q]);r={query:"?",fragment:"#"},s=function(a,b){return function(c,d){return void 0===c?this._parts[a]||"":(null!==c&&(c+="",c.charAt(0)===b&&(c=c.substring(1))),this._parts[a]=c,this.build(!d),this)}};for(q in r)o[q]=s(q,r[q]);r={search:["?","query"],hash:["#","fragment"]},s=function(a,b){return function(c,d){var e=this[a](c,d);return"string"==typeof e&&e.length?b+e:e}};for(q in r)o[q]=s(r[q][1],r[q][0]);o.pathname=function(a,b){if(void 0===a||a===!0){var c=this._parts.path||(this._parts.hostname?"/":"");return a?e.decodePath(c):c}return this._parts.path=a?e.recodePath(a):"/",this.build(!b),this},o.path=o.pathname,o.href=function(a,b){var c;if(void 0===a)return this.toString();this._string="",this._parts=e._parts();var d=a instanceof e,f="object"==typeof a&&(a.hostname||a.path||a.pathname);if(a.nodeName){var g=e.getDomAttribute(a);a=a[g]||"",f=!1}if(!d&&f&&void 0!==a.pathname&&(a=a.toString()),"string"==typeof a)this._parts=e.parse(a,this._parts);else{if(!d&&!f)throw new TypeError("invalid input");var h=d?a._parts:a;for(c in h)p.call(this._parts,c)&&(this._parts[c]=h[c])}return this.build(!b),this},o.is=function(a){var b=!1,d=!1,f=!1,g=!1,h=!1,i=!1,j=!1,k=!this._parts.urn;switch(this._parts.hostname&&(k=!1,d=e.ip4_expression.test(this._parts.hostname),f=e.ip6_expression.test(this._parts.hostname),b=d||f,g=!b,h=g&&c&&c.has(this._parts.hostname),i=g&&e.idn_expression.test(this._parts.hostname),j=g&&e.punycode_expression.test(this._parts.hostname)),a.toLowerCase()){case"relative":return k;case"absolute":return!k;case"domain":case"name":return g;case"sld":return h;case"ip":return b;case"ip4":case"ipv4":case"inet4":return d;case"ip6":case"ipv6":case"inet6":return f;case"idn":return i;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return j}return null};var t=o.protocol,u=o.port,v=o.hostname;o.protocol=function(a,b){if(void 0!==a&&a&&(a=a.replace(/:(\/\/)?$/,""),!a.match(e.protocol_expression)))throw new TypeError("Protocol '"+a+"' contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return t.call(this,a,b)},o.scheme=o.protocol,o.port=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a&&(0===a&&(a=null),a&&(a+="",":"===a.charAt(0)&&(a=a.substring(1)),a.match(/[^0-9]/))))throw new TypeError("Port '"+a+"' contains characters other than [0-9]");
return u.call(this,a,b)},o.hostname=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a){var c={};e.parseHost(a,c),a=c.hostname}return v.call(this,a,b)},o.host=function(a,b){return this._parts.urn?void 0===a?"":this:void 0===a?this._parts.hostname?e.buildHost(this._parts):"":(e.parseHost(a,this._parts),this.build(!b),this)},o.authority=function(a,b){return this._parts.urn?void 0===a?"":this:void 0===a?this._parts.hostname?e.buildAuthority(this._parts):"":(e.parseAuthority(a,this._parts),this.build(!b),this)},o.userinfo=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){if(!this._parts.username)return"";var c=e.buildUserinfo(this._parts);return c.substring(0,c.length-1)}return"@"!==a[a.length-1]&&(a+="@"),e.parseUserinfo(a,this._parts),this.build(!b),this},o.resource=function(a,b){var c;return void 0===a?this.path()+this.search()+this.hash():(c=e.parse(a),this._parts.path=c.path,this._parts.query=c.query,this._parts.fragment=c.fragment,this.build(!b),this)},o.subdomain=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,c)||""}var d=this._parts.hostname.length-this.domain().length,g=this._parts.hostname.substring(0,d),h=new RegExp("^"+f(g));return a&&"."!==a.charAt(a.length-1)&&(a+="."),a&&e.ensureValidHostname(a),this._parts.hostname=this._parts.hostname.replace(h,a),this.build(!b),this},o.domain=function(a,b){if(this._parts.urn)return void 0===a?"":this;if("boolean"==typeof a&&(b=a,a=void 0),void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.match(/\./g);if(c&&c.length<2)return this._parts.hostname;var d=this._parts.hostname.length-this.tld(b).length-1;return d=this._parts.hostname.lastIndexOf(".",d-1)+1,this._parts.hostname.substring(d)||""}if(!a)throw new TypeError("cannot set domain empty");if(e.ensureValidHostname(a),!this._parts.hostname||this.is("IP"))this._parts.hostname=a;else{var g=new RegExp(f(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(g,a)}return this.build(!b),this},o.tld=function(a,b){if(this._parts.urn)return void 0===a?"":this;if("boolean"==typeof a&&(b=a,a=void 0),void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var d=this._parts.hostname.lastIndexOf("."),e=this._parts.hostname.substring(d+1);return b!==!0&&c&&c.list[e.toLowerCase()]?c.get(this._parts.hostname)||e:e}var g;if(!a)throw new TypeError("cannot set TLD empty");if(a.match(/[^a-zA-Z0-9-]/)){if(!c||!c.is(a))throw new TypeError("TLD '"+a+"' contains characters other than [A-Z0-9]");g=new RegExp(f(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(g,a)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");g=new RegExp(f(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(g,a)}return this.build(!b),this},o.directory=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||a===!0){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var c=this._parts.path.length-this.filename().length-1,d=this._parts.path.substring(0,c)||(this._parts.hostname?"/":"");return a?e.decodePath(d):d}var g=this._parts.path.length-this.filename().length,h=this._parts.path.substring(0,g),i=new RegExp("^"+f(h));return this.is("relative")||(a||(a="/"),"/"!==a.charAt(0)&&(a="/"+a)),a&&"/"!==a.charAt(a.length-1)&&(a+="/"),a=e.recodePath(a),this._parts.path=this._parts.path.replace(i,a),this.build(!b),this},o.filename=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||a===!0){if(!this._parts.path||"/"===this._parts.path)return"";var c=this._parts.path.lastIndexOf("/"),d=this._parts.path.substring(c+1);return a?e.decodePathSegment(d):d}var g=!1;"/"===a.charAt(0)&&(a=a.substring(1)),a.match(/\.?\//)&&(g=!0);var h=new RegExp(f(this.filename())+"$");return a=e.recodePath(a),this._parts.path=this._parts.path.replace(h,a),g?this.normalizePath(b):this.build(!b),this},o.suffix=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||a===!0){if(!this._parts.path||"/"===this._parts.path)return"";var c,d,g=this.filename(),h=g.lastIndexOf(".");return-1===h?"":(c=g.substring(h+1),d=/^[a-z0-9%]+$/i.test(c)?c:"",a?e.decodePathSegment(d):d)}"."===a.charAt(0)&&(a=a.substring(1));var i,j=this.suffix();if(j)i=new RegExp(a?f(j)+"$":f("."+j)+"$");else{if(!a)return this;this._parts.path+="."+e.recodePath(a)}return i&&(a=e.recodePath(a),this._parts.path=this._parts.path.replace(i,a)),this.build(!b),this},o.segment=function(a,b,c){var d=this._parts.urn?":":"/",e=this.path(),f="/"===e.substring(0,1),g=e.split(d);if(void 0!==a&&"number"!=typeof a&&(c=b,b=a,a=void 0),void 0!==a&&"number"!=typeof a)throw new Error("Bad segment '"+a+"', must be 0-based integer");if(f&&g.shift(),0>a&&(a=Math.max(g.length+a,0)),void 0===b)return void 0===a?g:g[a];if(null===a||void 0===g[a])if(h(b)){g=[];for(var i=0,j=b.length;j>i;i++)(b[i].length||g.length&&g[g.length-1].length)&&(g.length&&!g[g.length-1].length&&g.pop(),g.push(b[i]))}else(b||"string"==typeof b)&&(""===g[g.length-1]?g[g.length-1]=b:g.push(b));else b||"string"==typeof b&&b.length?g[a]=b:g.splice(a,1);return f&&g.unshift(""),this.path(g.join(d),c)},o.segmentCoded=function(a,b,c){var d,f,g;if("number"!=typeof a&&(c=b,b=a,a=void 0),void 0===b){if(d=this.segment(a,b,c),h(d))for(f=0,g=d.length;g>f;f++)d[f]=e.decode(d[f]);else d=void 0!==d?e.decode(d):void 0;return d}if(h(b))for(f=0,g=b.length;g>f;f++)b[f]=e.decode(b[f]);else b="string"==typeof b?e.encode(b):b;return this.segment(a,b,c)};var w=o.query;return o.query=function(a,b){if(a===!0)return e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof a){var c=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace),d=a.call(this,c);return this._parts.query=e.buildQuery(d||c,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!b),this}return void 0!==a&&"string"!=typeof a?(this._parts.query=e.buildQuery(a,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!b),this):w.call(this,a,b)},o.setQuery=function(a,b,c){var d=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("object"==typeof a)for(var f in a)p.call(a,f)&&(d[f]=a[f]);else{if("string"!=typeof a)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");d[a]=void 0!==b?b:null}return this._parts.query=e.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(c=b),this.build(!c),this},o.addQuery=function(a,b,c){var d=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return e.addQuery(d,a,void 0===b?null:b),this._parts.query=e.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(c=b),this.build(!c),this},o.removeQuery=function(a,b,c){var d=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return e.removeQuery(d,a,b),this._parts.query=e.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(c=b),this.build(!c),this},o.hasQuery=function(a,b,c){var d=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return e.hasQuery(d,a,b,c)},o.setSearch=o.setQuery,o.addSearch=o.addQuery,o.removeSearch=o.removeQuery,o.hasSearch=o.hasQuery,o.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},o.normalizeProtocol=function(a){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!a)),this},o.normalizeHostname=function(c){return this._parts.hostname&&(this.is("IDN")&&a?this._parts.hostname=a.toASCII(this._parts.hostname):this.is("IPv6")&&b&&(this._parts.hostname=b.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!c)),this},o.normalizePort=function(a){return"string"==typeof this._parts.protocol&&this._parts.port===e.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!a)),this},o.normalizePath=function(a){if(this._parts.urn)return this;if(!this._parts.path||"/"===this._parts.path)return this;var b,c,d,f=this._parts.path,g="";for("/"!==f.charAt(0)&&(b=!0,f="/"+f),f=f.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),b&&(g=f.substring(1).match(/^(\.\.\/)+/)||"",g&&(g=g[0]));;){if(c=f.indexOf("/.."),-1===c)break;0!==c?(d=f.substring(0,c).lastIndexOf("/"),-1===d&&(d=c),f=f.substring(0,d)+f.substring(c+3)):f=f.substring(3)}return b&&this.is("relative")&&(f=g+f.substring(1)),f=e.recodePath(f),this._parts.path=f,this.build(!a),this},o.normalizePathname=o.normalizePath,o.normalizeQuery=function(a){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(e.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!a)),this},o.normalizeFragment=function(a){return this._parts.fragment||(this._parts.fragment=null,this.build(!a)),this},o.normalizeSearch=o.normalizeQuery,o.normalizeHash=o.normalizeFragment,o.iso8859=function(){var a=e.encode,b=e.decode;return e.encode=escape,e.decode=decodeURIComponent,this.normalize(),e.encode=a,e.decode=b,this},o.unicode=function(){var a=e.encode,b=e.decode;return e.encode=m,e.decode=unescape,this.normalize(),e.encode=a,e.decode=b,this},o.readable=function(){var b=this.clone();b.username("").password("").normalize();var c="";if(b._parts.protocol&&(c+=b._parts.protocol+"://"),b._parts.hostname&&(b.is("punycode")&&a?(c+=a.toUnicode(b._parts.hostname),b._parts.port&&(c+=":"+b._parts.port)):c+=b.host()),b._parts.hostname&&b._parts.path&&"/"!==b._parts.path.charAt(0)&&(c+="/"),c+=b.path(!0),b._parts.query){for(var d="",f=0,g=b._parts.query.split("&"),h=g.length;h>f;f++){var i=(g[f]||"").split("=");d+="&"+e.decodeQuery(i[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==i[1]&&(d+="="+e.decodeQuery(i[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}c+="?"+d.substring(1)}return c+=e.decodeQuery(b.hash(),!0)},o.absoluteTo=function(a){var b,c,d,f=this.clone(),g=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(a instanceof e||(a=new e(a)),f._parts.protocol||(f._parts.protocol=a._parts.protocol),this._parts.hostname)return f;for(c=0;d=g[c];c++)f._parts[d]=a._parts[d];return f._parts.path?".."===f._parts.path.substring(-2)&&(f._parts.path+="/"):(f._parts.path=a._parts.path,f._parts.query||(f._parts.query=a._parts.query)),"/"!==f.path().charAt(0)&&(b=a.directory(),f._parts.path=(b?b+"/":"")+f._parts.path,f.normalizePath()),f.build(),f},o.relativeTo=function(a){var b,c,d,f,g,h=this.clone().normalize();if(h._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(a=new e(a).normalize(),b=h._parts,c=a._parts,f=h.path(),g=a.path(),"/"!==f.charAt(0))throw new Error("URI is already relative");if("/"!==g.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(b.protocol===c.protocol&&(b.protocol=null),b.username!==c.username||b.password!==c.password)return h.build();if(null!==b.protocol||null!==b.username||null!==b.password)return h.build();if(b.hostname!==c.hostname||b.port!==c.port)return h.build();if(b.hostname=null,b.port=null,f===g)return b.path="",h.build();if(d=e.commonPath(h.path(),a.path()),!d)return h.build();var i=c.path.substring(d.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return b.path=i+b.path.substring(d.length),h.build()},o.equals=function(a){var b,c,d,f=this.clone(),g=new e(a),i={},j={},l={};if(f.normalize(),g.normalize(),f.toString()===g.toString())return!0;if(b=f.query(),c=g.query(),f.query(""),g.query(""),f.toString()!==g.toString())return!1;if(b.length!==c.length)return!1;i=e.parseQuery(b,this._parts.escapeQuerySpace),j=e.parseQuery(c,this._parts.escapeQuerySpace);for(d in i)if(p.call(i,d)){if(h(i[d])){if(!k(i[d],j[d]))return!1}else if(i[d]!==j[d])return!1;l[d]=!0}for(d in j)if(p.call(j,d)&&!l[d])return!1;return!0},o.duplicateQueryParameters=function(a){return this._parts.duplicateQueryParameters=!!a,this},o.escapeQuerySpace=function(a){return this._parts.escapeQuerySpace=!!a,this},e}),define("src/util/pouchtovar",["pouchdb","uri/URI","src/util/debug"],function(a,b,c){function d(a){this.initProperties();for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);this.addChangeListener()}function e(a){this.type="array",this.value=DataObject.check(a||[]),Object.defineProperty(this,"__pouch",m);for(var b=0,c=this.value.length;c>b;b++)this.value[b]=new d(this.value[b]),this.value[b].__parent=this}function f(a){this.url=a,this.urlH=a.replace(/\/\/[^\/]*@/,"//***@"),this.froms={},this.tos={},this.run()}function g(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open("GET",a),d.onload=function(){200===d.status?b():c(Error(d.status+" : "+d.statusText))},d.onerror=function(){c(Error("Network error"))},d.send()})}function h(a){var c=new b(a);c.normalize();for(var d=c.segment();d.length>0;){var e=d.pop();if(e){c.segment(d);break}}return c.toString()}function i(a,b,c,d){var e=h(c);o[e]||(o[e]=new f(e));var g=o[e];g.add(a,c,b,d)}function j(a,b){for(var c=-1,d=0,e=a.length;e>d;d++)if(a[d]._id===b){c=d;break}return c}function k(b){this.name=b,this.pouchdb=new a(b),this.singleDocs={};var c=this;this.pouchdb.changes({include_docs:!0,live:!0,since:"now"}).on("create",function(a){if(c.allDocs){var b=new d(a.doc);b.setPouch(c),c.allDocs.value.push(b),c.allDocs.triggerChange("internal_pouch_change")}}).on("update",function(a){var b=a.id;if(c.singleDocs[b]&&c.singleDocs[b]._rev!==a.doc._rev&&c.singleDocs[b].mergeWith(a.doc,"internal_pouch_change"),c.allDocs){var d=c.allDocs.value,e=j(d,b);e>-1&&d[e]._rev!==a.doc._rev&&d[e].mergeWith(a.doc,"internal_pouch_change")}}).on("delete",function(a){var b=a.id;if(c.singleDocs[b]&&(c.singleDocs[b].setPouch(null),delete c.singleDocs[b]),c.allDocs){var d=c.allDocs.value,e=j(d,b);e>-1&&(d[e].setPouch(null),d.splice(e,1),c.allDocs.triggerChange("internal_pouch_change"))}})}var l={},m={writable:!0,enumerable:!1};d.prototype=Object.create(DataObject.prototype,{constructor:{value:d},initProperties:{value:function(){Object.defineProperties(this,{__pouch:m,__nane:m,__parent:m,_id:m,_rev:m})}},setPouch:{value:function(a){this.__pouch=a}},getPouch:{value:function(){return this.__pouch}},exportForPouch:{value:function(){var a=new DataObject;for(var b in this)"function "!=typeof this[b]&&0!==b.indexOf("_")&&(a[b]=this[b]);return a.resurrect()}},addChangeListener:{value:function(){function a(f){if(!d||f){d=!0;var g=b.shift();e.getPouch().pouchdb.put(g,e._id,e._rev,function(f,g){return f?c.error("Error while writing PouchObject",f):(e._rev=g.rev,void(b.length?a(!0):d=!1))})}}if(!this.hasChangeListener){Object.defineProperty(this,"hasChangeListener",{value:!0});var b=[],d=!1,e=this;this.onChange(function(){var c=e.exportForPouch();b.push(c),a()},"internal_pouch_change")}}}}),d.from=function(a,b){return a instanceof d||(a.__proto__=d.prototype,a.initProperties(),a.addChangeListener()),a.setPouch(b),a},e.prototype=Object.create(DataObject.prototype,{constructor:{value:e},setPouch:{value:function(a){this.__pouch=a;for(var b=0,c=this.value.length;c>b;b++)this.value[b].__pouch=a}},getPouch:{value:function(){return this.__pouch}},push:{value:function(){var a;if(!(a=this.getPouch()))return void c.error("No Pouch manager has been defined for this array. Aborting push procedure.");Array.prototype.push.apply(this.value,arguments);for(var b=arguments.length,e=Array(b),f=Array(b),g=0;b>g;g++){var h=d.from(arguments[g],a,!0),i=h.exportForPouch();h._id&&(i._id=h._id),e[g]=i,f[g]=h}a.pouchdb.bulkDocs({docs:e}).then(function(a){for(var c=0;b>c;c++)f[c]._rev=a[c].rev},function(a){c.error("An error occured while pushing into PouchArray.",a)}),this.triggerChange("internal_pouch_change")}},splice:{value:function(){var a;if(!(a=this.getPouch()))return void c.error("No Pouch manager has been defined for this array. Aborting splice procedure.");for(var b=Array.prototype.splice.apply(this.value,arguments),d=0,e=b.length;e>d;d++)a.pouchdb.remove(b[d]);return this.triggerChange("internal_pouch_change"),b}},indexOf:{value:function(){return Array.prototype.indexOf.apply(this.value,arguments)}}});var n=function(){var a={};return{get:function(b){return a[b]||(a[b]=new k(b)),a[b]}}}(),o={};f.prototype.add=function(a,b,d,e){function f(b){return b.ok?a?c.debug("Replication from couchDB "+i+" to localDB "+h+" finished.",b):c.debug("Replication from localDB "+h+" to couchDB "+i+" finished.",b):a?c.warn("Replication from couchDB "+i+" to localDB "+h+" failed.",b):c.warn("Replication from localDB "+h+" to couchDB "+i+" failed.",b)}e=!!e;var g,h=d.name,i=b.replace(/\/\/[^\/]*@/,"//***@");if(a){if(this.froms[h])return;g=function(){return c.debug("Started replication from couchDB "+i+" to localDB "+h+"."),d.pouchdb.replicate.from(b,{live:e}).on("complete",f)},this.froms[h]=g}else{if(this.tos[h])return;g=function(){return c.debug("Started replication from localDB "+h+" to couchDB "+i+"."),d.pouchdb.replicate.to(b,{live:e}).on("complete",f)},this.tos[h]=g}this.online&&this.running.push(g())},f.prototype.run=function(){if(!this.isRunning){this.isRunning=!0,this.online=!1,this.running=[];var a=this,b=function(){var b;g(a.url).then(function(){if(c.trace(a.urlH+" is responding."),!a.online){c.info("Start all replications");for(b in a.froms)a.running.push(a.froms[b]());for(b in a.tos)a.running.push(a.tos[b]());a.online=!0}},function(b){if(c.trace(a.urlH+" is not responding.",b),a.online){for(c.warn("Stop all replications");a.running.length>0;)a.running.pop().cancel();a.online=!1}})};b(),this.interval=window.setInterval(b,6e4)}},k.prototype.sync=function(a,b,c){i(a,this,b,c)},k.prototype.getDoc=function(a,b){if(this.singleDocs[a])return Promise.resolve(this.singleDocs[a]);b=b||{};var e=this;return new Promise(function(f){var g;e.pouchdb.get(a,b).then(function(b){g=new d(b,!0),g.setPouch(e),e.singleDocs[a]=g,f(g)},function(b){c.info("Doc "+a+" does not exist, creating new doc.",b),g=new d({_id:a}),g.setPouch(e),e.singleDocs[a]=g,f(g)})})},k.prototype.getDocs=function(a){if(this.allDocs)return Promise.resolve(this.allDocs);a=a||{},a.include_docs=!0;var b=this;return new Promise(function(d){b.pouchdb.allDocs(a).then(function(a){for(var c=[],f=0,g=a.rows.length;g>f;f++)c.push(a.rows[f].doc);c=new e(c),c.setPouch(b),b.allDocs=c,d(c)},function(a){c.warn("Error in pouchdb.allDocs",a)})})};var p={direction:"both",continuous:!0};return l.replicate=function(a,b,c){if(a&&b){c=$.extend({},p,c);var d=n.get(a);("CtoP"===c.direction||"both"===c.direction)&&d.sync(!0,b,c.continuous),("PtoC"===c.direction||"both"===c.direction)&&d.sync(!1,b,c.continuous)}},l.abortReplications=function(){for(var a in o){var b=o[a];if(b.isRunning)for(window.clearInterval(b.interval);b.running.length>0;)b.running.pop().cancel();delete o[a]}},l.pouchToVar=function(a,b,d,e){var f;return(f=l.getManager(a))?("function"==typeof b&&(e=d,d=b,b=!1),b?f.getDoc(b,e).then(d,function(){c.error("Caught error in PouchManager.getDoc",a,b)}):f.getDocs(e).then(d,function(){c.error("Caught error in PouchManager.getDocs",a)})):!0},l.getManager=function(a){return a?n.get(a):void 0},l}),!function(a,b){"undefined"!=typeof module&&module.exports?module.exports.browser=b():"function"==typeof define?define("bowser",b):this[a]=b()}("bowser",function(){function a(a){function c(b){var c=a.match(b);return c&&c.length>1&&c[1]||""}var d,e=c(/(ipod|iphone|ipad)/i).toLowerCase(),f=/like android/i.test(a),g=!f&&/android/i.test(a),h=c(/version\/(\d+(\.\d+)?)/i),i=/tablet/i.test(a),j=!i&&/[^-]mobi/i.test(a);/opera|opr/i.test(a)?d={name:"Opera",opera:b,version:h||c(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/windows phone/i.test(a)?d={name:"Windows Phone",windowsphone:b,msie:b,version:c(/iemobile\/(\d+(\.\d+)?)/i)}:/msie|trident/i.test(a)?d={name:"Internet Explorer",msie:b,version:c(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:/chrome|crios|crmo/i.test(a)?d={name:"Chrome",chrome:b,version:c(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:e?(d={name:"iphone"==e?"iPhone":"ipad"==e?"iPad":"iPod"},h&&(d.version=h)):/sailfish/i.test(a)?d={name:"Sailfish",sailfish:b,version:c(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(a)?d={name:"SeaMonkey",seamonkey:b,version:c(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(a)?(d={name:"Firefox",firefox:b,version:c(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(a)&&(d.firefoxos=b)):/silk/i.test(a)?d={name:"Amazon Silk",silk:b,version:c(/silk\/(\d+(\.\d+)?)/i)}:g?d={name:"Android",version:h}:/phantom/i.test(a)?d={name:"PhantomJS",phantom:b,version:c(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(a)||/rim\stablet/i.test(a)?d={name:"BlackBerry",blackberry:b,version:h||c(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(a)?(d={name:"WebOS",webos:b,version:h||c(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(a)&&(d.touchpad=b)):d=/bada/i.test(a)?{name:"Bada",bada:b,version:c(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(a)?{name:"Tizen",tizen:b,version:c(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||h}:/safari/i.test(a)?{name:"Safari",safari:b,version:h}:{},/(apple)?webkit/i.test(a)?(d.name=d.name||"Webkit",d.webkit=b,!d.version&&h&&(d.version=h)):!d.opera&&/gecko\//i.test(a)&&(d.name=d.name||"Gecko",d.gecko=b,d.version=d.version||c(/gecko\/(\d+(\.\d+)?)/i)),g||d.silk?d.android=b:e&&(d[e]=b,d.ios=b);var k="";e?(k=c(/os (\d+([_\s]\d+)*) like mac os x/i),k=k.replace(/[_\s]/g,".")):g?k=c(/android[ \/-](\d+(\.\d+)*)/i):d.windowsphone?k=c(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):d.webos?k=c(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):d.blackberry?k=c(/rim\stablet\sos\s(\d+(\.\d+)*)/i):d.bada?k=c(/bada\/(\d+(\.\d+)*)/i):d.tizen&&(k=c(/tizen[\/\s](\d+(\.\d+)*)/i)),k&&(d.osversion=k);var l=k.split(".")[0];return i||"ipad"==e||g&&(3==l||4==l&&!j)||d.silk?d.tablet=b:(j||"iphone"==e||"ipod"==e||g||d.blackberry||d.webos||d.bada)&&(d.mobile=b),d.msie&&d.version>=10||d.chrome&&d.version>=20||d.firefox&&d.version>=20||d.safari&&d.version>=6||d.opera&&d.version>=10||d.ios&&d.osversion&&d.osversion.split(".")[0]>=6?d.a=b:d.msie&&d.version<10||d.chrome&&d.version<20||d.firefox&&d.version<20||d.safari&&d.version<6||d.opera&&d.version<10||d.ios&&d.osversion&&d.osversion.split(".")[0]<6?d.c=b:d.x=b,d}var b=!0,c=a("undefined"!=typeof navigator?navigator.userAgent:"");return c._detect=a,c}),function(){function a(a,b,c){c=(c||0)-1;for(var d=a?a.length:0;++c<d;)if(a[c]===b)return c;return-1}function b(b,c){var d=typeof c;if(b=b.l,"boolean"==d||null==c)return b[c]?0:-1;"number"!=d&&"string"!=d&&(d="object");var e="number"==d?c:r+c;return b=(b=b[d])&&b[e],"object"==d?b&&-1<a(b,c)?0:-1:b?0:-1}function c(a){var b=this.l,c=typeof a;if("boolean"==c||null==a)b[a]=!0;else{"number"!=c&&"string"!=c&&(c="object");var d="number"==c?a:r+a,b=b[c]||(b[c]={});"object"==c?(b[d]||(b[d]=[])).push(a):b[d]=!0}}function d(a){return a.charCodeAt(0)}function e(a,b){for(var c=a.m,d=b.m,e=-1,f=c.length;++e<f;){var g=c[e],h=d[e];if(g!==h){if(g>h||"undefined"==typeof g)return 1;if(h>g||"undefined"==typeof h)return-1}}return a.n-b.n}function f(a){var b=-1,d=a.length,e=a[0],f=a[d/2|0],g=a[d-1];if(e&&"object"==typeof e&&f&&"object"==typeof f&&g&&"object"==typeof g)return!1;for(e=i(),e["false"]=e["null"]=e["true"]=e.undefined=!1,f=i(),f.k=a,f.l=e,f.push=c;++b<d;)f.push(a[b]);return f}function g(a){return"\\"+U[a]}function h(){return o.pop()||[]}function i(){return p.pop()||{k:null,l:null,m:null,"false":!1,n:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,o:null}}function j(a){a.length=0,o.length<t&&o.push(a)}function k(a){var b=a.l;b&&k(b),a.k=a.l=a.m=a.object=a.number=a.string=a.o=null,p.length<t&&p.push(a)}function l(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);var d=-1;c=c-b||0;for(var e=Array(0>c?0:c);++d<c;)e[d]=a[b+d];return e}function m(c){function o(a,b,c){if(!a||!T[typeof a])return a;b=b&&"undefined"==typeof c?b:bb(b,c,3);for(var d=-1,e=T[typeof a]&&Kc(a),f=e?e.length:0;++d<f&&(c=e[d],!1!==b(a[c],c,a)););return a}function p(a,b,c){var d;if(!a||!T[typeof a])return a;b=b&&"undefined"==typeof c?b:bb(b,c,3);for(d in a)if(!1===b(a[d],d,a))break;return a}function t(a,b,c){var d,e=a,f=e;if(!e)return f;for(var g=arguments,h=0,i="number"==typeof c?2:g.length;++h<i;)if((e=g[h])&&T[typeof e])for(var j=-1,k=T[typeof e]&&Kc(e),l=k?k.length:0;++j<l;)d=k[j],"undefined"==typeof f[d]&&(f[d]=e[d]);return f}function U(a,b,c){var d,e=a,f=e;if(!e)return f;var g=arguments,h=0,i="number"==typeof c?2:g.length;if(i>3&&"function"==typeof g[i-2])var j=bb(g[--i-1],g[i--],2);else i>2&&"function"==typeof g[i-1]&&(j=g[--i]);for(;++h<i;)if((e=g[h])&&T[typeof e])for(var k=-1,l=T[typeof e]&&Kc(e),m=l?l.length:0;++k<m;)d=l[k],f[d]=j?j(f[d],e[d]):e[d];return f}function W(a){var b,c=[];if(!a||!T[typeof a])return c;for(b in a)rc.call(a,b)&&c.push(b);return c}function X(a){return a&&"object"==typeof a&&!Jc(a)&&rc.call(a,"__wrapped__")?a:new Y(a)}function Y(a,b){this.__chain__=!!b,this.__wrapped__=a}function Z(a){function b(){if(d){var a=l(d);sc.apply(a,arguments)}if(this instanceof b){var f=ab(c.prototype),a=c.apply(f,a||arguments);return vb(a)?a:f}return c.apply(e,a||arguments)}var c=a[0],d=a[2],e=a[4];return Ic(b,a),b}function _(a,b,c,d,e){if(c){var f=c(a);if("undefined"!=typeof f)return f}if(!vb(a))return a;var g=kc.call(a);if(!Q[g])return a;var i=Gc[g];switch(g){case J:case K:return new i(+a);case M:case P:return new i(a);case O:return f=i(a.source,z.exec(a)),f.lastIndex=a.lastIndex,f}if(g=Jc(a),b){var k=!d;d||(d=h()),e||(e=h());for(var m=d.length;m--;)if(d[m]==a)return e[m];f=g?i(a.length):{}}else f=g?l(a):U({},a);return g&&(rc.call(a,"index")&&(f.index=a.index),rc.call(a,"input")&&(f.input=a.input)),b?(d.push(a),e.push(f),(g?Db:o)(a,function(a,g){f[g]=_(a,b,c,d,e)}),k&&(j(d),j(e)),f):f}function ab(a){return vb(a)?xc(a):{}}function bb(a,b,c){if("function"!=typeof a)return Ub;if("undefined"==typeof b||!("prototype"in a))return a;var d=a.__bindData__;if("undefined"==typeof d&&(Hc.funcNames&&(d=!a.name),d=d||!Hc.funcDecomp,!d)){var e=pc.call(a);Hc.funcNames||(d=!A.test(e)),d||(d=E.test(e),Ic(a,d))}if(!1===d||!0!==d&&1&d[1])return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return Sb(a,b)}function cb(a){function b(){var a=i?g:this;if(e){var o=l(e);sc.apply(o,arguments)}return(f||k)&&(o||(o=l(arguments)),f&&sc.apply(o,f),k&&o.length<h)?(d|=16,cb([c,m?d:-4&d,o,null,g,h])):(o||(o=arguments),j&&(c=a[n]),this instanceof b?(a=ab(c.prototype),o=c.apply(a,o),vb(o)?o:a):c.apply(a,o))}var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=1&d,j=2&d,k=4&d,m=8&d,n=c;return Ic(b,a),b}function db(c,d){var e=-1,g=mb(),h=c?c.length:0,i=h>=s&&g===a,j=[];if(i){var l=f(d);l?(g=b,d=l):i=!1}for(;++e<h;)l=c[e],0>g(d,l)&&j.push(l);return i&&k(d),j}function eb(a,b,c,d){d=(d||0)-1;for(var e=a?a.length:0,f=[];++d<e;){var g=a[d];if(g&&"object"==typeof g&&"number"==typeof g.length&&(Jc(g)||qb(g))){b||(g=eb(g,b,c));var h=-1,i=g.length,j=f.length;for(f.length+=i;++h<i;)f[j++]=g[h]}else c||f.push(g)}return f}function fb(a,b,c,d,e,f){if(c){var g=c(a,b);if("undefined"!=typeof g)return!!g}if(a===b)return 0!==a||1/a==1/b;if(a===a&&!(a&&T[typeof a]||b&&T[typeof b]))return!1;if(null==a||null==b)return a===b;var i=kc.call(a),k=kc.call(b);if(i==H&&(i=N),k==H&&(k=N),i!=k)return!1;switch(i){case J:case K:return+a==+b;case M:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case O:case P:return a==fc(b)}if(k=i==I,!k){var l=rc.call(a,"__wrapped__"),m=rc.call(b,"__wrapped__");if(l||m)return fb(l?a.__wrapped__:a,m?b.__wrapped__:b,c,d,e,f);if(i!=N)return!1;if(i=a.constructor,l=b.constructor,i!=l&&!(ub(i)&&i instanceof i&&ub(l)&&l instanceof l)&&"constructor"in a&&"constructor"in b)return!1}for(i=!e,e||(e=h()),f||(f=h()),l=e.length;l--;)if(e[l]==a)return f[l]==b;var n=0,g=!0;if(e.push(a),f.push(b),k){if(l=a.length,n=b.length,(g=n==l)||d)for(;n--;)if(k=l,m=b[n],d)for(;k--&&!(g=fb(a[k],m,c,d,e,f)););else if(!(g=fb(a[n],m,c,d,e,f)))break}else p(b,function(b,h,i){return rc.call(i,h)?(n++,g=rc.call(a,h)&&fb(a[h],b,c,d,e,f)):void 0}),g&&!d&&p(a,function(a,b,c){return rc.call(c,b)?g=-1<--n:void 0});return e.pop(),f.pop(),i&&(j(e),j(f)),g}function gb(a,b,c,d,e){(Jc(b)?Db:o)(b,function(b,f){var g,h,i=b,j=a[f];if(b&&((h=Jc(b))||Pc(b))){for(i=d.length;i--;)if(g=d[i]==b){j=e[i];break}if(!g){var k;c&&(i=c(j,b),k="undefined"!=typeof i)&&(j=i),k||(j=h?Jc(j)?j:[]:Pc(j)?j:{}),d.push(b),e.push(j),k||gb(j,b,c,d,e)}}else c&&(i=c(j,b),"undefined"==typeof i&&(i=b)),"undefined"!=typeof i&&(j=i);a[f]=j})}function hb(a,b){return a+oc(Fc()*(b-a+1))}function ib(c,d,e){var g=-1,i=mb(),l=c?c.length:0,m=[],n=!d&&l>=s&&i===a,o=e||n?h():m;for(n&&(o=f(o),i=b);++g<l;){var p=c[g],q=e?e(p,g,c):p;(d?!g||o[o.length-1]!==q:0>i(o,q))&&((e||n)&&o.push(q),m.push(p))}return n?(j(o.k),k(o)):e&&j(o),m}function jb(a){return function(b,c,d){var e={};c=X.createCallback(c,d,3),d=-1;var f=b?b.length:0;if("number"==typeof f)for(;++d<f;){var g=b[d];a(e,g,c(g,d,b),b)}else o(b,function(b,d,f){a(e,b,c(b,d,f),f)});return e}}function kb(a,b,c,d,e,f){var g=1&b,h=4&b,i=16&b,j=32&b;if(!(2&b||ub(a)))throw new gc;i&&!c.length&&(b&=-17,i=c=!1),j&&!d.length&&(b&=-33,j=d=!1);var k=a&&a.__bindData__;return k&&!0!==k?(k=l(k),k[2]&&(k[2]=l(k[2])),k[3]&&(k[3]=l(k[3])),!g||1&k[1]||(k[4]=e),!g&&1&k[1]&&(b|=8),!h||4&k[1]||(k[5]=f),i&&sc.apply(k[2]||(k[2]=[]),c),j&&vc.apply(k[3]||(k[3]=[]),d),k[1]|=b,kb.apply(null,k)):(1==b||17===b?Z:cb)([a,b,c,d,e,f])}function lb(a){return Lc[a]}function mb(){var b=(b=X.indexOf)===Mb?a:b;return b}function nb(a){return"function"==typeof a&&lc.test(a)}function ob(a){var b,c;return a&&kc.call(a)==N&&(b=a.constructor,!ub(b)||b instanceof b)?(p(a,function(a,b){c=b}),"undefined"==typeof c||rc.call(a,c)):!1}function pb(a){return Mc[a]}function qb(a){return a&&"object"==typeof a&&"number"==typeof a.length&&kc.call(a)==H||!1}function rb(a,b,c){var d=Kc(a),e=d.length;for(b=bb(b,c,3);e--&&(c=d[e],!1!==b(a[c],c,a)););return a}function sb(a){var b=[];return p(a,function(a,c){ub(a)&&b.push(c)}),b.sort()}function tb(a){for(var b=-1,c=Kc(a),d=c.length,e={};++b<d;){var f=c[b];e[a[f]]=f}return e}function ub(a){return"function"==typeof a}function vb(a){return!(!a||!T[typeof a])}function wb(a){return"number"==typeof a||a&&"object"==typeof a&&kc.call(a)==M||!1}function xb(a){return"string"==typeof a||a&&"object"==typeof a&&kc.call(a)==P||!1}function yb(a){for(var b=-1,c=Kc(a),d=c.length,e=Zb(d);++b<d;)e[b]=a[c[b]];return e}function zb(a,b,c){var d=-1,e=mb(),f=a?a.length:0,g=!1;return c=(0>c?Cc(0,f+c):c)||0,Jc(a)?g=-1<e(a,b,c):"number"==typeof f?g=-1<(xb(a)?a.indexOf(b,c):e(a,b,c)):o(a,function(a){return++d<c?void 0:!(g=a===b)}),g}function Ab(a,b,c){var d=!0;b=X.createCallback(b,c,3),c=-1;var e=a?a.length:0;if("number"==typeof e)for(;++c<e&&(d=!!b(a[c],c,a)););else o(a,function(a,c,e){return d=!!b(a,c,e)});return d}function Bb(a,b,c){var d=[];b=X.createCallback(b,c,3),c=-1;var e=a?a.length:0;if("number"==typeof e)for(;++c<e;){var f=a[c];b(f,c,a)&&d.push(f)}else o(a,function(a,c,e){b(a,c,e)&&d.push(a)});return d}function Cb(a,b,c){b=X.createCallback(b,c,3),c=-1;var d=a?a.length:0;if("number"!=typeof d){var e;return o(a,function(a,c,d){return b(a,c,d)?(e=a,!1):void 0}),e}for(;++c<d;){var f=a[c];if(b(f,c,a))return f}}function Db(a,b,c){var d=-1,e=a?a.length:0;if(b=b&&"undefined"==typeof c?b:bb(b,c,3),"number"==typeof e)for(;++d<e&&!1!==b(a[d],d,a););else o(a,b);return a}function Eb(a,b,c){var d=a?a.length:0;if(b=b&&"undefined"==typeof c?b:bb(b,c,3),"number"==typeof d)for(;d--&&!1!==b(a[d],d,a););else{var e=Kc(a),d=e.length;
o(a,function(a,c,f){return c=e?e[--d]:--d,b(f[c],c,f)})}return a}function Fb(a,b,c){var d=-1,e=a?a.length:0;if(b=X.createCallback(b,c,3),"number"==typeof e)for(var f=Zb(e);++d<e;)f[d]=b(a[d],d,a);else f=[],o(a,function(a,c,e){f[++d]=b(a,c,e)});return f}function Gb(a,b,c){var e=-1/0,f=e;if("function"!=typeof b&&c&&c[b]===a&&(b=null),null==b&&Jc(a)){c=-1;for(var g=a.length;++c<g;){var h=a[c];h>f&&(f=h)}}else b=null==b&&xb(a)?d:X.createCallback(b,c,3),Db(a,function(a,c,d){c=b(a,c,d),c>e&&(e=c,f=a)});return f}function Hb(a,b,c,d){if(!a)return c;var e=3>arguments.length;b=X.createCallback(b,d,4);var f=-1,g=a.length;if("number"==typeof g)for(e&&(c=a[++f]);++f<g;)c=b(c,a[f],f,a);else o(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)});return c}function Ib(a,b,c,d){var e=3>arguments.length;return b=X.createCallback(b,d,4),Eb(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)}),c}function Jb(a){var b=-1,c=a?a.length:0,d=Zb("number"==typeof c?c:0);return Db(a,function(a){var c=hb(0,++b);d[b]=d[c],d[c]=a}),d}function Kb(a,b,c){var d;b=X.createCallback(b,c,3),c=-1;var e=a?a.length:0;if("number"==typeof e)for(;++c<e&&!(d=b(a[c],c,a)););else o(a,function(a,c,e){return!(d=b(a,c,e))});return!!d}function Lb(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=-1;for(b=X.createCallback(b,c,3);++f<e&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a?a[0]:n;return l(a,0,Dc(Cc(0,d),e))}function Mb(b,c,d){if("number"==typeof d){var e=b?b.length:0;d=0>d?Cc(0,e+d):d||0}else if(d)return d=Ob(b,c),b[d]===c?d:-1;return a(b,c,d)}function Nb(a,b,c){if("number"!=typeof b&&null!=b){var d=0,e=-1,f=a?a.length:0;for(b=X.createCallback(b,c,3);++e<f&&b(a[e],e,a);)d++}else d=null==b||c?1:Cc(0,b);return l(a,d)}function Ob(a,b,c,d){var e=0,f=a?a.length:e;for(c=c?X.createCallback(c,d,1):Ub,b=c(b);f>e;)d=e+f>>>1,c(a[d])<b?e=d+1:f=d;return e}function Pb(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c="function"!=typeof b&&d&&d[b]===a?null:b,b=!1),null!=c&&(c=X.createCallback(c,d,3)),ib(a,b,c)}function Qb(){for(var a=1<arguments.length?arguments:arguments[0],b=-1,c=a?Gb(Tc(a,"length")):0,d=Zb(0>c?0:c);++b<c;)d[b]=Tc(a,b);return d}function Rb(a,b){var c=-1,d=a?a.length:0,e={};for(b||!d||Jc(a[0])||(b=[]);++c<d;){var f=a[c];b?e[f]=b[c]:f&&(e[f[0]]=f[1])}return e}function Sb(a,b){return 2<arguments.length?kb(a,17,l(arguments,2),null,b):kb(a,1,null,null,b)}function Tb(a,b,c){function d(){k&&nc(k),g=k=l=n,(p||o!==b)&&(m=Uc(),h=a.apply(j,f),k||g||(f=j=null))}function e(){var c=b-(Uc()-i);c>0?k=tc(e,c):(g&&nc(g),c=l,g=k=l=n,c&&(m=Uc(),h=a.apply(j,f),k||g||(f=j=null)))}var f,g,h,i,j,k,l,m=0,o=!1,p=!0;if(!ub(a))throw new gc;if(b=Cc(0,b)||0,!0===c)var q=!0,p=!1;else vb(c)&&(q=c.leading,o="maxWait"in c&&(Cc(b,c.maxWait)||0),p="trailing"in c?c.trailing:p);return function(){if(f=arguments,i=Uc(),j=this,l=p&&(k||!q),!1===o)var c=q&&!k;else{g||q||(m=i);var n=o-(i-m),r=0>=n;r?(g&&(g=nc(g)),m=i,h=a.apply(j,f)):g||(g=tc(d,n))}return r&&k?k=nc(k):k||b===o||(k=tc(e,b)),c&&(r=!0,h=a.apply(j,f)),!r||k||g||(f=j=null),h}}function Ub(a){return a}function Vb(a,b,c){var d=!0,e=b&&sb(b);b&&(c||e.length)||(null==c&&(c=b),f=Y,b=a,a=X,e=sb(b)),!1===c?d=!1:vb(c)&&"chain"in c&&(d=c.chain);var f=a,g=ub(f);Db(e,function(c){var e=a[c]=b[c];g&&(f.prototype[c]=function(){var b=this.__chain__,c=this.__wrapped__,g=[c];if(sc.apply(g,arguments),g=e.apply(a,g),d||b){if(c===g&&vb(g))return this;g=new f(g),g.__chain__=b}return g})})}function Wb(){}function Xb(a){return function(b){return b[a]}}function Yb(){return this.__wrapped__}c=c?$.defaults(V.Object(),c,$.pick(V,G)):V;var Zb=c.Array,$b=c.Boolean,_b=c.Date,ac=c.Function,bc=c.Math,cc=c.Number,dc=c.Object,ec=c.RegExp,fc=c.String,gc=c.TypeError,hc=[],ic=dc.prototype,jc=c._,kc=ic.toString,lc=ec("^"+fc(kc).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),mc=bc.ceil,nc=c.clearTimeout,oc=bc.floor,pc=ac.prototype.toString,qc=nb(qc=dc.getPrototypeOf)&&qc,rc=ic.hasOwnProperty,sc=hc.push,tc=c.setTimeout,uc=hc.splice,vc=hc.unshift,wc=function(){try{var a={},b=nb(b=dc.defineProperty)&&b,c=b(a,a,a)&&b}catch(d){}return c}(),xc=nb(xc=dc.create)&&xc,yc=nb(yc=Zb.isArray)&&yc,zc=c.isFinite,Ac=c.isNaN,Bc=nb(Bc=dc.keys)&&Bc,Cc=bc.max,Dc=bc.min,Ec=c.parseInt,Fc=bc.random,Gc={};Gc[I]=Zb,Gc[J]=$b,Gc[K]=_b,Gc[L]=ac,Gc[N]=dc,Gc[M]=cc,Gc[O]=ec,Gc[P]=fc,Y.prototype=X.prototype;var Hc=X.support={};Hc.funcDecomp=!nb(c.a)&&E.test(m),Hc.funcNames="string"==typeof ac.name,X.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:B,variable:"",imports:{_:X}},xc||(ab=function(){function a(){}return function(b){if(vb(b)){a.prototype=b;var d=new a;a.prototype=null}return d||c.Object()}}());var Ic=wc?function(a,b){S.value=b,wc(a,"__bindData__",S)}:Wb,Jc=yc||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&kc.call(a)==I||!1},Kc=Bc?function(a){return vb(a)?Bc(a):[]}:W,Lc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Mc=tb(Lc),Nc=ec("("+Kc(Mc).join("|")+")","g"),Oc=ec("["+Kc(Lc).join("")+"]","g"),Pc=qc?function(a){if(!a||kc.call(a)!=N)return!1;var b=a.valueOf,c=nb(b)&&(c=qc(b))&&qc(c);return c?a==c||qc(a)==c:ob(a)}:ob,Qc=jb(function(a,b,c){rc.call(a,c)?a[c]++:a[c]=1}),Rc=jb(function(a,b,c){(rc.call(a,c)?a[c]:a[c]=[]).push(b)}),Sc=jb(function(a,b,c){a[c]=b}),Tc=Fb,Uc=nb(Uc=_b.now)&&Uc||function(){return(new _b).getTime()},Vc=8==Ec(u+"08")?Ec:function(a,b){return Ec(xb(a)?a.replace(C,""):a,b||0)};return X.after=function(a,b){if(!ub(b))throw new gc;return function(){return 1>--a?b.apply(this,arguments):void 0}},X.assign=U,X.at=function(a){for(var b=arguments,c=-1,d=eb(b,!0,!1,1),b=b[2]&&b[2][b[1]]===a?1:d.length,e=Zb(b);++c<b;)e[c]=a[d[c]];return e},X.bind=Sb,X.bindAll=function(a){for(var b=1<arguments.length?eb(arguments,!0,!1,1):sb(a),c=-1,d=b.length;++c<d;){var e=b[c];a[e]=kb(a[e],1,null,null,a)}return a},X.bindKey=function(a,b){return 2<arguments.length?kb(b,19,l(arguments,2),null,a):kb(b,3,null,null,a)},X.chain=function(a){return a=new Y(a),a.__chain__=!0,a},X.compact=function(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d},X.compose=function(){for(var a=arguments,b=a.length;b--;)if(!ub(a[b]))throw new gc;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}},X.constant=function(a){return function(){return a}},X.countBy=Qc,X.create=function(a,b){var c=ab(a);return b?U(c,b):c},X.createCallback=function(a,b,c){var d=typeof a;if(null==a||"function"==d)return bb(a,b,c);if("object"!=d)return Xb(a);var e=Kc(a),f=e[0],g=a[f];return 1!=e.length||g!==g||vb(g)?function(b){for(var c=e.length,d=!1;c--&&(d=fb(b[e[c]],a[e[c]],null,!0)););return d}:function(a){return a=a[f],g===a&&(0!==g||1/g==1/a)}},X.curry=function(a,b){return b="number"==typeof b?b:+b||a.length,kb(a,4,null,null,null,b)},X.debounce=Tb,X.defaults=t,X.defer=function(a){if(!ub(a))throw new gc;var b=l(arguments,1);return tc(function(){a.apply(n,b)},1)},X.delay=function(a,b){if(!ub(a))throw new gc;var c=l(arguments,2);return tc(function(){a.apply(n,c)},b)},X.difference=function(a){return db(a,eb(arguments,!0,!0,1))},X.filter=Bb,X.flatten=function(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c="function"!=typeof b&&d&&d[b]===a?null:b,b=!1),null!=c&&(a=Fb(a,c,d)),eb(a,b)},X.forEach=Db,X.forEachRight=Eb,X.forIn=p,X.forInRight=function(a,b,c){var d=[];p(a,function(a,b){d.push(b,a)});var e=d.length;for(b=bb(b,c,3);e--&&!1!==b(d[e--],d[e],a););return a},X.forOwn=o,X.forOwnRight=rb,X.functions=sb,X.groupBy=Rc,X.indexBy=Sc,X.initial=function(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=e;for(b=X.createCallback(b,c,3);f--&&b(a[f],f,a);)d++}else d=null==b||c?1:b||d;return l(a,0,Dc(Cc(0,e-d),e))},X.intersection=function(){for(var c=[],d=-1,e=arguments.length,g=h(),i=mb(),l=i===a,m=h();++d<e;){var n=arguments[d];(Jc(n)||qb(n))&&(c.push(n),g.push(l&&n.length>=s&&f(d?c[d]:m)))}var l=c[0],o=-1,p=l?l.length:0,q=[];a:for(;++o<p;){var r=g[0],n=l[o];if(0>(r?b(r,n):i(m,n))){for(d=e,(r||m).push(n);--d;)if(r=g[d],0>(r?b(r,n):i(c[d],n)))continue a;q.push(n)}}for(;e--;)(r=g[e])&&k(r);return j(g),j(m),q},X.invert=tb,X.invoke=function(a,b){var c=l(arguments,2),d=-1,e="function"==typeof b,f=a?a.length:0,g=Zb("number"==typeof f?f:0);return Db(a,function(a){g[++d]=(e?b:a[b]).apply(a,c)}),g},X.keys=Kc,X.map=Fb,X.mapValues=function(a,b,c){var d={};return b=X.createCallback(b,c,3),o(a,function(a,c,e){d[c]=b(a,c,e)}),d},X.max=Gb,X.memoize=function(a,b){function c(){var d=c.cache,e=b?b.apply(this,arguments):r+arguments[0];return rc.call(d,e)?d[e]:d[e]=a.apply(this,arguments)}if(!ub(a))throw new gc;return c.cache={},c},X.merge=function(a){var b=arguments,c=2;if(!vb(a))return a;if("number"!=typeof b[2]&&(c=b.length),c>3&&"function"==typeof b[c-2])var d=bb(b[--c-1],b[c--],2);else c>2&&"function"==typeof b[c-1]&&(d=b[--c]);for(var b=l(arguments,1,c),e=-1,f=h(),g=h();++e<c;)gb(a,b[e],d,f,g);return j(f),j(g),a},X.min=function(a,b,c){var e=1/0,f=e;if("function"!=typeof b&&c&&c[b]===a&&(b=null),null==b&&Jc(a)){c=-1;for(var g=a.length;++c<g;){var h=a[c];f>h&&(f=h)}}else b=null==b&&xb(a)?d:X.createCallback(b,c,3),Db(a,function(a,c,d){c=b(a,c,d),e>c&&(e=c,f=a)});return f},X.omit=function(a,b,c){var d={};if("function"!=typeof b){var e=[];p(a,function(a,b){e.push(b)});for(var e=db(e,eb(arguments,!0,!1,1)),f=-1,g=e.length;++f<g;){var h=e[f];d[h]=a[h]}}else b=X.createCallback(b,c,3),p(a,function(a,c,e){b(a,c,e)||(d[c]=a)});return d},X.once=function(a){var b,c;if(!ub(a))throw new gc;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}},X.pairs=function(a){for(var b=-1,c=Kc(a),d=c.length,e=Zb(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e},X.partial=function(a){return kb(a,16,l(arguments,1))},X.partialRight=function(a){return kb(a,32,null,l(arguments,1))},X.pick=function(a,b,c){var d={};if("function"!=typeof b)for(var e=-1,f=eb(arguments,!0,!1,1),g=vb(a)?f.length:0;++e<g;){var h=f[e];h in a&&(d[h]=a[h])}else b=X.createCallback(b,c,3),p(a,function(a,c,e){b(a,c,e)&&(d[c]=a)});return d},X.pluck=Tc,X.property=Xb,X.pull=function(a){for(var b=arguments,c=0,d=b.length,e=a?a.length:0;++c<d;)for(var f=-1,g=b[c];++f<e;)a[f]===g&&(uc.call(a,f--,1),e--);return a},X.range=function(a,b,c){a=+a||0,c="number"==typeof c?c:+c||1,null==b&&(b=a,a=0);var d=-1;b=Cc(0,mc((b-a)/(c||1)));for(var e=Zb(b);++d<b;)e[d]=a,a+=c;return e},X.reject=function(a,b,c){return b=X.createCallback(b,c,3),Bb(a,function(a,c,d){return!b(a,c,d)})},X.remove=function(a,b,c){var d=-1,e=a?a.length:0,f=[];for(b=X.createCallback(b,c,3);++d<e;)c=a[d],b(c,d,a)&&(f.push(c),uc.call(a,d--,1),e--);return f},X.rest=Nb,X.shuffle=Jb,X.sortBy=function(a,b,c){var d=-1,f=Jc(b),g=a?a.length:0,l=Zb("number"==typeof g?g:0);for(f||(b=X.createCallback(b,c,3)),Db(a,function(a,c,e){var g=l[++d]=i();f?g.m=Fb(b,function(b){return a[b]}):(g.m=h())[0]=b(a,c,e),g.n=d,g.o=a}),g=l.length,l.sort(e);g--;)a=l[g],l[g]=a.o,f||j(a.m),k(a);return l},X.tap=function(a,b){return b(a),a},X.throttle=function(a,b,c){var d=!0,e=!0;if(!ub(a))throw new gc;return!1===c?d=!1:vb(c)&&(d="leading"in c?c.leading:d,e="trailing"in c?c.trailing:e),R.leading=d,R.maxWait=b,R.trailing=e,Tb(a,b,R)},X.times=function(a,b,c){a=-1<(a=+a)?a:0;var d=-1,e=Zb(a);for(b=bb(b,c,1);++d<a;)e[d]=b(d);return e},X.toArray=function(a){return a&&"number"==typeof a.length?l(a):yb(a)},X.transform=function(a,b,c,d){var e=Jc(a);if(null==c)if(e)c=[];else{var f=a&&a.constructor;c=ab(f&&f.prototype)}return b&&(b=X.createCallback(b,d,4),(e?Db:o)(a,function(a,d,e){return b(c,a,d,e)})),c},X.union=function(){return ib(eb(arguments,!0,!0))},X.uniq=Pb,X.values=yb,X.where=Bb,X.without=function(a){return db(a,l(arguments,1))},X.wrap=function(a,b){return kb(b,16,[a])},X.xor=function(){for(var a=-1,b=arguments.length;++a<b;){var c=arguments[a];if(Jc(c)||qb(c))var d=d?ib(db(d,c).concat(db(c,d))):c}return d||[]},X.zip=Qb,X.zipObject=Rb,X.collect=Fb,X.drop=Nb,X.each=Db,X.eachRight=Eb,X.extend=U,X.methods=sb,X.object=Rb,X.select=Bb,X.tail=Nb,X.unique=Pb,X.unzip=Qb,Vb(X),X.clone=function(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=b,b=!1),_(a,b,"function"==typeof c&&bb(c,d,1))},X.cloneDeep=function(a,b,c){return _(a,!0,"function"==typeof b&&bb(b,c,1))},X.contains=zb,X.escape=function(a){return null==a?"":fc(a).replace(Oc,lb)},X.every=Ab,X.find=Cb,X.findIndex=function(a,b,c){var d=-1,e=a?a.length:0;for(b=X.createCallback(b,c,3);++d<e;)if(b(a[d],d,a))return d;return-1},X.findKey=function(a,b,c){var d;return b=X.createCallback(b,c,3),o(a,function(a,c,e){return b(a,c,e)?(d=c,!1):void 0}),d},X.findLast=function(a,b,c){var d;return b=X.createCallback(b,c,3),Eb(a,function(a,c,e){return b(a,c,e)?(d=a,!1):void 0}),d},X.findLastIndex=function(a,b,c){var d=a?a.length:0;for(b=X.createCallback(b,c,3);d--;)if(b(a[d],d,a))return d;return-1},X.findLastKey=function(a,b,c){var d;return b=X.createCallback(b,c,3),rb(a,function(a,c,e){return b(a,c,e)?(d=c,!1):void 0}),d},X.has=function(a,b){return a?rc.call(a,b):!1},X.identity=Ub,X.indexOf=Mb,X.isArguments=qb,X.isArray=Jc,X.isBoolean=function(a){return!0===a||!1===a||a&&"object"==typeof a&&kc.call(a)==J||!1},X.isDate=function(a){return a&&"object"==typeof a&&kc.call(a)==K||!1},X.isElement=function(a){return a&&1===a.nodeType||!1},X.isEmpty=function(a){var b=!0;if(!a)return b;var c=kc.call(a),d=a.length;return c==I||c==P||c==H||c==N&&"number"==typeof d&&ub(a.splice)?!d:(o(a,function(){return b=!1}),b)},X.isEqual=function(a,b,c,d){return fb(a,b,"function"==typeof c&&bb(c,d,2))},X.isFinite=function(a){return zc(a)&&!Ac(parseFloat(a))},X.isFunction=ub,X.isNaN=function(a){return wb(a)&&a!=+a},X.isNull=function(a){return null===a},X.isNumber=wb,X.isObject=vb,X.isPlainObject=Pc,X.isRegExp=function(a){return a&&"object"==typeof a&&kc.call(a)==O||!1},X.isString=xb,X.isUndefined=function(a){return"undefined"==typeof a},X.lastIndexOf=function(a,b,c){var d=a?a.length:0;for("number"==typeof c&&(d=(0>c?Cc(0,d+c):Dc(c,d-1))+1);d--;)if(a[d]===b)return d;return-1},X.mixin=Vb,X.noConflict=function(){return c._=jc,this},X.noop=Wb,X.now=Uc,X.parseInt=Vc,X.random=function(a,b,c){var d=null==a,e=null==b;return null==c&&("boolean"==typeof a&&e?(c=a,a=1):e||"boolean"!=typeof b||(c=b,e=!0)),d&&e&&(b=1),a=+a||0,e?(b=a,a=0):b=+b||0,c||a%1||b%1?(c=Fc(),Dc(a+c*(b-a+parseFloat("1e-"+((c+"").length-1))),b)):hb(a,b)},X.reduce=Hb,X.reduceRight=Ib,X.result=function(a,b){if(a){var c=a[b];return ub(c)?a[b]():c}},X.runInContext=m,X.size=function(a){var b=a?a.length:0;return"number"==typeof b?b:Kc(a).length},X.some=Kb,X.sortedIndex=Ob,X.template=function(a,b,c){var d=X.templateSettings;a=fc(a||""),c=t({},c,d);var e,f=t({},c.imports,d.imports),d=Kc(f),f=yb(f),h=0,i=c.interpolate||D,j="__p+='",i=ec((c.escape||D).source+"|"+i.source+"|"+(i===B?y:D).source+"|"+(c.evaluate||D).source+"|$","g");a.replace(i,function(b,c,d,f,i,k){return d||(d=f),j+=a.slice(h,k).replace(F,g),c&&(j+="'+__e("+c+")+'"),i&&(e=!0,j+="';"+i+";\n__p+='"),d&&(j+="'+((__t=("+d+"))==null?'':__t)+'"),h=k+b.length,b}),j+="';",i=c=c.variable,i||(c="obj",j="with("+c+"){"+j+"}"),j=(e?j.replace(v,""):j).replace(w,"$1").replace(x,"$1;"),j="function("+c+"){"+(i?"":c+"||("+c+"={});")+"var __t,__p='',__e=_.escape"+(e?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+j+"return __p}";try{var k=ac(d,"return "+j).apply(n,f)}catch(l){throw l.source=j,l}return b?k(b):(k.source=j,k)},X.unescape=function(a){return null==a?"":fc(a).replace(Nc,pb)},X.uniqueId=function(a){var b=++q;return fc(null==a?"":a)+b},X.all=Ab,X.any=Kb,X.detect=Cb,X.findWhere=Cb,X.foldl=Hb,X.foldr=Ib,X.include=zb,X.inject=Hb,Vb(function(){var a={};return o(X,function(b,c){X.prototype[c]||(a[c]=b)}),a}(),!1),X.first=Lb,X.last=function(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=e;for(b=X.createCallback(b,c,3);f--&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a?a[e-1]:n;return l(a,Cc(0,e-d))},X.sample=function(a,b,c){return a&&"number"!=typeof a.length&&(a=yb(a)),null==b||c?a?a[hb(0,a.length-1)]:n:(a=Jb(a),a.length=Dc(Cc(0,b),a.length),a)},X.take=Lb,X.head=Lb,o(X,function(a,b){var c="sample"!==b;X.prototype[b]||(X.prototype[b]=function(b,d){var e=this.__chain__,f=a(this.__wrapped__,b,d);return e||null!=b&&(!d||c&&"function"==typeof b)?new Y(f,e):f})}),X.VERSION="2.4.1",X.prototype.chain=function(){return this.__chain__=!0,this},X.prototype.toString=function(){return fc(this.__wrapped__)},X.prototype.value=Yb,X.prototype.valueOf=Yb,Db(["join","pop","shift"],function(a){var b=hc[a];X.prototype[a]=function(){var a=this.__chain__,c=b.apply(this.__wrapped__,arguments);return a?new Y(c,a):c}}),Db(["push","reverse","sort","unshift"],function(a){var b=hc[a];X.prototype[a]=function(){return b.apply(this.__wrapped__,arguments),this}}),Db(["concat","slice","splice"],function(a){var b=hc[a];X.prototype[a]=function(){return new Y(b.apply(this.__wrapped__,arguments),this.__chain__)}}),X}var n,o=[],p=[],q=0,r=+new Date+"",s=75,t=40,u=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",v=/\b__p\+='';/g,w=/\b(__p\+=)''\+/g,x=/(__e\(.*?\)|\b__t\))\+'';/g,y=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,z=/\w*$/,A=/^\s*function[ \n\r\t]+\w/,B=/<%=([\s\S]+?)%>/g,C=RegExp("^["+u+"]*0+(?=.$)"),D=/($^)/,E=/\bthis\b/,F=/['\n\r\t\u2028\u2029\\]/g,G="Array Boolean Date Function Math Number Object RegExp String _ attachEvent clearTimeout isFinite isNaN parseInt setTimeout".split(" "),H="[object Arguments]",I="[object Array]",J="[object Boolean]",K="[object Date]",L="[object Function]",M="[object Number]",N="[object Object]",O="[object RegExp]",P="[object String]",Q={};Q[L]=!1,Q[H]=Q[I]=Q[J]=Q[K]=Q[M]=Q[N]=Q[O]=Q[P]=!0;var R={leading:!1,maxWait:0,trailing:!1},S={configurable:!1,enumerable:!1,value:null,writable:!1},T={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},U={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},V=T[typeof window]&&window||this,W=T[typeof exports]&&exports&&!exports.nodeType&&exports,X=T[typeof module]&&module&&!module.nodeType&&module,Y=X&&X.exports===W&&W,Z=T[typeof global]&&global;!Z||Z.global!==Z&&Z.window!==Z||(V=Z);var $=m();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(V._=$,define("lodash",[],function(){return $})):W&&X?Y?(X.exports=$)._=$:W._=$:V._=$}.call(this),window.Modernizr=function(a,b,c){function d(a){t.cssText=a}function e(a,b){return d(x.join(a+";")+(b||""))}function f(a,b){return typeof a===b}function g(a,b){return!!~(""+a).indexOf(b)}function h(a,b){for(var d in a){var e=a[d];if(!g(e,"-")&&t[e]!==c)return"pfx"==b?e:!0}return!1}function i(a,b,d){for(var e in a){var g=b[a[e]];if(g!==c)return d===!1?a[e]:f(g,"function")?g.bind(d||b):g}return!1}function j(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+z.join(d+" ")+d).split(" ");return f(b,"string")||f(b,"undefined")?h(e,b):(e=(a+" "+A.join(d+" ")+d).split(" "),i(e,b,c))}function k(){o.input=function(c){for(var d=0,e=c.length;e>d;d++)E[c[d]]=!!(c[d]in u);return E.list&&(E.list=!(!b.createElement("datalist")||!a.HTMLDataListElement)),E}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),o.inputtypes=function(a){for(var d,e,f,g=0,h=a.length;h>g;g++)u.setAttribute("type",e=a[g]),d="text"!==u.type,d&&(u.value=v,u.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(e)&&u.style.WebkitAppearance!==c?(q.appendChild(u),f=b.defaultView,d=f.getComputedStyle&&"textfield"!==f.getComputedStyle(u,null).WebkitAppearance&&0!==u.offsetHeight,q.removeChild(u)):/^(search|tel)$/.test(e)||(d=/^(url|email)$/.test(e)?u.checkValidity&&u.checkValidity()===!1:u.value!=v)),D[a[g]]=!!d;return D}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var l,m,n="2.8.3",o={},p=!0,q=b.documentElement,r="modernizr",s=b.createElement(r),t=s.style,u=b.createElement("input"),v=":)",w={}.toString,x=" -webkit- -moz- -o- -ms- ".split(" "),y="Webkit Moz O ms",z=y.split(" "),A=y.toLowerCase().split(" "),B={svg:"http://www.w3.org/2000/svg"},C={},D={},E={},F=[],G=F.slice,H=function(a,c,d,e){var f,g,h,i,j=b.createElement("div"),k=b.body,l=k||b.createElement("body");if(parseInt(d,10))for(;d--;)h=b.createElement("div"),h.id=e?e[d]:r+(d+1),j.appendChild(h);return f=["&#173;",'<style id="s',r,'">',a,"</style>"].join(""),j.id=r,(k?j:l).innerHTML+=f,l.appendChild(j),k||(l.style.background="",l.style.overflow="hidden",i=q.style.overflow,q.style.overflow="hidden",q.appendChild(l)),g=c(j,a),k?j.parentNode.removeChild(j):(l.parentNode.removeChild(l),q.style.overflow=i),!!g},I=function(b){var c=a.matchMedia||a.msMatchMedia;if(c)return c(b)&&c(b).matches||!1;var d;return H("@media "+b+" { #"+r+" { position: absolute; } }",function(b){d="absolute"==(a.getComputedStyle?getComputedStyle(b,null):b.currentStyle).position}),d},J=function(){function a(a,e){e=e||b.createElement(d[a]||"div"),a="on"+a;var g=a in e;return g||(e.setAttribute||(e=b.createElement("div")),e.setAttribute&&e.removeAttribute&&(e.setAttribute(a,""),g=f(e[a],"function"),f(e[a],"undefined")||(e[a]=c),e.removeAttribute(a))),e=null,g}var d={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return a}(),K={}.hasOwnProperty;m=f(K,"undefined")||f(K.call,"undefined")?function(a,b){return b in a&&f(a.constructor.prototype[b],"undefined")}:function(a,b){return K.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var c=G.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(G.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(G.call(arguments)))};return d}),C.flexbox=function(){return j("flexWrap")},C.flexboxlegacy=function(){return j("boxDirection")},C.canvas=function(){var a=b.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))},C.canvastext=function(){return!(!o.canvas||!f(b.createElement("canvas").getContext("2d").fillText,"function"))},C.webgl=function(){return!!a.WebGLRenderingContext},C.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:H(["@media (",x.join("touch-enabled),("),r,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=9===a.offsetTop}),c},C.geolocation=function(){return"geolocation"in navigator},C.postmessage=function(){return!!a.postMessage},C.websqldatabase=function(){return!!a.openDatabase},C.indexedDB=function(){return!!j("indexedDB",a)},C.hashchange=function(){return J("hashchange",a)&&(b.documentMode===c||b.documentMode>7)},C.history=function(){return!(!a.history||!history.pushState)},C.draganddrop=function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a},C.websockets=function(){return"WebSocket"in a||"MozWebSocket"in a},C.rgba=function(){return d("background-color:rgba(150,255,150,.5)"),g(t.backgroundColor,"rgba")},C.hsla=function(){return d("background-color:hsla(120,40%,100%,.5)"),g(t.backgroundColor,"rgba")||g(t.backgroundColor,"hsla")},C.multiplebgs=function(){return d("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(t.background)},C.backgroundsize=function(){return j("backgroundSize")},C.borderimage=function(){return j("borderImage")},C.borderradius=function(){return j("borderRadius")},C.boxshadow=function(){return j("boxShadow")},C.textshadow=function(){return""===b.createElement("div").style.textShadow},C.opacity=function(){return e("opacity:.55"),/^0.55$/.test(t.opacity)},C.cssanimations=function(){return j("animationName")},C.csscolumns=function(){return j("columnCount")},C.cssgradients=function(){var a="background-image:",b="gradient(linear,left top,right bottom,from(#9f9),to(white));",c="linear-gradient(left top,#9f9, white);";return d((a+"-webkit- ".split(" ").join(b+a)+x.join(c+a)).slice(0,-a.length)),g(t.backgroundImage,"gradient")},C.cssreflections=function(){return j("boxReflect")},C.csstransforms=function(){return!!j("transform")},C.csstransforms3d=function(){var a=!!j("perspective");return a&&"webkitPerspective"in q.style&&H("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b){a=9===b.offsetLeft&&3===b.offsetHeight}),a},C.csstransitions=function(){return j("transition")},C.fontface=function(){var a;return H('@font-face {font-family:"font";src:url("https://")}',function(c,d){var e=b.getElementById("smodernizr"),f=e.sheet||e.styleSheet,g=f?f.cssRules&&f.cssRules[0]?f.cssRules[0].cssText:f.cssText||"":"";a=/src/i.test(g)&&0===g.indexOf(d.split(" ")[0])}),a},C.generatedcontent=function(){var a;return H(["#",r,"{font:0/0 a}#",r,':after{content:"',v,'";visibility:hidden;font:3px/1 a}'].join(""),function(b){a=b.offsetHeight>=3}),a},C.video=function(){var a=b.createElement("video"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),c.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))}catch(d){}return c},C.audio=function(){var a=b.createElement("audio"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),c.mp3=a.canPlayType("audio/mpeg;").replace(/^no$/,""),c.wav=a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),c.m4a=(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(d){}return c},C.localstorage=function(){try{return localStorage.setItem(r,r),localStorage.removeItem(r),!0}catch(a){return!1}},C.sessionstorage=function(){try{return sessionStorage.setItem(r,r),sessionStorage.removeItem(r),!0}catch(a){return!1}},C.webworkers=function(){return!!a.Worker},C.applicationcache=function(){return!!a.applicationCache},C.svg=function(){return!!b.createElementNS&&!!b.createElementNS(B.svg,"svg").createSVGRect},C.inlinesvg=function(){var a=b.createElement("div");return a.innerHTML="<svg/>",(a.firstChild&&a.firstChild.namespaceURI)==B.svg},C.smil=function(){return!!b.createElementNS&&/SVGAnimate/.test(w.call(b.createElementNS(B.svg,"animate")))},C.svgclippaths=function(){return!!b.createElementNS&&/SVGClipPath/.test(w.call(b.createElementNS(B.svg,"clipPath")))};for(var L in C)m(C,L)&&(l=L.toLowerCase(),o[l]=C[L](),F.push((o[l]?"":"no-")+l));return o.input||k(),o.addTest=function(a,b){if("object"==typeof a)for(var d in a)m(a,d)&&o.addTest(d,a[d]);else{if(a=a.toLowerCase(),o[a]!==c)return o;b="function"==typeof b?b():b,"undefined"!=typeof p&&p&&(q.className+=" "+(b?"":"no-")+a),o[a]=b}return o},d(""),s=u=null,function(a,b){function c(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function d(){var a=s.elements;return"string"==typeof a?a.split(" "):a}function e(a){var b=r[a[p]];return b||(b={},q++,a[p]=q,r[q]=b),b}function f(a,c,d){if(c||(c=b),k)return c.createElement(a);d||(d=e(c));var f;return f=d.cache[a]?d.cache[a].cloneNode():o.test(a)?(d.cache[a]=d.createElem(a)).cloneNode():d.createElem(a),!f.canHaveChildren||n.test(a)||f.tagUrn?f:d.frag.appendChild(f)}function g(a,c){if(a||(a=b),k)return a.createDocumentFragment();c=c||e(a);for(var f=c.frag.cloneNode(),g=0,h=d(),i=h.length;i>g;g++)f.createElement(h[g]);return f}function h(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return s.shivMethods?f(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+d().join().replace(/[\w\-]+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(s,b.frag)}function i(a){a||(a=b);var d=e(a);return!s.shivCSS||j||d.hasCSS||(d.hasCSS=!!c(a,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),k||h(a,d),a}var j,k,l="3.7.0",m=a.html5||{},n=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,o=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,p="_html5shiv",q=0,r={};!function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",j="hidden"in a,k=1==a.childNodes.length||function(){b.createElement("a");var a=b.createDocumentFragment();return"undefined"==typeof a.cloneNode||"undefined"==typeof a.createDocumentFragment||"undefined"==typeof a.createElement}()}catch(c){j=!0,k=!0}}();var s={elements:m.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:l,shivCSS:m.shivCSS!==!1,supportsUnknownElements:k,shivMethods:m.shivMethods!==!1,type:"default",shivDocument:i,createElement:f,createDocumentFragment:g};a.html5=s,i(b)}(this,b),o._version=n,o._prefixes=x,o._domPrefixes=A,o._cssomPrefixes=z,o.mq=I,o.hasEvent=J,o.testProp=function(a){return h([a])},o.testAllProps=j,o.testStyles=H,o.prefixed=function(a,b,c){return b?j(a,b,c):j(a,"pfx")},q.className=q.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(p?" js "+F.join(" "):""),o}(this,this.document),define("modernizr",function(a){return function(){var b;return b||a.Modernizr}}(this)),function(a){"function"==typeof define&&define.amd?define("jquery-cookie",["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){function b(a){return h.raw?a:encodeURIComponent(a)}function c(a){return h.raw?a:decodeURIComponent(a)}function d(a){return b(h.json?JSON.stringify(a):String(a))}function e(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return a=decodeURIComponent(a.replace(g," ")),h.json?JSON.parse(a):a}catch(b){}}function f(b,c){var d=h.raw?b:e(b);return a.isFunction(c)?c(d):d}var g=/\+/g,h=a.cookie=function(e,g,i){if(void 0!==g&&!a.isFunction(g)){if(i=a.extend({},h.defaults,i),"number"==typeof i.expires){var j=i.expires,k=i.expires=new Date;k.setTime(+k+864e5*j)}return document.cookie=[b(e),"=",d(g),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}for(var l=e?void 0:{},m=document.cookie?document.cookie.split("; "):[],n=0,o=m.length;o>n;n++){var p=m[n].split("="),q=c(p.shift()),r=p.join("=");if(e&&e===q){l=f(r,g);break}e||void 0===(r=f(r))||(l[q]=r)}return l};h.defaults={},a.removeCookie=function(b,c){return void 0===a.cookie(b)?!1:(a.cookie(b,"",a.extend({},c,{expires:-1})),!a.cookie(b))}}),define("src/util/browser",["src/util/debug","bowser","lodash","modernizr","jquery-cookie"],function(a,b,c,d){function e(){var d=c.keys(k),e=c.map(d,function(a){return b[a]}),f=c.any(e);if(!f)return a.warn("browser not recognized"),!0;var g=d[e.indexOf(!0)];return k[g]>+b.version?!1:!0}function f(){var a="<h1>Incompatible browser</h1>";return a+="<b><%- browserName %> <%- browserVersion %> </b> is incompatible with the visualizer<br/>",a+="Please update your browser to one of the following: <br/>",a+='<ul class="browser-list"><% _.forEach(browsers, function(b) { %><li class="<%- b.name.toLowerCase() %>"><a href="<%- b.url %>"> <%- b.name %> </a> <span style="color:orange"><%- b.message %></span></li><% }); %></ul>',c.template(a,l)}function g(){var a="<h1>Your browser is missing some important features </h1><br/>";a+='<table><% _.forEach(features, function(f) { %> <tr>  <td style="width:20px; background-color: <%- f.color %>;"></td> <td> <%- f.name %>  </td></tr> <% }); %> </table><br/>',a+="<p>We recommend updating your browser to one of the following:</p>",a+='<ul class="browser-list"><% _.forEach(browsers, function(b) { %><li class="<%- b.name.toLowerCase() %>"><a href="<%- b.url %>"> <%- b.name %> </a> <span style="color:orange"><%- b.message %></span></li><% }); %></ul>';var b={features:c.cloneDeep(h)};
return c.template(a,c.merge(b,l))}var h={canvas:{name:"Canvas",type:"recommended"},webgl:{name:"WebGL",type:"recommended"},smil:{name:"SMIL (canvas animation)",type:"recommended"},localstorage:{name:"LocalStorage",type:"recommended"}};for(var i in h)d[i]?(h[i].has=!0,h[i].color="green"):(h[i].has=!1,h[i].color="red");var j=c.every(c.map(h,function(a){return a.has})),k={chrome:5,msie:11,firefox:5},l={browserName:b.name,browserVersion:b.version,browsers:[{name:"Chrome",url:"https://www.google.com/intl/en/chrome/browser/",message:"(Recommended)"},{name:"Firefox",url:"https://www.mozilla.org/en-US/firefox/new/"}]},m=e();return{checkCompatibility:function(){return new Promise(function(b){if(!m)return a.error("browser is not compatible"),b(f());if($.cookie("visualizer-skip-feature-warning"))return a.info("user does not want to see warning"),b();if(j)return a.info("user has all required features"),b();var c=$("#ci-dialog");c.html(g()),c.append($('<input id="skip-warning-checkbox" type="checkbox">Don\'t show this again</input>')),c.dialog({modal:!0,buttons:{Ok:function(){$(this).dialog("close"),$("#skip-warning-checkbox").is(":checked")&&$.cookie("visualizer-skip-feature-warning",!0,{path:"/"}),b()}},close:function(){b()},width:600})})}}}),define("src/main/entrypoint",["jquery","src/header/header","src/util/repository","src/main/grid","src/util/api","src/util/context","src/util/datatraversing","src/util/versioning","modules/modulefactory","src/util/viewmigration","src/util/actionmanager","src/util/cron","src/util/pouchtovar","src/util/debug","src/util/browser"],function($,Header,Repository,Grid,API,Context,Traversing,Versioning,ModuleFactory,Migration,ActionManager,Cron,PouchDBUtil,Debug,browser){function doView(a){var b,c=0;for(DataObject.recursiveTransform(a,!1),a=Migration(a),a.grid=a.grid||new DataObject,this.viewLoaded?(reloadingView(),Grid.reset(a.grid)):(Grid.init(a.grid,document.getElementById("modules-grid")),this.viewLoaded=!0),ModuleFactory.empty(),a.modules=a.modules||new DataArray,b=a.modules.length,a.variables=a.variables||new DataArray,a.pouchvariables=a.pouchvariables||new DataArray,a.configuration=a.configuration||new DataObject,a.configuration.title=a.configuration.title||"No title";b>c;)Grid.addModuleFromJSON(a.getChildSync(["modules",c++],!0));Grid.checkDimensions(),a.modules=ModuleFactory.getDefinitions(),viewLoaded()}function reloadingView(){RepositoryData.resetCallbacks(),RepositoryActions.resetCallbacks()}function doData(a,b){b&&reloadingData(),dataLoaded()}function reloadingData(){RepositoryData.resetVariables(),RepositoryActions.resetVariables(),RepositoryHighlight.resetCallbacks(),RepositoryHighlight.resetVariables()}function viewLoaded(){_viewLoaded=!0,_check("view")}function dataLoaded(){_dataLoaded=!0,_check("data")}function _check(loading){if(_dataLoaded&&_viewLoaded){var view=Versioning.getView(),data=Versioning.getData(),def=new Promise(function(resolve,reject){if(view.init_script){var prefix="(function init_script(init_deferred){\n",script=view.init_script[0].groups.general[0].script[0]||"",suffix="\n})({resolve:resolve});";-1===script.indexOf("init_deferred")&&(suffix+="resolve();"),eval(prefix+script+suffix)}else resolve()});def.then(function(){if(ActionManager.viewHasChanged(view),0===view.variables.length)for(var a in data)"_"!==a.charAt(0)&&view.variables.push(new DataObject({varname:a,jpath:[a]}));API.loading("Fetching remote variables");for(var b,c=[],a=0,d=view.variables.length;d>a;a++)b=view.traceSync(["variables",a]),b.varname&&(b.url?c.push(b.fetch(!0).then(function(a){var b=a.varname;data[b]=a.value,API.setVariable(b,!1,[b])})):b.jpath?("string"==typeof b.jpath&&(b.jpath=b.jpath.split("."),b.jpath.shift()),API.setVariable(b.varname,!1,b.jpath)):API.createData(name,!1));Promise.all(c).then(function(){API.stopLoading("Fetching remote variables")}),API.loading("Fetching local variables");for(var e,f=[],a=0,d=view.pouchvariables.length;d>a;a++)e=view.pouchvariables[a],e.dbname&&e.varname&&!function(a){f.push(PouchDBUtil.pouchToVar(view.pouchvariables[a].dbname,view.pouchvariables[a].id,function(b){b.linkToParent(data,view.pouchvariables[a].varname),API.setVariable(view.pouchvariables[a].varname,!1,[view.pouchvariables[a].varname])}))}(a);if(Promise.all(f).then(function(){API.stopLoading("Fetching local variables")},function(a){Debug.error("Unable to fetch local variables",a)}),PouchDBUtil.abortReplications(),view.couch_replication)for(var g=view.couch_replication[0].groups.couch[0],a=0,d=g.length;d>a;a++)g[a].couchurl&&PouchDBUtil.replicate(g[a].pouchname,g[a].couchurl,{direction:g[a].direction,continuous:g[a].continuous?g[a].continuous.length:!0})},function(a){Debug.error("Error executing the init script",a)})}}function configureEntryPoint(){var a=(Date.now(),Versioning.getData()),b=Versioning.getView(),c=$("<div></div>").dialog({modal:!0,position:["center",50],width:"80%"});c.prev().remove(),c.parent().css("z-index",1e3);var d=[];Traversing.getJPathsFromElement(a,d),require(["forms/form"],function(a){var e=new a;e.init({onValueChanged:function(){}}),e.setStructure({sections:{cfg:{options:{title:"General configuration",icon:"hostname"},groups:{tablevars:{options:{type:"table",title:"Main variables",multiple:!0},fields:{varname:{type:"text",multiple:!1,title:"Variable name"},jpath:{type:"combo",title:"J-Path",options:d,extractValue:function(a){if(a){var b=a.split(".");return b.shift(),b}},insertValue:function(a){return"element."+(a||[]).join(".")}},url:{type:"text",title:"From URL"},timeout:{type:"text",title:"Timeout"}}},pouchvars:{options:{type:"table",title:"PouchDB variables",multiple:!0},fields:{varname:{type:"text",multiple:!1,title:"Variable name"},dbname:{type:"text",title:"DB name"},id:{type:"text",title:"ID"}}}}},actionscripts:{options:{title:"Action scripting",icon:"script_go"},sections:{actions:{options:{multiple:!0,title:"Action"},groups:{action:{options:{type:"list"},fields:{name:{type:"text",title:"Action name"},script:{type:"jscode",title:"Script"}}}}}}},actionfiles:{options:{title:"Action files",icon:"server_go"},groups:{action:{options:{type:"table",multiple:!0},fields:{name:{type:"text",title:"Action name"},file:{type:"text",title:"File"},mode:{type:"combo",title:"File type",options:[{key:"worker",title:"WebWorker"},{key:"amd",title:"Asynchronously loaded module"}]}}}}},webservice:{options:{title:"Webservice",icon:"web_disk"},sections:{general:{options:{multiple:!0,title:"Webservice instance"},groups:{general:{options:{type:"list",multiple:!0},fields:{action:{type:"text",title:"Triggering action"},url:{type:"text",title:"URL"},method:{type:"combo",title:"Method",options:[{key:"get",title:"GET"},{key:"post",title:"POST"}]}}},varsin:{options:{type:"table",multiple:!0,title:"Vars in"},fields:{action:{type:"text",title:"Triggering action"},url:{type:"text",title:"URL"}}},varsout:{options:{type:"table",multiple:!0,title:"Variables out"},fields:{action:{type:"combo",title:"jPath"},url:{type:"text",title:"Variable name"}}},structure:{options:{type:"list",multiple:!0,title:"Response structure"},fields:{action:{type:"jscode",title:"JSON"}}}}}}},webcron:{options:{title:"Webservice crontab",icon:"world_go"},groups:{general:{options:{type:"table",multiple:!0},fields:{cronurl:{type:"text",title:"Cron URL"},crontime:{type:"float",title:"Repetition (s)"},cronvariable:{type:"text",title:"Target variable"}}}}},script_cron:{options:{title:"Script execution",icon:"scripts"},sections:{script_el:{options:{multiple:!0,title:"Script element"},groups:{general:{options:{type:"list",multiple:!0},fields:{crontime:{type:"float",title:"Repetition (s)"},script:{type:"jscode",title:"Javascript to execute"}}}}}}},init_script:{options:{title:"Initialization script",icon:"scripts"},groups:{general:{options:{type:"list",multiple:!0},fields:{script:{type:"jscode",title:"Javascript to execute"}}}}},couch_replication:{options:{title:"Couch replication",icon:"scripts"},groups:{couch:{options:{type:"table",multiple:!0},fields:{pouchname:{type:"text",title:"Pouch DB name"},couchurl:{type:"text",title:"Couch URL"},direction:{type:"combo",title:"Direction",options:[{key:"PtoC",title:"Pouch -> Couch"},{key:"CtoP",title:"Couch -> Pouch"},{key:"both",title:"Both ways"}],"default":"both"},continuous:{type:"checkbox",title:"Continuous replication",options:{continuous:"Continuous"}}}}}}}}),e.onStructureLoaded().done(function(){e.fill({sections:{cfg:[{groups:{tablevars:[b.variables],pouchvars:[b.pouchvariables]}}],actionscripts:[{sections:{actions:ActionManager.getScriptsForm()}}],init_script:b.init_script,actionfiles:ActionManager.getFilesForm(),webcron:[{groups:{general:[b.crons||[]]}}],script_cron:b.script_crons,couch_replication:b.couch_replication}})}),e.addButton("Cancel",{color:"blue"},function(){c.dialog("close")}),e.addButton("Save",{color:"green"},function(){c.dialog("close");var a,d,f=e.getValue();a=new DataArray(f.sections.cfg[0].groups.tablevars[0],!0),d=new DataObject(f.sections.webcron[0].groups.general[0],!0),b.variables=a,b.crons=d,b.couch_replication=f.sections.couch_replication,b.init_script=f.sections.init_script;var a=new DataArray(f.sections.cfg[0].groups.pouchvars[0]);b.pouchvariables=a,_check(!0);var a=f.sections.actionscripts[0].sections.actions;ActionManager.setScriptsFromForm(a);var a=f.sections.actionfiles;ActionManager.setFilesFromForm(a),"undefined"!=typeof CronManager&&CronManager.setCronsFromForm(a,b)}),e.onLoaded().done(function(){c.html(e.makeDom()),e.inDom()})})}var _viewLoaded,_dataLoaded,RepositoryData=new Repository,RepositoryHighlight=new Repository,RepositoryActions=new Repository;return API.setRepositoryData(RepositoryData),API.setRepositoryHighlights(RepositoryHighlight),API.setRepositoryActions(RepositoryActions),{init:function(a,b){function c(c){if(c)return void $("#ci-visualizer").append('<div id="browser-compatibility">'+c+"</div>");var e=a.config||$("#ci-visualizer").attr("config")||"usr/config/default.json";$.getJSON(e,{},function(a){a.usrDir&&require.config({paths:{usr:a.usrDir}}),!d&&a.debugLevel&&Debug.setDebugLevel(a.debugLevel),(a.lockView||a.viewLock)&&API.viewLock(),a.header&&Header.init(a.header),a.modules&&ModuleFactory.setModules(a.modules),a.contextMenu&&API.setContextMenu(a.contextMenu),API.setAllFilters(a.filters||[])}).fail(function(a,b){console.error("Error loading the config : "+b)}).always(function(){require(["usr/datastructures/filelist"],function(){Context.init(document.getElementById("modules-grid")),API.isViewLocked()||(Context.listen(Context.getRootDom(),[['<li class="ci-item-configureentrypoint"><a><span class="ui-icon ui-icon-key"></span>Global preferences</a></li>',function(){configureEntryPoint()}]]),Context.listen(Context.getRootDom(),[['<li class="ci-item-refresh" name="refresh"><a><span class="ui-icon ui-icon-arrowrefresh-1-s"></span>Refresh page</a></li>',function(){document.location.reload()}]])),Versioning.setViewLoadCallback(doView),Versioning.setDataLoadCallback(doData),Versioning.setViewJSON({}),Versioning.setDataJSON({}),Versioning.setURLType(b);var c=$("#ci-visualizer"),d={view:{urls:a.views,branch:a.viewBranch,url:a.viewURL||c.attr("viewURL")},data:{urls:a.results,branch:a.resultBranch,url:a.dataURL||c.attr("dataURL")}};window.history.replaceState({type:"viewchange",value:d},""),Versioning.switchView(d,!1)})})}var d;a.debug&&(Debug.setDebugLevel(parseInt(a.debug)),d=!0),browser.checkCompatibility().then(c)},getRepositoryData:function(){return RepositoryData},getRepositoryActions:function(){return RepositoryActions},getRepositoryHighlight:function(){return RepositoryHighlight}}}),function(a,b){"object"==typeof exports?module.exports=b(require("./URI")):"function"==typeof define&&define.amd?define("uri/URI.fragmentQuery",["./URI"],b):b(a.URI)}(this,function(a){var b=a.prototype,c=b.fragment;a.fragmentPrefix="?";var d=a._parts;return a._parts=function(){var b=d();return b.fragmentPrefix=a.fragmentPrefix,b},b.fragmentPrefix=function(a){return this._parts.fragmentPrefix=a,this},b.fragment=function(b,d){var e=this._parts.fragmentPrefix,f=this._parts.fragment||"";return b===!0?f.substring(0,e.length)!==e?{}:a.parseQuery(f.substring(e.length)):void 0!==b&&"string"!=typeof b?(this._parts.fragment=e+a.buildQuery(b),this.build(!d),this):c.call(this,b,d)},b.addFragment=function(b,c,d){var e=this._parts.fragmentPrefix,f=a.parseQuery((this._parts.fragment||"").substring(e.length));return a.addQuery(f,b,c),this._parts.fragment=e+a.buildQuery(f),"string"!=typeof b&&(d=c),this.build(!d),this},b.removeFragment=function(b,c,d){var e=this._parts.fragmentPrefix,f=a.parseQuery((this._parts.fragment||"").substring(e.length));return a.removeQuery(f,b,c),this._parts.fragment=e+a.buildQuery(f),"string"!=typeof b&&(d=c),this.build(!d),this},b.addHash=b.addFragment,b.removeHash=b.removeFragment,a}),requirejs.config({waitSeconds:0,paths:{ace:"components/ace/lib/ace",d3:"components/d3/d3.min",fancytree:"components/fancytree/dist/jquery.fancytree-all",jqgrid:"components/jqgrid_edit/js/jquery.jqGrid",jquery:"components/jquery/jquery.min",jqueryui:"components/jquery-ui/ui/minified/jquery-ui.min",ckeditor:"components/ckeditor/ckeditor",threejs:"components/three.js/build/three.min",forms:"lib/forms",plot:"lib/plot/plot",ChemDoodle:"lib/chemdoodle/ChemDoodleWeb-unpacked",pouchdb:"components/pouchdb/dist/pouchdb-nightly.min",uri:"components/uri.js/src",underscore:"components/underscore/underscore",lodash:"components/lodash/dist/lodash.min",leaflet:"components/leaflet/dist/leaflet",modernizr:"components/modernizr/modernizr",bowser:"components/bowser/bowser.min","jquery-cookie":"components/jquery-cookie/jquery.cookie",chemcalc:"components/chemcalc/lib"},shim:{d3:{exports:"d3"},threejs:{exports:"THREE"},"components/x2js/xml2json.min":{exports:"X2JS"},leaflet:{exports:"L",init:function(){return this.L.noConflict()}},"components/jit/Jit/jit":{exports:"$jit"},ckeditor:{exports:"CKEDITOR"},modernizr:{exports:"Modernizr"},"jquery-cookie":"jquery","components/three.js/examples/js/controls/TrackballControls":["threejs"],jqgrid:["jquery","components/jqgrid_edit/js/i18n/grid.locale-en"],"libs/jsmol/js/JSmolApplet":["libs/jsmol/JSmol.min.nojq"],"lib/flot/jquery.flot.pie":["jquery","lib/flot/jquery.flot"],jqueryui:["jquery"],ChemDoodle:["lib/chemdoodle/ChemDoodleWeb-libs"],"components/farbtastic/src/farbtastic":["components/jquery/jquery-migrate.min"],"lib/pixastic/pixastic":["lib/pixastic/pixastic/pixastic.core"],"lib/biojs-1.0/src/main/javascript/Biojs.FeatureViewer.js":["lib/biojs-1.0/src/main/javascript/Biojs.js"],"lib/biojs-1.0/src/main/javascript/Biojs.DasProteinFeatureViewer.js":["lib/biojs-1.0/src/main/javascript/Biojs.js","lib/biojs-1.0/src/main/javascript/Biojs.FeatureViewer.js"]}}),require(["jquery","src/main/datas","src/main/entrypoint","uri/URI.fragmentQuery"],function(a,b,c,d){a(document).ready(function(){var a=new d(window.location.href),b=a.search().length>0?"search":"?"===a.fragment()[0]?"fragment":"search",e=new d(a[b]()).query(!0);c.init(e,b.replace(b[0],b[0].toUpperCase()))})}),define("init",function(){});
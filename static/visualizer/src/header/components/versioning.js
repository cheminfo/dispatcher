define(["jquery","src/header/components/default","src/util/versioning","forms/button","src/util/util"],function(a,b,c,d,e){function f(){for(var b=["view","data"],f=0;f<b.length;f++)!function(f){var h=0==f?c.getView():c.getData(),i=0==f?c.getViewHandler():c.getDataHandler();g[b[f]].copyToLocal=new d("Copy to local",function(){i.serverCopy(h)},{color:"red"}),g[b[f]].snapshotLocal=new d("Snapshot",function(){i.localSnapshot(h)},{color:"blue"}),g[b[f]].autosaveLocal=new d("Autosave",function(a,b,c){i.localAutosave(b,function(){return h},function(){c.children().find("span").remove();var a=new Date;a=e.pad(a.getHours())+":"+e.pad(a.getMinutes()),c.children().append("<span> ("+a+")</span>")})},{checkbox:!0,color:"blue"}),g[b[f]].branchLocal=new d("Make branch",function(){require(["forms/formfactory","jquery-ui","forms/button"],function(b,c,d){var e=a("<div></div>").dialog({modal:!0,width:"80%",title:"Make brach"});e.parent().css("zIndex",1e4),b.newform(e,{sections:{cfg:{config:{multiple:!1,title:"Branch name"},groups:{general:{config:{type:"list"},fields:[{type:"Text",name:"name",multiple:!1,title:"Name"}]}}}}},function(a){var b=new d("Save",function(){a.dom.trigger("stopEditing");var b=a.getValue();i.localBranch(h,b.cfg[0].general[0].name[0]),a.getDom().dialog("close")});b.setColor("blue"),a.addButtonZone(b)})})},{color:"blue"}),g[b[f]].revertLocal=new d("Revert head",function(){i.localRevert(h)},{color:"blue"}),g[b[f]].localToServer=new d("Push to server",function(a,b,c){i.serverPush(h).done(function(){c.children().find("span").remove();var a=new Date;a=e.pad(a.getHours())+":"+e.pad(a.getMinutes()),c.children().append("<span> ("+a+")</span>")})},{color:"green"})}(f);return g}var g={view:{},data:{}},h=function(){};return a.extend(h.prototype,b,{getReady:function(){if(this.$_elToOpen)return this.$_elToOpen;this.$_elToOpen=a("<div />").attr("id","visualizer-dataviews"),this._ready=!0,f(),$dom=this.$_elToOpen,$dom.append("<h1>Data</h1>"),$dom.append(g.data.copyToLocal.render()),$dom.append(g.data.localToServer.render()),$dom.append(g.data.snapshotLocal.render()),$dom.append(g.data.autosaveLocal.render()),$dom.append(g.data.branchLocal.render()),$dom.append(g.data.revertLocal.render());var b=a('<div class="ci-dataview-path"><label>Data path : </label></div>');$dom.append(b);var d=a("<div />").appendTo(b);d.append(c.getDataHandler().getDom()),$dom.append("<br /><br />"),$dom.append("<h1>View</h1>"),$dom.append(g.view.copyToLocal.render()),$dom.append(g.view.localToServer.render()),$dom.append(g.view.snapshotLocal.render()),$dom.append(g.view.autosaveLocal.render()),$dom.append(g.view.branchLocal.render()),$dom.append(g.view.revertLocal.render());var b=a('<div class="ci-dataview-path"><label>View path : </label></div>');$dom.append(b);var d=a("<div />").appendTo(b);d.append(c.getViewHandler().getDom()),this._versionDiv=$dom,c.getViewHandler().updateButtons=this.updateButtons,c.getViewHandler().doUpdateButtons(),c.getDataHandler().updateButtons=this.updateButtons,c.getDataHandler().doUpdateButtons()},updateButtons:function(a,b,c){g[a].autosaveLocal&&("head"!==b||"local"!==c?g[a].autosaveLocal.disable():g[a].autosaveLocal.enable(),"local"==c?(g[a].copyToLocal.disable(),g[a].snapshotLocal.enable(),g[a].branchLocal.enable(),"head"==b?g[a].revertLocal.disable():g[a].revertLocal.enable()):(g[a].copyToLocal.enable(),g[a].snapshotLocal.disable(),g[a].branchLocal.disable(),g[a].revertLocal.disable()))},_onClick:function(){this.getReady();this.setStyleOpen(this._open),this._open?this.open():this.close()}}),h});
define(["modules/default/defaultview","src/util/util","ckeditor","lodash","src/util/typerenderer","src/main/grid","chroma"],function(a,b,c,d,e,f,g){function h(){this._id=b.getNextUniqueId()}return h.prototype=$.extend(!0,{},a,{init:function(){},inDom:function(){this.initEditor(),this.resolveReady()},update:{html:function(a){this.module.data=a,this.module.definition.richtext=a.get(),this.updateEditor(a.get())}},initEditor:function(){var a=this,b=this.module.definition.richtext||"";if(this.module.getConfigurationCheckbox("editable","isEditable"))this.dom=$(' <div id="'+this._id+'" contenteditable="true">'),this.dom.html(b),this.module.getDomContent().html(this.dom),this._setCss(),this.module.controller.valueChanged(b);else{var d=e.toScreen({type:"html",value:b},this.module);d.always(function(){a.dom=$('<div id="'+this._id+'">'),a.dom.html(b),a.module.getDomContent().html(a.dom),a._setCss()})}c.instances[this._id]&&c.instances[this._id].destroy(),this.module.getConfigurationCheckbox("editable","isEditable")&&(c.disableAutoInline=!0,this.instance=c.inline(this._id,{extraPlugins:"mathjax,font,sourcedialog,codesnippet",removeButtons:""}),this.instance.on("change",function(){a.module.controller.valueChanged(a.instance.getData()),a.module.getConfigurationCheckbox("autoHeight","yes")&&(a.module.getDomWrapper().height(a.getContentHeight()+50),f.moduleResize(a.module))}))},updateEditor:function(a){this.instance.setData(a)},getContentHeight:function(){var a=0;return this.dom.children().each(function(){a+=$(this).height()}),a},_setCss:function(){var a=this.module.getConfiguration("bgColor");if(this.dom.css({height:"100%",width:"100%",padding:"5px",boxSizing:"border-box"}),this.module.getConfigurationCheckbox("postit","yes")){var c=g(a[0],a[1],a[2]);this.dom.addClass("richtext-postit"),this.dom.parents(".ci-module-wrapper").addClass("ci-module-richtext-postit"),this.dom.css({background:b.getCssVendorPrefix()+"radial-gradient(center, ellipse cover, "+c.brighter().hex()+" 0%, "+c.hex()+" 100%)"})}else this.dom.css({background:""}),this.dom.css({"background-color":"rgba("+a.join(",")+")"}),this.dom.removeClass("richtext-postit"),this.dom.parents(".ci-module-wrapper").removeClass("ci-module-richtext-postit")}}),h});
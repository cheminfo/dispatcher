define(["modules/default/defaultview","src/util/datatraversing","src/util/api","src/util/typerenderer","lib/formcreator/formcreator"],function(Default,Traversing,API,Renderer,FormCreator){function view(){}return view.prototype=$.extend(!0,{},Default,{init:function(){this.dom=$("<div>").css({}),this.module.getDomContent().html(this.dom),this.variables={},this.cfgValue={};for(var self=this,filters=this.module.getConfiguration("filters"),script=this.module.getConfiguration("script"),varsoutCfg=this.module.definition.vars_out||[],varsout=[],i=0,l=filters.length,j=0,k=varsoutCfg.length,cfg={sections:{cfg:{groups:{cfg:{options:{type:"list"},fields:FormCreator.makeStructure(filters)}}}}};k>j;j++)varsout.push(varsoutCfg[j].name);var form=FormCreator.makeForm();form.init({onValueChanged:function(){var a=form.getValue().sections.cfg[0].groups.cfg[0],b={};for(var c in a)b[c]=a[c][0];$.extend(self.cfgValue,b),self.filter()}}),form.setStructure(cfg),form.onStructureLoaded().done(function(){form.fill({})}),form.onLoaded().done(function(){self.dom.html(form.makeDom(2)),form.inDom()}),this._filter=function(API,_cfg,_varsIn,_varsOut,script){function getVar(a){return"undefined"!=typeof _varsIn[a]?_varsIn[a]:(console.warn(" Variable "+a+" does not exist. Returning null "),null)}function setVar(a,b){return _varsOut.indexOf(a)>-1?void(_varsToSet[a]=b):void console.warn(" Variable "+a+" has not been selected for variable out")}function getConfig(){return _cfg}function _doSetVars(){var a;for(a in _varsToSet)API.setVar(a,_varsToSet[a])}var _varsToSet=[];return eval("var f = function() { \n"+script+"\n  _doSetVars(); \n }"),f}(API,this.cfgValue,this.variables,varsout,script),this.resolveReady()},blank:{value:function(){this.dom.empty()}},filter:function(){this._filter()},update:{variable:function(a,b){a=Traversing.get(a),this.variables[b]=a,this.filter()}},typeToScreen:{}}),view});
define(["modules/default/defaultcontroller","lib/json-schema/schema"],function(a,b){function c(){}return c.prototype=$.extend(!0,{},a),c.prototype.moduleInformation={moduleName:"Alpaca",description:"Create a form base on a schema and output an object",author:"Daniel Kostro",date:"04.11.2014",license:"MIT",cssClass:"alpaca"},c.prototype.initImpl=function(){this.inputSchema={},this.resolveReady()},c.prototype.references={inputValue:{label:"Input object"},outputValue:{label:"Output object"},schema:{label:"JSON schema"},options:{label:"Alpaca options"}},c.prototype.events={onFormSubmit:{label:"The form was submitted",refVariable:["outputValue"],refAction:["outputValue"]}},c.prototype.variablesIn=["inputValue","schema","options"],c.prototype.actionsIn={},c.prototype.configurationStructure=function(){return{groups:{group:{options:{type:"list"},fields:{hasButton:{type:"checkbox",title:"Show export button","default":["show"],options:{show:"Show"}},button_text:{type:"text",title:"Text of the export button","default":"Export"},debouncing:{type:"float",title:"Debouncing","default":-1},sendOnLoad:{type:"checkbox",title:"Send on load",options:{yes:"Yes"},"default":[]},output:{type:"combo",title:"Output result",options:[{title:"Modified input object",key:"modified"},{title:"New object",key:"new"}],"default":"new"},mode:{type:"combo",title:"Form generation",options:[{title:"Input object",key:"object"},{title:"Schema",key:"schema"},{title:"Both",key:"both"}],"default":"object",displaySource:{object:"o",schema:"s",both:"b"}},schemaSource:{type:"combo",title:"Schema source",options:[{title:"Input variable",key:"variable"},{title:"Config",key:"config"}],displayTarget:["s","b"],displaySource:{config:"c"},"default":"config"},optionsSource:{type:"combo",title:"Options source",options:[{title:"Input variable",key:"variable"},{title:"Config",key:"config"}],displaySource:{config:"co"},"default":"config"},schema:{type:"jscode",mode:"json",title:"JSON schema","default":"{}",displayTarget:["c"]},options:{type:"jscode",mode:"json",title:"Alpaca form options","default":"{}",displayTarget:["co"]}}}}}},c.prototype.configAliases={output:["groups","group",0,"output",0],mode:["groups","group",0,"mode",0],sendOnChange:["groups","group",0,"sendOnChange",0],sendOnLoad:["groups","group",0,"sendOnLoad",0],schemaSource:["groups","group",0,"schemaSource",0],optionsSource:["groups","group",0,"optionsSource",0],schema:["groups","group",0,"schema",0],button_text:["groups","group",0,"button_text",0],hasButton:["groups","group",0,"hasButton",0],debouncing:["groups","group",0,"debouncing",0],options:["groups","group",0,"options",0]},c.prototype.getSchema=function(){var a=this.module.getConfiguration("mode"),c={};if(("object"===a||"both"===a)&&this.module.view.inputObj&&(c=b.fromObject(this.module.view.inputObj)),"schema"===a||"both"===a){var d,e=this.module.getConfiguration("schemaSource");d="variable"===e?this.inputSchema:JSON.parse(this.module.getConfiguration("schema")),$.extend(!0,c,d)}return c},c.prototype.getOptions=function(){var a,b=this.module.getConfiguration("optionsSource");return a="variable"===b?this.inputOptions:JSON.parse(this.module.getConfiguration("options")),a||{}},c.prototype.onSubmit=function(a){var b=this.module.getConfiguration("output");"new"===b?(this.createDataFromEvent("onFormSubmit","outputValue",a),this.sendAction("outputValue",a,"onFormSubmit")):this.module.view.inputObj&&this.module.view.inputObj.mergeWith(a,this.module.getId())},c});
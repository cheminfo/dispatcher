define(["modules/default/defaultview","src/util/api","src/util/util","src/util/datatraversing","src/util/typerenderer","ChemDoodle"],function(a,b,c,d,e){function f(){}return f.prototype=$.extend(!0,{},a,{init:function(){this._id=c.getNextUniqueId(),this.module.getDomContent().html(this.dom),this._highlighted={},this.typeToScreen.molfile2D=this.typeToScreen.mol2d,this.resolveReady()},inDom:function(){},onResize:function(){this._height=this.height-20,this._width=this.width-20,this.def&&this.def.canvas&&this.def.canvas.resize(this._width,this._height),this.drawMolecule()},blank:{mol2d:function(){var a=this;b.killHighlight(this.module.getId()),a.module.getDomContent().empty()}},update:{mol2d:function(a,c){if(a&&a.get()){b.killHighlight(this.module.getId()),this._lastMol=a;{var f=this;d.getType(a)}this.def=e.toScreen(a,this.module,this._id),this.def.always(function(b){if(f.module.getDomContent().empty(),f.module.getDomContent().html(b),f.def.build){f.def.build(),f._molecule=f.def.canvas;var d=f._molecule.molecule.atoms;if(c&&f._atomLabels)for(var e=0,g=f._atomLabels.length;g>e;e++)d[e]&&(d[e].altLabel=""==f._atomLabels[e]?null:f._atomLabels[e]||null);else f._atomLabels=!1;f.def.canvas.CIOnMouseMove(function(b){var c,d=(f.def.canvas.specs.atoms_font_size_2D,b.offsetX),e=b.offsetY;if(a._atoms&&a._highlight){d-=this.width/2,d/=this.specs.scale,d+=this.width/2,e-=this.height/2,e/=this.specs.scale,e+=this.height/2;for(var g=0,h=f.def.molecule.atoms.length;h>g;g++)if(f.def.molecule.atoms[g].textBounds&&f.def.molecule.atoms[g].textBounds.length>0){inside=!1;for(var i=0,j=f.def.molecule.atoms[g].textBounds.length;j>i;i++)if(c=f.def.molecule.atoms[g].textBounds[i],c.x<d&&c.x+c.w>d&&c.y<e&&c.y+c.h>e){f._doHighlight(g,!0),inside=!0;break}inside||f._doHighlight(g,!1)}else{var k=d-f.def.molecule.atoms[g].x,l=e-f.def.molecule.atoms[g].y;Math.pow(Math.pow(k,2)+Math.pow(l,2),.5)<this.specs.atoms_font_size_2D?f._doHighlight(g,!0):f._doHighlight(g,!1)}}})}})}},atomLabels:function(a){this._atomLabels=a,this._lastMol&&this.update.mol2d.call(this,this._lastMol,!0)}},drawMolecule:function(){!(this._width&&this._height&&this.def&&this.def.molecule&&this.def.canvas)},getDom:function(){return this.dom},_doHighlight:function(a,c){if(!(this._highlighted[a]&&c||!this._highlighted[a]&&!c)){this._highlighted[a]=c;for(var d in this._lastMol._atoms)this._lastMol._atoms[d].indexOf(a)>-1&&b.highlight(d,c)}},typeToScreen:{mol2d:function(a,c){var d=this;if(this._canvas){var e=ChemDoodle.readMOL(c.value);e.scaleToAverageBondLength(30),a.resolve(e),d._currentValue=c,e._highlights=e._highlights||{},b.killHighlight(this.module.getId()),b.listenHighlight(c._highlight,function(a,b){var f=d._canvas,g={};e._highlights=e._highlights||{};for(var h=b.length-1;h>=0;h--)if(g=c._atoms[b[h]])for(var i=g.length-1;i>=0;i--)e.atoms[g[i]].isHover=a;f._domcanvas.width=f._domcanvas.width;for(var h=0;h<e.atoms.length;h++)e.atoms[h].drawChildExtras=!0;f.repaint()},!0,this.module.getId())}}}}),f});
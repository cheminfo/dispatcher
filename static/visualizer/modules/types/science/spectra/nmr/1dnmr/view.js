define(["modules/default/defaultview","lib/plot/plot","src/util/datatraversing","src/util/jcampconverter"],function(a,b,c,d){function e(){}return e.prototype=$.extend(!0,{},a,{init:function(){var a=[];a.push('<div class="2drmn"></div>'),this.integrals=[],this.dom=$(a.join("")),this.module.getDomContent().html(this.dom),this.resolveReady()},redrawIntegrals:function(){if("undefined"!=typeof this.currentMaxSumAnnot)for(var a=0,b=this.integrals.length;b>a;a++)this.integrals[a].setScale(this._instance.getDrawingHeight()-100,this.currentMaxSumAnnot.lastSum),this.integrals[a].redraw()},inDom:function(){var a=this;this._instance=new b(this.dom.get(0),{plugins:["zoom","nmrintegral"],zoomMode:"x",keyCombinations:{zoom:{shift:!1,ctrl:!1},nmrintegral:{shift:!0,ctrl:!1}},onAnnotationMake:function(b,c){a.currentMaxSumAnnot||(a.currentMaxSumAnnot=c),a.integrals.push(c),a.redrawIntegrals()},onAnnotationChange:function(b,c){(!a.currentMaxSumAnnot||a.currentMaxSumAnnot==c||a.currentMaxSumAnnot!=c&&c.lastSum>a.currentMaxSumAnnot.lastSum)&&(a.currentMaxSumAnnot=c,a.redrawIntegrals())}},{bottom:[{primaryGrid:!1,secondaryGrid:!1,flipped:!0}],left:[{primaryGrid:!1,secondaryGrid:!1,display:!1}]}),this.series={},this._instance.getLeftAxis(0,{flipped:!0}).setLabel("ppm")},onResize:function(){this._instance.resize(this.width-20,this.height-20)},update:{jcamp:function(a,b){var c=this;this._instance&&(this.deferred&&this.deferred.reject(),this.deferred=d(a.get(),{lowRes:1024}).done(function(a){c.series[b]=[],a=a.spectra;for(var d=0,e=a.length;e>d;d++){serie=c._instance.newSerie(b,{trackMouse:!0});var f=a[d].data[a[d].data.length-1];serie.setData(f),serie.autoAxis(),c.series[b].push(serie),c.redraw();break}}))}},redraw:function(){this._instance.redraw(),this._instance.drawSeries()}}),e});
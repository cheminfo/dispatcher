define(["modules/default/defaultview","lib/plot/plot","src/util/datatraversing","src/util/jcampconverter"],function(a,b,c,d){function e(){}return e.prototype=$.extend(!0,{},a,{init:function(){var a=[];a.push('<div class="2drmn"></div>'),this.namedSeries={},this.dom=$(a.join("")),this.module.getDomContent().html(this.dom),this.resolveReady()},inDom:function(){var a=new b(this.dom.get(0),{});this._instance=a,a.resetAxis(),a.resetSeries(),a.setOption("zoomMode","xy"),a.setOption("defaultWheelAction","toSeries"),a.setOption("defaultMouseAction","zoomXY"),a.setOption("shiftMouseAction","drag"),a.getTopAxis(0,{flipped:!0}).setLabel("Blahppm"),a.getLeftAxis(0,{flipped:!1}).setLabel("ppm")},onResize:function(){this._instance.resize(this.width-20,this.height-20)},update:{jcampx:function(a){this._instance&&(this.addSerieJcampXOrY(a,!0),this.redraw())},jcampy:function(a){this._instance&&(this.addSerieJcampXOrY(a,!1),this.redraw())},jcampxy:function(a){this._instance&&(value=d(c.getValueIfNeeded(a),{lowres:1024}),this.addSerieXOrY(value,!0),this.addSerieXOrY(value,!1),this.redraw())},jcamp2d:function(a){if(this._instance){var b=d(c.getValueIfNeeded(a));if(b.contourLines){var e=this._instance;e.resetSeries();var f=e.newSerie("2d"+Date.now(),{},"contour");f.setData(b.contourLines),f.setXAxis(e.getTopAxis()),f.setYAxis(e.getLeftAxis()),this.redraw()}}},annotations:function(a){a=DataTraversing.getValueIfNeeded(a),console.log(a),a&&(this.annotations=a,this.resetAnnotations(!0))}},addSerieJcampXOrY:function(a,b){a=c.getValueIfNeeded(a),spectra=d(a,{lowres:1024}),this.addSerieXOrY(spectra,b)},addSerieXOrY:function(a,b){var c=this._instance,d=b?c.getTopAxis():c.getLeftAxis();d.killSeries(!0),a=a.spectra;for(var e=0,f=a.length;f>e;e++){serie=d.addSerie((b?"x":"y")+Date.now(),{trackMouse:!1,trackMouseLabel:"<x>",trackMouseLabelRouding:3,zoomMode:b?"x":"y"}),serie.setData(a[e].data[a[e].data.length-1]),b||serie.setFlip(!0);break}},redraw:function(){this._instance.redraw(),this._instance.drawSeries()}}),e});
define(["modules/default/defaultview","src/util/datatraversing","./gcms","src/util/util","src/util/api"],function(a,b,c,d,e){function f(){}return f.prototype=$.extend(!0,{},a,{init:function(){var a=[];a.push('<div class="gcms"><div class="gc"></div><div class="ms"></div></div>'),this.namedSeries={},this.dom=$(a.join("")),this.module.getDomContent().html(this.dom),this.resolveReady()},unload:function(){this.gcmsInstance.unload(),this.dom.remove()},inDom:function(){var a=this,b=new c;b.setMSContinuous(this.module.getConfiguration("continuous")),b.inDom(this.dom.find(".gc").get(0),this.dom.find(".ms").get(0)),b.onAnnotationChange=function(b){switch(b.type){case"verticalLine":break;case"surfaceUnderCurve":a.module.controller.sendAction("GCIntegration",b,"onGCIntegralChange")}b&&b.triggerChange(a.module.getId())},b.onAnnotationMake=function(b){switch(b.type){case"verticalLine":b._msIon&&a.module.controller.sendAction("MSIon",b._msIon,"onMSTrackingAdded");break;case"surfaceUnderCurve":a.module.controller.sendAction("GCIntegration",b,"onGCIntegralAdd")}},b.onAnnotationRemove=function(b){switch(b.type){case"verticalLine":break;case"surfaceUnderCurve":a.module.controller.sendAction("GCIntegration",b,"onGCIntegralRemove")}},b.onMSSelect=function(b){a.module.controller.createDataFromEvent("onGCIntegralSelect","MSTrace",new DataArray(b))},b.onIntegralSelect=function(b){a.module.controller.createDataFromEvent("onGCIntegralSelect","GCIntegration",b)},b.onZoomGC=function(b,c){a.module.controller.sendAction("fromtoGC",new DataObject({type:"fromTo",value:new DataObject({from:b,to:c})}),"onZoomGCChange")},b.onZoomMS=function(b,c){a.module.controller.sendAction("fromtoMS",new DataObject({type:"fromTo",value:new DataObject({from:b,to:c})}),"onZoomMSChange")},b.msIonAdded=function(){},this.gcmsInstance=b},unload:function(){this.dom.remove(),this.gcmsInstance=!1},onResize:function(){this.gcmsInstance.resize(this.width,this.height)},blank:{jcamp:function(){this.gcmsInstance.blank()}},update:{jcamp:function(a){var b=this;a&&(a=a.get(),require(["src/util/jcampconverter"],function(c){c(a).done(function(a){a.gcms&&(b.gcmsInstance.setGC(a.gcms.gc),b.gcmsInstance.setMS(a.gcms.ms),b.module.controller.createDataFromEvent("onJCampParsed","msdata",a.gcms.ms),b.module.controller.createDataFromEvent("onJCampParsed","gcdata",a.gcms.gc),b.resetAnnotationsGC())})}))},annotationgc:function(a){a&&(this.annotations=a.get(),this.resetAnnotationsGC())},gcms:function(a){this.gcmsInstance.setGC(a.gc),this.gcmsInstance.setMS(a.ms),this.resetAnnotationsGC()},gc:function(a){var b=this;if(this.gcmsInstance&&a){tojcamp(a.get()).done(function(a){a.spectra&&b.gcmsInstance.setExternalGC(a.spectra[0].data[0])})}},ms:function(a,b,c){var d=this;this.gcmsInstance&&a&&require(["src/util/jcampconverter"],function(b){b(a.get()).done(function(a){a.spectra&&d.gcmsInstance.setExternalMS(a.spectra[0].data[0],c)})})},mscont:function(a,b){this.update.ms(a,b,!0)}},getDom:function(){return this.dom},resetAnnotationsGC:function(){if(this.gcmsInstance&&this.annotations){if(this.shapes)for(var a=0,b=this.shapes.length;b>a;a++)this.shapes[a].kill();this.shapes=[];for(var a=0,b=this.annotations.length;b>a;a++)this.shapes.push(this.doAnnotation(this.annotations[a]))}},onActionReceive:{fromtoGC:function(a){this.gcmsInstance.getGC().getBottomAxis()._doZoomVal(a.value.from,a.value.to,!0)},fromtoMS:function(a){this.gcmsInstance.getMS().getBottomAxis()._doZoomVal(a.value.from,a.value.to,!0)},zoomOnAnnotation:function(a){(a.pos||a.pos2)&&this.gcmsInstance.zoomOn(a.pos.x,a.pos2.x,a._max||!1)},displayChemicalLabels:function(){for(var a=0,b=this.shapes.length;b>a;a++)this.shapes[a].toggleLabel(1,!0)},hideChemicalLabels:function(){for(var a=0,b=this.shapes.length;b>a;a++)this.shapes[a].toggleLabel(1,!1)}},doAnnotation:function(a){var b=this,c=this.gcmsInstance.getGC().makeShape(a,{},!1);return c.setSelectable(!0),a.onChange(function(){c.draw(),c.redraw()},b.module.getId()),e.killHighlight(this.module.getId()),e.listenHighlight(a,function(a){a?c.highlight():c.unHighlight()},!1,this.module.getId()),c.draw(),c.redraw(),c}}),f});
define(["modules/default/defaultview","src/util/util","src/util/datatraversing","src/util/context","lib/d3/d3.parcoords"],function(a,b,c,d,e){function f(){this._id=b.getNextUniqueId(),this._value=new DataArray,this._addedColumns={},this._currentColumns={},this._previousColumns=[]}return b.loadCss("lib/d3/d3.parcoords.css"),f.prototype=$.extend(!0,{},a,{init:function(){var a=this,b='<div class="parcoords" id="'+this._id+'"></div>';this.dom=$(b).css({height:"100%",width:"100%"}),d.listen(this.dom[0],[['<li><a><span class="ui-icon ui-icon-refresh"></span>Reset selection</a></li>',function(){a.resetBrush()}]]),this.jpathConfig=$.extend(!0,[],this.module.getConfiguration("colsjPaths")),this.module.getDomContent().html(this.dom)},blank:{value:function(){this.dom.empty()}},update:{value:function(a){a&&(a=a.get(),a.length&&(this._value=a,this.redrawChart()))},columns:function(a){if(a instanceof Array){var b;for(b=0;b<this._previousColumns.length;b++)delete this._currentColumns[this._previousColumns[b].name];for(b=0;b<a.length;b++)this._currentColumns[a[b].name]=a[b];this._previousColumns=a,this.redrawChart()}}},onActionReceive:{addColumn:function(a){a&&a.name&&a.jpath&&(this._addedColumns[a.name]=a,this.redrawChart())},removeColumn:function(a){a&&a.name&&(delete this._addedColumns[a.name],this.redrawChart())}},inDom:function(){this.resolveReady()},onResize:function(){this.redrawChart()},redrawChart:function(){var a=this;if(this.createIntermediateData(),this.dom.empty(),this._data){var b=e.parcoords()("#"+this._id);b.data(this._data),b.detectDimensions(),this._names&&b.dimensions(this._names),b.color(function(a){return a.__color?a.__color:"#000"}),this._data.length>1e3&&(b.mode("queue"),b.rate(200)),b.render().brushable().reorderable(),b.on("brush",function(b){a.module.controller.onBrushSelection(b)}),this._parcoords=b,this.module.controller.onBrushSelection(this._data)}else this.dom.html("No column to display")},createIntermediateData:function(){var a=this.getColumns(),c=a.length,d=this.module.getConfiguration("colorjpath");d&&(d=b.makejPathFunction(d));var e=this._value,f=e.length;if(!c||!f)return void(this._data=[]);var g,h=new Array(f),i=new Array(c);for(g=0;c>g;g++)i[g]=a[g].name.toString();this._names=i;var j,k;for(g=0;f>g;g++){j={},k=e[g],h[g]=j;for(var l=0;c>l;l++){var m=a[l].jpath(k);j[a[l].name]=m?m.valueOf():m}d&&(j.__color=d(k)),j.__id=g}this._data=h},getColumns:function(){var a,c=[],d={},e=this.jpathConfig;if(e)for(a=0;a<e.length;a++)e[a].jpath&&(d[e[a].name]=$.extend(!0,{},e[a]));$.extend(d,this._currentColumns,this._addedColumns);for(a in d)c.push(d[a]);for(a=0;a<c.length;a++)"function"!=typeof c[a].jpath&&(c[a].jpath=b.makejPathFunction(c[a].jpath));return c},resetBrush:function(){this._parcoords&&(this._parcoords.brushReset(),this.module.controller.onBrushSelection(this._data))}}),f});
define(["modules/default/defaultview","src/util/util","lib/d3/d3.phylogram","src/util/api"],function(a,b,c,d){function e(){}return e.prototype=$.extend(!0,{},a,{init:function(){this._id=b.getNextUniqueId(),this.selectorId="#"+this._id,this.chart=null,this.currentHighlightId=null;var a=$("<div>",{id:this._id});a.css({display:"table",height:"90%",width:"85%",overflow:"hidden"}),this.dom=a,this.module.getDomContent().html(this.dom),this.resolveReady()},blank:function(){this.dom.empty()},getIdHash:function(a){if(a.id&&(this._idHash[a.id]=a),Array.isArray(a.children))for(var b=0;b<a.children.length;b++)this.getIdHash(a.children[b])},update:{tree:function(a){a&&(a=a.get(),this._idHash=[],this.getIdHash(a),d.killHighlight(this._id),this._data=a,this.drawPhylogram())}},drawPhylogram:function(a){if(this._data){var a=this._data,b=this;this.dom.empty();var e=!0;a.children&&a.children.length>0&&(e=void 0===a.children[0].length),c.phylogram.build(this.selectorId,a,{skipBranchLengthScaling:e,skipTicks:!1,skipLabels:!0,children:function(a){return a.children},callbackMouseOverLeaf:function(a){b.module.controller.mouseOverLeaf(a),d.highlight(a.data,1)},callbackMouseOutLeaf:function(a){b.module.controller.mouseOutLeaf(a),d.highlight(a.data,0)},callbackClickLeaf:function(a){b.module.controller.clickLeaf(a)},callbackMouseOverBranch:function(a){b.module.controller.mouseOverBranch(a.target)},callbackMouseOutBranch:function(a){b.module.controller.mouseOutBranch(a.target)},callbackClickBranch:function(a){b.module.controller.clickBranch(a.target)}});var f=c.selectAll(this.selectorId+" .leaf");f.each(function(a){!function(a,c){a.data&&a.data._highlight&&d.listenHighlight(a.data,function(a){var b=c.select("circle");b.attr("fill",function(b){return b.data&&b.data.$color?b.data.$color:a?"#f5f48d":"grey"}),b.attr("r",a?9:4.5)},!1,b._id)}(a,c.select(this))}),c.selectAll(this.selectorId+" .link").each(function(){c.select(this).attr("stroke-width",b.module.getConfiguration("branchWidth")+"px"||"5px")})}},onResize:function(){this.drawPhylogram()}}),e});
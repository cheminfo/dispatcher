define(["modules/default/defaultview","src/util/util","lib/loadingplot/libs/jquery.mousewheel.min","lib/loadingplot/svg","lib/loadingplot/point","lib/loadingplot/springs"],function(a,b){function c(){}return b.loadCss("lib/loadingplot/svg.css"),c.prototype=$.extend(!0,{},a,{init:function(){this.dom=$('<div class="ci-display-loading-plot"></div>'),this.module.getDomContent().html(this.dom),this.resolveReady()},onResize:function(){this._w=this.width-10,this._h=this.height-10,this._w&&this._h&&this._svg&&this._svg.setSize(this._w,this._h)},blank:function(){this.table=null},update:{preferences:function(a){if(this._lastConf=a,this._lastValue)for(var b in a)for(var c=0;c<this._lastValue.series.length;c++)if(this._lastValue.series[c].category==b)for(var d=0;d<this._lastValue.series[c].data.length;d++)this._instances[c][d].filter(a[b])},center:function(a){a&&this._svg.setCenter.apply(this._svg,a)},zoom:function(a){console.log(a),a&&this._svg.setZoom(a)},viewport:function(a){a&&this._svg.setViewBox.apply(this._svg,[!1].concat(a))},loading:function(a){var b=this;if(a&&a.value){this._highlights=[],this._svg&&(this._svg.remove(),this.dom.empty());var c=new LoadingPlot.SVG(null,null,null,null,this.module.getConfiguration("navigation")[0][0]||!1);c.onZoomChange(function(a){b.module.controller.onZoomChange(a),b.module.controller.onChangeViewport(c.getViewBox())}),c.onMove(function(a,d){b.module.controller.onMove(a,d),b.module.controller.onChangeViewport(c.getViewBox())}),this._svg=c,this._w&&this._h&&c.setSize(this._w,this._h);var d=a.value.minX||0,e=a.value.minY||0,f=(a.value.maxX||100)-d,g=(a.value.maxY||100)-e;c.setViewBoxWidth(d,e,f,g,!0),c.create(),c.bindTo(this.dom);var h=new LoadingPlot.SpringLabels(c);if(c.initZoom(),LoadingPlot.SVGElement.prototype.Springs=h,this._lastValue=a.value,this._instances=[],a.value&&a.value.series){for(var i=this.module.getConfiguration("layers"),j=0;j<i.length;j++){for(var k=i[j].groups.group[0],l=k.labels[0],m={},n=0;n<l.length;n++)m[l[n]]=!0;for(var o=k.el[0],p=k.type[0]||"ellipse",n=0;n<a.value.series.length;n++)if(a.value.series[n].category===o){for(var q=a.value.series[n].data,r=0,s=q.length;s>r;r++){if("pie"===p)var t=new LoadingPlot.Pie(c,q[r].x,q[r].y,q[r]);else if("ellipse"===p)var t=new LoadingPlot.Ellipse(c,q[r].x,q[r].y,q[r]);else if("img"===p)var t=new LoadingPlot.Image(c,q[r].x,q[r].y,q[r]);t.allowLabelDisplay(m.display_labels),k.labelsize[0]&&t.setLabelSize(k.labelsize[0]),t.forceField(m.forcefield),""!==k.labelzoomthreshold[0]&&t.setLabelDisplayThreshold(k.labelzoomthreshold[0]);var u=k.highlightmag[0]?k.highlightmag[0]:1,v=k.highlighteffect[0][0]?!0:!1;t.setHighlightMag(u),t.setHighlightEffect({mag:u,yStroke:v}),t.setLabelStroke(m.blackstroke),t.setLabelScale(m.scalelabel);{$.proxy(t.highlight,t)}t.hoverCallback=function(){b.module.controller.hover(this._data)},this._instances[n]=this._instances[n]||[],this._instances[n][r]=t,c.add(t)}break}}c.ready(),h.resolve(),this._lastConf&&this.update.preferences.call(this,this._lastConf)}}}},getDom:function(){return this.dom},typeToScreen:{}}),c});
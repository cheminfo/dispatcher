define(["modules/default/defaultview","src/util/typerenderer","src/util/api"],function(a,b,c){function d(){}return d.prototype=$.extend(!0,{},a,{init:function(){var a=[];a.push('<div class="ci-displaylist-list-2d"></div>'),this.dom=$(a.join("")),this.module.getDomContent().html(this.dom)},blank:{list:function(){c.killHighlight(this.module.getId()),this.dom.empty()}},inDom:function(){var a=this;this.module.getDomView().on("mouseenter mouseleave click","td",function(b){var d=$(this).index(),e=$(this).parent().index(),f=a.module.getConfiguration("colnumber",4)||4,g=e*f+d,h=a.list.get()[g];"mouseenter"===b.type?(a.module.controller.setVarFromEvent("onHover","cell","list",[g]),c.highlight(h,1)):"mouseleave"===b.type?c.highlight(h,0):"click"===b.type&&(a.module.controller.setVarFromEvent("onClick","cell","list",[g]),a.module.controller.sendAction("cell",h,"onClick"))}),this.resolveReady()},update:{list:function(a){if(this.defs=[],Array.isArray(a)){var b,c=this,d=$.proxy(this.module.getConfiguration,this.module),e=d("colnumber",4)||4,f="",g=this,h=a.get(),i=$('<table cellpadding="3" cellspacing="0">').css("text-align","center"),j=h.length,k=0,l=0;g.list=h,(d.width||d.height)&&(d.width&&(f+="width: "+Math.round(100/e)+"%; "),d.height&&(f+="height: "+d.height+"px; "));var m,n;for(this._inDom=!1;j>l;l++)b=this.renderElement(c.list.getChildSync([l]),e),n=k%e,0===n&&(m&&m.appendTo(i),m=$("<tr />")),k++,b.appendTo(m);for(m&&m.appendTo(i),c.dom.html(i),l=0,j=this.defs.length;j>l;l++)!function(a){g.defs[a].then(function(){g.defs[a].build&&g.defs[a].build()})}(l)}}},renderElement:function(a,d){var e=$.proxy(this.module.getConfiguration,this.module),f=e("colorjpath",!1),g=e("valjpath",""),h=$("<td>").css({width:Math.round(100/d)+"%",height:e.height});return f&&a.getChild(f,!0).then(function(a){h.css("background-color",a.get())}),this.defs.push(b.toScreen(a,this.module,{},g).always(function(a){h.html(a)})),c.listenHighlight(a,function(a){a?h.css("border-color","black"):h.css("border-color","")},!1,this.module.getId()),h},getDom:function(){return this.dom},typeToScreen:{}}),d});
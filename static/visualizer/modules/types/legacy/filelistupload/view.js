define(["modules/default/defaultview","src/util/datatraversing","src/util/api","src/util/util"],function(a,b,c,d){function e(){}return e.prototype=$.extend(!0,{},a,{init:function(){var a=this;this.dom=$('<ul class="ci-fileupload"></ul>'),this.module.getDomContent().html(this.dom);var b=this.dom.get(0);b.addEventListener("dragenter",function(b){b.stopPropagation(),b.preventDefault(),a.dom.addClass("ci-fileupload-over")}),b.addEventListener("dragover",function(a){a.stopPropagation(),a.preventDefault()}),b.addEventListener("dragleave",function(b){b.stopPropagation(),b.preventDefault(),a.dom.addClass("ci-fileupload-over")}),b.addEventListener("drop",function(b){b.stopPropagation(),b.preventDefault(),a.upload(b.dataTransfer.files)})},upload:function(a){this.queue=a,this.currentIndex=0,this.startUpload()},startUpload:function(){var a=this,b=new FormData,d=this.queue[this.currentIndex];if(d){b.append("file",d);var e=$(this.newLi(d.type,d.name,d.size,"<progress />")),f=new XMLHttpRequest;this.dom.append(e),f.addEventListener("readystatechange",function(){4==f.readyState&&(e.find("progress").replaceWith(d.type),200==f.status?(e.attr("href",f.responseText),a.currentVar.push({type:d.type,filename:d.name,filesize:d.size,link:f.responseText}),c.setVariable(a.varname,a.currentVarRoot,!0)):e.addClass("file-error"))}),f.open("POST",this.module.getConfiguration("fileuploadurl")),f.send(b)}},inDom:function(){},blank:function(){this.dom.empty(),this.table=!1},newLi:function(a,b,c,e){return c=d.formatSize(c),'<a target="_blank" href="'+(e||"")+'"><li data-file-type="'+(a||"")+'"><div class="file-filename">'+(b||"")+'</div><div class="file-type"	>'+(a||"")+'</div><div class="file-size">Size: '+(c||"")+'</div><div class="ci-spacer"></div></li></a>'},update:{filelist:function(a,b){if(a){this.currentVar=a.value=a.value||[],this.currentVarRoot=a,this.varname=b;for(var c=a.get(),d=0,e=c.length;e>d;d++)this.dom.append(this.newLi(c[d].type,c[d].filename,c[d].filesize,c[d].link))}}},getDom:function(){return this.dom}}),e});
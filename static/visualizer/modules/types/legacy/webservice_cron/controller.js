define(["modules/default/defaultcontroller"],function(a){function b(){}return b.prototype=$.extend(!0,{},a,{initimpl:function(){this.timeout=[],this.doVariables()},doVariables:function(){this.clearTimeouts();var a,b,c,d=this.module.getConfiguration().variables;if(d)for(var e=0,f=d.length;f>e;e++)a=d[e].variable,b=d[e].type,c=d[e].repeat,url=d[e].url,this.setTimeout(b,a,c,url)},clearTimeouts:function(){for(var a=0,b=this.timeout.length;b>a;a++)this.timeout[a]&&window.clearTimeout(this.timeout[a]),this.timeout[a]=!1},setTimeout:function(a,b,c,d){this.timeout[b]&&(window.clearTimeout(this.timeout[b]),this.timeout[b]=!1);var e=this;window.setTimeout(function(){e.doAjax(a,b,c,d)},1e3*c)},doAjax:function(a,b,c,d){var e=this,f=(this.module.getConfiguration().variables,{url:d,dataType:"json"});if("get"==a)f.success=function(a){CI.API.setSharedVar(b,a),e.module.view.log(!0,b)},f.method="get",f.type="get";else{f.success=function(a){CI.API.setSharedVar(b,a),e.module.view.log(!0,b)};var b=CI.Repo.get(b);if(!b)return;f.data={data:b[1]},f.method="post",f.type="post"}f.complete=function(){e.setTimeout(a,b,c,d)},f.error=function(){e.module.view.log(!1,b)},$.ajax(f)},configurationSend:{events:{},rels:{}},configurationReceive:{},moduleInformations:{moduleName:"Webservice Crontab"},doConfiguration:function(a){var b=new BI.Forms.GroupFields.Table("varcfg");a.addFieldGroup(b);var c=b.addField({type:"Text",name:"variable"});c.setTitle(new BI.Title("Variable"));var c=b.addField({type:"Combo",name:"type"});c.setTitle(new BI.Title("Type")),c.implementation.setOptions([{key:"get",title:"Fetch URL to variable"},{key:"put",title:"Push variable to URL"}]);var c=b.addField({type:"Text",name:"url"});c.setTitle(new BI.Title("URL"));var c=b.addField({type:"Text",name:"repeat"});return c.setTitle(new BI.Title("Repetition time (s)")),!0},doFillConfiguration:function(){var a=this.module.getConfiguration().variables,b=[],c=[],d=[],e=[];for(var f in a)b.push(a[f].variable),c.push(a[f].type),d.push(a[f].url),e.push(a[f].repeat);return{groups:{varcfg:[{variable:b,type:c,url:d,repeat:e}]}}},doSaveConfiguration:function(a){for(var b=a[0].varcfg[0],c=[],d=0;d<b.length;d++)c.push({variable:b[d].variable,type:b[d].type,url:b[d].url,repeat:b[d].repeat});this.module.getConfiguration().variables=c,this.doVariables()}}),b});